/*
    ChickenPaint Be
    https://github.com/satopian/ChickenPaint_Be
    by satopian
    Customized from ChickenPaint by Nicholas Sherlock.
    GNU GENERAL PUBLIC LICENSE
    Version 3, 29 June 2007
    <http://www.gnu.org/licenses/>
*/
/*
    ChickenPaint

    ChickenPaint is a translation of ChibiPaint from Java to JavaScript
    by Nicholas Sherlock / Chicken Smoothie.

    ChibiPaint is Copyright (c) 2006-2008 Marc Schefer

    ChickenPaint is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    ChickenPaint is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with ChickenPaint. If not, see <http://www.gnu.org/licenses/>.
*/
/*
    Bootstrap (https://getbootstrap.com/)
    Copyright The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
    Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)

    EventEmitter v5.2.9 - git.io/ee
    Unlicense - http://unlicense.org/
    Oliver Caldwell - https://oli.me.uk/
*/
/*
    jQuery throttle / debounce - v1.1 - 3/7/2010
    http://benalman.com/projects/jquery-throttle-debounce-plugin/

    Copyright (c) 2010 "Cowboy" Ben Alman
    Dual licensed under the MIT and GPL licenses.
    http://benalman.com/about/license/
*/
!function(){function Ha(a){return a&&a.__esModule?a.default:a}function ic(a,c,d,b){Object.defineProperty(a,c,{get:d,set:b,enumerable:!0,configurable:!0})}function ha(a){for(var c in ha.DEFAULTS)ha.DEFAULTS.hasOwnProperty(c)&&(this[c]=ha.DEFAULTS[c]);for(c in a)a.hasOwnProperty(c)&&(this[c]=a[c])}function ka(a,c,d,b){this.left=a;this.top=c;this.right=d;this.bottom=b}function sc(a,c){this.width=0|a;this.height=0|c}function Zb(a,c){var d=document.createElement("canvas");return d.width=a,d.height=c,d}
function Ed(a,c){return document.createElement("canvas").getContext("2d").createImageData(a,c)}function z(a,c){"number"==typeof a?(sc.call(this,a,c),this.imageData=Ed(this.width,this.height)):(sc.call(this,a.width,a.height),this.imageData=a);this.data=this.imageData.data}function me(a,c,d,b){var g,n=0,f=[0,0,0,0];var e=0;for(g=0;g<b&&g<d;g++){for(var l=0;l<z.BYTES_PER_PIXEL;l++)f[l]+=a[e++];n++}g=0;for(l=0;l<d;l++){if(l+b<d){e=(l+b)*z.BYTES_PER_PIXEL;for(var k=0;k<z.BYTES_PER_PIXEL;k++)f[k]+=a[e++];
n++}for(e=0;e<z.BYTES_PER_PIXEL;e++)c[g++]=Math.round(f[e]/n);if(0<=l-b){e=(l-b)*z.BYTES_PER_PIXEL;for(k=0;k<z.BYTES_PER_PIXEL;k++)f[k]-=a[e++];n--}}}function ne(a,c){if(0==(c%=4))return a;let d=Zb(0,0),b=d.getContext("2d");switch(0==c%2?(d.width=a.width,d.height=a.height):(d.width=a.height,d.height=a.width),c){case 1:b.rotate(Math.PI/2);b.drawImage(a,0,-a.height);break;case 2:b.rotate(Math.PI);b.drawImage(a,-a.width,-a.height);break;case 3:b.rotate(-Math.PI/2);b.drawImage(a,-a.width,0);break;default:return a}return d}
function Qa(a,c){Ta.call(this,a);this.layers=[];this.expanded=!0;this.blendMode=c}function Hf(a,c){return a+c}function ya(a,c,d){sc.call(this,a,c);this.createBitmap(a,c,d)}function oe(a,c,d,b){var g,n=0,f=0;for(g=0;g<b&&g<d;g++)f+=a[g],n++;g=0;for(let e=0;e<d;e++)e+b<d&&(f+=a[e+b],n++),c[g++]=Math.round(f/n),0<=e-b&&(f-=a[e-b],n--)}function L(){}function Ta(a){this.name=a||"";this.parent=null;this.lockAlpha=!1;this.alpha=100;this.visible=!0;this.blendMode=L.LM_NORMAL;this.mask=null;this.maskVisible=
this.maskLinked=!0;this.maskThumbnail=null;this.useLegacyMultiply=!1}function qa(a,c,d){Ta.call(this,d);0<a&&0<c?this.image=new z(a,c):this.image=null;this.clip=!1;this.imageThumbnail=null}function Pc(a,c,d){d?(this.isGroup=d instanceof Qa,this.image=d.image,this.mask=d.getEffectiveMask(),this.layer=d,this.blendMode=d.blendMode,this.alpha=d.alpha,this.visible=d.visible):(this.isGroup=!0,this.image=null,this.mask=null,this.layer=null,this.blendMode=L.LM_PASSTHROUGH,this.alpha=100,this.visible=!0);
this.dirtyRect=new ka(0,0,a,c);this.layers=[];this.parent=null;this.clip=!1}function Fd(a,c,d,b){function g(){return 0<k.length?k.pop():new z(c,d)}function n(m){if(0==m.layers.length)return null;if(1==m.layers.length&&(null==m.mask||null==m.layers[0].mask)){let q=m.layers[0];return q.alpha=Math.round(m.alpha*q.alpha/100),m.blendMode!=L.LM_PASSTHROUGH&&(q.blendMode=m.blendMode),q.mask=m.mask||q.mask,m.layer&&h.set(m.layer,q),q}return m.blendMode==L.LM_PASSTHROUGH&&100==m.alpha&&null==m.mask?m.layers:
(m.image=g(),m)}function f(m){let q=new Pc(c,d,m);return h.set(m,q),q}function e(m,q){m&&(m.dirtyRect.union(q),e(m.parent,q))}let l,k=[],h=new Map;this.invalidateLayerRect=function(m,q){e(h.get(m),q)};this.buildTree=function(){if(!l){if(l=function r(q){if(0==q.getEffectiveAlpha())return null;let t=f(q);for(var u=0;u<q.layers.length;u++){let A=q.layers[u];var y=q.layers[u+1];if(A instanceof qa&&y&&y.clip){y=new Pc(c,d,null);y.blendMode=A.blendMode;y.alpha=100;y.clip=!0;y.addChildren(f(A));for(u+=1;u<
q.layers.length;u++)if(q.layers[u].clip)0<q.layers[u].getEffectiveAlpha()&&y.addChildren(f(q.layers[u]));else break;0<A.getEffectiveAlpha()&&t.addChildren(n(y));--u}else A instanceof Qa?t.addChildren(r(A)):0<A.getEffectiveAlpha()&&t.addChildren(f(A))}return n(t)}(a)){if(Array.isArray(l)||b&&(100>l.alpha||l.mask)){let q=l;(l=new Pc(c,d)).blendMode=Array.isArray(q)?L.LM_NORMAL:q.blendMode;l.alpha=100;l.image=g();l.addChildren(q)}}else(l=new Pc(c,d,{image:g(),blendMode:L.LM_NORMAL,alpha:100,getEffectiveMask:()=>
null,visible:!0})).image.clearAll(0);k=[]}};this.resetTree=function(){l&&(!function r(q){if(q.isGroup)for(let t of(q.image&&k.push(q.image),q.layers))r(t)}(l),l=null,h.clear())};this.layerPropertyChanged=function(m,q){let r=h.get(m);r&&r.visible==m.visible&&r.alpha==m.alpha&&null==r.mask==(null==m.getEffectiveMask())&&r.blendMode==L.LM_PASSTHROUGH==(m.blendMode==L.LM_PASSTHROUGH)&&"clip"!==q?(r.blendMode=m.blendMode,e(r,new ka(0,0,c,d))):this.resetTree()};this.blendTree=function(){return function r(q){if(!q||
!q.isGroup)return q;let t=q.dirtyRect;var u=!0,y=!0;if(q.blendMode==L.LM_PASSTHROUGH&&q.parent&&t.union(q.parent.dirtyRect),t.isEmpty())return q;if(q.blendMode==L.LM_PASSTHROUGH&&q.parent){u=!1;var A=q.image;var F=q.parent.image;t.getWidth()==A.width&&t.getHeight()==A.height?A.copyPixelsFrom(F):L.replaceOntoFusionWithOpaqueLayer(A,F,100,t)}for(A=0;A<q.layers.length;A++){var D=r(q.layers[A]);if(u){u=q.image;F=D.image;var G=D.alpha,E=t;D=D.mask;if(100!=G||D||E.getWidth()!=u.width||E.getHeight()!=u.height){let P=
"replaceOntoFusionWith";100==G?P+="OpaqueLayer":P+="TransparentLayer";D&&(P+="Masked");L[P](u,F,G,E,D)}else u.copyPixelsFrom(F);!0;u=!1}else y=y&&q.image.hasAlphaInRect(t),L.fuseImageOntoImage(q.image,y,D.image,D.alpha,D.blendMode,t,D.mask)}q.clip&&(y=q.layers[0],100>y.alpha?y.mask?L.replaceAlphaOntoFusionWithTransparentLayerMasked(q.image,y.image,y.alpha,t,y.mask):L.replaceAlphaOntoFusionWithTransparentLayer(q.image,y.image,y.alpha,t):y.mask?L.replaceAlphaOntoFusionWithOpaqueLayerMasked(q.image,
y.image,100,t,y.mask):L.replaceAlphaOntoFusionWithOpaqueLayer(q.image,y.image,100,t));return q.dirtyRect.makeEmpty(),q}(l)}}function If(){function a(h){if(null!=g&&h.curSize==n&&h.curSqueeze==f&&h.curAngle==e&&h.tip==l)return g;switch(h.tip){case ha.TIP_ROUND_AIRBRUSH:!function(m,q){let r=Math.ceil(q.curSize),t=r/2,u=q.curSize/2*(q.curSize/2),y=1+10*q.curSqueeze,A=Math.cos(q.curAngle);q=Math.sin(q.curAngle);let F=0;for(let E=0;E<r;E++)for(let P=0;P<r;P++){var D=P+.5-t;let N=E+.5-t;var G=(D*A-N*q)*
y;D=N*A+D*q;G=G*G+D*D;G<=u?m[F++]=~~(255*(1-G/u)):m[F++]=0}}(c,h);break;case ha.TIP_ROUND_AA:!function(m,q){let r=Math.ceil(q.curSize),t=r/2,u=q.curSize/2*(q.curSize/2),y=(q.curSize-2)/2*((q.curSize-2)/2),A=(q.curSize+2)/2*((q.curSize+2)/2),F=1+10*q.curSqueeze,D=Math.cos(q.curAngle);q=Math.sin(q.curAngle);let G=0;for(let P=0;P<r;P++)for(let N=0;N<r;N++){let O=N+.5-t,U=P+.5-t,da=(O*D-U*q)*F,la=U*D+O*q;var E=da*da+la*la;if(E<=y)m[G++]=255;else if(E>A)m[G++]=0;else{E=0;for(let J=0;4>J;J++)for(let ea=
0;4>ea;ea++)(da=((O=N+.25*ea-t)*D-(U=P+.25*J-t)*q)*F)*da+(la=U*D+O*q)*la<=u&&(E+=1);m[G++]=Math.min(16*E,255)}}}(c,h);break;case ha.TIP_ROUND_PIXEL:!function(m,q){let r=Math.ceil(q.curSize),t=r/2,u=q.curSize/2*(q.curSize/2),y=1+10*q.curSqueeze,A=Math.cos(q.curAngle);q=Math.sin(q.curAngle);let F=0;for(let G=0;G<r;G++)for(let E=0;E<r;E++){var D=E+.5-t;let P=G+.5-t,N=(D*A-P*q)*y;D=P*A+D*q;N*N+D*D<=u?m[F++]=255:m[F++]=0}}(c,h);break;case ha.TIP_SQUARE_AA:!function(m,q){let r=Math.ceil(q.curSize),t=r/
2;var u=q.curSize*Math.sin(Math.PI/4);let y=u/2/(1+10*q.curSqueeze);u/=2;let A=y-1,F=u-1,D=y+1,G=u+1,E=Math.cos(q.curAngle);q=Math.sin(q.curAngle);let P=0;for(let O=0;O<r;O++)for(let U=0;U<r;U++){var N=U+.5-t;let da=O+.5-t,la=Math.abs(N*E-da*q);N=Math.abs(da*E+N*q);if(la<=A&&N<=F)m[P++]=255;else if(la>D||N>G)m[P++]=0;else{let J=0;for(let ea=0;4>ea;ea++)for(let Z=0;4>Z;Z++)la=Math.abs((N=U+.25*Z-t)*E-(da=O+.25*ea-t)*q),N=Math.abs(da*E+N*q),la<=y&&N<=u&&J++;m[P++]=Math.min(16*J,255)}}}(c,h);break;case ha.TIP_SQUARE_PIXEL:!function(m,
q){let r=Math.ceil(q.curSize),t=r/2;var u=q.curSize*Math.sin(Math.PI/4);let y=u/2/(1+10*q.curSqueeze);u/=2;let A=Math.cos(q.curAngle);q=Math.sin(q.curAngle);let F=0;for(let D=0;D<r;D++)for(let G=0;G<r;G++){let E=G+.5-t,P=D+.5-t,N=Math.abs(P*A+E*q);Math.abs(E*A-P*q)<=y&&N<=u?m[F++]=255:m[F++]=0}}(c,h)}return g=c,n=h.curSize,l=h.tip,f=h.curSqueeze,e=h.curAngle,c}let c=new Uint8Array(160801),d=new Uint8Array(161604),b=[new Float32Array(402),new Float32Array(402)],g=null,n,f,e,l,k=this;this.getDab=function(h,
m,q){let r={alpha:q.curAlpha,width:Math.ceil(q.curSize),height:Math.ceil(q.curSize)},t=q.isAA&&q.tip!=ha.TIP_ROUND_PIXEL;t&&(r.width++,r.height++);h=h-r.width/2+.5;m=m-r.height/2+.5;let u=Math.floor(h),y=Math.floor(m);return t?r.brush=function(A,F,D){var G=a(A);let E=Math.ceil(A.curSize);A=Math.ceil(A.curSize)+1;let P=(1-F)*(1-D),N=F*(1-D),O=F*D,U=(1-F)*D,da=0;F=0;D=b[0];let la=b[1];D.fill(0);for(let ea=0;ea<E;ea++){var J=0;for(la[0]=0;J<E;J++,da++,F++){let Z=G[da];d[F]=D[J]+Z*P+.5|0;D[J+1]+=Z*N;
la[J]+=Z*U;la[J+1]=Z*O}d[F++]=D[J]+.5|0;J=D;D=la;la=J}for(G=0;G<A;G++,F++)d[F]=D[G]+.5|0;return d}(q,h-u,m-y):r.brush=a(q),r.x=u,r.y=y,0<q.texture&&null!=this.texture&&(r.brush==c&&(d.set(c),r.brush=d),!function(A,F){F=Math.floor(255*F);let D=k.texture,G=A.x%D.width,E=A.y%D.height,P=0,N,O;0>G&&(G+=D.width);0>E&&(E+=D.height);for(let U=0;U<A.height;U++){N=E*D.width+G;O=E*D.width+D.width;for(let da=0;da<A.width;da++)A.brush[P]=~~(A.brush[P]*(D.data[N]*F/255^255)/255),P++,++N==O&&(N-=D.width);++E==D.height&&
(E=0)}}(r,q.texture)),r};this.setTexture=function(h){this.texture=h}}function Gd(a,c,d){this.bmp=a;this.x=c;this.y=d}function ed(a){if(0==a.saturation)return a.value<<16|a.value<<8|a.value;var c=a.hue/60;c-=Math.floor(c);var d=a.saturation/255,b=~~(a.value*(1-d)),g=~~(a.value*(1-d*c));c=~~(a.value*(1-d*(1-c)));switch(~~(a.hue/60)){case 0:return a.value<<16|c<<8|b;case 1:return g<<16|a.value<<8|b;case 2:return b<<16|a.value<<8|c;case 3:return b<<16|g<<8|a.value;case 4:return c<<16|b<<8|a.value;case 5:return a.value<<
16|b<<8|g;default:return 0}}function Za(a){this.value=this.saturation=this.hue=this.rgb=0;this.setRgb(a||0)}function Jf(){var a,c=!1;this.nextGaussian=function(){if(c)return c=!1,a;do var d=(b=2*Math.random()-1)*b+(g=2*Math.random()-1)*g;while(1<=d||0==d);var b,g;d=Math.sqrt(-2*Math.log(d)/d);return a=g*d,c=!0,b*d}}function ib(){this.setToIdentity()}function Hd(a){for(var c=["imageSmoothingEnabled","mozImageSmoothingEnabled","webkitImageSmoothingEnabled","msImageSmoothingEnabled"],d=0;d<c.length;d++)if(c[d]in
a)return c[d];return null}function Id(a,c){var d=Hd(a);d&&(a[d]=c)}function ec(a,c,d){this.r=a;this.g=c;this.b=d}function pe(a){let c=0;for(let d=0;d<a.length;d++)c+=a[d];return c/a.length}function qe(a){let c=new ec(0,0,0);for(let d=0;d<a.length;d++){let b=a[d];c.r+=b.r;c.g+=b.g;c.b+=b.b}return c.r/=a.length,c.g/=a.length,c.b/=a.length,c}function re(a,c){let d=a.data;if(0<c.left)for(var b=c.top;b<c.bottom;b++){var g=b*a.width,n=g;g=d[g+c.left];for(var f=0;f<c.left;f++,n++)d[n]=g}if(c.right<a.width)for(b=
c.top;b<c.bottom;b++)for(n=b*a.width+c.right,g=d[n-1],f=c.right;f<a.width;f++,n++)d[n]=g;b=0;for(n=0;n<c.top;n++)for(g=c.top*a.width,f=0;f<a.width;f++,g++,b++)d[b]=d[g];b=c.bottom*a.width;for(n=c.bottom;n<a.width;n++)for(g=(c.bottom-1)*a.width,f=0;f<a.width;f++,g++,b++)d[b]=d[g]}function fd(a,c){return a+c}function se(a){return a?a.width*a.height*4:0}function Pb(a,c){function d(x){Fb=!1;(0<$b.size||0<sb.size)&&(x?e():Gb||setTimeout(e,1E3))}function b(){Q.emitEvent("changeSelection",[])}function g(x){Q.emitEvent("updateRegion",
[x])}function n(){Q.emitEvent("changeStructure");Ca.resetTree();u();g(Q.getBounds())}function f(x,H,w){Q.emitEvent("changeLayer",[x]);w||(Ca.layerPropertyChanged(x,H),g(Q.getBounds()))}function e(){for(let x of $b)x.rebuildImageThumbnail(),Q.emitEvent("changeLayerImageThumb",[x]);for(let x of sb)x.rebuildMaskThumbnail(),Q.emitEvent("changeLayerMaskThumb",[x]);$b.clear();Gb&&(clearTimeout(Gb),Gb=null)}function l(x,H,w,C){Array.isArray(x)||(x=[x]);x.forEach(M=>Ca.invalidateLayerRect(M,H));let I=!1;
if(w)for(let M of(jb.union(H),x))M instanceof qa&&($b.add(M),I=!0);C&&(ta.union(H),x.forEach(M=>{sb.add(M);ma&&ma.layer==M&&ma.invalidateRect(H)}),I=!0);I&&(Gb&&(clearTimeout(Gb),Gb=null),Fb||(Gb=setTimeout(e,1E3)));g(H)}function k(x,H){l(x,H,!Ba,Ba)}function h(){return Ba?V.mask:V.image}function m(){if(!na.isEmpty()){if(Ba){var x=V.mask;Ia.brushMode==ha.BRUSH_MODE_ERASE?Ja[ha.BRUSH_MODE_PAINT].mergeOntoMask(x,sa,4278190080):Ja[Ia.brushMode].mergeOntoMask(x,sa,255&Xb)}else{x=V.image;let H=V.getLockAlpha();
Ia.brushMode==ha.BRUSH_MODE_ERASE&&H?Ja[ha.BRUSH_MODE_PAINT].mergeOntoImage(x,pb,16777215):Ja[Ia.brushMode].mergeOntoImage(x,pb,Xb);H&&x.copyAlphaFrom(pb,na)}na.makeEmpty()}}function q(){V instanceof qa&&!jb.isEmpty()&&(pb.copyBitmapRect(V.image,jb.left,jb.top,jb),jb.makeEmpty())}function r(){V.mask&&!ta.isEmpty()&&(sa.copyBitmapRect(V.mask,ta.left,ta.top,ta),ta.makeEmpty())}function t(){Ba?r():q()}function u(){let x=Q.getBounds();jb.set(x);ta.set(x)}function y(x){Q.setHasUnsavedChanges(!0);0<Wa.length&&
(Wa=[]);0!==bb.length&&bb[bb.length-1].merge(x)?bb[bb.length-1].noChange()&&bb.pop():(30<=bb.length&&bb.shift(),Q.compactUndo(),bb.push(x))}function A(x,H){x||H||(x=!Ba,H=Ba);let w=Ma.clone(),C=x?pb.copyRectXOR(V.image,w):null,I=H?sa.copyRectXOR(V.mask,w):null;this.layer=V;Ma.makeEmpty();this.redo=this.undo=function(){C&&this.layer.image.setRectXOR(C,w);I&&this.layer.mask.setRectXOR(I,w);l(this.layer,w,null!=C,null!=I)};this.getMemoryUsed=function(M,X){return(C?C.length:0)+(I?I.length:0)}}function F(x){let H=
x.maskLinked,w=x.maskVisible;this.undo=function(){x.setMask(null);x.maskLinked=H;x.maskVisible=w;n();Q.setActiveLayer(x,!1)};this.redo=function(){let C=new ya(Q.width,Q.height,8);C.clearAll(255);x.maskLinked=!0;x.maskVisible=!0;x.setMask(C);n();Q.setActiveLayer(x,!0)};this.redo()}function D(x,H){let w=x.mask,C,I=!1;C=H&&x instanceof qa?x.image.clone():null;I=V==x&&Ba;this.undo=function(){x.setMask(w);C&&(x.image.copyPixelsFrom(C),l(x,x.image.getBounds(),!0,!1));I&&Q.setActiveLayer(x,!0);n()};this.redo=
function(){C&&(L.multiplyAlphaByMask(x.image,100,x.mask),l(x,Q.getBounds(),!0,!1));I&&Q.setActiveLayer(x,!1);x.setMask(null);n()};this.redo()}function G(x,H,w){let C=w instanceof qa&&w.clip,I=x.layers[H],M=I instanceof qa&&I.clip,X=Ba;this.undo=function(){x.removeLayer(w);let W=x.layers[H-1]||x.layers[0]||x;I instanceof qa&&(I.clip=M);w instanceof qa&&(w.clip=C);n();Q.setActiveLayer(W,X)};this.redo=function(){x.insertLayer(H,w);M&&(w instanceof qa?w.clip=!0:I.clip=!1);n();Q.setActiveLayer(w,!1)};
this.redo()}function E(x){let H=x.clone(),w=Ba;this.undo=function(){H.parent.removeLayer(H);n();Q.setActiveLayer(x,w)};this.redo=function(){let C=x.name;C.endsWith(" Copy")||(C+=" Copy");H.name=C;x.parent.insertLayer(x.parent.indexOf(x)+1,H);n();Q.setActiveLayer(H,!1)};this.redo()}function P(x){let H=x.parent,w=H.indexOf(x),C=Ba,I=0;if(x instanceof qa&&!x.clip)for(let M=w+1;M<H.layers.length;M++)if(H.layers[M]instanceof qa&&H.layers[M].clip)I++;else break;this.undo=function(){H.insertLayer(w,x);for(let M=
0;M<I;M++)H.layers[M+w+1].clip=!0;n();Q.setActiveLayer(x,C)};this.redo=function(){var M;for(M=0;M<I;M++)H.layers[M+w+1].clip=!1;H.removeLayerAtIndex(w);M=0==H.layers.length?x.parent:H.layers[Math.max(w-1,0)];n();Q.setActiveLayer(M,!1)};this.getMemoryUsed=function(M,X){return M?0:x.getMemoryUsed()};this.redo()}function N(x){let H=x.parent.indexOf(x),w=Ba,C=new qa(Q.width,Q.height,"");this.undo=function(){x.parent.setLayerAtIndex(H,x);n();Q.setActiveLayer(x,w)};this.redo=function(){x.parent.setLayerAtIndex(H,
C);n();Q.setActiveLayer(C,!1)};this.getMemoryUsed=function(M,X){return M?0:x.getMemoryUsed()};var I=new Fd(x,Q.width,Q.height,!1);I.buildTree();I=I.blendTree();C.name=x.name;C.alpha=I.alpha;C.image=I.image;C.blendMode=I.blendMode;C.mask=I.mask;C.blendMode==L.LM_PASSTHROUGH&&(C.blendMode=L.LM_NORMAL);this.redo()}function O(x){let H=x.parent,w=H.layers[H.indexOf(x)-1],C=new qa(Q.width,Q.height,""),I=Ba;this.undo=function(){let M=H.indexOf(C);H.removeLayerAtIndex(M);H.insertLayer(M,x);H.insertLayer(M,
w);n();Q.setActiveLayer(x,I)};this.redo=function(){if(w.clip||!x.clip)C.copyFrom(w),0<x.getEffectiveAlpha()&&(C.mask?L.multiplyAlphaByMask(C.image,C.alpha,C.mask):L.multiplyAlphaBy(C.image,C.alpha),L.fuseImageOntoImage(C.image,!0,x.image,x.alpha,x.blendMode,x.getBounds(),x.mask));else{var M=new Qa;M.layers=[w,x];M.parent=null;M.name="Temporary Group";M=new Fd(M,Q.width,Q.height,!1);M.buildTree();C.image=M.blendTree().image}C.name=w.name;C.alpha=100;C.blendMode=w.blendMode;C.mask=null;M=H.indexOf(w);
H.removeLayerAtIndex(M);H.removeLayerAtIndex(M);H.insertLayer(M,C);n();Q.setActiveLayer(C,!1)};this.getMemoryUsed=function(M,X){return M?0:x.getMemoryUsed()+C.getMemoryUsed()};this.redo()}function U(){let x=Q.getActiveLayer(),H=Xa.layers.slice(0),w=new qa(Q.width,Q.height,"");this.undo=function(){Xa.layers=H.slice(0);n();Q.setActiveLayer(x,!1)};this.redo=function(){let C=Q.fusionLayers();w.copyImageFrom(C);Xa.clearLayers();w.setName(Q.getDefaultLayerName(!1));Xa.addLayer(w);n();Q.setActiveLayer(w,
!1)};this.getMemoryUsed=function(C,I){return H.map(M=>M.getMemoryUsed()).reduce(fd,0)};this.redo()}function da(x,H,w){let C=x.parent,I=x.parent.indexOf(x),M=Ba,X=C.layers[C.indexOf(x)+1],W=H.layers[w],ra=x instanceof qa&&x.clip,Ka=!!ra&&x.getClippingBase(),db=0,tb=0;if(x instanceof qa&&!x.clip)for(var xb=I+1;xb<C.layers.length;xb++)if(C.layers[xb]instanceof qa&&C.layers[xb].clip)db++;else break;else if(x instanceof Qa)for(xb=w;xb<H.layers.length;xb++)if(H.layers[xb]instanceof qa&&H.layers[xb].clip)tb++;
else break;this.undo=function(){x.parent.removeLayer(x);var Ya=X?C.indexOf(X):C.layers.length;C.insertLayer(Ya,x);x instanceof qa&&(x.clip=ra);for(Ya=0;Ya<db;Ya++)C.layers[Ya+I+1].clip=!0;for(Ya=0;Ya<tb;Ya++)H.layers[Ya+w].clip=!0;n();Q.setActiveLayer(x,M)};this.redo=function(){for(var Ya=0;Ya<db;Ya++)C.layers[Ya+I+1].clip=!1;x.parent.removeLayer(x);Ya=W?H.indexOf(W):H.layers.length;H.insertLayer(Ya,x);for(var ia=0;ia<tb;ia++)H.layers[ia+Ya+1].clip=!1;x instanceof qa&&(x.clip&&x.getClippingBase()!=
Ka&&(x.clip=!1),W instanceof qa&&W.clip&&(x.clip=!0));for(ia=0;ia<tb;ia++)H.layers[ia+Ya+1].clip=!1;n();Q.setActiveLayer(x,!1)};this.redo()}function la(x,H){let w=x.substring(0,1).toUpperCase()+x.substring(1),C=function(I,M){Array.isArray(I)||(I=[I]);this.layers=I;this.from=this.layers.map(X=>X["get"+w]());this.to=M;this.redo()};return C.prototype=Object.create(Mb.prototype),C.prototype.constructor=C,C.prototype.undo=function(){this.layers.forEach((I,M)=>I["set"+w](this.from[M]));this.layers.forEach(I=>
f(I,x,!H))},C.prototype.redo=function(){this.layers.forEach(I=>I["set"+w](this.to));this.layers.forEach(I=>f(I,x,!H))},C.prototype.merge=function(I){var M;if(M=I instanceof C)a:{M=this.layers;var X=I.layers;if(M.length!=X.length)M=!1;else{for(let W=0;W<M.length;W++)if(M[W]!=X[W]){M=!1;break a}M=!0}}return!!M&&(this.to=I.to,!0)},C.prototype.noChange=function(){for(let I=0;I<this.from.length;I++)if(this.from[I]!=this.to)return!1;return!0},C}function J(x,H){x=x.clone();H=H.clone();this.undo=function(){Q.setSelection(x);
g(Q.getBounds())};this.redo=function(){Q.setSelection(H);g(Q.getBounds())};this.noChange=function(){return x.equals(H)}}function ea(x,H,w){let C=H?x.mask:x.image,I=C.cloneRect(w);w=w.clone();this.undo=function(){C.copyBitmapRect(I,w.left,w.top,I.getBounds());Q.setActiveLayer(x,H);Q.setSelection(w);l(x,w,!H,H)};this.redo=function(){H?C.clearRect(w,0):C.clearRect(w,16777215);Bb=new Gd(I,w.left,w.top);Q.setActiveLayer(x,H);Q.emptySelection();l(x,w,!H,H)};this.getMemoryUsed=function(M,X){return I==X?
0:I.getMemorySize()};this.redo()}function Z(x){let H=Q.getSelection(),w=Ba,C=new qa(Q.width,Q.height,Q.getDefaultLayerName(!1)),I=V,M=I.parent;this.undo=function(){M.removeLayer(C);Q.setSelection(H);n();Q.setActiveLayer(I,w)};this.redo=function(){var X=M.indexOf(I);let W=x.bmp.getBounds(),ra,Ka;(M.insertLayer(X+1,C),W.isInside(Q.getBounds())?(ra=x.x,Ka=x.y):(ra=(Q.width-x.bmp.width)/2|0,Ka=(Q.height-x.bmp.height)/2|0),x.bmp instanceof ya)?(X=new z(x.bmp.width,x.bmp.height),X.copyPixelsFromGreyscale(x.bmp),
C.image.copyBitmapRect(X,ra,Ka,W)):C.image.copyBitmapRect(x.bmp,ra,Ka,W);Q.emptySelection();n();Q.setActiveLayer(C,!1)};this.getMemoryUsed=function(X,W){return x.bmp==W?0:x.bmp.getMemorySize()};this.redo()}a|=0;c|=0;let Xa=new Qa("Root",L.LM_NORMAL),Ca=new Fd(Xa,a,c,!0),pb=new z(a,c),jb=new ka(0,0,a,c),sa=new ya(a,c,8),ta=new ka(0,0,a,c),T=new ya(a,c,32),na=new ka(0,0,0,0),ba=new If,Q=this,Ja=[],V=Xa,Ba=!1,ma=null,Ma=new ka(0,0,0,0),yb=!1,Cb=new ka(0,0,0,0),vb=null,eb=new Jf,lb=null,Bb=null,bb=[],
Wa=[],Ia=null,Ub=0,$a=0,wb=0,zb=!1,Fb=!1,sb=new Set,$b=new Set,Gb=null,Xb=0,Yb="smooth";this.getLayersRoot=function(){return Xa};this.getSelectionAutoSelect=function(){return Cb.isEmpty()?this.getBounds():this.getSelection()};this.getSelection=function(){return Cb.clone()};this.setHasUnsavedChanges=function(x){x!=yb&&(yb=x,this.emitEvent("unsavedChanges",[x]))};this.getHasUnsavedChanges=function(){return yb};this.isAddLayerMaskAllowed=function(){return!V.mask};this.addLayerMask=function(){this.isAddLayerMaskAllowed()&&
y(new F(V))};this.isRemoveLayerMaskAllowed=function(){return null!==V.mask};this.removeLayerMask=function(){this.isRemoveLayerMaskAllowed()&&y(new D(V,!1))};this.isApplyLayerMaskAllowed=function(){return null!==V.mask&&V instanceof qa};this.applyLayerMask=function(x){this.isApplyLayerMaskAllowed()&&y(new D(V,!0))};this.addLayer=function(x){let H,w;if(V instanceof Qa&&V.expanded?(H=V,w=V.layers.length):w=(H=V.parent).layers.indexOf(V)+1,"group"===x){for(;H.layers[w]instanceof qa&&H.layers[w].clip;)w++;
x=new Qa(this.getDefaultLayerName(!0),L.LM_PASSTHROUGH)}else(x=new qa(this.width,this.height,this.getDefaultLayerName(!1))).image.clearAll(16777215);return y(new G(H,w,x)),x};this.addLayerObject=function(x,H){x.addLayer(H);x==Xa&&1==Xa.layers.length&&(V=H);n()};this.addLayerGroupObject=function(x,H,w){let C=[];for(let I=0;I<w;I++)C.unshift(x.layers.pop());C.forEach(I=>H.addLayer(I));this.addLayerObject(x,H)};this.isRemoveLayerAllowed=function(){return V instanceof qa?Xa.getLinearizedLayerList(!1).some(x=>
x instanceof qa&&x!=V):V instanceof Qa&&Xa.getLinearizedLayerList(!1).some(x=>x instanceof qa&&!x.hasAncestor(V))};this.removeLayer=function(){return!!this.isRemoveLayerAllowed()&&(y(new P(V)),!0)};this.duplicateLayer=function(){y(new E(V))};this.isMergeDownAllowed=function(){let x=V.parent.indexOf(V);return 0<x&&V instanceof qa&&V.parent.layers[x-1]instanceof qa};this.mergeDown=function(){this.isMergeDownAllowed()&&y(new O(V))};this.isMergeGroupAllowed=function(){return V instanceof Qa&&0<V.getEffectiveAlpha()};
this.mergeGroup=function(){this.isMergeGroupAllowed()&&y(new N(V))};this.isMergeAllLayersAllowed=function(){return 1<Xa.getLinearizedLayerList(!1).length};this.mergeAllLayers=function(){this.isMergeAllLayersAllowed()&&y(new U)};this.relocateLayer=function(x,H,w){x&&H&&x!=H&&!H.hasAncestor(x)&&y(new da(x,H,w))};this.setLayerVisibility=function(x,H){let w=[];if(x.ancestorsAreVisible())x.visible!=H&&y(new tc(x,H));else{for(;null!=x;x=x.parent)x.visible||w.push(x);y(new tc(w,!0))}};this.expandLayerGroup=
function(x,H){x.expanded!=H&&(x.expanded=H,!H&&V.hasAncestor(x)&&this.setActiveLayer(x,!1),f(x,"expanded",!0))};this.setLayerAlpha=function(x){V.getAlpha()!=x&&y(new fc(V,x))};this.setLayerMaskLinked=function(x){V.maskLinked!=x&&y(new Ea(V,x))};this.setLayerMaskVisible=function(x,H){x.maskVisible!=H&&y(new Qb(x,H))};this.setLayerBlendMode=function(x){V.getBlendMode()!=x&&(x!=L.LM_PASSTHROUGH||V instanceof Qa)&&y(new uc(V,x))};this.setLayerName=function(x,H){x.getName()!=H&&y(new ac(x,H))};this.paintDab=
function(x,H,w){Ia.applyPressure(w);0<Ia.scattering&&(x+=eb.nextGaussian()*Ia.curScattering/4,H+=eb.nextGaussian()*Ia.curScattering/4);w=Ja[Ia.brushMode];x=ba.getDab(x,H,Ia);H=new ka(0,0,x.width,x.height);let C=new ka(0,0,x.width,x.height);if(C.translate(x.x,x.y),Q.getBounds().clipSourceDest(H,C),!C.isEmpty()){Ma.union(C);var I=Ba?V.mask:V.image;w.paintDab(I,C,zb&&!Ba?vb:I,Ia,H,x,Xb);!Ba&&w.noMergePhase&&V.getLockAlpha()&&I.copyAlphaFrom(pb,C);w.wantsOutputAsInput&&(m(),zb&&!Ba&&Q.fusionLayers());
k(V,C)}};this.getDefaultLayerName=function(x){let H=x?"Group ":"Layer ";x=x?/^Group [0-9]+$/:/^Layer [0-9]+$/;let w=0,C=Xa.getLinearizedLayerList(!1);for(let I=0;I<C.length;I++){let M=C[I];x.test(M.name)&&(w=Math.max(w,parseInt(M.name.substring(H.length),10)))}return H+(w+1)};this.addBackgroundLayer=function(){let x=new qa(Q.width,Q.height,this.getDefaultLayerName(!1));x.image.clearAll(4294967295);this.addLayerObject(this.getLayersRoot(),x)};this.addDefaultLayer=function(){let x=new qa(Q.width,Q.height,
this.getDefaultLayerName(!1));x.image.clearAll(16777215);this.addLayerObject(this.getLayersRoot(),x);this.setActiveLayer(x,!1)};this.fusionLayers=function(){m();Ca.buildTree();return vb=Ca.blendTree().image};this.upgradeMultiplyLayers=function(x){let H=this.getLayersRoot().getLinearizedLayerList(!1,[]),w=-1;for(var C=0;C<H.length;C++){var I=H[C];if(!(I instanceof qa)||I.mask||I.blendMode>L.LM_LAST_CHIBIPAINT)throw Error("Bad layer type during multiply upgrade");I.blendMode===L.LM_MULTIPLY&&(w=C)}if(-1!==
w){C=new z(this.width,this.height);let M=I=!0,X=this.getBounds();C.clearAll(X,16777215);for(let W=0;W<=w;W++){let ra=H[W];M||(I=I&&C.hasAlphaInRect(X));ra.blendMode===L.LM_MULTIPLY&&("bake"===x?!I&&0<ra.getEffectiveAlpha()&&(100===ra.alpha?L.upgradeMultiplyOfOpaqueLayer(C,ra.image,100,X):L.upgradeMultiplyOfTransparentLayer(C,ra.image,ra.alpha,X),ra.setBlendMode(L.LM_MULTIPLY2)):I&&ra.setBlendMode(L.LM_MULTIPLY2));0<ra.getEffectiveAlpha()&&(M=!1,L.fuseImageOntoImage(C,I,ra.image,ra.alpha,ra.blendMode,
X,null))}}};this.isCreateClippingMaskAllowed=function(){var x=V.parent.indexOf(V);x=V.parent.layers[x-1];return V instanceof qa&&!V.clip&&x instanceof qa};this.createClippingMask=function(){this.isCreateClippingMaskAllowed()&&y(new ca(V,!0))};this.isReleaseClippingMaskAllowed=function(){return V instanceof qa&&V.clip};this.releaseClippingMask=function(){this.isReleaseClippingMaskAllowed()&&y(new ca(V,!1))};this.setActiveLayer=function(x,H){if(x){let w=(H=x.mask&&H)!=Ba;if(V!=x||w){let C=V;V=x;Ba=
H;u();this.emitEvent("changeActiveLayer",[C,x,Ba]);w&&this.emitEvent("editModeChanged",[Ba?Pb.EDITING_MODE_MASK:Pb.EDITING_MODE_IMAGE]);ma&&ma.layer==C&&(H?ma.setLayer(x):this.closeMaskView())}}};this.closeMaskView=function(){ma.close();ma=null};this.toggleMaskView=function(){return null!=ma&&ma.isOpen()?this.closeMaskView():ma=V.mask?new Kf(V,m):null,ma};this.selectTopmostVisibleLayer=function(){let x=Xa.getLinearizedLayerList(!1);for(var H=x.length-1;0<=H;H--)if(x[H]instanceof qa&&0<x[H].getEffectiveAlpha()){this.setActiveLayer(x[H],
!1);return}for(H=x.length-1;0<=H;H--)if(x[H]instanceof qa){this.setActiveLayer(x[H],!1);return}this.setActiveLayer(x[x.length-1],!1)};this.getActiveLayer=function(){return V};this.isEditingMask=function(){return Ba};this.isActiveLayerDrawable=function(){return Ba&&V.mask||!Ba&&V instanceof qa};this.getUndoMemoryUsed=function(){let x=0;for(let H of Wa)x+=H.getMemoryUsed(!0,null);for(let H of bb)x+=H.getMemoryUsed(!1,null);return x};this.isUndoAllowed=function(){return 0<bb.length};this.isRedoAllowed=
function(){return 0<Wa.length};this.undo=function(){if(this.isUndoAllowed()){this.setHasUnsavedChanges(!0);var x=bb.pop();x.undo();Wa.push(x)}};this.redo=function(){if(this.isRedoAllowed()){this.setHasUnsavedChanges(!0);var x=Wa.pop();x.redo();bb.push(x)}};this.performIdleTasks=function(){t();m();Ca.buildTree()};this.compactUndo=function(){0<bb.length&&bb[bb.length-1].compact()};this.clearHistory=function(){bb=[];Wa=[]};this.colorPicker=function(x,H){return Ba&&V.mask?Za.greyToRGB(V.mask.getPixel(~~x,
~~H)):16777215&vb.getPixel(~~x,~~H)};this.setSelection=function(x){Cb.set(x);Cb.roundNearest();Cb.clipTo(this.getBounds())};this.emptySelection=function(){Cb.makeEmpty()};this.floodFill=function(x,H){let w=h();w&&(t(),Ma=this.getBounds(),w.floodFill(~~x,~~H,4278190080|Xb),y(new A),k(V,this.getBounds()))};this.gradientFill=function(x,H,w,C,I){let M=this.getSelectionAutoSelect(),X=h();X&&(t(),Ma=M.clone(),X.gradient(M,x,H,w,C,I,!1),this.getLayerLockAlpha()&&X instanceof z&&X.copyAlphaFrom(pb,M),y(new A),
k(V,M))};this.fill=function(x){let H=this.getSelectionAutoSelect(),w=h();w&&(t(),Ma=H.clone(),w.clearRect(H,x),y(new A),k(V,H))};this.clear=function(){Ba?this.fill(0):this.fill(16777215)};this.flip=function(x){let H=this.getSelection(),w=H.isEmpty();var C=w&&V instanceof qa&&V.mask&&V.maskLinked;let I=(!Ba||C)&&V instanceof qa;C=(Ba||C)&&V.mask;x=x?"copyRegionHFlip":"copyRegionVFlip";(I||C)&&(w&&(H=this.getBounds()),Ma=H.clone(),I&&(q(),V.image[x](H,pb)),C&&(r(),V.mask[x](H,sa)),y(new A(I,C)),l(V,
H,I,C))};this.hFlip=function(){this.flip(!0)};this.vFlip=function(){this.flip(!1)};this.monochromaticNoise=function(){let x=this.getSelectionAutoSelect(),H=h();H&&(t(),Ma=x.clone(),H.fillWithNoise(x),y(new A),k(V,x))};this.isColorNoiseAllowed=function(){return!this.isEditingMask()&&this.isActiveLayerDrawable()};this.colorNoise=function(){if(this.isColorNoiseAllowed()){let x=this.getSelectionAutoSelect();t();Ma=x.clone();V.image.fillWithColorNoise(x);y(new A(!0,!1));l(V,x,!0,!1)}};this.invert=function(){let x=
this.getSelectionAutoSelect(),H=h();H&&(t(),Ma=x.clone(),H.invert(x),y(new A),k(V,x))};this.brightnessToOpacity=function(){let x=this.getSelectionAutoSelect(),H=h();H&&(t(),Ma=x.clone(),H.brightnessToOpacity(x),y(new A),k(V,x))};this.boxBlur=function(x,H,w){let C=this.getSelectionAutoSelect(),I=h();if(I){t();Ma=C.clone();for(let M=0;M<w;M++)I.boxBlur(C,x,H);y(new A);k(V,C)}};this.rectangleSelection=function(x){x=x.clone();x.clipTo(this.getBounds());y(new J(this.getSelection(),x));this.setSelection(x)};
this.move=function(x,H,w){if(H|=0,0!=(x|=0)||0!=H){var C=0<bb.length?bb[bb.length-1]:null;!w&&C instanceof Vb&&C.layer==this.getActiveLayer()?(C.amend(x,H),Wa=[],this.setHasUnsavedChanges(!0)):(x=new Vb(x,H,w),y(x),x.redo())}};this.setTransformInterpolation=function(x){Yb=x;lb instanceof Hb&&lb.setInterpolation(x)};this.transformAffineAbort=function(){lb instanceof Hb&&(lb.undo(),lb=null,d(!0))};this.transformAffineBegin=function(){if(lb instanceof Hb)return{transform:lb.getTransform(),rect:lb.getInitialTransformRect(),
selection:lb.getInitialSelectionRect()};let x=new ib,H;return(H=new Hb(x,Yb)).getInitialTransformRect().isEmpty()?null:(lb=H,Fb=!0,{transform:x,rect:H.getInitialTransformRect(),selection:H.getInitialSelectionRect()})};this.transformAffineFinish=function(){lb instanceof Hb&&(y(lb),lb=null,d(!0))};this.transformAffineAmend=function(x){lb instanceof Hb&&lb.amend(x)};this.isCopySelectionAllowed=this.isCutSelectionAllowed=function(){return!this.getSelection().isEmpty()&&null!==h()};this.cutSelection=function(){this.isCutSelectionAllowed()&&
y(new ea(V,Ba,this.getSelection()))};this.copySelection=function(){if(this.isCopySelectionAllowed()){let x=Q.getSelection();Bb=new Gd(h().cloneRect(x),x.left,x.top)}};this.isCopySelectionMergedAllowed=function(){return!this.getSelection().isEmpty()};this.copySelectionMerged=function(){if(this.isCopySelectionMergedAllowed()){let x=Q.getSelection();Bb=new Gd(this.fusionLayers().cloneRect(x),x.left,x.top)}};this.isPasteClipboardAllowed=function(){return!this.isClipboardEmpty()};this.pasteClipboard=function(){this.isPasteClipboardAllowed()&&
y(new Z(Bb))};this.getClipboard=function(){return Bb};this.setClipboard=function(x){Bb=x};this.isClipboardEmpty=function(){return null==Bb};this.setSampleAllLayers=function(x){zb=x};this.getLayerLockAlpha=function(){return this.getActiveLayer().getLockAlpha()};this.setLayerLockAlpha=function(x){V.getLockAlpha()!=x&&y(new Kb(V,x))};this.setForegroundColor=function(x){Xb=x};this.setBrush=function(x){Ia=x};this.setBrushTexture=function(x){ba.setTexture(x)};this.beginStroke=function(x,H,w){return null!==
Ia&&!!this.isActiveLayerDrawable()&&(t(),Ma.makeEmpty(),T.clearAll(0),na.makeEmpty(),Ub=x,$a=H,wb=w,Fb=!0,Ja[Ia.brushMode].beginStroke(),this.paintDab(x,H,w),!0)};this.continueStroke=function(x,H,w){if(null!=Ia){var C=Math.sqrt((Ub-x)*(Ub-x)+($a-H)*($a-H)),I=Math.max(Ia.minSpacing,Ia.curSize*Ia.spacing);if(C>I){let M=Ub,X=$a,W=wb;C=(I-.001)/C;for(I=C;1>=I;I+=C)M=I*x+(1-I)*Ub,X=I*H+(1-I)*$a,W=I*w+(1-I)*wb,this.paintDab(M,X,W);Ub=M;$a=X;wb=W}}};this.endStroke=function(){null!=Ia&&(m(),Ja[Ia.brushMode].endStroke(),
Ma.clipTo(this.getBounds()),Ma.isEmpty()||(y(new A),t()),d(!1))};this.hasAlpha=function(){return vb.hasAlpha()};this.getFlatPNG=function(x){return this.fusionLayers(),vb.getAsPNG(x)};this.getFlatPNGBuffer=function(x){return this.fusionLayers(),vb.getAsPNGBuffer(x)};this.isSimpleDrawing=function(){return 1==Xa.layers.length&&Xa.layers[0]instanceof qa&&!Xa.layers[0].mask&&100==Xa.layers[0].getEffectiveAlpha()};A.prototype=Object.create(Mb.prototype);A.prototype.constructor=A;F.prototype=Object.create(Mb.prototype);
F.prototype.constructor=F;D.prototype=Object.create(Mb.prototype);D.prototype.constructor=D;G.prototype=Object.create(Mb.prototype);G.prototype.constructor=G;E.prototype=Object.create(Mb.prototype);E.prototype.constructor=E;P.prototype=Object.create(Mb.prototype);P.prototype.constructor=P;N.prototype=Object.create(Mb.prototype);N.prototype.constructor=N;O.prototype=Object.create(Mb.prototype);O.prototype.constructor=O;U.prototype=Object.create(Mb.prototype);U.prototype.constructor=U;da.prototype=
Object.create(Mb.prototype);da.prototype.constructor=da;let fc=la("alpha",!0),uc=la("blendMode",!0),tc=la("visible",!0),ca=la("clip",!0),Qb=la("maskVisible",!0),ac=la("name",!1),Kb=la("lockAlpha",!1),Ea=la("maskLinked",!1);J.prototype=Object.create(Mb.prototype);J.prototype.constructor=J;class wa extends Mb{undo(){let x=[];this.dstRect.isEmpty()||x.push(this.dstRect);this.erasesSourceRect&&(x.push(this.srcRect),x=ka.union(x));this.movingLayers.forEach(H=>{this.hasFullUndo?x.forEach(w=>{H.moveImage&&
H.layer.image.copyBitmapRect(H.imageUndo,w.left,w.top,w);H.moveMask&&H.layer.mask.copyBitmapRect(H.maskUndo,w.left,w.top,w)}):(H.moveImage&&H.imageRect.forEach((w,C)=>{H.layer.image.copyBitmapRect(w,C.left,C.top,w.getBounds())}),H.moveMask&&H.maskRect.forEach((w,C)=>{H.layer.mask.copyBitmapRect(w,C.left,C.top,w.getBounds())}))});l(this.movingLayers.map(H=>H.layer),x.reduce((H,w)=>H.getUnion(w),new ka(0,0,0,0)),!0,!0);this.dstRect.makeEmpty();Q.setSelection(this.fromSelection);Q.setActiveLayer(this.layer,
this.fromMaskMode);b()}getMemoryUsed(x,H){return this.movingLayers.map(function(w){return[w.imageUndo,w.maskUndo,w.imageRect,w.maskRect].map(C=>C?C.getMemorySize():0).reduce(fd,0)}).reduce(fd,0)}buildFullUndo(){this.hasFullUndo||(this.movingLayers.forEach(function(x){x.moveImage&&(x.imageUndo=x.layer.image.clone());x.moveMask&&(x.maskUndo=x.layer.mask.clone());x.imageRect.clear();x.maskRect.clear()}),this.hasFullUndo=!0)}compact(){if(this.hasFullUndo){let x=[];this.dstRect.isEmpty()||x.push(this.dstRect);
this.erasesSourceRect&&(x.push(this.srcRect),x=ka.union(x));this.movingLayers.forEach(H=>{H.imageRect.clear();H.maskRect.clear();x.forEach(w=>{H.moveImage&&H.imageRect.set(w,H.imageUndo.cloneRect(w));H.moveMask&&H.maskRect.set(w,H.maskUndo.cloneRect(w))});H.imageUndo=null;H.maskUndo=null});this.hasFullUndo=!1}}constructor(){super();this.layer=V;this.fromSelection=Q.getSelection();this.fromMaskMode=Ba;this.movingWholeLayer=this.fromSelection.isEmpty();this.movingImage=!Ba||this.movingWholeLayer&&this.layer.maskLinked;
this.movingMask=Ba||this.movingWholeLayer&&this.layer.maskLinked;this.erasesSourceRect=this.hasFullUndo=!1;this.dstRect=new ka(0,0,0,0);this.movingLayers=[{layer:this.layer,moveImage:this.layer instanceof qa&&this.movingImage,moveMask:null!==this.layer.mask&&this.movingMask,imageRect:new Map,maskRect:new Map}];this.layer instanceof Qa&&this.movingImage&&this.movingWholeLayer&&(this.movingLayers=this.movingLayers.concat(this.layer.getLinearizedLayerList(!1).map(C=>({layer:C,moveImage:C instanceof qa,
moveMask:null!==C.mask&&C.maskLinked,imageRect:new Map,maskRect:new Map}))));let x=new ka(0,0,0,0);if(this.movingWholeLayer){this.srcRect=Q.getBounds();for(var H=0;H<this.movingLayers.length&&!x.equals(this.srcRect);H++){var w=this.movingLayers[H];w.moveMask&&x.union(w.layer.mask.getValueBounds(this.srcRect,255));w.moveImage&&x.union(w.layer.image.getNonTransparentBounds(this.srcRect))}}else for(this.srcRect=this.fromSelection.clone(),H=0;H<this.movingLayers.length&&!x.equals(this.srcRect);H++)w=
this.movingLayers[H],w.moveMask&&x.union(w.layer.mask.getValueBounds(this.srcRect,0)),w.moveImage&&x.union(w.layer.image.getNonTransparentBounds(this.srcRect));this.srcRect=x}}class Hb extends wa{buildFullUndo(){this.hasFullUndo||(super.buildFullUndo(),this.movingLayers.forEach(x=>{if(x.moveImage){var H=Zb(this.srcRect.getWidth(),this.srcRect.getHeight());H.getContext("2d").putImageData(x.layer.image.getImageData(),-this.srcRect.left,-this.srcRect.top,this.srcRect.left,this.srcRect.top,this.srcRect.getWidth(),
this.srcRect.getHeight());x.imageSourceCanvas=H}x.moveMask&&(H=Zb(this.srcRect.getWidth(),this.srcRect.getHeight()),H.getContext("2d").putImageData(x.layer.mask.getImageData(this.srcRect.left,this.srcRect.top,this.srcRect.getWidth(),this.srcRect.getHeight()),0,0),x.maskSourceCanvas=H)}),this.composeCanvas=Zb(Q.width,Q.height),this.composeCanvasContext=this.composeCanvas.getContext("2d",{willReadFrequently:!0}),Id(this.composeCanvasContext,"smooth"==this.interpolation),this.junk=this.composeCanvasContext.getImageData(0,
0,1,1))}redo(){this.buildFullUndo();var x=this.dstRect.clone();let H=this.srcRect.toPoints();this.affineTransform.transformPoints(H);this.dstRect.set(ka.createBoundingBox(H).roundContain().clipTo(Q.getBounds()));let w=ka.subtract(this.dstRect,this.srcRect),C=ka.subtract(x.isEmpty()?this.srcRect:this.srcRect.getIntersection(x),this.dstRect),I=this.srcRect.getIntersection(this.dstRect),M=ka.subtract(x,[this.dstRect,this.srcRect]);x=this.srcRect.getUnion(this.dstRect).getUnion(x);(this.movingLayers.forEach(X=>
{if(C.forEach(W=>{X.moveImage&&X.layer.image.clearRect(W,16777215);X.moveMask&&(this.movingWholeLayer?X.layer.mask.clearRect(W,255):X.layer.mask.clearRect(W,0))}),!this.dstRect.isEmpty()){if(X.moveImage){let W=X.imageUndo.getImageData();w.forEach(ra=>{this.composeCanvasContext.putImageData(W,0,0,ra.left,ra.top,ra.getWidth(),ra.getHeight())});this.composeCanvasContext.clearRect(I.left,I.top,I.getWidth(),I.getHeight());this.composeCanvasContext.save();this.composeCanvasContext.setTransform(this.affineTransform.m[0],
this.affineTransform.m[1],this.affineTransform.m[2],this.affineTransform.m[3],this.affineTransform.m[4],this.affineTransform.m[5]);this.composeCanvasContext.drawImage(X.imageSourceCanvas,this.srcRect.left,this.srcRect.top);this.composeCanvasContext.restore();X.layer.image.copyBitmapRect(new z(this.composeCanvasContext.getImageData(this.dstRect.left,this.dstRect.top,this.dstRect.getWidth(),this.dstRect.getHeight())),this.dstRect.left,this.dstRect.top,new ka(0,0,this.dstRect.getWidth(),this.dstRect.getHeight()))}X.moveMask&&
(w.forEach(W=>{this.composeCanvasContext.putImageData(X.layer.mask.getImageData(W.left,W.top,W.getWidth(),W.getHeight()),W.left,W.top)}),this.movingWholeLayer?this.composeCanvasContext.fillStyle="#FFF":this.composeCanvasContext.fillStyle="#000",this.composeCanvasContext.fillRect(I.left,I.top,I.getWidth(),I.getHeight()),this.composeCanvasContext.save(),this.composeCanvasContext.setTransform(this.affineTransform.m[0],this.affineTransform.m[1],this.affineTransform.m[2],this.affineTransform.m[3],this.affineTransform.m[4],
this.affineTransform.m[5]),this.composeCanvasContext.drawImage(X.maskSourceCanvas,this.srcRect.left,this.srcRect.top),this.composeCanvasContext.restore(),X.layer.mask.pasteImageData(this.composeCanvasContext.getImageData(this.dstRect.left,this.dstRect.top,this.dstRect.getWidth(),this.dstRect.getHeight()),this.dstRect.left,this.dstRect.top))}M.forEach(W=>{X.moveImage&&X.layer.image.copyBitmapRect(X.imageUndo,W.left,W.top,W);X.moveMask&&X.layer.mask.copyBitmapRect(X.maskUndo,W.left,W.top,W)})}),l(this.movingLayers.map(X=>
X.layer),x,!0,!0),this.fromSelection.isEmpty())||(x=this.fromSelection.toPoints(),this.affineTransform.transformPoints(x),(x=ka.createBoundingBox(x)).roundNearest(),Q.setSelection(x),b());Q.setActiveLayer(this.layer,this.fromMaskMode)}amend(x){this.hasFullUndo||this.undo();this.affineTransform=x.clone();this.redo()}setInterpolation(x){x!=this.interpolation&&(this.interpolation=x,this.composeCanvasContext&&Id(this.composeCanvasContext,"smooth"==this.interpolation),this.undo(),this.redo())}compact(){super.compact();
this.composeCanvasContext=this.composeCanvas=null;this.movingLayers.forEach(x=>x.imageSourceCanvas=null)}getMemoryUsed(x,H){x=super.getMemoryUsed(x,H);return x+=se(this.composeCanvas),x+=this.movingLayers.map(w=>se(w.imageSourceCanvas)).reduce(fd,0)}getTransform(){return this.affineTransform.clone()}getInitialTransformRect(){return this.srcRect.clone()}getInitialSelectionRect(){return this.fromSelection.clone()}constructor(x,H){super();this.erasesSourceRect=!0;this.affineTransform=x.clone();this.interpolation=
H||"smooth";this.composeCanvasContext=this.composeCanvas=null}}class Vb extends wa{redo(){var x=this.dstRect.clone();let H,w,C=x.clone(),I=null;(this.buildFullUndo(),this.dstRect.set(this.srcRect),this.dstRect.translate(this.offsetX,this.offsetY),H=this.dstRect.clone(),this.dstRect.clipTo(Q.getBounds()),this.erasesSourceRect?(I=x.isEmpty()?this.srcRect:this.srcRect.getIntersection(x),C.union(I),w=x.subtract(this.srcRect)):w=[x],this.movingLayers.forEach(M=>{I&&(M.moveImage&&M.layer.image.clearRect(I,
16777215),M.moveMask&&M.layer.mask.clearRect(I,255*!!this.movingWholeLayer));w.forEach(function(X){M.moveImage&&M.layer.image.copyBitmapRect(M.imageUndo,X.left,X.top,X);M.moveMask&&M.layer.mask.copyBitmapRect(M.maskUndo,X.left,X.top,X)});M.moveImage&&L.normalFuseImageOntoImageAtPosition(M.layer.image,M.imageUndo,H.left,H.top,this.srcRect);M.moveMask&&M.layer.mask.copyBitmapRect(M.maskUndo,H.left,H.top,this.srcRect)}),C.union(this.dstRect),l(this.movingLayers.map(M=>M.layer),C,!0,!0),this.fromSelection.isEmpty())||
(x=this.fromSelection.clone(),x.translate(this.offsetX,this.offsetY),Q.setSelection(x),b())}amend(x,H){this.hasFullUndo||this.undo();this.offsetX+=x;this.offsetY+=H;this.redo()}constructor(x,H,w){super();this.offsetX=x;this.offsetY=H;this.erasesSourceRect=!w}}ea.prototype=Object.create(Mb.prototype);ea.prototype.constructor=ea;Z.prototype=Object.create(Mb.prototype);Z.prototype.constructor=Z;Ja=[Dc,Lf,Mf,Nf,Qc,Of,Pf,Qf].map(x=>new x(T,na));this.width=a;this.height=c}function Va(a,c,d){this.data=a;
this.eof=!1;this.start=void 0===c?0:c;this.end=void 0===d?a.length:d;this.pos=this.start}function Ec(a){for(var c=a.length;0<=--c;)a[c]=0}function Jd(a,c,d,b,g){this.static_tree=a;this.extra_bits=c;this.extra_base=d;this.elems=b;this.max_length=g;this.has_stree=a&&a.length}function Kd(a,c){this.dyn_tree=a;this.max_code=0;this.stat_desc=c}function te(a){return 256>a?Rc[a]:Rc[256+(a>>>7)]}function Sc(a,c){a.pending_buf[a.pending++]=255&c;a.pending_buf[a.pending++]=c>>>8&255}function Rb(a,c,d){a.bi_valid>
16-d?(a.bi_buf|=c<<a.bi_valid&65535,Sc(a,a.bi_buf),a.bi_buf=c>>16-a.bi_valid,a.bi_valid+=d-16):(a.bi_buf|=c<<a.bi_valid&65535,a.bi_valid+=d)}function bc(a,c,d){Rb(a,d[2*c],d[2*c+1])}function ue(a,c){var d=0;do d|=1&a,a>>>=1,d<<=1;while(0<--c);return d>>>1}function ve(a,c,d){var b,g=Array(16),n=0;for(b=1;15>=b;b++)g[b]=n=n+d[b-1]<<1;for(d=0;d<=c;d++)b=a[2*d+1],0!==b&&(a[2*d]=ue(g[b]++,b))}function we(a){var c;for(c=0;286>c;c++)a.dyn_ltree[2*c]=0;for(c=0;30>c;c++)a.dyn_dtree[2*c]=0;for(c=0;19>c;c++)a.bl_tree[2*
c]=0;a.dyn_ltree[512]=1;a.opt_len=a.static_len=0;a.last_lit=a.matches=0}function xe(a){8<a.bi_valid?Sc(a,a.bi_buf):0<a.bi_valid&&(a.pending_buf[a.pending++]=a.bi_buf);a.bi_buf=0;a.bi_valid=0}function ye(a,c,d,b){var g=2*c,n=2*d;return a[g]<a[n]||a[g]===a[n]&&b[c]<=b[d]}function Ld(a,c,d){for(var b=a.heap[d],g=d<<1;g<=a.heap_len&&(g<a.heap_len&&ye(c,a.heap[g+1],a.heap[g],a.depth)&&g++,!ye(c,b,a.heap[g],a.depth));)a.heap[d]=a.heap[g],d=g,g<<=1;a.heap[d]=b}function ze(a,c,d){var b,g,n=0;if(0!==a.last_lit){do{var f=
a.pending_buf[a.d_buf+2*n]<<8|a.pending_buf[a.d_buf+2*n+1];var e=a.pending_buf[a.l_buf+n];n++;0===f?bc(a,e,c):(bc(a,(b=Tc[e])+256+1,c),0!==(g=Md[b])&&Rb(a,e-Nd[b],g),bc(a,b=te(--f),d),0!==(g=gd[b])&&Rb(a,f-hd[b],g))}while(n<a.last_lit)}bc(a,256,c)}function Od(a,c){var d,b=c.dyn_tree;var g=c.stat_desc.static_tree;var n=c.stat_desc.has_stree,f=c.stat_desc.elems,e=-1;var l=0;a.heap_len=0;for(a.heap_max=573;l<f;l++)0!==b[2*l]?(a.heap[++a.heap_len]=e=l,a.depth[l]=0):b[2*l+1]=0;for(;2>a.heap_len;)b[2*(d=
a.heap[++a.heap_len]=2>e?++e:0)]=1,a.depth[d]=0,a.opt_len--,n&&(a.static_len-=g[2*d+1]);c.max_code=e;for(l=a.heap_len>>1;1<=l;l--)Ld(a,b,l);d=f;do l=a.heap[1],a.heap[1]=a.heap[a.heap_len--],Ld(a,b,1),g=a.heap[1],a.heap[--a.heap_max]=l,a.heap[--a.heap_max]=g,b[2*d]=b[2*l]+b[2*g],a.depth[d]=(a.depth[l]>=a.depth[g]?a.depth[l]:a.depth[g])+1,b[2*l+1]=b[2*g+1]=d,a.heap[1]=d++,Ld(a,b,1);while(2<=a.heap_len);a.heap[--a.heap_max]=a.heap[1];var k,h,m,q,r;l=c.dyn_tree;d=c.max_code;g=c.stat_desc.static_tree;
n=c.stat_desc.has_stree;f=c.stat_desc.extra_bits;var t=c.stat_desc.extra_base,u=c.stat_desc.max_length,y=0;for(m=0;15>=m;m++)a.bl_count[m]=0;l[2*a.heap[a.heap_max]+1]=0;for(c=a.heap_max+1;573>c;c++)(m=l[2*l[2*(k=a.heap[c])+1]+1]+1)>u&&(m=u,y++),l[2*k+1]=m,k>d||(a.bl_count[m]++,q=0,k>=t&&(q=f[k-t]),r=l[2*k],a.opt_len+=r*(m+q),!n||(a.static_len+=r*(g[2*k+1]+q)));if(0!==y){do{for(m=u-1;0===a.bl_count[m];)m--;a.bl_count[m]--;a.bl_count[m+1]+=2;a.bl_count[u]--;y-=2}while(0<y);for(m=u;0!==m;m--)for(k=a.bl_count[m];0!==
k;)(h=a.heap[--c])>d||(l[2*h+1]!==m&&(a.opt_len+=(m-l[2*h+1])*l[2*h],l[2*h+1]=m),k--)}ve(b,e,a.bl_count)}function Ae(a,c,d){var b,g=-1,n=c[1],f=0,e=7,l=4;0===n&&(e=138,l=3);c[2*(d+1)+1]=65535;for(b=0;b<=d;b++){var k=n;n=c[2*(b+1)+1];++f<e&&k===n||(f<l?a.bl_tree[2*k]+=f:0!==k?(k!==g&&a.bl_tree[2*k]++,a.bl_tree[32]++):10>=f?a.bl_tree[34]++:a.bl_tree[36]++,f=0,g=k,0===n?(e=138,l=3):k===n?(e=6,l=3):(e=7,l=4))}}function Be(a,c,d){var b,g,n=-1,f=c[1],e=0,l=7,k=4;0===f&&(l=138,k=3);for(b=0;b<=d;b++)if(g=
f,f=c[2*(b+1)+1],!(++e<l)||g!==f){if(e<k){do bc(a,g,a.bl_tree);while(0!=--e)}else 0!==g?(g!==n&&(bc(a,g,a.bl_tree),e--),bc(a,16,a.bl_tree),Rb(a,e-3,2)):10>=e?(bc(a,17,a.bl_tree),Rb(a,e-3,3)):(bc(a,18,a.bl_tree),Rb(a,e-11,7));e=0;n=g;0===f?(l=138,k=3):g===f?(l=6,k=3):(l=7,k=4)}}function Ce(a,c,d,b){Rb(a,+!!b,3);xe(a);Sc(a,d);Sc(a,~d);za.arraySet(a.pending_buf,a.window,c,d,a.pending);a.pending+=d}function jc(a,c){return a.msg=vc[c],c}function kc(a){for(var c=a.length;0<=--c;)a[c]=0}function lc(a){var c=
a.state,d=c.pending;d>a.avail_out&&(d=a.avail_out);0!==d&&(za.arraySet(a.output,c.pending_buf,c.pending_out,d,a.next_out),a.next_out+=d,c.pending_out+=d,a.total_out+=d,a.avail_out-=d,c.pending-=d,0===c.pending&&(c.pending_out=0))}function Ib(a,c){Rf(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,c);a.block_start=a.strstart;lc(a.strm)}function ab(a,c){a.pending_buf[a.pending++]=c}function Uc(a,c){a.pending_buf[a.pending++]=c>>>8&255;a.pending_buf[a.pending++]=255&c}function De(a,c){var d,
b,g=a.max_chain_length,n=a.strstart,f=a.prev_length,e=a.nice_match,l=a.strstart>a.w_size-262?a.strstart-(a.w_size-262):0,k=a.window,h=a.w_mask,m=a.prev,q=a.strstart+258,r=k[n+f-1],t=k[n+f];a.prev_length>=a.good_match&&(g>>=2);e>a.lookahead&&(e=a.lookahead);do if(k[(d=c)+f]===t&&k[d+f-1]===r&&k[d]===k[n]&&k[++d]===k[n+1]){n+=2;for(d++;k[++n]===k[++d]&&k[++n]===k[++d]&&k[++n]===k[++d]&&k[++n]===k[++d]&&k[++n]===k[++d]&&k[++n]===k[++d]&&k[++n]===k[++d]&&k[++n]===k[++d]&&n<q;);if(b=258-(q-n),n=q-258,
b>f){if(a.match_start=c,f=b,b>=e)break;r=k[n+f-1];t=k[n+f]}}while((c=m[c&h])>l&&0!=--g);return f<=a.lookahead?f:a.lookahead}function wc(a){var c,d,b=a.w_size;do{if(d=a.window_size-a.lookahead-a.strstart,a.strstart>=b+(b-262)){za.arraySet(a.window,a.window,b,b,0);a.match_start-=b;a.strstart-=b;a.block_start-=b;var g=c=a.hash_size;do{var n=a.head[--g];a.head[g]=n>=b?n-b:0}while(--c);g=c=b;do n=a.prev[--g],a.prev[g]=n>=b?n-b:0;while(--c);d+=b}if(0===a.strm.avail_in)break;g=a.strm;n=a.window;var f=a.strstart+
a.lookahead,e=g.avail_in;if(c=(e>d&&(e=d),0===e)?0:(g.avail_in-=e,za.arraySet(n,g.input,g.next_in,e,f),1===g.state.wrap?g.adler=Fc(g.adler,n,e,f):2===g.state.wrap&&(g.adler=Db(g.adler,n,e,f)),g.next_in+=e,g.total_in+=e,e),a.lookahead+=c,3<=a.lookahead+a.insert)for(d=a.strstart-a.insert,a.ins_h=a.window[d],a.ins_h=(a.ins_h<<a.hash_shift^a.window[d+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[d+3-1])&a.hash_mask,a.prev[d&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=d,d++,a.insert--,
!(3>a.lookahead+a.insert)););}while(262>a.lookahead&&0!==a.strm.avail_in)}function Pd(a,c){for(var d,b;;){if(262>a.lookahead){if(wc(a),262>a.lookahead&&0===c)return 1;if(0===a.lookahead)break}if(d=0,3<=a.lookahead&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==d&&a.strstart-d<=a.w_size-262&&(a.match_length=De(a,d)),3<=a.match_length)if(b=mc(a,a.strstart-a.match_start,a.match_length-3),a.lookahead-=
a.match_length,a.match_length<=a.max_lazy_match&&3<=a.lookahead){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(0!=--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else b=mc(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(b&&(Ib(a,!1),
0===a.strm.avail_out))return 1}return(a.insert=2>a.strstart?a.strstart:2,4===c)?(Ib(a,!0),0===a.strm.avail_out)?3:4:a.last_lit&&(Ib(a,!1),0===a.strm.avail_out)?1:2}function Gc(a,c){for(var d,b,g;;){if(262>a.lookahead){if(wc(a),262>a.lookahead&&0===c)return 1;if(0===a.lookahead)break}if(d=0,3<=a.lookahead&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,
a.match_length=2,0!==d&&a.prev_length<a.max_lazy_match&&a.strstart-d<=a.w_size-262&&(a.match_length=De(a,d),5>=a.match_length&&(1===a.strategy||3===a.match_length&&4096<a.strstart-a.match_start)&&(a.match_length=2)),3<=a.prev_length&&a.match_length<=a.prev_length){g=a.strstart+a.lookahead-3;b=mc(a,a.strstart-1-a.prev_match,a.prev_length-3);a.lookahead-=a.prev_length-1;a.prev_length-=2;do++a.strstart<=g&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+3-1])&a.hash_mask,d=a.prev[a.strstart&a.w_mask]=
a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(0!=--a.prev_length);if(a.match_available=0,a.match_length=2,a.strstart++,b&&(Ib(a,!1),0===a.strm.avail_out))return 1}else if(a.match_available){if(mc(a,0,a.window[a.strstart-1])&&Ib(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return 1}else a.match_available=1,a.strstart++,a.lookahead--}return(a.match_available&&(mc(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=2>a.strstart?a.strstart:2,4===c)?(Ib(a,!0),0===a.strm.avail_out)?3:
4:a.last_lit&&(Ib(a,!1),0===a.strm.avail_out)?1:2}function cc(a,c,d,b,g){this.good_length=a;this.max_lazy=c;this.nice_length=d;this.max_chain=b;this.func=g}function Sf(){this.strm=null;this.status=0;this.pending_buf=null;this.wrap=this.pending=this.pending_out=this.pending_buf_size=0;this.gzhead=null;this.gzindex=0;this.method=8;this.last_flush=-1;this.w_mask=this.w_bits=this.w_size=0;this.window=null;this.window_size=0;this.head=this.prev=null;this.nice_match=this.good_match=this.strategy=this.level=
this.max_lazy_match=this.max_chain_length=this.prev_length=this.lookahead=this.match_start=this.strstart=this.match_available=this.prev_match=this.match_length=this.block_start=this.hash_shift=this.hash_mask=this.hash_bits=this.hash_size=this.ins_h=0;this.dyn_ltree=new za.Buf16(1146);this.dyn_dtree=new za.Buf16(122);this.bl_tree=new za.Buf16(78);kc(this.dyn_ltree);kc(this.dyn_dtree);kc(this.bl_tree);this.bl_desc=this.d_desc=this.l_desc=null;this.bl_count=new za.Buf16(16);this.heap=new za.Buf16(573);
kc(this.heap);this.heap_max=this.heap_len=0;this.depth=new za.Buf16(573);kc(this.depth);this.bi_valid=this.bi_buf=this.insert=this.matches=this.static_len=this.opt_len=this.d_buf=this.last_lit=this.lit_bufsize=this.l_buf=0}function Ee(a,c){if(65534>c&&(a.subarray&&Fe||!a.subarray&&Ge))return String.fromCharCode.apply(null,za.shrinkBuf(a,c));for(var d="",b=0;b<c;b++)d+=String.fromCharCode(a[b]);return d}function xc(a){if(!(this instanceof xc))return new xc(a);this.options=za.assign({level:-1,method:8,
chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},a||{});var c,d,b;a=this.options;a.raw&&0<a.windowBits?a.windowBits=-a.windowBits:a.gzip&&0<a.windowBits&&16>a.windowBits&&(a.windowBits+=16);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new Qd;this.strm.avail_out=0;var g=this.strm;var n=a.level;var f=a.method,e=a.windowBits,l=a.memLevel,k=a.strategy;if(g){var h,m,q,r=1;if(-1===n&&(n=6),0>e?(r=0,e=-e):15<e&&(r=2,e-=16),1>l||9<l||8!==f||8>e||15<e||0>n||9<n||0>k||4<k)n=jc(g,
-2);else{8===e&&(e=9);var t=new Sf;n=(g.state=t,t.strm=g,t.wrap=r,t.gzhead=null,t.w_bits=e,t.w_size=1<<t.w_bits,t.w_mask=t.w_size-1,t.hash_bits=l+7,t.hash_size=1<<t.hash_bits,t.hash_mask=t.hash_size-1,t.hash_shift=~~((t.hash_bits+3-1)/3),t.window=new za.Buf8(2*t.w_size),t.head=new za.Buf16(t.hash_size),t.prev=new za.Buf16(t.w_size),t.lit_bufsize=1<<l+6,t.pending_buf_size=4*t.lit_bufsize,t.pending_buf=new za.Buf8(t.pending_buf_size),t.d_buf=+t.lit_bufsize,t.l_buf=3*t.lit_bufsize,t.level=n,t.strategy=
k,t.method=f,0===(q=g&&g.state?(g.total_in=g.total_out=0,g.data_type=2,(h=g.state).pending=0,h.pending_out=0,0>h.wrap&&(h.wrap=-h.wrap),h.status=h.wrap?42:113,g.adler=+(2!==h.wrap),h.last_flush=0,Tf(h),0):jc(g,-2))&&((m=g.state).window_size=2*m.w_size,kc(m.head),m.max_lazy_match=Vc[m.level].max_lazy,m.good_match=Vc[m.level].good_length,m.nice_match=Vc[m.level].nice_length,m.max_chain_length=Vc[m.level].max_chain,m.strstart=0,m.block_start=0,m.lookahead=0,m.insert=0,m.match_length=m.prev_length=2,
m.match_available=0,m.ins_h=0),q)}}else n=-2;if(0!==n)throw Error(vc[n]);if(a.header&&(c=this.strm,d=a.header,c&&c.state&&2===c.state.wrap&&(c.state.gzhead=d)),a.dictionary){if(b="string"==typeof a.dictionary?Rd(a.dictionary):"[object ArrayBuffer]"===He.call(a.dictionary)?new Uint8Array(a.dictionary):a.dictionary,0!==(n=Uf(this.strm,b)))throw Error(vc[n]);this._dict_set=!0}}function Sd(a,c){c=new xc(c);if(c.push(a,!0),c.err)throw c.msg||vc[c.err];return c.result}function Ie(a){return(a>>>24&255)+
(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function Vf(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.total=this.check=this.dmax=this.flags=0;this.head=null;this.wnext=this.whave=this.wsize=this.wbits=0;this.window=null;this.extra=this.offset=this.length=this.bits=this.hold=0;this.distcode=this.lencode=null;this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0;this.next=null;this.lens=new za.Buf16(320);this.work=new za.Buf16(288);this.distdyn=this.lendyn=null;this.was=
this.back=this.sane=0}function Je(a,c,d,b){var g;a=a.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new za.Buf8(a.wsize)),b>=a.wsize?(za.arraySet(a.window,c,d-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((g=a.wsize-a.wnext)>b&&(g=b),za.arraySet(a.window,c,d-b,g,a.wnext),(b-=g)?(za.arraySet(a.window,c,d-b,b,0),a.wnext=b,a.whave=a.wsize):(a.wnext+=g,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=g))),0}function yc(a){if(!(this instanceof yc))return new yc(a);
this.options=za.assign({chunkSize:16384,windowBits:0,to:""},a||{});var c,d,b,g,n,f,e,l,k,h=this.options;h.raw&&0<=h.windowBits&&16>h.windowBits&&(h.windowBits=-h.windowBits,0===h.windowBits&&(h.windowBits=-15));0<=h.windowBits&&16>h.windowBits&&(!a||!a.windowBits)&&(h.windowBits+=32);15<h.windowBits&&48>h.windowBits&&0==(15&h.windowBits)&&(h.windowBits|=15);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new Qd;this.strm.avail_out=0;a=(c=this.strm,d=h.windowBits,c?(c.state=g=new Vf,
g.window=null,0!==(n=d,b=c&&c.state?(e=c.state,0>n?(f=0,n=-n):(f=(n>>4)+1,48>n&&(n&=15)),n&&(8>n||15<n))?-2:(null!==e.window&&e.wbits!==n&&(e.window=null),e.wrap=f,e.wbits=n,c&&c.state?((l=c.state).wsize=0,l.whave=0,l.wnext=0,c&&c.state?(k=c.state,c.total_in=c.total_out=k.total=0,c.msg="",k.wrap&&(c.adler=1&k.wrap),k.mode=1,k.last=0,k.havedict=0,k.dmax=32768,k.head=null,k.hold=0,k.bits=0,k.lencode=k.lendyn=new za.Buf32(852),k.distcode=k.distdyn=new za.Buf32(592),k.sane=1,k.back=-1,0):-2):-2):-2)&&
(c.state=null),b):-2);if(a!==ub.Z_OK||(this.header=new Ke,Wf(this.strm,this.header),h.dictionary&&("string"==typeof h.dictionary?h.dictionary=Rd(h.dictionary):"[object ArrayBuffer]"===Le.call(h.dictionary)&&(h.dictionary=new Uint8Array(h.dictionary)),h.raw&&(a=Me(this.strm,h.dictionary))!==ub.Z_OK)))throw Error(vc[a]);}function Td(a,c){c=new yc(c);if(c.push(a,!0),c.err)throw c.msg||vc[c.err];return c.result}function Ud(a){this.version=a.readU32BE();this.width=a.readU32BE();this.height=a.readU32BE();
this.layersNb=a.readU32BE()}function id(a){let c=[,,,,];for(let d=0;d<c.length;d++)c[d]=String.fromCharCode(a.readByte());if(this.chunkType=c.join(""),this.chunkSize=a.readU32BE(),a.eof)throw"Truncated chunk";}function Ne(a){return{major:a>>16&65535,minor:65535&a}}function Vd(a,c){let d=new Va(new Uint8Array(id.HEADER_LENGTH+c));return d.writeString(a),d.writeU32BE(c),d}function Hc(){}function jd(a){function c(n,f){null===f?g.emitEvent("loadingProgress",[1,"Loading your "+n.friendly+"..."]):g.emitEvent("loadingProgress",
[f,"Loading your "+n.friendly+" ("+Math.round(100*f)+"%)..."])}var d=[],b={},g=this;a.loadChibiFileUrl&&0<(""+a.loadChibiFileUrl).length?d.push({url:a.loadChibiFileUrl,friendly:"drawing layers",name:"layers",required:!0}):a.loadImageUrl&&0<(""+a.loadImageUrl).length&&d.push({url:a.loadImageUrl,friendly:"drawing",name:"flat",required:!0});a.loadSwatchesUrl&&d.push({url:a.loadSwatchesUrl,friendly:"color swatches",name:"swatches",required:!1,noProgress:!0});this.load=function(){function n(){f.required?
g.emitEvent("loadingFailure",["Failed to load your "+f.friendly+", please try again later."]):g.load()}if(0==d.length)g.emitEvent("loadingComplete",[b]);else{var f=d.shift(),e=new XMLHttpRequest;e.addEventListener("progress",function(l){c(f,l.lengthComputable&&!f.noProgress?l.loaded/l.total:null)},!1);e.addEventListener("load",function(l){if(200==this.status){let k=this.response;g.emitEvent("loadingProgress",[1,"Starting ChickenPaint..."]);setTimeout(function(){(function(h,m){switch(h.name){case "flat":return new Promise(function(q,
r){let t=new Blob([m],{type:"image/png"}),u=window.URL.createObjectURL(t);if(u){let y=new Image;y.onload=function(){let A=new Pb(this.width,this.height),F=new qa(0,0,"Layer 1");F.image=z.createFromImage(y);A.addLayerObject(A.getLayersRoot(),F);y=null;window.URL.revokeObjectURL(u);q(A)};y.src=u}else r(null)});case "swatches":return(h=(new Hc).read(m))?Promise.resolve(h):Promise.reject(null);case "layers":return function(q,r){function t(O){let U;var da=N;if(null!==da&&0!==da.length)if(null===O||0===
O.length)O=da;else{var la=new Uint8Array(da.length+O.length);O=(la.set(da,0),la.set(O,da.length),la)}for(N=O;N;){if(G<N.length)N=N.subarray(G),G=0;else{G-=N.length;N=null;break}switch(y){case 0:if(N.length<id.HEADER_LENGTH)break;if(P=new id(U=new Va(N)),N=N.subarray(U.pos),E)if("ZEND"==P.chunkType)y=45;else{"LAYR"==P.chunkType?(y=2,D=new Xf(P,E.width,E.height)):"GRUP"==P.chunkType?(y=3,D=new Yf(P,E.width,E.height)):(console.log("Unknown chunk type '"+P.chunkType+"', attempting to skip..."),G=P.chunkSize);
continue}else if("HEAD"==P.chunkType){y=1;continue}else y=5;break;case 1:if(N.length<P.chunkSize)break;if(0<Ne((E=new Ud(U=new Va(N))).version).major){y=5;break}F=(A=new Pb(E.width,E.height)).getLayersRoot();G=P.chunkSize;y=0;continue;case 2:if(N=D.decode(N),D.done){A.addLayerObject(F,D.layer);y=0;continue}break;case 3:if(N=D.decode(N),D.done){A.addLayerGroupObject(F,D.layer,D.childLayers);y=0;continue}}break}}r=r||{};let u=new (Ha(Wd).Inflate)({}),y=0,A=null,F=null,D,G=0,E=null,P=null,N=null;return(new Promise(function(O){if(q instanceof
ArrayBuffer)O(q);else{let U=new FileReader;U.onload=function(){O(this.result)};U.readAsArrayBuffer(q)}})).then(O=>new Promise(function(U,da){let la=new Uint8Array(O);(function(J){for(let ea=0;8>ea;ea++)if(J[ea]!="CHIBIOEK".charCodeAt(ea))return!1;return!0})(la)?(la=la.subarray(8),u.onData=t,u.onEnd=function(J){0===J&&45==y?(!1!==r.upgradeMultiplyLayers&&10>E.version&&A.upgradeMultiplyLayers(r.upgradeMultiplyLayers),A.selectTopmostVisibleLayer(),U(A)):da("Fatal error decoding ChibiFile: "+J)},u.push(la,
!0)):da("This doesn't appear to be a ChibiPaint layers file, is it damaged?")}))}(m);default:return Promise.reject("Unexpected resource type '"+h.name+"'")}})(f,k).then(function(h){b[f.name]=h;g.load()},function(){g.emitEvent("loadingFailure",["Failed to read your "+f.friendly])})},0)}else n()},!1);e.addEventListener("error",n);c(f,f.noProgress?null:0);e.open("GET",f.url,!0);e.responseType="arraybuffer";e.send()}}}function Xd(a){(a=a.split(/[-_]/,1)[0].toLowerCase())in Yd?(kd=Yd[a],Zd=a):(kd=ld,Zd=
"en")}function S(a){return a in kd?kd[a]:a}function Wc(a){function c(e){null===e?n.emitEvent("savingProgress",[1,S("Saving drawing...")]):n.emitEvent("savingProgress",[e,S("Saving drawing...")+" ("+Math.round(100*e)+"%)"])}function d(e){n.emitEvent("savingFailure",[e])}async function b(e){try{let l=await g(e),k=`${(l/1024/1024).toFixed(3)}MB`,h=`${a.post_max_size}MB`;if(console.log("Total size of FormData:",k),console.log("post_max_size:",h),a&&a.post_max_size&&l&&!isNaN(l)&&l>1048576*a.post_max_size){d(`${S("The file size exceeds the server limit.")}
${S("Limit size")}:${h}
${S("Current size")}:${k}`);return}console.log(S("The total size of FormData is within the acceptable range."))}catch(l){console.error("Error details:",l);d("An error occurred in the getFormDataSize function.");return}c(.5);fetch(a.url,{method:"POST",mode:"same-origin",headers:{"X-Requested-With":"chickenpaint"},body:e}).then(l=>{if(!l.ok){let k;switch(l.status){case 400:k="Bad Request";break;case 401:k="Unauthorized";break;case 403:k="Forbidden";break;case 404:k="Not Found";break;case 500:k="Internal Server Error";
break;case 502:k="Bad Gateway";break;case 503:k="Service Unavailable";break;default:k="Unknown Error"}throw Error(`${S("Network response was not OK")} ( ${S("HTTP status code")} ${l.status} : ${k} )`);}return l.text()}).then(l=>{/^CHIBIOK/.test(l)?(c(1),n.emitEvent("savingComplete")):d(l)}).catch(l=>{d(l.message)})}async function g(e){if(a.post_max_size)return e=Array.from(e.entries()).map(([l,k])=>"string"==typeof k?new Blob([`${l}=${k}`]):k),(new Blob(e)).size}var n=this,f=!1;a.rotation=a.rotation||
0;this.save=function(){var e,l,k,h,m;(e=new Blob([function(q){for(var r=new Uint8Array(q.length),t=0;t<q.length;t++)r[t]=q.charCodeAt(t);return r}(a.artwork.getFlatPNG(a.rotation))],{type:"image/png"}),a.artwork.isSimpleDrawing())?k=Promise.resolve(null):(h=a.artwork,m=m||{},k=Promise.resolve().then(()=>{var q,r;let t,u=new (Ha(Wd).Deflate)({level:7}),y=[],A=new Uint8Array(8),F=h.getLayersRoot().getLinearizedLayerList(!1),D=m.forceOldVersion?0:function(E){for(let P of E.getLayersRoot().getLinearizedLayerList(!1))if(P instanceof
Qa||P.mask||P.clip||P.blendMode>L.LM_LAST_CHIBIPAINT||P.blendMode===L.LM_MULTIPLY)return 10;return 0}(h),G=0===(r=Ne(D)).major&&0===r.minor?"ChibiPaint v0.0":"ChickenPaint v"+r.major+"."+r.minor;r=Promise.resolve();u.onData=function(E){y.push(E)};for(let E=0;8>E;E++)A[E]="CHIBIOEK".charCodeAt(E);for(let E of(y.push(A),u.push((q=F.length,(t=Vd("HEAD",Ud.FIXED_HEADER_LENGTH)).writeU32BE(D),t.writeU32BE(h.width),t.writeU32BE(h.height),t.writeU32BE(q),t.getAsDataArray()),!1),F))r=r.then(()=>new Promise(function(P){var N=
u.push,O=E,U=O instanceof qa,da=4*(U?5:6),la=O.name.length;var J=Vd(U?"LAYR":"GRUP",da+la+((U?O.image.data.length:0)+(O.mask?O.mask.data.length:0)));var ea=0;let Z;O.visible&&(ea|=1);U&&O.clip&&(ea|=2);O.mask&&(ea|=4);O.maskLinked&&(ea|=8);O.maskVisible&&(ea|=16);O.lockAlpha&&(ea|=64);!U&&O.expanded&&(ea|=32);O.blendMode===L.LM_MULTIPLY2?(Z=L.LM_MULTIPLY,ea|=128):Z=O.blendMode;J.writeU32BE(da+la);J.writeU32BE(Z);J.writeU32BE(O.alpha);J.writeU32BE(ea);J.writeU32BE(O.name.length);U||J.writeU32BE(O.layers.length);
J.writeString(O.name);if(U){U=J.pos;da=J.data;la=O.image.data;for(ea=0;ea<la.length;ea+=z.BYTES_PER_PIXEL)da[U++]=la[ea+z.ALPHA_BYTE_OFFSET],da[U++]=la[ea+z.RED_BYTE_OFFSET],da[U++]=la[ea+z.GREEN_BYTE_OFFSET],da[U++]=la[ea+z.BLUE_BYTE_OFFSET];J.pos=U;!0}O.mask&&(O=O.mask,J.data.set(O.data,J.pos),J.pos+=O.data.length);J=J.getAsDataArray();N.call(u,J,!1);setTimeout(P,10)}));return r.then(()=>new Promise((E,P)=>{u.onEnd=function(N){if(0===N)if("undefined"!=typeof Blob)E({bytes:new Blob(y,{type:"application/octet-stream"}),
version:G});else{N=new Uint8Array(y.map(U=>U.byteLength).reduce((U,da)=>U+da,0));let O=0;for(let U of y)N.set(U,O),O+=U.byteLength;E({bytes:N,version:G})}else P(N)};u.push(Vd("ZEND",0).getAsDataArray(),!0)}))}));k.then(function(q){if(f)n.emitEvent("savingFailure");else if(l=a.swatches?new Blob([(new Hc).write(a.swatches)],{type:"application/octet-stream"}):null,a.url){var r=new FormData;r.append("beginMarker","This marker ensures the upload wasn't truncated");r.append("painter","ChickenPaint v2.0");
r.append("picture",e);e=null;q?(r.append("chibifileFormat",q.version),r.append("chibifile",q.bytes),r.append("rotation",""+a.rotation)):r.append("rotation","0");l&&(r.append("swatches",l),l=null);r.append("endMarker","This marker ensures the upload wasn't truncated");b(r)}else r="oekaki_"+(new Date).toISOString().split(".")[0].replace(/[^0-9]/g,"_"),Ha(Xc).saveAs(e,r+".png"),q&&Ha(Xc).saveAs(q.bytes,r+".chi"),l&&Ha(Xc).saveAs(l,r+".aco")}).catch(function(q){n.emitEvent("savingFailure")})};this.cancel=
function(){f=!0}}function Zf(a,c,d){function b(){var N=k.width/2,O=k.height/2;if(h.fillStyle="white",h.fillRect(0,0,k.width,k.height),D==F.length){var U=t.width,da=t.height,la=Math.round(N-U/2),J=Math.round(O-da/2);h.drawImage(t,la,J);var ea=G;n||((n=document.createElement("canvas")).width=U,n.height=da,e=n.getContext("2d"));e.globalCompositeOperation="copy";e.drawImage(m,0,0);f||((f=document.createElement("canvas")).width=U,f.height=da,l=f.getContext("2d"));l.globalCompositeOperation="copy";l.drawImage(A,
0,0);l.globalCompositeOperation="source-in";l.drawImage(A,0,Math.round(170*ea));e.globalCompositeOperation="source-over";e.drawImage(f,0,0);e.drawImage(q,0,0);e.globalCompositeOperation="screen";e.drawImage(y,0,0);e.globalCompositeOperation="multiply";e.drawImage(u,0,0);h.globalAlpha=.88;h.drawImage(n,la,J);h.globalAlpha=1;h.drawImage(r,la,J);O=Math.round(O+da/2+2)}if(""!=E)for(h.fillStyle="black",ea=E.split("\n"),U=0;U<ea.length;U++)da=ea[U],la=h.measureText(da).width,O+=28,h.fillText(da,N-la/2,
O)}function g(){k.width=k.clientWidth;k.height=k.clientHeight;h.font="14pt sans-serif";b()}var n,f,e,l,k=document.createElement("canvas"),h=k.getContext("2d"),m=new Image,q=new Image,r=new Image,t=new Image,u=new Image,y=new Image,A=new Image,F=[m,q,r,t,u,y,A],D=0,G=0,E="";d+="splash/";for(var P=0;P<F.length;P++)F[P].onload=function(){++D==F.length&&b()};m.src=d+"cup.png";y.src=d+"highlights.png";q.src=d+"lid.png";r.src=d+"lines.png";u.src=d+"shading.png";A.src=d+"smoothie.png";t.src=d+"text.png";
c.on("loadingProgress",function(N,O){G=N;E=O;b()});c.on("loadingFailure",function(N){G=0;E=N;b()});c.on("loadingComplete",function(){window.removeEventListener("resize",g);a.removeChild(k)});window.addEventListener("resize",g);k.className="chickenpaint-splash-screen";a.appendChild(k);g()}function Oe(a){for(var c={DELETE:46,BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27," ":32,ARROWLEFT:37,ARROWUP:38,ARROWRIGHT:39,ARROWDOWN:40,SHIFT:16,"[":219,"]":221,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,0:48,"-":189,
"=":187,"+":187,";":187,META:91,LEFTMETA:91,RIGHTMETA:91,ALT:18,ALTGRAPH:18,OPTION:18,CONTROL:17},d=65;90>=d;d++)c[String.fromCharCode(d)]=d;if((a=a.toUpperCase())in c)return c[a]}function Pe(){let a,c,d,b,g,n,f,e;this.x0=this.y0=this.x1=this.y1=this.x2=this.y2=this.x3=this.y3=0;let l=k=>{let h=3*k,m=h*k;k*=k*k;let q=2*m,r=6*k,t=this.x0-2*this.x1+this.x2,u=this.y0-2*this.y1+this.y2,y=3*(this.x1-this.x2)-this.x0+this.x3,A=3*(this.y1-this.y2)-this.y0+this.y3;a=this.x0;g=this.y0;c=(this.x1-this.x0)*
h+t*m+y*k;n=(this.y1-this.y0)*h+u*m+A*k;d=t*q+y*r;f=u*q+A*r;b=y*r;e=A*r};this.compute=(k,h,m)=>{l(1/m);k[0]=a;h[0]=g;for(let q=1;q<m;q++)a+=c,g+=n,c+=d,n+=f,d+=b,f+=e,k[q]=a,h[q]=g}}function Qe(a,c,d,b){var g,n=0;return"boolean"!=typeof c&&(b=d,d=c,c=void 0),function(){function f(){n=+new Date;d.apply(e,k)}var e=this,l=+new Date-n,k=arguments;b&&!g&&f();g&&clearTimeout(g);void 0===b&&l>a?f():!0!==c&&(g=setTimeout(b?function(){g=void 0}:f,void 0===b?a-l:a))}}function zc(a){this.points=a||[]}function kb(a,
c){this.x=a;this.y=c}function Re(a){for(var c=document.createElement("canvas"),d=c.getContext("2d"),b=d.createImageData(64,64),g=b.data,n=0,f=0;64>f;f++)for(var e=0;64>e;e++)0!=(8&e)^0!=(8&f)?(g[n++]=255,g[n++]=255,g[n++]=255):(g[n++]=204,g[n++]=204,g[n++]=204),g[n++]=255;return c.width=64,c.height=64,d.putImageData(b,0,0),a.createPattern(c,"repeat")}function md(a,c){c+="Style";a.globalCompositeOperation="exclusion";"exclusion"==a.globalCompositeOperation?a[c]="white":(a.globalCompositeOperation=
"difference",a[c]="#888","difference"!=a.globalCompositeOperation&&(a[c]="black"))}function Yc(a){function c(){var u=a?d.clientHeight:d.clientWidth;m=l/(f-n)*u;u=(e-n)/(f-n)*(u-m);g.style[a?"height":"width"]=m+"px";b.style[a?"height":"width"]=m+"px";b.style[a?"top":"left"]=u+"px"}let d=document.createElement("div"),b=document.createElement("div"),g=document.createElement("div"),n=0,f=1,e=0,l=1,k=10,h=!1,m=1,q=!1,r,t=this;this.setValues=function(u,y,A,F){e=u;l=y;n=A;f=F;c()};this.setBlockIncrement=
function(u){k=u};this.setUnitIncrement=function(u){};this.getElement=function(){return d};this.getValueIsAdjusting=function(){return h};d.className="chickenpaint-scrollbar "+(a?"chickenpaint-scrollbar-vertical":"chickenpaint-scrollbar-horizontal");b.className="chickenpaint-scrollbar-handle";b.setAttribute("touch-action","none");g.className="chickenpaint-scrollbar-handle-inner";b.appendChild(g);d.appendChild(b);b.addEventListener("pointerdown",function(u){u.stopPropagation();r=a?u.pageY-d.offsetTop-
window.scrollY:u.pageX-d.offsetLeft-window.scrollX;b.setPointerCapture(u.pointerId);b.classList.add("dragging");q=!0});b.addEventListener("pointermove",function(u){q&&(h=!0,u=a?u.pageY-d.offsetTop-window.scrollY:u.pageX-d.offsetLeft-window.scrollX,e+=(u-r)*(f-n)/((a?d.clientHeight:d.clientWidth)-m),e=Math.min(Math.max(e,n),f),r=u,t.emitEvent("valueChanged",[e]),c(),h=!1)});b.addEventListener("pointerup",function(u){if(u.stopPropagation(),q){try{b.releasePointerCapture(u.pointerId)}catch(y){}b.classList.remove("dragging");
q=!1}});b.addEventListener("click",function(u){u.stopPropagation()});d.addEventListener("click",function(u){this==d&&((a?u.pageY-d.offsetTop-window.scrollY:u.pageX-d.offsetLeft-window.scrollX)<parseInt(b.style[a?"top":"left"],10)?e-=k:e+=k,t.emitEvent("valueChanged",[e]),c())})}function Jb(){this.modes=[]}function nd(a){function c(){}function d(){}function b(){this.shouldPaintBrushPreview=!1;this.oldPreviewRect=null}function g(){b.call(this);this.smoothMouse={x:0,y:0}}function n(){var w,C;this.mouseDown=
function(I,M,X){if(!this.capture&&0==M&&!I.altKey&&!Ha(qb).isPressed("space")&&A())return this.capture=!0,w=C={x:Wa+.5,y:Ia+.5},this.eraseBrushPreview(),!0};this.mouseDrag=function(I){if(this.capture){var M=new ka(Math.min(w.x,C.x)-1-1,Math.min(w.y,C.y)-1-1,Math.max(w.x,C.x)+1+1+1,Math.max(w.y,C.y)+1+1+1);if(C={x:Wa+.5,y:Ia+.5},I.shiftKey){var X=Math.PI/4;I=Math.round(Math.atan2(C.y-w.y,C.x-w.x)/X);switch(I){case 0:case 4:C.y=w.y;break;case 2:case 6:C.x=w.x;break;default:I*=X,X=Math.sqrt((C.y-w.y)*
(C.y-w.y)+(C.x-w.x)*(C.x-w.x)),C.x=w.x+X*Math.cos(I),C.y=w.y+X*Math.sin(I)}}return M.union(new ka(Math.min(w.x,C.x)-1-1,Math.min(w.y,C.y)-1-1,Math.max(w.x,C.x)+1+1+1,Math.max(w.y,C.y)+1+1+1)),Ca(M),!0}this.mouseMove.call(this,I)};this.mouseUp=function(I,M,X){if(this.capture&&0==M)return I=G(w),M=G(C),this.capture=!1,this.drawLine(I,M),Ca(new ka(Math.min(w.x,C.x)-1-1,Math.min(w.y,C.y)-1-1,Math.max(w.x,C.x)+1+1+1,Math.max(w.y,C.y)+1+1+1)),!0};this.paint=function(){this.capture?(Q.lineWidth=1,Q.beginPath(),
Q.moveTo(w.x,w.y),Q.lineTo(C.x,C.y),Q.stroke()):b.prototype.paint.call(this)};b.call(this)}function f(){let w=0,C,I,M,X;this.mouseDown=function(W,ra,Ka){if(!this.capture&&0==ra&&!W.altKey&&!Ha(qb).isPressed("space")&&A())return W=G({x:Wa,y:Ia}),w=0,C=I=M=X=W,this.capture=!0,this.eraseBrushPreview(),!0};this.mouseDrag=function(W){if(this.capture&&0===w)return M=X=G({x:Wa,y:Ia}),sa.repaintAll(),!0;this.mouseMove.call(this,W)};this.mouseUp=function(W,ra,Ka){if(this.capture&&0==ra){switch(w){case 0:w=
1;break;case 1:w=2;break;case 2:this.capture=!1;ra=C;Ka=I;let db=M,tb=X;W=new Pe;W.x0=ra.x;W.y0=ra.y;W.x1=Ka.x;W.y1=Ka.y;W.x2=db.x;W.y2=db.y;W.x3=tb.x;W.y3=tb.y;ra=Array(500);Ka=Array(500);W.compute(ra,Ka,500);ma.beginStroke(ra[0],Ka[0],1);for(W=1;500>W;W++)ma.continueStroke(ra[W],Ka[W],1);ma.endStroke();sa.repaintAll()}return!0}};this.mouseMove=function(W,ra){if(this.capture)return W=G({x:Wa,y:Ia}),1==w?I=W:2==w&&(M=W),sa.repaintAll(),!0;b.prototype.mouseMove.call(this,W,ra)};this.paint=function(){if(this.capture){var W=
new Pe;let ra=P(C),Ka=P(I),db=P(M),tb=P(X);W.x0=ra.x;W.y0=ra.y;W.x1=Ka.x;W.y1=Ka.y;W.x2=db.x;W.y2=db.y;W.x3=tb.x;W.y3=tb.y;let xb=Array(100),Ya=Array(100);W.compute(xb,Ya,100);Q.beginPath();Q.moveTo(xb[0],Ya[0]);for(W=1;100>W;W++)Q.lineTo(xb[W],Ya[W]);Q.moveTo(~~ra.x,~~ra.y);Q.lineTo(~~Ka.x,~~Ka.y);Q.moveTo(~~db.x,~~db.y);Q.lineTo(~~tb.x,~~tb.y);Q.stroke()}else b.prototype.paint.call(this)};b.call(this)}function e(){var w;this.mouseDown=function(C,I,M){return!!this.capture||(Ha(qb).isPressed("space")||
(0!=I||this.transient&&!C.altKey)&&2!=I?void(this.transient&&Ea.pop()):(w=I,this.capture=!0,u("crosshair"),this.mouseDrag(C),!0))};this.mouseDrag=function(C){if(this.capture)return C=G({x:Wa,y:Ia}),ma.isPointWithin(C.x,C.y)&&a.setCurColor(new Za(ma.colorPicker(C.x,C.y))),!0};this.mouseUp=function(C,I,M){if(this.capture&&I==w)return w=-1,this.capture=!1,u("default"),this.transient&&Ea.pop(),!0};this.enter=function(){c.prototype.enter.call(this);w=-1}}function l(){var w,C,I,M;this.keyDown=function(X){if(" "===
X.key)return this.capture||u("grab"),!0};this.keyUp=function(X){if(this.transient&&1!=M&&" "===X.key)return u("default"),Ea.pop(),!0};this.mouseDown=function(X,W,ra){return!!this.capture||(1==W||Ha(qb).isPressed("space")&&0==W||!this.transient&&0==W?(this.capture=!0,M=W,w=X.pageX,C=X.pageY,I=sa.getOffset(),u("grabbing"),!0):void(this.transient&&Ea.pop()))};this.mouseDrag=function(X){if(this.capture)return sa.setOffset(I.x+X.pageX-w,I.y+X.pageY-C),!0};this.mouseUp=function(X,W,ra){if(this.capture&&
W==M)return M=-1,this.capture=!1,this.transient&&!Ha(qb).isPressed("space")&&(u("default"),Ea.pop()),!0};this.enter=function(){u("grab")}}function k(){}function h(){var w,C=new ka(0,0,0,0),I=-1;this.mouseDown=function(M,X,W){if(!this.capture&&0==X&&!M.altKey&&!Ha(qb).isPressed("space"))return M=E({x:Wa,y:Ia}),I=X,C.makeEmpty(),w=M,sa.repaintAll(),this.capture=!0,!0};this.mouseDrag=function(M){if(!this.capture)return!1;var X=E({x:Wa,y:Ia});M=M.shiftKey;var W=~~Math.max(Math.abs(X.x-w.x),Math.abs(X.y-
w.y));return X.x>=w.x?(C.left=w.x,C.right=(M?w.x+W:X.x)+1):(C.left=M?w.x-W:X.x,C.right=w.x+1),X.y>=w.y?(C.top=w.y,C.bottom=(M?w.y+W:X.y)+1):(C.top=M?w.y-W:X.y,C.bottom=w.y+1),sa.repaintAll(),!0};this.mouseUp=function(M,X,W){if(this.capture&&X==I)return ma.rectangleSelection(C),C.makeEmpty(),sa.repaintAll(),this.capture=!1,I=-1,!0};this.paint=function(){C.isEmpty()||(Q.lineWidth=1,U(Q,C))}}function m(){var w,C,I=!1;this.mouseDown=function(M,X,W){if(!this.capture&&0==X&&!Ha(qb).isPressed("space")&&
y())return w=G({x:Wa,y:Ia}),C=M.altKey,I=!0,this.capture=!0,!0};this.mouseDrag=Qe(25,function(M){if(this.capture){M=G({x:Wa,y:Ia});var X=M.x-w.x,W=M.y-w.y,ra=~~X,Ka=~~W;return(0!=ra||0!=Ka)&&(ma.move(ra,Ka,C&&I),I=!1),w.x=M.x-(X-ra),w.y=M.y-(W-Ka),!0}});this.mouseUp=function(M,X,W){if(this.capture&&0==X)return this.capture=!1,this.transient&&Ea.pop(),!0}}function q(){function w(ia,ua){return{x:(ia.x+ua.x)/2,y:(ia.y+ua.y)/2}}function C(ia){return{x:Math.round(ia.x),y:Math.round(ia.y)}}function I(ia,
ua){for(var va=0;va<ia.points.length;va++)if(49>=(ua.x-ia.points[va].x)*(ua.x-ia.points[va].x)+(ua.y-ia.points[va].y)*(ua.y-ia.points[va].y))return 2*va;for(va=0;va<ia.points.length;va++){var Ra=ia.points[va],Ua=ia.points[(va+1)%ia.points.length];Ua=new kb(Ua.x-Ra.x,Ua.y-Ra.y);Ra=new kb(ua.x-Ra.x,ua.y-Ra.y);var Wb=Ua.getLength(),Ac=Ua.getScaled(1/Wb);Wb=Ra.getScaled(1/Wb);Ac=Ac.getDotProduct(Wb);if(0<=Ac&&1>=Ac&&(Ua.scale(Ac),49>=(Ua.x-Ra.x)*(Ua.x-Ra.x)+(Ua.y-Ra.y)*(Ua.y-Ra.y)))return 2*va+1}return ia.containsPoint(ua)?
-3:-2}function M(){var ia=Ka.getTransformed(eb),ua=I(ia,{x:Wa,y:Ia});switch(ua){case 0:case 2:case 4:case 6:ua=~~(ua/2);let va=ia.points[ua],Ra=ia.points[(ua+1)%4];X(kb.subtractPoints(ia.points[(ua+3)%4],va).normalize().add(kb.subtractPoints(Ra,va).normalize()));break;case 1:case 3:case 5:case 7:X(kb.subtractPoints(ia.points[(~~(ua/2)+1)%4],ia.points[~~(ua/2)]).getPerpendicular());break;case -3:u("move");break;default:u("default")}}function X(ia){ia=Math.floor(Math.atan2(-ia.y,ia.x)/(Math.PI/4)+.5);
switch(0>ia&&(ia+=4),ia){default:ia="ew-resize";break;case 1:ia="nesw-resize";break;case 2:ia="ns-resize";break;case 3:ia="nwse-resize"}u(ia)}var W,ra,Ka,db,tb,xb,Ya=-1;this.mouseDown=function(ia,ua,va){if(!this.capture&&0==ua&&!ia.altKey&&!Ha(qb).isPressed("space"))return Ya=I(Ka.getTransformed(eb),{x:Wa,y:Ia}),tb=G(db={x:Wa,y:Ia}),this.capture=!0,M(),!0};this.mouseDrag=Qe(40,function(ia){if(this.capture){var ua={x:Wa,y:Ia};switch(Ya){case -3:ia=C(G(ua));var va=kb.subtractPoints(ia,tb);ua=va.getTruncated();
va=va.subtract(ua);var Ra=new ib;Ra.translate(ua.x,ua.y);W.preMultiply(Ra);tb=kb.subtractPoints(ia,va);break;case -2:Ra=Math.PI/4;va=Ka.getCenter();var Ua=P(va),Wb=Math.atan2(ua.y-Ua.y,ua.x-Ua.x)-Math.atan2(db.y-Ua.y,db.x-Ua.x);Ua=new ib;xb+=Wb;ia=ia.shiftKey?-W.decompose().rotate+Math.round(xb/Ra)*Ra:Wb;Ua.rotateAroundPoint(ia,va.x,va.y);W.preMultiply(Ua);db=ua;break;case 0:case 2:case 4:case 6:Ra=~~(Ya/2);va=ra.points[Ra];Ua=W.getInverted().getTransformedPoint(C(G(ua)));ua=ra.points[(Ra+2)%4];Ra=
(Ua.x-ua.x)/(va.x-ua.x);va=(Ua.y-ua.y)/(va.y-ua.y);if(.001>Math.abs(Ra)||.001>Math.abs(va)||isNaN(Ra)||isNaN(va))return!0;ia.shiftKey&&(va=Ra=ia=Math.max(Ra,va));W.scaleAroundPoint(Ra,va,ua.x,ua.y);break;case 1:case 5:case 3:case 7:ia=~~(Ya/2);Ua=w(ra.points[ia],ra.points[(ia+1)%4]);ua=W.getInverted().getTransformedPoint(C(G(ua)));ia=w(ra.points[(ia+2)%4],ra.points[(ia+3)%4]);Ua=kb.subtractPoints(Ua,ia);ua=kb.subtractPoints(ua,ia);Wb=Ua.getLength();ua=Ua.getDotProduct(ua)/Wb/Wb;if(.001>Math.abs(ua)||
isNaN(ua))return!0;1==Ya||5==Ya?(va=1,Ra=ua):(va=ua,Ra=1);W.scaleAroundPoint(va,Ra,ia.x,ia.y)}return Ka=ra.getTransformed(W),ma.transformAffineAmend(W),sa.repaintAll(),!0}});this.mouseUp=function(ia,ua,va){if(this.capture&&0==ua)return this.capture=!1,Ya=-1,!0};this.mouseMove=function(){this.capture||M()};this.paint=function(){var ia=Ka.getTransformed(eb).points,ua=Array(2*ia.length);for(var va=0;va<ia.length;va++)ua[va]=ia[va];for(let Ua=0;Ua<ia.length;Ua++){va=ia[Ua];var Ra=ia[(Ua+1)%ia.length];
ua[Ua+ia.length]={x:(va.x+Ra.x)/2,y:(va.y+Ra.y)/2}}md(Q,"fill");for(va=0;va<ua.length;va++)Q.fillRect(ua[va].x-3,ua[va].y-3,7,7);O(Q,ia)};this.keyDown=function(ia){return"Enter"===ia.key?(a.actionPerformed({action:"CPTransformAccept"}),!0):"Escape"===ia.key?(a.actionPerformed({action:"CPTransformReject"}),!0):void 0};this.enter=function(){c.prototype.enter.call(this);var ia,ua=ma.transformAffineBegin();W=ua.transform;ua.rect;(ia=ua.selection).isEmpty()&&(ia=ua.rect.clone());Ka=(ra=new zc(ia.toPoints())).getTransformed(W);
Ya=-1;xb=0;sa.repaintAll()};this.leave=function(){c.prototype.leave.call(this);sa.repaintAll()}}function r(){var w,C,I=0,M=!1,X=-1;this.mouseDown=function(W,ra,Ka){return!!this.capture||(!this.transient&&0==ra&&!W.altKey&&!Ha(qb).isPressed("space")||0==ra&&!W.altKey&&!Ha(qb).isPressed("space")&&Ha(qb).isPressed("r")?(w={x:Wa,y:Ia},I=sa.getRotation(),C=eb.clone(),M=!1,this.capture=!0,X=ra,!0):void(this.transient&&Ea.pop()))};this.mouseDrag=function(W){if(this.capture){var ra=ba.clientWidth/2,Ka=ba.clientHeight/
2;W=ba.width/2;var db=ba.height/2;ra=Math.atan2(Ia-Ka,Wa-ra)-Math.atan2(w.y-Ka,w.x-ra);Ka=new ib;return Ka.rotateAroundPoint(ra,W,db),Ka.multiply(C),sa.setRotation(I+ra),sa.setOffset(~~Ka.getTranslateX(),~~Ka.getTranslateY()),M=!0,!0}};this.mouseUp=function(W,ra,Ka){if(this.capture&&ra==X){if(M){W=Math.round(vb/(Math.PI/2))*Math.PI/2;if(Math.abs(vb-W)<5/180*Math.PI){Ka=W-I;W=ba.width/2;ra=ba.height/2;let db=new ib;db.rotateAroundPoint(Ka,W,ra);db.multiply(C);sa.setRotation(I+Ka);sa.setOffset(~~db.getTranslateX(),
~~db.getTranslateY());sa.repaintAll()}sa.emitEvent("canvasRotated90",[sa.getRotation90()])}else sa.resetRotation();return this.capture=!1,this.transient&&!Ha(qb).isPressed("r")&&Ea.pop(),!0}};this.keyUp=function(W){if(this.transient&&1!=X&&" "===W.key)return u("default"),Ea.pop(),!0};this.keyDown=function(W){if("r"===W.key.toLowerCase())return!0}}function t(){n.call(this)}function u(w){ba.getAttribute("data-cursor")!=w&&ba.setAttribute("data-cursor",w)}function y(){var w=ma.getActiveLayer();return w.visible&&
w.ancestorsAreVisible()?0!=w.alpha||(a.showLayerNotification(w,S("Whoops! This layer's opacity is currently 0%"),"opacity"),!1):(a.showLayerNotification(w,S("Whoops! This layer is currently hidden"),"layer"),!1)}function A(){var w=ma.getActiveLayer();return w instanceof Qa&&!ma.isEditingMask()?(a.showLayerNotification(w,S("Whoops! You can't draw on a group"),"layer"),!1):y()}function F(w,C,I,M,X){w.setValues(-X,M,C-M-X+I/4,C+I-X-I/4);w.setBlockIncrement(Math.max(1,~~(.66*M)));w.setUnitIncrement(Math.max(1,
~~(.05*M)))}function D(){if(eb.setToIdentity(),eb.translate(yb,Cb),eb.scale(Ma,Ma),eb.rotate(vb),null!=Hb&&null!=Vb&&!Hb.getValueIsAdjusting()&&!Vb.getValueIsAdjusting()){var w=da(new ka(0,0,Ja.width,Ja.height));F(Hb,w.left,w.getWidth(),ba.clientWidth,sa.getOffset().x);F(Vb,w.top,w.getHeight(),ba.clientHeight,sa.getOffset().y)}sa.repaintAll()}function G(w){return eb.getInverted().getTransformedPoint(w)}function E(w){w=G(w);return w.x=Math.floor(w.x),w.y=Math.floor(w.y),w}function P(w){return eb.getTransformedPoint(w)}
function N(w){w=P(w);return w.x=Math.round(w.x),w.y=Math.round(w.y),w}function O(w,C){w.beginPath();w.moveTo(C[0].x,C[0].y);for(var I=1;I<C.length;I++)w.lineTo(C[I].x,C[I].y);w.lineTo(C[0].x,C[0].y);w.stroke()}function U(w,C){var I=P({x:(C.left+C.right)/2,y:(C.top+C.bottom)/2});C=C.toPoints();for(var M=0;M<C.length;M++)C[M]=N(C[M]),C[M].x+=.5*Math.sign(I.x-C[M].x),C[M].y+=.5*Math.sign(I.y-C[M].y);O(w,C)}function da(w){var C=N({x:w.left-1,y:w.top-1}),I=N({x:w.left-1,y:w.bottom}),M=N({x:w.right,y:w.top-
1});w=N({x:w.right,y:w.bottom});C=new ka(Math.min(Math.min(C.x,I.x),Math.min(M.x,w.x)),Math.min(Math.min(C.y,I.y),Math.min(M.y,w.y)),Math.max(Math.max(C.x,I.x),Math.max(M.x,w.x))+1,Math.max(Math.max(C.y,I.y),Math.max(M.y,w.y))+1);return C.grow(2,2),C}function la(){var w=ba.width,C=ba.height,I=P({x:ma.width/2,y:ma.height/2});sa.setOffset(Math.round(yb+w/2-I.x),Math.round(Cb+C/2-I.y))}function J(w,C,I){if(w=Math.max(.1,Math.min(16,w)),sa.getZoom()!=w){var M=sa.getOffset();sa.setOffset(M.x+~~((C-M.x)*
(1-w/sa.getZoom())),M.y+~~((I-M.y)*(1-w/sa.getZoom())));sa.setZoom(w);sa.repaintAll()}}function ea(w){let C=ba.clientWidth,I=ba.clientHeight,M=parseFloat(w);.01>Math.abs(M-1)?w=1:.2>Math.abs(M-2)?w=2:.08>Math.abs(M-.5)&&(w=.5);J(w,C/2,I/2)}function Z(w){return"mouse"===w.pointerType&&0!==w.buttons&&0===w.pressure?1:"touch"===w.pointerType?(0!==w.pressure&&(zb=!0),zb)?2*w.pressure:1:2*w.pressure}function Xa(){$b||($b=!0,window.requestAnimationFrame(function(){sa.paint()}))}function Ca(w){sb.union(w);
Xa()}function pb(){Fb=ma.getBounds();sa.repaintAll()}let jb,sa=this,ta=document.createElement("div"),T=document.createElement("div"),na=document.createElement("div"),ba=document.createElement("canvas"),Q=ba.getContext("2d"),Ja=document.createElement("canvas"),V=Ja.getContext("2d"),Ba=Re(Q),ma=a.getArtwork(),Ma=1,yb=0,Cb=0,vb=0,eb=new ib,lb=!1,Bb=!1,bb=32,Wa=0,Ia=0,Ub=!1,$a=[!1,!1,!1],wb=!1,zb=!1,Fb=ma.getBounds(),sb=new ka(0,0,0,0),$b=!1,Gb;let Xb,Yb,fc,uc,tc,ca,Qb,ac,Kb=[],Ea=new Jb,wa,Hb=new Yc(!1),
Vb=new Yc(!0);Math.sign=Math.sign||function(w){return 0==(w*=1)||isNaN(w)?w:0<w?1:-1};c.prototype.transient=!1;c.prototype.capture=!1;c.prototype.enter=function(){u("default")};c.prototype.leave=function(){this.capture=!1};c.prototype.mouseMove=c.prototype.paint=c.prototype.mouseDown=c.prototype.mouseDrag=c.prototype.mouseUp=c.prototype.keyDown=c.prototype.suspend=c.prototype.resume=c.prototype.keyUp=function(){};d.prototype=Object.create(c.prototype);d.prototype.constructor=d;d.prototype.mouseDown=
function(w,C,I){var M=Ha(qb).isPressed("space");!M&&(2==C||0==C&&w.altKey)?(Ea.push(Xb,!0),Ea.peek().mouseDown(w,C,I)):M||0!=C||w.altKey||!Ha(qb).isPressed("r")?(1==C||!w.altKey&&M&&0==C)&&(Ea.push(Yb,!0),Ea.peek().mouseDown(w,C,I)):(Ea.push(fc,!0),Ea.peek().mouseDown(w,C,I))};d.prototype.keyDown=function(w){if("r"===w.key.toLowerCase()&&" "!==w.key)Ea.push(fc,!0),Ea.peek().keyDown(w);else if("r"!==w.key.toLowerCase()&&" "===w.key&&!w.altKey)return Ea.push(Yb,!0),Ea.peek().keyDown(w),!0};b.prototype=
Object.create(c.prototype);b.prototype.constructor=b;b.prototype.getBrushPreviewOval=function(){let w=a.getBrushSize()*Ma/2;return new ka(Wa-w,Ia-w,Wa+w,Ia+w)};b.prototype.queueBrushPreview=function(){if(Ea.peek()==this){this.shouldPaintBrushPreview=!0;var w=this.getBrushPreviewOval();w.grow(2,2);null!=this.oldPreviewRect&&(w.union(this.oldPreviewRect),this.oldPreviewRect=null);Ca(w)}};b.prototype.eraseBrushPreview=function(){this.shouldPaintBrushPreview=!1;null!=this.oldPreviewRect&&(Ca(this.oldPreviewRect),
this.oldPreviewRect=null)};b.prototype.mouseMove=function(w,C){this.queueBrushPreview()};b.prototype.enter=function(){c.prototype.enter.call(this);Ub&&this.queueBrushPreview()};b.prototype.leave=function(){c.prototype.leave.call(this);this.eraseBrushPreview()};b.prototype.suspend=b.prototype.leave;b.prototype.resume=b.prototype.enter;b.prototype.paint=function(){if(this.shouldPaintBrushPreview){this.shouldPaintBrushPreview=!1;var w=this.getBrushPreviewOval();Q.beginPath();Q.arc((w.left+w.right)/2,
(w.top+w.bottom)/2,w.getWidth()/2,0,2*Math.PI);Q.stroke();w.grow(2,2);null==this.oldPreviewRect?this.oldPreviewRect=w:this.oldPreviewRect.union(w)}};g.prototype=Object.create(b.prototype);g.prototype.constructor=g;g.prototype.mouseDown=function(w,C,I){if(!this.capture&&0==C&&!w.altKey&&!Ha(qb).isPressed("space")&&A()&&(w=G({x:Wa,y:Ia}),this.eraseBrushPreview(),ma.beginStroke(w.x,w.y,I)))return this.capture=!0,this.smoothMouse=w,!0};g.prototype.mouseDrag=function(w,C){if(("number"!=typeof navigator.maxTouchPoints||
3>navigator.maxTouchPoints)&&b.prototype.mouseMove.call(this,w,C),this.capture){w=G({x:Wa,y:Ia});var I=Math.min(.999,Math.pow(a.getBrushInfo().smoothing,.3));let M=1-I;return this.smoothMouse.x=M*w.x+I*this.smoothMouse.x,this.smoothMouse.y=M*w.y+I*this.smoothMouse.y,ma.continueStroke(this.smoothMouse.x,this.smoothMouse.y,C),!0}this.mouseMove(w)};g.prototype.mouseUp=function(w,C,I){if(this.capture)return 0==C&&(this.capture=!1,ma.endStroke()),!0};n.prototype=Object.create(b.prototype);n.prototype.constructor=
n;n.prototype.drawLine=function(w,C){ma.beginStroke(w.x,w.y,1);ma.continueStroke(C.x,C.y,1);ma.endStroke()};f.prototype=Object.create(b.prototype);f.prototype.constructor=f;e.prototype=Object.create(c.prototype);e.prototype.constructor=e;l.prototype=Object.create(c.prototype);l.prototype.constructor=l;k.prototype=Object.create(c.prototype);k.prototype.constructor=k;k.prototype.mouseDown=function(w,C,I){if(0==C&&!w.altKey&&!Ha(qb).isPressed("space")&&A())return w=G({x:Wa,y:Ia}),ma.isPointWithin(w.x,
w.y)&&(ma.floodFill(w.x,w.y),sa.repaintAll()),!0};h.prototype=Object.create(c.prototype);h.prototype.constructor=h;m.prototype=Object.create(c.prototype);m.prototype.constructor=m;m.prototype.mouseMove=function(w){if(!Ha(qb).isPressed("r"))return u("move"),!0};m.prototype.enter=function(){u("move")};q.prototype=Object.create(c.prototype);q.prototype.constructor=q;r.prototype=Object.create(c.prototype);r.prototype.constructor=r;t.prototype=Object.create(n.prototype);t.prototype.constructor=t;t.prototype.drawLine=
function(w,C){ma.gradientFill(Math.round(w.x),Math.round(w.y),Math.round(C.x),Math.round(C.y),a.getCurGradient())};t.prototype.queueBrushPreview=function(){};this.setZoom=function(w){Ma=w;D()};this.getZoom=function(){return Ma};this.setGridSize=function(w){bb=Math.max(Math.round(w),1);this.repaintAll()};this.getGridSize=function(){return bb};this.setOffset=function(w,C){isNaN(w)||isNaN(C)?console.log("Bad offset"):(yb=w,Cb=C,D())};this.getOffset=function(){return{x:yb,y:Cb}};this.setInterpolation=
function(w){lb=w;Id(Q,w);this.repaintAll()};this.setRotation=function(w){vb=w%(2*Math.PI);D()};this.getRotation=function(){return vb};this.getRotation90=function(){var w=Math.round(this.getRotation()/Math.PI*2);return 0>(w%=4)&&(w+=4),w};this.zoomIn=function(){ea(1.41*this.getZoom())};this.zoomOut=function(){ea(.7092*this.getZoom())};this.zoom100=function(){ea(1);la()};this.resetRotation=function(){var w=ba.width/2,C=ba.height/2,I=new ib;I.rotateAroundPoint(-this.getRotation(),w,C);I.multiply(eb);
this.setOffset(~~I.getTranslateX(),~~I.getTranslateY());this.setRotation(0);sa.emitEvent("canvasRotated90",[0])};let x=!1;this.getElement=function(){return ta};this.repaintAll=function(){sb.left=0;sb.top=0;sb.right=ba.width;sb.bottom=ba.height;Xa()};this.paint=function(){var w=!1;if($b=!1,sb.isEmpty()||(Q.save(),Q.clipTo&&(Q.beginPath(),sb.left|=0,sb.top|=0,Q.rect(sb.left,sb.top,Math.ceil(sb.getWidth()),Math.ceil(sb.getHeight())),Q.clip()),w=!0),!Fb.isEmpty()){var C=Gb&&Gb.isOpen()?Gb.getImageData():
ma.fusionLayers().getImageData();V.putImageData(C,0,0,Fb.left,Fb.top,Fb.getWidth(),Fb.getHeight());Fb.makeEmpty()}if(Q.fillStyle="#606060",Q.fillRect(0,0,ba.width,ba.height),Q.save(),Q.setTransform(eb.m[0],eb.m[1],eb.m[2],eb.m[3],eb.m[4],eb.m[5]),Q.fillStyle=Ba,Q.fillRect(0,0,ma.width,ma.height),Q.drawImage(Ja,0,0,Ja.width,Ja.height),Q.restore(),md(Q,"stroke"),Q.lineWidth=1,ma.getSelection().isEmpty()||Ea.peek()instanceof h&&Ea.peek().capture||(Q.setLineDash([3,2]),U(Q,ma.getSelection()),Q.setLineDash([])),
Bb)if(C=ma.getBounds(),2<Ma*bb){Q.beginPath();for(var I=bb-1;I<C.right;I+=bb){var M=P({x:I,y:C.top}),X=P({x:I,y:C.bottom});Q.moveTo(M.x+.5,M.y+.5);Q.lineTo(X.x+.5,X.y+.5)}for(I=bb-1;I<C.bottom;I+=bb)M=P({x:0,y:I}),X=P({x:C.right,y:I}),Q.moveTo(M.x+.5,M.y+.5),Q.lineTo(X.x+.5,X.y+.5);Q.stroke()}Ea.paint(Q);Q.globalCompositeOperation="source-over";w&&(sb.makeEmpty(),Q.restore())};this.showGrid=function(w){Bb=w;this.repaintAll()};this.resize=function(w,C){w-=na.offsetHeight;ba.style.height=w+"px";ba.width=
ba.clientWidth;ba.height=w;jb=null;C||la();this.setInterpolation(lb);this.repaintAll()};a.on("toolChange",function(w,C){w=Kb[C.strokeMode];for(C=0;C<Ea.modes.length;C++)if(Ea.modes[C]instanceof b){Ea.modes[C].leave();Ea.modes[C]=w;Ea.modes[C].enter();break}wa=w});a.on("modeChange",function(w){switch(w){case Y.M_DRAW:var C=wa;break;case Y.M_FLOODFILL:C=uc;break;case Y.M_GRADIENTFILL:C=tc;break;case Y.M_RECT_SELECTION:C=ca;break;case Y.M_MOVE_TOOL:C=Qb;break;case Y.M_ROTATE_CANVAS:C=fc;break;case Y.M_PAN_CANVAS:C=
Yb;break;case Y.M_COLOR_PICKER:C=Xb;break;case Y.M_TRANSFORM:C=ac}Ea.setUserMode(C)});a.on("maskViewOpened",function(w){Gb&&Gb.off("changeLayer",pb);(Gb=w).on("changeLayer",pb);pb()});var H=new d;Xb=new e;Yb=new l;fc=new r;uc=new k;tc=new t;ca=new h;Qb=new m;ac=new q;wa=(Kb=[new g,new n,new f])[ha.STROKE_MODE_FREEHAND];Ea.setDefaultMode(H);Ea.setUserMode(wa);Ja.width=ma.width;Ja.height=ma.height;ba.width=800;ba.height=900;ba.className="chickenpaint-canvas";ba.setAttribute("touch-action","none");Q.setLineDash||
(Q.setLineDash=function(){});ba.addEventListener("contextmenu",function(w){w.preventDefault()});ba.addEventListener("mouseenter",function(){Ub=!0});ba.addEventListener("mouseleave",function(){Ub=!1;$a[0]||$a[2]||$a[1]||sa.repaintAll()});ba.addEventListener("pointerdown",function(w){wb&&"touch"===w.pointerType||(ba.setPointerCapture(w.pointerId),jb=ba.getBoundingClientRect(),Wa=w.clientX-jb.left,Ia=w.clientY-jb.top,$a[0]=!1,$a[2]=!1,$a[1]=!1,$a[w.button]=!0,Ea.mouseDown(w,w.button,Z(w)))});ba.addEventListener("pointermove",
function(w){if(jb||=ba.getBoundingClientRect(),!wb||"touch"!==w.pointerType){Wa=w.clientX-jb.left;Ia=w.clientY-jb.top;var C=0!==w.buttons,I=C?Z(w):0;if(0!=(1&w.buttons)!=$a[0]){if(.5===w.mozPressure)return;$a[0]=!$a[0];$a[0]?Ea.mouseDown(w,0,I):Ea.mouseUp(w,0,I)}0!=(2&w.buttons)!=$a[2]&&($a[2]=!$a[2],$a[2]?Ea.mouseDown(w,2,I):Ea.mouseUp(w,2,I));0!=(4&w.buttons)!=$a[1]&&($a[1]=!$a[1],$a[1]?Ea.mouseDown(w,1,I):Ea.mouseUp(w,1,I));C?Ea.mouseDrag(w,I):Ea.mouseMove(w,I);wb||"pen"!==w.pointerType||(wb=!0)}});
ba.addEventListener("pointerup",function(w){$a[0]=!1;$a[2]=!1;$a[1]=!1;Ea.mouseUp(w,w.button,0);ba.releasePointerCapture(w.pointerId)});ba.addEventListener("wheel",function(w){if(0!=w.deltaY){if(!x||20<Math.abs(w.deltaY)){var C,I;let M;M=0<w.deltaY?1/1.15:1.15;let X=(C={x:w.pageX,y:w.pageY},I=ba.getBoundingClientRect(),{x:C.x-I.left-window.pageXOffset,y:C.y-I.top-window.pageYOffset});C=G(X);ma.isPointWithin(C.x,C.y)?J(sa.getZoom()*M,X.x,X.y):J(sa.getZoom()*M,yb+~~(ma.width*Ma/2),Cb+~~(ma.height*Ma/
2));x=x||setTimeout(function(){x=!1},50)}w.preventDefault()}},{passive:!1});document.addEventListener("keydown",function(w){Ea.keyDown(w)});document.addEventListener("keyup",function(w){"alt"===w.key.toLowerCase()&&w.preventDefault();Ea.keyUp(w)});document.addEventListener("visibilitychange",function(){let w=ba.height+na.offsetHeight;ba.width=1;ba.height=1;sa.resize(w,!0)},!1);window.addEventListener("scroll",function(){jb=null});ba.addEventListener("mousedown",function(w){1==w.button&&w.preventDefault()});
ma.on("changeSelection",function(){sa.repaintAll()});ma.on("updateRegion",function(w){Fb.union(w);Ca(da(Fb))});Hb.on("valueChanged",function(w){var C=sa.getOffset();sa.setOffset(-w,C.y)});Vb.on("valueChanged",function(w){var C=sa.getOffset();sa.setOffset(C.x,-w)});this.setInterpolation(!0);H=document.createElement("div");H.className="chickenpaint-canvas-container-wrapper";H.appendChild(ba);T.className="chickenpaint-canvas-container-top";T.appendChild(H);T.appendChild(Vb.getElement());na.className=
"chickenpaint-canvas-container-bottom";na.appendChild(Hb.getElement());ta.appendChild(T);ta.appendChild(na);a.setCanvas(this)}function Eb(a,c,d,b){a.getSmallScreenMode()&&S(d+" (shorter)")!==d+" (shorter)"?this.title=S(d+" (shorter)"):this.title=S(d);b=b||{};this.name=c;this.resizeVert=b.resizeVert||!1;this.resizeHorz=b.resizeHorz||!1;let g=document.createElement("div");d=document.createElement("div");let n=document.createElement("i"),f=document.createElement("button"),e=document.createElement("div"),
l=null,k=null,h,m,q,r=this;this.getElement=function(){return g};this.getBodyElement=function(){return e};this.getWidth=function(){return g.offsetWidth};this.getHeight=function(){return g.offsetHeight};this.getX=function(){return parseInt(g.style.left,10)||0};this.getY=function(){return parseInt(g.style.top,10)||0};this.setLocation=function(u,y){g.style.left=u+"px";g.style.top=y+"px"};this.setWidth=function(u){g.style.width=u+"px"};this.setHeight=function(u){g.style.height=u+"px"};this.setSize=function(u,
y){this.setWidth(u);this.setHeight(y)};this.setCollapseDownwards=function(u){b.collapseDownwards=u};this.toggleCollapse=function(u){var y;if(void 0===u)u=!g.classList.contains("collapsed");else if(g.classList.contains("collapsed")===u)return;var A=null===(y=g.closest(".chickenpaint"))||void 0===y?void 0:y.querySelector(".chickenpaint-canvas");y=A?A.clientHeight:window.innerHeight;A=this.getHeight();A=this.getY()+A;(g.classList.toggle("collapsed",u),n.classList.toggle("icon-angle-down",!u),n.classList.toggle("icon-angle-up",
u),u)?b.collapseDownwards&&this.setLocation(this.getX(),Math.min(A,y)-this.getHeight()):(u=this.getHeight(),b.collapseDownwards?this.setLocation(this.getX(),Math.max(A-u,0)):this.getY()+u>y&&this.setLocation(this.getX(),Math.max(y-u,0)))};this.userIsDoneWithUs=function(){a.getSmallScreenMode()&&this.toggleCollapse(!0)};n.className="collapse-icon fas icon-angle-down";f.type="button";f.className="btn btn-close";f.textContent="";f.tabIndex=-1;g.className="chickenpaint-palette chickenpaint-palette-"+
c;d.className="chickenpaint-palette-head";d.setAttribute("touch-action","none");c=document.createElement("div");let t=document.createElement("h5");c.className="modal-header";t.className="modal-title";t.appendChild(document.createTextNode(this.title));t.appendChild(n);c.appendChild(t);c.appendChild(f);d.appendChild(c);e.className="chickenpaint-palette-body";g.appendChild(d);g.appendChild(e);this.resizeVert&&((l=document.createElement("div")).className="chickenpaint-resize-handle-vert",l.addEventListener("pointerdown",
function(u){m="vertResize";l.setPointerCapture(u.pointerId)}),l.addEventListener("pointermove",function(u){"vertResize"==m&&r.setHeight(u.pageY-g.offsetTop)}),l.addEventListener("pointerup",function(u){l.releasePointerCapture(u.pointerId);m=!1}),g.appendChild(l));this.resizeHorz&&((k=document.createElement("div")).className="chickenpaint-resize-handle-horz",k.addEventListener("pointerdown",function(u){m="horzResize";k.setPointerCapture(u.pointerId)}),k.addEventListener("pointermove",function(u){"horzResize"==
m&&r.setWidth(u.pageX-g.offsetLeft)}),k.addEventListener("pointerup",function(u){k.releasePointerCapture(u.pointerId);m=!1}),g.appendChild(k));d.addEventListener("pointerdown",function(u){0==u.button&&(u.stopPropagation(),u.preventDefault(),"BUTTON"==u.target.nodeName?r.emitEvent("paletteVisChange",[r,!1]):(h={x:parseInt(g.style.left,10)||0,y:parseInt(g.style.top,10)||0},q={x:u.pageX-g.offsetLeft,y:u.pageY-g.offsetTop},m=a.getSmallScreenMode()?"dragStart":"dragging",u.target.setPointerCapture(u.pointerId)))});
d.addEventListener("pointermove",function(u){if(("dragStart"===m||"dragging"===m)&&0!==u.buttons){let F=u.pageX-q.x,D=u.pageY-q.y;if("dragStart"==m){u=F;var y=D;var A=h;25<(u-A.x)*(u-A.x)+(y-A.y)*(y-A.y)&&(m="dragging")}"dragging"==m&&r.setLocation(F,D)}});d.addEventListener("pointerup",function(u){if("dragging"===m||"dragStart"===m){"dragStart"===m&&(u.stopPropagation(),u.preventDefault(),setTimeout(()=>{r.setLocation(h.x,h.y);r.toggleCollapse()},100));m=!1;try{u.target.releasePointerCapture(u.pointerId)}catch(y){console.error(y)}}})}
function od(a){function c(f){"LI"==this.nodeName&&(f=b[parseInt(this.getAttribute("data-buttonIndex"),10)],a.actionPerformed({action:f.command}))}Eb.call(this,a,"tool","Tools");let d=this,b=[{className:"chickenpaint-tool-rect-selection",command:"CPRectSelection",toolTip:"Marquee",shortcut:"m",mode:Y.M_RECT_SELECTION},{className:"chickenpaint-tool-move",command:"CPMoveTool",toolTip:"Move tool",shortcut:"v",mode:Y.M_MOVE_TOOL},{className:"chickenpaint-tool-flood-fill",command:"CPFloodFill",toolTip:"Flood fill",
shortcut:"f",mode:Y.M_FLOODFILL},{className:"chickenpaint-tool-gradient-fill",command:"CPGradientFill",toolTip:"Gradient fill",shortcut:"g",mode:Y.M_GRADIENTFILL},{className:"chickenpaint-tool-color-picker",command:"CPColorPicker",toolTip:"Color picker",shortcut:"i",mode:Y.M_COLOR_PICKER},{className:"chickenpaint-tool-blur",command:"CPBlur",toolTip:"Blur",shortcut:"u",mode:Y.M_DRAW,tool:Y.T_BLUR},{className:"chickenpaint-tool-pencil",command:"CPPencil",toolTip:"Pencil",shortcut:"n",mode:Y.M_DRAW,
tool:Y.T_PENCIL},{className:"chickenpaint-tool-pen",command:"CPPen",toolTip:"Pen",selected:!0,shortcut:"b",mode:Y.M_DRAW,tool:Y.T_PEN},{className:"chickenpaint-tool-airbrush",command:"CPAirbrush",toolTip:"Airbrush",shortcut:"a",mode:Y.M_DRAW,tool:Y.T_AIRBRUSH},{className:"chickenpaint-tool-water",command:"CPWater",toolTip:"Waterpaint",shortcut:"w",mode:Y.M_DRAW,tool:Y.T_WATER},{className:"chickenpaint-tool-eraser",command:"CPEraser",toolTip:"Eraser",shortcut:"e",mode:Y.M_DRAW,tool:Y.T_ERASER},{className:"chickenpaint-tool-soft-eraser",
command:"CPSoftEraser",toolTip:"Soft eraser",shortcut:"s",mode:Y.M_DRAW,tool:Y.T_SOFTERASER},{className:"chickenpaint-tool-smudge",command:"CPSmudge",toolTip:"Smudge",shortcut:"d",mode:Y.M_DRAW,tool:Y.T_SMUDGE},{className:"chickenpaint-tool-blender",command:"CPBlender",toolTip:"Blender",shortcut:"c",mode:Y.M_DRAW,tool:Y.T_BLENDER},{className:"chickenpaint-tool-dodge",command:"CPDodge",toolTip:"Dodge (tool)",shortcut:"o",mode:Y.M_DRAW,tool:Y.T_DODGE},{className:"chickenpaint-tool-burn",command:"CPBurn",
toolTip:"Burn (tool)",shortcut:"p",mode:Y.M_DRAW,tool:Y.T_BURN},{className:"chickenpaint-tool-rotate-canvas",command:"CPRotateCanvas",commandDoubleClick:"CPResetCanvasRotation",toolTip:"Rotate canvas",mode:Y.M_ROTATE_CANVAS},{className:"chickenpaint-tool-pan-canvas",command:"CPPanCanvas",toolTip:"Grab canvas",mode:Y.M_PAN_CANVAS}],g=document.createElement("ul");a.on("modeChange",function(f){let e=d.getBodyElement();(e.querySelectorAll("li").forEach(function(l){l.classList.remove("selected")}),f==
Y.M_DRAW)?(f=e.querySelector(`li[data-tool="${a.getCurTool()}"]`))&&f.classList.add("selected"):(f=e.querySelector(`li[data-mode="${f}"]`))&&f.classList.add("selected")});a.on("toolChange",function(f){let e=d.getBodyElement();a.getCurMode()==Y.M_DRAW&&(e.querySelectorAll("li").forEach(function(l){l.classList.remove("selected")}),(f=e.querySelector(`li[data-tool="${f}"]`))&&f.classList.add("selected"))});let n=d.getBodyElement();for(let f in g.className="chickenpaint-tools list-unstyled",b)!function(e){let l=
b[e],k=document.createElement("li"),h=document.createElement("div");k.className="chickenpaint-toolbar-button "+l.className;k.setAttribute("data-buttonIndex",e);k.setAttribute("data-mode",l.mode);void 0!==l.tool&&k.setAttribute("data-tool",l.tool);k.title=S(l.toolTip);l.shortcut&&(k.title+=" ("+l.shortcut.toUpperCase()+")",Ha(qb)(l.shortcut,function(){return c.call(k),!1}));l.selected&&(k.className+=" selected");h.className="chickenpaint-toolbar-button-icon";k.appendChild(h);g.appendChild(k)}(f);g.addEventListener("click",
function(f){let e=f.target.closest("li");e&&c.call(e,f)});g.addEventListener("dblclick",function(f){if(f=f.target.closest("li"))f=b[parseInt(f.getAttribute("data-buttonIndex"),10)],f.commandDoubleClick&&a.actionPerformed({action:f.commandDoubleClick})});n.appendChild(g)}function pd(a){Eb.call(this,a,"misc","Misc");let c=this,d=[{className:"chickenpaint-tool-zoom-in",command:"CPZoomIn",toolTip:"Zoom in"},{className:"chickenpaint-tool-zoom-out",command:"CPZoomOut",toolTip:"Zoom out"},{className:"chickenpaint-tool-zoom-100",
command:"CPZoom100",toolTip:"Zoom 100%"},{className:"chickenpaint-tool-flip-horizontal",command:"CPHFlip",toolTip:"Flip horizontal"},{className:"chickenpaint-tool-undo",command:"CPUndo",toolTip:"Undo"},{className:"chickenpaint-tool-redo",command:"CPRedo",toolTip:"Redo"},{className:"chickenpaint-tool-send",command:"CPSend",toolTip:"Save Oekaki"}];!function(){let b=c.getBodyElement(),g=document.createElement("ul");for(let n in g.className="chickenpaint-misc-tools list-unstyled",d){let f=d[n],e=document.createElement("li"),
l=document.createElement("div");"CPSend"!=f.command||a.isActionSupported("CPContinue")||(f.toolTip="Post Oekaki",f.className="chickenpaint-tool-send-and-end");e.className="chickenpaint-toolbar-button "+f.className;e.setAttribute("data-buttonIndex",n);e.setAttribute("title",S(f.toolTip));l.className="chickenpaint-toolbar-button-icon";e.appendChild(l);g.appendChild(e)}g.addEventListener("click",function(n){if(n=n.target.closest("li"))n=d[parseInt(n.getAttribute("data-buttonIndex"),10)],a.actionPerformed({action:n.command})});
b.appendChild(g)}()}function qd(a){Eb.call(this,a,"stroke","Stroke");let c=[{className:"chickenpaint-tool-freehand",command:"CPFreeHand",toolTip:S("Free-hand"),selected:!0},{className:"chickenpaint-tool-line",command:"CPLine",toolTip:S("Straight line")},{className:"chickenpaint-tool-bezier",command:"CPBezier",toolTip:S("Bezier curve")}],d=this.getBodyElement(),b=document.createElement("ul");for(let g in b.className="chickenpaint-stroke-tools list-unstyled",c){let n=c[g],f=document.createElement("li"),
e=document.createElement("div");f.className="chickenpaint-toolbar-button "+n.className;f.setAttribute("data-buttonIndex",g);f.setAttribute("title",n.toolTip);n.selected&&(f.className+=" selected");e.className="chickenpaint-toolbar-button-icon";f.appendChild(e);b.appendChild(f)}b.addEventListener("click",function(g){if(g=g.target.closest("li"))g=c[parseInt(g.getAttribute("data-buttonIndex"),10)],a.actionPerformed({action:g.command})});d.appendChild(b);a.on("toolChange",function(g,n){g=document.querySelector(".chickenpaint-tool-freehand");
let f=document.querySelector(".chickenpaint-tool-line"),e=document.querySelector(".chickenpaint-tool-bezier");g&&g.classList.toggle("selected",n.strokeMode==ha.STROKE_MODE_FREEHAND);f&&f.classList.toggle("selected",n.strokeMode==ha.STROKE_MODE_LINE);e&&e.classList.toggle("selected",n.strokeMode==ha.STROKE_MODE_BEZIER)})}function Nb(a,c,d){return c in a?Object.defineProperty(a,c,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[c]=d,a}function rd(a){Eb.call(this,a,"color","Color (picker)");let c=
new Se(a),d=new Te(a,c);a=new $f(a);let b=this.getBodyElement(),g=document.createElement("div");g.className="chickenpaint-colorpicker-top";g.appendChild(c.getElement());g.appendChild(d.getElement());b.appendChild(g);b.appendChild(a.getElement())}function $f(a){function c(n,f,e){for(;n.length<e;)n=f+n;return n}function d(){g.style.backgroundColor="#"+c(Number(b).toString(16),"0",6)}let b=0,g=document.createElement("div");this.getElement=function(){return g};a.on("colorChange",function(n){b=n.getRgb();
d()});g.className="chickenpaint-colorpicker-show";g.addEventListener("click",function(n){n.preventDefault();n="#"+c(Number(b).toString(16),"0",6);if(null!=(n=window.prompt(S("Please enter a color in hex format"),n)))try{(n.match(/^#/)||n.match(/^$/))&&(n=n.substring(1));let f=parseInt(n,16);a.setCurColor(new Za(f))}catch(f){}});d()}function Ic(a,c){function d(){var f=b.width;g.clearRect(0,0,f,b.height);g.beginPath();g.arc(f/2+1,f/2+1,Math.max(f/2,1)-2,0,2*Math.PI);n.state?g.fill():g.stroke()}var b=
document.createElement("canvas"),g=b.getContext("2d"),n=this;this.state=a||!1;this.setValue=function(f){this.state!=f&&(this.state=f,this.emitEvent("valueChange",[f]),d())};this.getElement=function(){return b};b.addEventListener("mousedown",function(f){n.setValue(!n.state)});b.title=c||"";b.className="chickenpaint-checkbox";b.width=20;b.height=20;b.fillStyle="black";b.strokeStyle="black";d()}function Sb(a,c,d,b,g=150){function n(){let u=l.width||g,y=l.height,A="string"==typeof t.title?S(t.title):
t.title(t.value),F=3*window.devicePixelRatio,D=.75*l.height;if(d)k.save(),k.fillStyle="white",k.fillRect(0,0,u,y),k.fillStyle="black",k.fillText(A,F,D),k.beginPath(),t.value>=h/2?k.rect(u/2,0,(t.value-h/2)*u/h,y):k.rect(t.value*u/h,0,(h/2-t.value)*u/h,y),k.fill(),k.clip(),k.fillStyle="white";else{var G=(t.value-a)/h;b&&(G=Math.pow(G,.6666666666666666));G*=u;k.save();k.save();k.fillStyle="black";k.beginPath();k.rect(0,0,G,y);k.fill();k.clip();k.fillStyle="white";k.fillText(A,F,D);k.restore();k.fillStyle=
"white";k.beginPath();k.rect(G,0,u,y);k.fill();k.clip();k.fillStyle="black"}k.fillText(A,F,D);k.restore()}function f(u){let y=l.clientWidth,A=l.getBoundingClientRect().left+window.scrollX;u=(u.pageX-A)/y;b&&(u=Math.pow(Math.max(u,0),1.5));t.setValue(u*h+a)}function e(u){switch(m){case 1:return f(u);case 2:var y=t.title();if(!y.includes(S("Brush size"))&&!y.includes(S("Opacity")))return f(u);y=(u.pageX-q)/4;if(0!==y){y=t.value+y;let A=Math.floor(y);t.setValue(A);q=u.pageX-4*(y-A)}}}let l=document.createElement("canvas"),
k=l.getContext("2d"),h=c-a,m=0,q,r=!1,t=this;this.value=void 0;this.title="";d=d||!1;l.addEventListener("pointerup",u=>{if(0===m)return l.releasePointerCapture(u.pointerId),l.removeEventListener("pointermove",e);if(0!==m)switch(m){case 1:0!==u.button||u.shiftKey||(m=0);break;case 2:(2==u.button||0===u.button&&u.shiftKey)&&(m=0);break;default:return}return l.releasePointerCapture(u.pointerId),l.removeEventListener("pointermove",e)});this.setValue=function(u){u=~~Math.max(a,Math.min(c,u));this.value!=
u&&(this.value=u,this.emitEvent("valueChange",[this.value]),r?n():(r=!0,this.resize()))};this.getElement=function(){return l};this.resize=function(){l.width=l.clientWidth||g;l.height=l.clientHeight||20;1<window.devicePixelRatio&&(l.style.height=l.height+"px",l.width*=window.devicePixelRatio,l.height*=window.devicePixelRatio);k.font=.47*l.height+"pt sans-serif";n()};l.addEventListener("pointerdown",function(u){0===m&&(2===u.button||0===u.button&&u.shiftKey?(m=2,q=u.pageX):(m=1,f(u)),l.setPointerCapture(u.pointerId),
l.addEventListener("pointermove",e))});l.addEventListener("contextmenu",function(u){u.preventDefault()});l.setAttribute("touch-action","none");l.className="chickenpaint-slider";"devicePixelRatio"in window||(window.devicePixelRatio=1)}function Zc(a,c,d){function b(){for(var h=e.style,m=Number(n.getRgb()).toString(16);6>m.length;)m="0"+m;h.backgroundColor="#"+m}let g=this,n=new Za(0),f=255,e=document.createElement("div");this.getElement=function(){return e};this.setColor=function(h){n.isEqual(h)||(n.copyFrom(h),
b(),this.emitEvent("colorChange",[n]))};this.setAlpha=function(h){h!=f&&(f=h,b(),this.emitEvent("alphaChange",[f]))};this.getColorRgb=function(){return n.getRgb()};this.getAlpha=function(){return f};this.setCurColor=this.setColor;e.className="chickenpaint-color-pick-swatch";a&&n.copyFrom(a);c&&(f=c);let l=new Lb.Popover(e,{html:!0,content:function(){return window.addEventListener("mousedown",k),function(){let h=document.createElement("div"),m=document.createElement("div"),q=new Se(g,n),r=new Te(g,
q,n.getHue()),t=new Sb(0,255);return h.className="chickenpaint-color-pick-panel",m.className="chickenpaint-colorpicker-top",m.appendChild(q.getElement()),m.appendChild(r.getElement()),h.appendChild(m),t.value=f,t.title=function(u){return S("Opacity: ")+u},t.on("valueChange",function(u){g.setAlpha(u)}),h.appendChild(t.getElement()),setTimeout(function(){t.resize()},0),h}()},trigger:"manual",placement:"bottom",container:d||!1}),k=function(h){var m=h.target;m=m.closest(".popover-body")||m.classList.contains("chickenpaint-color-pick-panel")||
m.classList.contains("chickenpaint-colorpicker-select")||m.classList.contains("chickenpaint-colorpicker-slider");h.preventDefault();m||l.hide()};e.addEventListener("click",function(h){h.preventDefault();l.toggle()});e.addEventListener("hidden.bs.popover",function(){window.removeEventListener("mousedown",k)});b()}function $d(a,c){let d=document.createElement("div");return d.className="chickenpaint-checkbox-slider-group",d.appendChild(a.getElement()),d.appendChild(c.getElement()),d}function Ue(a,c){for(let d in c)if(c.hasOwnProperty(d)){let b=
document.createElement("option");b.appendChild(document.createTextNode(S(c[d])));b.value=d;a.appendChild(b)}}function ag(a){function c(){n.gradient(n.getBounds(),0,0,n.width,0,l,!0);e.putImageData(n.imageData,0,0,0,0,150,32);b.fillRect(0,0,d.width,d.height);b.drawImage(f,0,0)}let d=document.createElement("canvas"),b=d.getContext("2d"),g=Re(b),n=new z(150,32),f=document.createElement("canvas"),e=f.getContext("2d"),l=a.getCurGradient();this.getElement=function(){return d};a.on("gradientChange",function(k){l=
k;c()});d.width=f.width=150;d.height=f.height=32;d.className="chickenpaint-gradient-preview";b.fillStyle=g;c()}function Jc(a){Eb.call(this,a,"brush","Tool options");let c=new bg(a),d=new cg(a),b=new dg(a),g=this.getBodyElement();g.addEventListener("touchmove",n=>{n.preventDefault()},{passive:!1});g.appendChild(c.getElement());g.appendChild(d.getElement());g.appendChild(b.getElement());a.on("modeChange",function(n){switch(c.getElement().style.display="none",d.getElement().style.display="none",b.getElement().style.display=
"none",n){case Y.M_GRADIENTFILL:d.getElement().style.display="block";break;case Y.M_TRANSFORM:b.getElement().style.display="block";break;default:c.getElement().style.display="block"}})}function bg(a){let c=[1,2,3,4,5,6,7,8,9,10,15,20,25,30,35,40,45,50,60,70,80,90,100,125,150,175,200],d=document.createElement("div"),b=document.createElement("select"),g=new Ic(!1,S("Control brush opacity with pen pressure")),n=new Sb(1,255),f=new Ic(!0,S("Control brush size with pen pressure")),e=new Sb(1,200,!1,!0),
l=new Ic(!1,S("Control brush scattering with pen pressure")),k=new Sb(0,1E3,!1,!0),h=new Sb(0,100,!1,!0),m=new Sb(0,100,!1,!0),q=new Sb(0,100,!1,!0),r=new Sb(0,100,!1,!0),t=new Jc.CPBrushPreview(a);this.getElement=function(){return d};n.title=function(u){return S("Opacity")+": "+u};n.on("valueChange",function(u){a.setAlpha(u)});e.title=function(u){return S("Brush size")+": "+u};e.on("valueChange",function(u){a.setBrushSize(u)});h.title=function(u){return S("Color")+": "+u+"%"};h.on("valueChange",
function(u){a.getBrushInfo().resat=u/100;a.callToolListeners()});m.title=function(u){return S("Blend")+": "+u+"%"};m.on("valueChange",function(u){a.getBrushInfo().bleed=u/100;a.callToolListeners()});q.title=function(u){return S("Spacing")+": "+u+"%"};q.on("valueChange",function(u){a.getBrushInfo().spacing=u/100;a.callToolListeners()});k.title=function(u){return S("Scattering")+": "+u+"%"};k.on("valueChange",function(u){a.getBrushInfo().scattering=u/100;a.callToolListeners()});r.title=function(u){return S("Smoothing")+
": "+u+"%"};r.on("valueChange",function(u){a.getBrushInfo().smoothing=u/100;a.callToolListeners()});l.on("valueChange",function(u){a.getBrushInfo().pressureScattering=u;a.callToolListeners()});g.on("valueChange",function(u){a.getBrushInfo().pressureAlpha=u;a.callToolListeners()});f.on("valueChange",function(u){a.getBrushInfo().pressureSize=u;a.callToolListeners()});b.addEventListener("change",function(u){a.getBrushInfo().tip=parseInt(b.value,10);b.blur()});b.className="form-control form-control-sm";
b.tabIndex=-1;Ue(b,["Round Pixelated","Round Hard Edge","Round Soft","Square Pixelated","Square Hard Edge"]);d.appendChild(b);d.appendChild(t.getElement());d.appendChild($d(f,e));d.appendChild($d(g,n));d.appendChild(h.getElement());d.appendChild(m.getElement());d.appendChild(q.getElement());d.appendChild($d(l,k));d.appendChild(r.getElement());g.setValue(a.getBrushInfo().pressureAlpha);n.setValue(a.getAlpha());f.setValue(a.getBrushInfo().pressureSize);e.setValue(a.getBrushSize());l.setValue(a.getBrushInfo().pressureScattering);
k.setValue(~~(100*a.getBrushInfo().scattering));b.value=a.getBrushInfo().tip;h.setValue(~~(100*a.getBrushInfo().resat));m.setValue(~~(100*a.getBrushInfo().bleed));q.setValue(~~(100*a.getBrushInfo().spacing));r.setValue(~~(100*a.getBrushInfo().smoothing));a.on("toolChange",function(u,y){n.setValue(y.alpha);e.setValue(y.size);f.setValue(y.pressureSize);g.setValue(y.pressureAlpha);b.value=y.tip;l.setValue(y.pressureScattering);~~(100*y.resat)!=h.value&&h.setValue(~~(100*y.resat));~~(100*y.bleed)!=m.value&&
m.setValue(~~(100*y.bleed));~~(100*y.spacing)!=q.value&&q.setValue(~~(100*y.spacing));~~(100*y.scattering)!=k.value&&k.setValue(~~(100*y.scattering));~~(100*y.smoothing)!=r.value&&r.setValue(~~(100*y.smoothing))});Ha(qb)("1,2,3,4,5,6,7,8,9,0",function(u,y){u=parseInt(y.shortcut,10);0==u&&(u=10);a.setAlpha(Math.round(u/10*255))});Ha(qb)("{,[",function(){let u=a.getBrushSize();for(let y=c.length-1;0<=y;y--)if(u>c[y]){a.setBrushSize(c[y]);break}});Ha(qb)("},]",function(){let u=a.getBrushSize();for(let y=
0;y<c.length;y++)if(u<c[y]){a.setBrushSize(c[y]);break}})}function cg(a){function c(){let e=[n.getAlpha()<<24|n.getColorRgb(),f.getAlpha()<<24|f.getColorRgb()];a.setCurGradient(e)}var d;let b=document.createElement("div");var g=new ag(a);let n=new Zc(new Za(16777215&a.getCurGradient()[0]),a.getCurGradient()[0]>>>24,b),f=new Zc(new Za(16777215&a.getCurGradient()[1]),a.getCurGradient()[1]>>>24,b);this.getElement=function(){return b};b.className="chickenpaint-gradient-panel";b.style.display="none";n.on("colorChange",
c);n.on("alphaChange",c);f.on("colorChange",c);f.on("alphaChange",c);(d=document.createElement("p")).textContent=S("Gradient");b.appendChild(d);b.appendChild(g.getElement());(d=document.createElement("div")).className="chickenpaint-gradient-colors";(g=document.createElement("div")).className="chickenpaint-gradient-start-color";g.appendChild(n.getElement());d.appendChild(g);(g=document.createElement("div")).className="chickenpaint-gradient-end-color";g.appendChild(f.getElement());d.appendChild(g);
b.appendChild(d)}function dg(a){var c={smooth:S("Smooth"),sharp:S("Sharp")};let d=document.createElement("div"),b=document.createElement("button"),g=document.createElement("button");var n=document.createElement("select");if(this.getElement=function(){return d},d.className="chickenpaint-transform-panel",d.style.display="none",b.type="button",g.type="button",b.className="btn btn-primary btn-block",g.className="btn btn-light btn-block",b.textContent=S("Apply transform"),g.textContent=S("Cancel"),n.addEventListener("change",
function(f){a.setTransformInterpolation(this.value)}),n.className="form-control chickenpaint-transform-interpolation",Ue(n,c),Hd(Zb(0,0).getContext("2d"))){c=document.createElement("div");let f=document.createElement("label");f.textContent=S("Transform style");c.className="form-group";c.appendChild(f);c.appendChild(n);d.appendChild(c)}n=document.createElement("div");n.appendChild(b);n.appendChild(g);n.className="form-group";d.appendChild(n);b.addEventListener("click",function(f){a.actionPerformed({action:"CPTransformAccept"});
f.preventDefault()});g.addEventListener("click",function(f){a.actionPerformed({action:"CPTransformReject"});f.preventDefault()})}function eg(a){a.preventDefault();a.stopPropagation()}function Tb(a){let c=document.createElement("span");return c.className="fa "+a,c}function ae(a){let c=document.createElement("span");return c.className="chickenpaint-icon chickenpaint-icon-"+a,c}function Ve(a,c){let d=document.createElement("div"),b=document.createElement("label");return b.tabIndex=-1,a.tabIndex=-1,d.className=
"form-check",a.className="form-check-input",b.className="form-check-label",b.setAttribute("for",a.id),b.appendChild(a),b.appendChild(document.createTextNode(c)),d.appendChild(a),d.appendChild(b),d}function sd(a){function c(){let D=g.getActiveLayer();D.getAlpha()!=k.value&&k.setValue(D.getAlpha());let G=g.getActiveLayer();for(;h.lastChild;)h.removeChild(h.lastChild);for(let E=L.LM_FIRST;E<=L.LM_LAST;E++)if(E!=L.LM_MULTIPLY2&&(E==G.blendMode||E===L.LM_PASSTHROUGH&&G instanceof Qa||E<=L.LM_LAST_CHIBIPAINT)){let P=
document.createElement("option");P.appendChild(document.createTextNode(S(L.BLEND_MODE_DISPLAY_NAMES[E])));E!==L.LM_MULTIPLY||G.blendMode===E||G.useLegacyMultiply?P.value=E:P.value=L.LM_MULTIPLY2;h.appendChild(P)}D.getBlendMode()!=parseInt(h.value,10)&&(h.value=D.getBlendMode());D.getLockAlpha()!=r.checked&&(r.checked=D.getLockAlpha());(function(){var E=g.getActiveLayer();let P=g.isEditingMask();E={"image-layer":E instanceof qa,"layer-group":E instanceof Qa,"clipping-mask":E instanceof qa&&E.clip,
"no-clipping-mask":E instanceof qa&&!E.clip,"no-clipping-mask-or-is-group":!(E instanceof qa)||!E.clip,mask:E&&null!==E.mask,"no-mask":E&&null===E.mask,"mask-enabled":E&&null!==E.mask&&E.maskVisible,"mask-disabled":E&&null!==E.mask&&!E.maskVisible,isNotEditingMask:E&&!P,isEditingMask:E&&null!==E.mask&&P};for(let N of"mask no-mask isEditingMask isNotEditingMask clipping-mask no-clipping-mask-or-is-group image-layer layer-group".split(" "))for(let O of u.getElementsByClassName("chickenpaint-action-require-"+
N))O.style.display=E[N]?"inline-block":"none";u.querySelectorAll("[data-action]").forEach(function(N){let O=N.getAttribute("data-action");N.classList.toggle("disabled",!a.isActionAllowed(O))})})()}function d(){g=this;l.resize();c()}Eb.call(this,a,"layers","Layers",{resizeHorz:!0,resizeVert:!0});let b=this,g=a.getArtwork(),n=null,f=this.getBodyElement(),e=this.getElement(),l=new function(){function D(ta){let T=Ca.querySelectorAll(".chickenpaint-layer");return T[T.length-1-ta]}function G(ta){ta=ta.closest(".chickenpaint-layer");
if(!ta)return-1;let T=Array.from(Ca.querySelectorAll(".chickenpaint-layer"));return T.length-1-T.indexOf(ta)}function E(){var ta;if(2===Z.state){var T=e.getBoundingClientRect();var na=!0;var ba=!0;if(Z.dropTarget=function(V,Ba){var ma=Ca.querySelectorAll(".chickenpaint-layer");V={layer:n[n.length-1],displayIndex:n.length-1,direction:"over"};for(var Ma=0;Ma<ma.length;Ma++){let yb=ma[ma.length-1-Ma].getBoundingClientRect();if(0===Ma&&Ba>yb.bottom){V=g.getLayersRoot().layers[0];V={layer:V,displayIndex:n.indexOf(V),
direction:"under"};break}if(Ba>=yb.top){ma=n[Ma];let Cb=yb.bottom-yb.top;V={layer:ma,displayIndex:Ma};ma instanceof Qa?Ba>=yb.top+.75*Cb?ma.expanded&&0<ma.layers.length?(V.layer=ma.layers[ma.layers.length-1],V.displayIndex--,V.direction="over"):V.direction="under":Ba>=yb.top+.25*Cb?ma.expanded&&0<ma.layers.length?(V.layer=ma.layers[ma.layers.length-1],V.displayIndex--,V.direction="over"):V.direction="inside":V.direction="over":V.direction=Ba>=yb.top+.5*Cb?"under":"over";break}}return V.layer.parent===
Z.layer.parent&&("over"===V.direction||"under"===V.direction)&&(Ba=V.layer.parent,Ma=Ba.indexOf(V.layer),"over"===V.direction&&Ba.layers[Ma+1]===Z.layer||"under"===V.direction&&Ba.layers[Ma-1]===Z.layer||V.layer===Z.layer)?null:Z.layer instanceof Qa&&(V.layer===Z.layer&&"inside"===V.direction||V.layer.hasAncestor(Z.layer))?null:V}(Z.dragX,Z.dragY),Z.dropTarget){var Q=D(Z.dropTarget.displayIndex);switch(Z.dropTarget.direction){case "over":case "under":Ca.appendChild(Z.dropBetweenMarkerElem);na=Z.dropTarget.layer.getDepth()-
1;var Ja;Q=Q.getBoundingClientRect();if("under"===Z.dropTarget.direction&&Z.dropTarget.layer instanceof Qa&&Z.dropTarget.layer.expanded){for(Ja=Z.dropTarget.displayIndex-1;0<=Ja&&n[Ja].hasAncestor(Z.dropTarget.layer);Ja--);Ja=D(Ja+1).getBoundingClientRect().bottom}else Ja=Q.bottom;na=Q.left-T.left+(0<na?26+16*na:0);Z.dropBetweenMarkerElem.style.left=na+"px";Z.dropBetweenMarkerElem.style.width=Q.right-T.left-na+"px";Z.dropBetweenMarkerElem.style.top=("over"===Z.dropTarget.direction?Q.top-1:Ja+1)-T.top+
"px";Ca.querySelectorAll(".chickenpaint-layer-drop-target").forEach(Ba=>Ba.classList.remove("chickenpaint-layer-drop-target"));na=!1;break;case "inside":let V=Ca.querySelectorAll(".chickenpaint-layer");V.forEach((Ba,ma)=>{Ba.classList.toggle("chickenpaint-layer-drop-target",V.length-1-ma===Z.dropTarget.displayIndex)});ba=!1}}ba&&Ca.querySelectorAll(".chickenpaint-layer-drop-target").forEach(V=>V.classList.remove("chickenpaint-layer-drop-target"));na&&(null===(ta=Z.dropBetweenMarkerElem)||void 0===
ta||ta.remove());Z.frameElem.style.top=Z.dragY-T.top-parseInt(Z.frameElem.style.height,10)/2+"px"}else null===(T=Z.dropBetweenMarkerElem)||void 0===T||T.remove(),null===(ba=Z.frameElem)||void 0===ba||ba.remove()}function P(ta){let T=ta.getImageThumbnail().getAsCanvas(pb);return T.title=S("Image"),T.className="chickenpaint-layer-thumbnail chickenpaint-layer-image-thumbnail",T.style.maxWidth=T.width/T.height*25+"px",ta!=g.getActiveLayer()||g.isEditingMask()||(T.className+=" active"),T}function N(ta){let T=
ta.getMaskThumbnail().getAsCanvas(pb);(T.title=S("Layer mask"),T.className="chickenpaint-layer-thumbnail chickenpaint-layer-mask-thumbnail",T.style.maxWidth=T.width/T.height*25+"px",ta==g.getActiveLayer()&&g.isEditingMask()&&(T.className+=" active"),ta.maskVisible)||(T.className+=" disabled",ta=T.getContext("2d"),ta.strokeStyle="red",ta.lineWidth=3,ta.moveTo(5,5),ta.lineTo(T.width-5,T.height-5),ta.moveTo(T.width-5,5),ta.lineTo(5,T.height-5),ta.stroke());return T}function O(ta,T){let na=document.createElement("div");
var ba=document.createElement("div");let Q=document.createElement("div");var Ja=document.createElement("div");let V=document.createElement("div"),Ba=document.createElement("div"),ma=document.createElement("div");if(na.className="chickenpaint-layer list-group-item",T==g.getActiveLayer()&&(na.className+=" active"),ba.className="chickenpaint-layer-eye",T.ancestorsAreVisible()||(ba.className+=" chickenpaint-layer-eye-hidden-ancestors"),ba.style.marginRight=2+16*(T.getDepth()-1)+"px",T.visible?(na.className+=
" chickenpaint-layer-visible",ba.appendChild(Tb("icon-eye"))):(na.className+=" chickenpaint-layer-hidden",ba.appendChild(Tb("icon-eye-slash"))),na.appendChild(ba),Q.className="chickenpaint-layer-description",T instanceof qa){if(T.clip&&(na.className+=" chickenpaint-layer-clipped",Ja.appendChild(Tb("icon-level-down-alt fa-flip-horizontal"))),T.lockAlpha)ba=ae("lock-alpha"),ba.title=S("Transparency locked"),Ba.appendChild(ba)}else T instanceof Qa&&(na.className+=" chickenpaint-layer-group",T.expanded?
(na.className+=" chickenpaint-layer-group-expanded",Ja.appendChild(Tb("icon-folder-open chickenpaint-layer-group-toggle"))):(na.className+=" chickenpaint-layer-group-collapsed",Ja.appendChild(Tb("icon-folder chickenpaint-layer-group-toggle"))));Ja.childNodes.length&&(Ja.className="chickenpaint-layer-icons",na.appendChild(Ja));try{T instanceof qa&&na.appendChild(P(T)),T.mask&&na.appendChild(N(T))}catch(Ma){console.log("Failed to create layer thumb")}Ja=T.name&&0<T.name.length?T.name:"(unnamed "+(T instanceof
Qa?"group":"layer")+")";return V.innerText=Ja,V.setAttribute("title",Ja),V.className="chickenpaint-layer-name",ma.innerText=S(L.BLEND_MODE_DISPLAY_NAMES[T.blendMode])+": "+T.alpha+"%",ma.className="chickenpaint-layer-blend",Q.appendChild(V),Q.appendChild(ma),na.appendChild(Q),Ba.className="chickenpaint-layer-status",na.appendChild(Ba),na.setAttribute("data-display-index",""+ta),na}function U(ta){if(-1<ta){let T=n[ta];ta=D(ta);T&&ta&&m.show(T,ta)}}function da(ta){2===Z.state?(Z.layerElem.classList.remove("chickenpaint-layer-dragging"),
Z.dropTarget&&("inside"===Z.dropTarget.direction?a.actionPerformed({action:"CPRelocateLayer",layer:Z.layer,toGroup:Z.dropTarget.layer,toIndex:Z.dropTarget.layer.layers.length}):a.actionPerformed({action:"CPRelocateLayer",layer:Z.layer,toGroup:Z.dropTarget.layer.parent,toIndex:Z.dropTarget.layer.parent.indexOf(Z.dropTarget.layer)+ +("over"===Z.dropTarget.direction)})),Z.dropTarget=null,Z.state=0,E()):Z.state=0;sa&&(clearTimeout(sa),sa=null);Ca.releasePointerCapture(ta.pointerId);Ca.removeEventListener("pointermove",
J);Ca.removeEventListener("pointerup",da)}function la(){Z.state=2;Z.frameElem=document.createElement("div");Z.frameElem.className="chickenpaint-layer-drag-frame";Z.frameElem.style.width=Z.layerElem.offsetWidth+"px";Z.frameElem.style.height=Z.layerElem.offsetHeight+"px";Z.dropBetweenMarkerElem=document.createElement("div");Z.dropBetweenMarkerElem.className="chickenpaint-layer-drop-between-mark";Z.layerElem.classList.add("chickenpaint-layer-dragging");Ca.appendChild(Z.frameElem)}function J(ta){ta=ta.clientY;
switch(Z.state){case 3:if(5<Math.abs(ta-Z.dragY))Z.state=4;else break;case 4:Ca.scrollTop=Z.initialScrollTop+Z.dragY-ta;break;case 1:if(5<Math.abs(ta-Z.dragY))la();else break;case 2:Z.dragY=ta,E()}}function ea(ta,T,na){try{let ba=ta.querySelector("."+(na?"chickenpaint-layer-mask-thumbnail":"chickenpaint-layer-image-thumbnail"));ba&&ba.replaceWith(na?N(T):P(T))}catch(ba){console.log("Error rebuilding thumbnail: ",ba)}}let Z={state:0,layer:null,layerElem:null,dragX:0,dragY:0,initialScrollTop:0,dropTarget:null,
dropBetweenMarkerElem:null,frameElem:null},Xa=document.createElement("div"),Ca=document.createElement("div"),pb=0,jb=!1,sa=null;for(let ta of(this.buildLayers=function(){let T=(n=g.getLayersRoot().getLinearizedLayerList(!0)).map((ba,Q)=>O(Q,ba)),na=document.createDocumentFragment();Ca.innerHTML="";for(let ba=T.length-1;0<=ba;ba--)na.appendChild(T[ba]);Ca.appendChild(na);E()},this.layerChanged=function(T){let na=n.indexOf(T),ba=D(na);!ba||T instanceof Qa&&(T.expanded!=ba.classList.contains("chickenpaint-layer-group-expanded")||
T.visible!=ba.classList.contains("chickenpaint-layer-visible"))?this.buildLayers():ba.replaceWith(O(na,T))},this.setRotation90=function(T){if(pb!==T)for(pb=T,T=0;T<n.length;T++){let na=n[T],ba=D(T);ba&&(ea(ba,na,!1),na.mask&&ea(ba,na,!0))}},this.layerImageThumbChanged=function(T){let na=D(n.indexOf(T));na&&ea(na,T,!1)},this.layerMaskThumbChanged=function(T){let na=D(n.indexOf(T));na&&(T.mask?ea(na,T,!0):(T=na.querySelector(".chickenpaint-layer-mask-thumbnail"))&&T.remove())},this.activeLayerChanged=
function(T,na){Ca.querySelectorAll(".active").forEach(Q=>{Q.classList.remove("active")});var ba=D(n.indexOf(T));ba.classList.add("active");T=ba.querySelector(".chickenpaint-layer-image-thumbnail");ba=ba.querySelector(".chickenpaint-layer-mask-thumbnail");T&&T.classList.toggle("active",!na);ba&&ba.classList.toggle("active",na)},this.resize=function(){b.dismissNotification();this.buildLayers()},this.getElement=function(){return Xa},this.revealLayer=function(T){T=D(T);let na=T.getBoundingClientRect(),
ba=Ca.getBoundingClientRect();return Ca.scrollTop=Math.max(Math.min(Math.max(Ca.scrollTop,Ca.scrollTop+na.bottom-ba.bottom),Ca.scrollTop+na.top-ba.top),0),T},e.id="chickenpaint-layer-pop",Xa.className="chickenpaint-layers-widget",Xa.addEventListener("contextmenu",T=>T.preventDefault(),!0),Ca.className="list-group",Ca.addEventListener("dblclick",function(T){0===T.button&&T.target.closest(".chickenpaint-layer-description")&&!T.target.closest("input")&&(U(G(T.target)),T.preventDefault())}),Ca.addEventListener("pointerdown",
function(T){let na=G(T.target.closest(".chickenpaint-layer"));if(-1!==na){let ba=n[na];if(0===T.button&&T.target.closest(".chickenpaint-layer-eye"))a.actionPerformed({action:"CPSetLayerVisibility",layer:ba,visible:!ba.visible});else if(0===T.button&&ba instanceof Qa&&T.target.closest(".chickenpaint-layer-group-toggle"))a.actionPerformed({action:"CPExpandLayerGroup",group:ba,expand:!ba.expanded});else{let Q=g.getActiveLayer()!==ba;if(jb=null!==T.target.closest(".chickenpaint-layer-mask-thumbnail")||
ba instanceof Qa&&null!==ba.mask&&Q,0===T.button&&T.shiftKey&&!T.ctrlKey&&!T.metaKey&&jb)a.actionPerformed({action:"CPSetMaskVisible",layer:ba,visible:!ba.maskVisible});else{let Ja,V;(Ja=0===T.button||Q?jb:g.isEditingMask(),V=g.isEditingMask()!==Ja,(Q||V)&&a.actionPerformed({action:"CPSetActiveLayer",layer:ba,mask:Ja}),Ja&&T.altKey)?a.actionPerformed({action:"CPToggleMaskView"}):Ja&&!T.shiftKey&&(T.ctrlKey||T.metaKey)?a.actionPerformed({action:"CPApplyLayerMask"}):Ja&&T.shiftKey&&(T.ctrlKey||T.metaKey)?
a.actionPerformed({action:"CPRemoveLayerMask"}):0===T.button?("pen"===T.pointerType||"touch"===T.pointerType?(Z.state=3,Z.initialScrollTop=Ca.scrollTop,sa&&clearTimeout(sa),sa=setTimeout(()=>{3===Z.state&&(la(),Z.dragY=T.clientY,E())},800)):Z.state=1,Z.dropTarget=null,Z.layer=ba,Z.layerElem=D(na),Z.dragX=T.clientX,Z.dragY=T.clientY,Ca.setPointerCapture(T.pointerId),Ca.addEventListener("pointermove",J),Ca.addEventListener("pointerup",da)):2!==T.button||Q||(T.preventDefault(),-1!=G(T.target)&&(U(G(T.target)),
T.preventDefault()))}}}}),Ca.setAttribute("touch-action","none"),["ontouchstart","ontouchmove","ontouchend","ontouchcancel"]))Ca.addEventListener(ta,eg);Xa.appendChild(Ca)},k=new Sb(0,100,!1,!1,208),h=document.createElement("select"),m=new function(){let D=null,G="",E=document.createElement("input"),P=this;this.hide=function(){D=null;let N=E.parentNode;N&&(N.removeChild(E),N.textContent=G)};this.renameAndHide=function(){D&&D.name!==E.value&&a.actionPerformed({action:"CPSetLayerName",layer:D,name:E.value});
this.hide()};this.show=function(N,O){E.value=G=(D=N).name;(N=O.querySelector(".chickenpaint-layer-name"))&&N.parentNode&&(O=N.firstChild)&&O.nodeType===Node.TEXT_NODE&&(N.removeChild(O),N.appendChild(E));E.select()};E.type="text";E.className="chickenpaint-layer-rename form-control input-sm";E.addEventListener("keydown",function(N){N.stopPropagation()});E.addEventListener("keydown",function(N){"Enter"===N.key&&P.renameAndHide();N.stopPropagation()});E.addEventListener("keyup",function(N){"Escape"===
N.key&&P.hide();N.stopPropagation()});E.addEventListener("blur",function(N){D&&P.renameAndHide()})},q=document.createElement("input"),r=document.createElement("input"),t=!1,u,y=this.setSize,A=this.setWidth,F=this.setHeight;this.setSize=function(D,G){y.call(this,D,G);this.dismissNotification();k.resize()};this.setWidth=function(D){A.call(this,D);k.resize();l.resize()};this.setHeight=function(D){F.call(this,D);l.resize()};this.setRotation90=function(D){l.setRotation90(D)};this.dismissNotification=function(){document.querySelectorAll(".chickenpaint-layer[aria-describedby], .chickenpaint-slider[aria-describedby]").forEach(D=>
{(D=Lb.Popover.getInstance(D))&&D.dispose()});t&&(clearTimeout(t),t=!1)};this.showNotification=(D,G,E)=>{let P=n.indexOf(D);D=g.getActiveLayer()==D&&"opacity"==E?k.getElement():l.revealLayer(P);this.dismissNotification();(new Lb.Popover(D,{html:!1,content:G,placement:"left",trigger:"manual",fallbackPlacement:[],boundary:"window",container:b.getElement()})).show();t=setTimeout(()=>{t=!1;this.dismissNotification()},Math.max(Math.round(70*G.length),3E3))};h.className="form-control form-control-sm";h.tabIndex=
-1;h.title=S("Layer blending mode");h.addEventListener("change",function(D){a.actionPerformed({action:"CPSetLayerBlendMode",blendMode:parseInt(h.value,10)});h.blur()});f.appendChild(h);k.title=function(D){return S("Opacity")+": "+D+"%"};k.on("valueChange",function(D){a.actionPerformed({action:"CPSetLayerAlpha",alpha:D})});f.appendChild(k.getElement());q.id="chickenpaint-chk-sample-all-layers";q.type="checkbox";q.addEventListener("click",function(D){g.setSampleAllLayers(q.checked);document.activeElement.blur()});
f.appendChild(Ve(q,S("Sample all layers")));r.id="chickenpaint-chk-lock-alpha";r.type="checkbox";r.addEventListener("click",function(D){a.actionPerformed({action:"CPSetLayerLockAlpha",lock:r.checked});document.activeElement.blur()});f.appendChild(Ve(r,S("Lock transparency")));f.appendChild(l.getElement());u=function(){var D=[{title:"Add layer",icon:Tb("icon-file"),action:"CPAddLayer"},{title:"Add group",icon:Tb("icon-folder"),action:"CPAddGroup"},{title:"Merge down",icon:Tb("icon-download_FILL"),
action:"CPLayerMergeDown",require:["image-layer"]},{title:"Merge group",icon:Tb("icon-collapse_all_FILL"),action:"CPGroupMerge",require:["layer-group"]},{title:"Clip to the layer below",icon:Tb("icon-level-down-alt fa-flip-horizontal"),action:"CPCreateClippingMask",require:"no-clipping-mask-or-is-group"},{title:"Unclip from the layer below",icon:Tb("icon-level-down-alt fa-flip-horizontal"),action:"CPReleaseClippingMask",require:"clipping-mask"},{title:"Add layer mask",icon:ae("mask"),action:"CPAddLayerMask",
require:["no-mask"]},{title:"Apply mask",icon:ae("mask"),action:"CPApplyLayerMask",require:["mask"]},{title:"Duplicate",icon:Tb("icon-clone"),action:"CPLayerDuplicate"},{title:"Delete layer mask",icon:Tb("icon-trash"),action:"CPRemoveLayerMask",require:"isEditingMask"},{title:"Delete layer",icon:Tb("icon-trash"),action:"CPRemoveLayer",require:"isNotEditingMask"}];let G=document.createElement("ul");for(let E of(G.className="chickenpaint-layer-buttons list-unstyled",D))D=document.createElement("li"),
D.setAttribute("data-action",E.action),D.className="chickenpaint-small-toolbar-button "+(E.require?"chickenpaint-action-require-"+E.require:""),D.title=S(E.title),D.appendChild(E.icon),D.addEventListener("click",function(){a.actionPerformed({action:E.action})}),G.appendChild(D);return G}();f.appendChild(u);g.on("changeActiveLayer",function(D,G,E){l.activeLayerChanged(G,E);c()});g.on("changeLayer",function(D){g=this;b.dismissNotification();l.layerChanged(D);c()});g.on("changeStructure",d);g.on("changeLayerMaskThumb",
function(D){g=this;l.layerMaskThumbChanged(D)});g.on("changeLayerImageThumb",function(D){g=this;l.layerImageThumbChanged(D)});a.on("layerNotification",this.showNotification.bind(this));d.call(g)}function fg(){this.table=new Uint8Array(256);this.loadIdentity=function(){for(var a=0;256>a;a++)this.table[a]=a};this.loadBrightnessContrast=function(a,c){c=0<c?1/(1.0001-c):1+c;a=.5-.5*c+a;for(var d=0;256>d;d++)this.table[d]=Math.min(255,Math.max(~~(255*(d/255*c+a)),0))};this.invert=function(){for(var a=
0;256>a;a++)this.table[a]=255-this.table[a]}}function We(a,c){let d=document.createElement("div"),b=document.createElement("label");return d.className="form-check",a.className="form-check-input",b.className="form-check-label",b.setAttribute("for",a.id),b.appendChild(a),b.appendChild(document.createTextNode(c)),d.appendChild(a),d.appendChild(b),d}function td(a){function c(P){for(let N=0;N<P.length;N++){let O=new e(P[N],32,32);O.on("click",function(){q=this.texture;f()});D.appendChild(O.getElement())}}
function d(P){let N=new ya(P,P,8);for(let O=1;O<P*P;O++)N.data[O]=255;return N}function b(P){let N=2*P,O=new ya(N,N,8);for(let U=0;U<N;U++)for(let da=0;da<N;da++)O.data[U+da*N]=255*(0!=(~~(U/P)+~~(da/P))%2);return O}function g(P,N){let O=new ya(N,N,8);for(let U=0;U<N*N;U++)~~(U%N)>=P&&(O.data[U]=255);return O}function n(P,N){let O=new ya(N,N,8);for(let U=0;U<N*N;U++)U/N>=P&&(O.data[U]=255);return O}function f(){if(null!=q){r=q.clone();t&&r.mirrorHorizontally();let P=new fg;P.loadBrightnessContrast(y,
A);u&&P.invert();r.applyLUT(P)}else r=null;a.getArtwork().setBrushTexture(r);null!=F&&F.updateTexture()}function e(P,N,O){let U=document.createElement("canvas"),da=U.getContext("2d"),la=this;this.setTexture=function(J){this.texture=J;this.paint()};this.getElement=function(){return U};this.paint=function(){null!=this.texture?da.fillStyle=da.createPattern(this.texture.getAsCanvas(),"repeat"):da.fillStyle="white";da.fillRect(0,0,U.width,U.height)};U.addEventListener("click",function(){la.emit("click")});
U.width=N;U.height=O;this.setTexture(P)}var l;let k,h,m;Eb.call(this,a,"textures","Textures");let q,r,t=!1,u=!1,y=0,A=0,F,D=document.createElement("div"),G=this.getBodyElement();e.prototype=Object.create(Ha(Ab).prototype);e.prototype.constructor=e;F=new function(){function P(){la.checked=u;J.checked=t;ea.setValue(100*y+100);Z.setValue(100*A+100)}let N,O,U,da=document.createElement("div"),la=document.createElement("input"),J=document.createElement("input"),ea=new Sb(0,200,!0),Z=new Sb(0,200,!0),Xa=
new e(null,64,64),Ca=document.createElement("button"),pb,jb=new Lb.Popover(Ca,{html:!0,content:()=>pb,trigger:"manual",placement:"right",container:G});this.updateTexture=function(){Ca.disabled=null==r;Xa.setTexture(r)};this.getElement=function(){return da};da.className="chickenpaint-texture-options";da.appendChild(Xa.getElement());Ca.type="button";Ca.className="btn btn-light btn-sm";Ca.setAttribute("data-bs-toggle","popover");Ca.setAttribute("data-bs-placement","right");Ca.textContent=S("Customize");
(N=document.createElement("div")).className="chickenpaint-texture-controls";la.id="chickenpaint-chk-texture-invert";la.type="checkbox";la.addEventListener("click",function(sa){u=this.checked;f()});N.appendChild(We(la,S("Inverse")));J.id="chickenpaint-chk-texture-mirror";J.type="checkbox";J.addEventListener("click",function(sa){t=this.checked;f()});N.appendChild(We(J,S("Mirror")));ea.title=function(sa){return S("Brightness")+": "+(sa-100)+"%"};ea.on("valueChange",function(sa){y=(sa-100)/100;f()});
N.appendChild(ea.getElement());Z.title=function(sa){return S("Contrast")+": "+(sa-100)+"%"};Z.on("valueChange",function(sa){A=(sa-100)/100;f()});N.appendChild(Z.getElement());O=document.createElement("button");U=document.createElement("button");O.textContent="Ok";O.className="btn btn-primary btn-sm";O.type="button";O.addEventListener("click",function(sa){jb.hide()});N.appendChild(O);N.appendChild(document.createTextNode(" "));U.textContent="Reset";U.className="btn btn-secondary btn-sm";U.type="button";
U.addEventListener("click",function(sa){A=y=0;u=t=!1;P();f()});N.appendChild(U);P();pb=N;Ca.addEventListener("click",function(){jb.toggle()});da.appendChild(Ca);this.updateTexture()};G.appendChild(F.getElement());D.className="chickenpaint-texture-swatches";G.appendChild(D);c((l=[null],(k=new ya(2,2,8)).data[0]=255,k.data[3]=255,l.push(k),l.push(d(2)),l.push(d(3)),l.push(d(4)),l.push(d(6)),l.push(d(8)),l.push(g(1,2)),l.push(g(2,4)),l.push(n(1,2)),l.push(n(2,4)),l.push(b(2)),l.push(b(4)),l.push(b(8)),
l.push(b(16)),l.push(function(P){let N=new ya(256,P,8);for(let O=0;O<P*P;O++)N.data[O]=Math.max(0,Math.min(255,Math.floor(.65*(.65*Math.floor(256*Math.random())-128)+128)));return N}(256)),l));l=a.getResourcesRoot()+"gfx/textures32.png?20241024.1";var E=function(P){c(P)};h=new Image;m=[];h.onload=function(){var P=document.createElement("canvas");let N=P.getContext("2d",{willReadFrequently:!0});P.width=h.width;P.height=h.height;for(P=0;2>P;P++){N.drawImage(h,0,32*P,32,32,0,0,32,32);try{let O=N.getImageData(0,
0,32,32),U=new ya(32,32,8);for(let da=0;1024>da;da++)U.data[da]=O.data[4*da];m.push(U)}catch(O){console.log(O)}}E(m)};h.src=l}function ud(a){function c(y){let A=document.createElement("div"),F=document.createElement("a"),D=document.createElement("ul"),G=document.createElement("a"),E=document.createElement("a"),P=this;this.getElement=function(){return A};this.setColor=function(O){F.setAttribute("data-color",O);var U=F.style;for(O=""+Number(O).toString(16);6>O.length;)O="0"+O;U.backgroundColor="#"+
O};this.setColor(y);F.href="#";F.className="chickenpaint-color-swatch dropdown-toggle";G.className="dropdown-item";G.href="#";G.textContent=S("Remove");G.addEventListener("click",function(O){O.preventDefault();A.remove();h=!0});E.className="dropdown-item";E.href="#";E.textContent=S("Replace with current color");E.addEventListener("click",function(O){O.preventDefault();P.setColor(a.getCurColor().getRgb());h=!0});D.className="dropdown-menu";y=document.createElement("li");let N=document.createElement("li");
y.appendChild(G);N.appendChild(E);D.appendChild(y);D.appendChild(N);A.className="chickenpaint-color-swatch-wrapper";A.appendChild(F);A.appendChild(D)}function d(y){y=new c(y);m.appendChild(y.getElement())}function b(y){let A=document.createElement("span");return A.className="fa icon-"+y,A}var g;let n;let f,e,l;Eb.call(this,a,"swatches","Color swatches");var k=[16777215,0,16711680,65280,255,16776960];let h=!1,m=document.createElement("ul"),q=document.createElement("div"),r,t=this;this.getSwatches=
function(){let y=m.querySelectorAll(".chickenpaint-color-swatch"),A=Array(y.length);for(let F=0;F<y.length;F++)A[F]=parseInt(y[F].getAttribute("data-color"),10);return A};this.setSwatches=function(y){for(;m.lastChild;)m.removeChild(m.lastChild);for(let A=0;A<y.length;A++)d(y[A]);h=!0};this.isModified=function(){return h};m.className="chickenpaint-color-swatches list-unstyled";for(g=0;g<k.length;g++)m.appendChild((new c(k[g])).getElement());m.addEventListener("click",function(y){let A=y.target;/^<a data-color=/i.test(A.outerHTML)&&
/chickenpaint-color-swatch/.test(A.className)&&0==y.button&&void 0!==A.getAttribute("data-color")&&(a.setCurColor(new Za(parseInt(A.getAttribute("data-color"),10))),y.stopPropagation(),y.preventDefault())});m.addEventListener("contextmenu",function(y){let A=y.target;if(/^<a data-color=/i.test(A.outerHTML)&&/chickenpaint-color-swatch/.test(A.className)){y.preventDefault();var F=new Lb.Dropdown(A);F.toggle();document.addEventListener("click",function E(G){F.hide();document.removeEventListener("click",
E)})}});this.getBodyElement().appendChild(m);k=document.createElement("button");g=document.createElement("button");n=document.createElement("ul");var u=document.createElement("a");f=document.createElement("a");g.type="button";g.title=S("Add the current brush color as a new swatch");g.className="btn chickenpaint-small-toolbar-button chickenpaint-color-swatch-add";g.appendChild(b("plus"));k.type="button";k.className="btn dropdown-toggle chickenpaint-small-toolbar-button chickenpaint-color-swatch-settings";
k.setAttribute("data-bs-toggle","dropdown");k.appendChild(b("cog"));u.className="dropdown-item";u.href="#";u.textContent=S("Save swatches to your computer...");u.addEventListener("click",function(y){y.preventDefault();y=new Blob([(new Hc).write(t.getSwatches())],{type:"application/octet-stream"});Ha(Xc).saveAs(y,"oekakiswatches.aco")});f.className="dropdown-item";f.href="#";f.textContent=S("Load swatches from your computer...");f.addEventListener("click",function(y){y.preventDefault();r.onchange=
function(){var A=this.files;if(!(1>A.length)){A=A[0];var F=new FileReader;F.onload=function(){let D=(new Hc).read(this.result);null!=D&&0<D.length?t.setSwatches(D):alert(S("The swatches could not be read, did you select an .aco file?"))};F.readAsArrayBuffer(A)}};r.click()});n.className="dropdown-menu";e=document.createElement("li");l=document.createElement("li");e.appendChild(u);l.appendChild(f);n.appendChild(e);n.appendChild(l);(u=document.createElement("div")).className="btn-group";u.appendChild(k);
u.appendChild(n);g.addEventListener("click",function(y){d(a.getCurColor().getRgb());h=!0});q.className="chickenpaint-color-swatches-buttons";window.File&&window.FileReader&&window.FileList&&window.Blob&&((r=document.createElement("input")).type="file",r.multiple=!1,r.style.display="none",q.appendChild(u),q.appendChild(r));q.appendChild(g);this.getBodyElement().appendChild(q)}function vd(a){function c(){let h=f.closest(".chickenpaint").querySelector(".chickenpaint-canvas");return{width:h.offsetWidth,
height:h.offsetHeight}}function d(h,m){let q=h.getElement();m?f.contains(q)||f.appendChild(q):f.contains(q)&&f.removeChild(q);e.emitEvent("paletteVisChange",[h.name,m])}let b={tool:new od(a),misc:new pd(a),stroke:new qd(a),color:new rd(a),brush:new Jc(a),layers:new sd(a),textures:new td(a),swatches:new ud(a)},g={tool:!1,color:!1,misc:!1};var n={color:!0,textures:!0,layers:!0};let f=document.createElement("div"),e=this,l=[],k=[];for(let h in this.palettes=b,this.showPaletteByName=function(m,q){(m=
b[m])&&d(m,q)},this.togglePalettes=function(){if(0===k.length)f.querySelectorAll(".chickenpaint-palette").forEach(function(m){e.showPaletteByName(m.getAttribute("data-paletteName"),!1);k.push(m)});else{for(let m=0;m<k.length;m++)e.showPaletteByName(k[m].getAttribute("data-paletteName"),!0);k=[]}},this.constrainPalettes=function(){let m=c();for(var q in b){let r=b[q];r.getX()+r.getWidth()/2>m.width&&r.setLocation(m.width-r.getWidth(),r.getY());r.getY()+r.getHeight()/2>m.height&&r.setLocation(r.getX(),
m.height-r.getHeight())}q=0<m.width-b.tool.getWidth()-b.misc.getWidth()-b.stroke.getWidth()-b.color.getWidth()-b.brush.getWidth()-15;b.swatches.getX()+b.swatches.getWidth()==b.brush.getX()+b.brush.getWidth()&&20>Math.abs(b.swatches.getY()-b.brush.getY())&&b.swatches.setLocation(b.brush.getX()-b.swatches.getWidth()-(q?5:1),0);b.layers.getY()+b.layers.getHeight()>m.height&&b.layers.setHeight(Math.max(m.height-b.layers.getY(),200))},this.arrangePalettes=function(){let m=c();if(a.getSmallScreenMode()){b.tool.setLocation(0,
0);b.misc.setLocation(b.tool.getX()+b.tool.getWidth()+1,0);var q=16>=m.width-(b.tool.getWidth()+b.misc.getWidth()+b.brush.getWidth())?b.misc.getY()+b.misc.getHeight()+1:0;b.brush.setLocation(m.width-b.brush.getWidth()-15,q);b.textures.setWidth(m.width-b.textures.getX());b.layers.setLocation(b.brush.getX()+b.brush.getWidth()-b.layers.getWidth(),b.textures.getY()-b.layers.getHeight());q=Math.max(b.textures.getY()-330-1,370);b.layers.setHeight(q);b.layers.setWidth(218);b.stroke.setLocation(b.misc.getX(),
b.misc.getY()+b.misc.getHeight()+1);b.swatches.setLocation(b.stroke.getX(),b.stroke.getY()+b.stroke.getHeight()+1)}else{q=0<m.width-b.tool.getWidth()-b.misc.getWidth()-b.stroke.getWidth()-b.color.getWidth()-b.brush.getWidth()-15;b.brush.setLocation(m.width-b.brush.getWidth()-15,0);var r=b.brush.getY()+b.brush.getHeight();r=300<m.height-r?r+2:r;b.layers.setSize(b.brush.getWidth()+30*!!q,m.height-r);b.layers.setLocation(b.brush.getX()+b.brush.getWidth()-b.layers.getWidth(),r);b.tool.setLocation(0,0);
b.misc.setLocation(b.tool.getX()+b.tool.getWidth()+(q?5:1),0);q?b.stroke.setLocation(b.misc.getX()+b.misc.getWidth()+(q?5:1),0):b.stroke.setLocation(b.misc.getX(),b.misc.getY()+b.misc.getHeight()+1);b.swatches.setLocation(Math.max(b.brush.getX()-b.swatches.getWidth()-(q?5:1),b.tool.getX()+b.tool.getWidth()),0);b.textures.setWidth(Math.min(b.layers.getX()-b.textures.getX(),490))}b.textures.setLocation(b.color.getX()+b.color.getWidth()+4,m.height-b.textures.getHeight());b.color.setLocation(0,Math.max(b.tool.getY()+
b.tool.getHeight(),m.height-b.color.getHeight()))},a.on("smallScreen",function(m){if(m)for(let q in b)b[q].toggleCollapse(m&&(!(q in g)||g[q]))}),this.getElement=function(){return f},f.className="chickenpaint-palettes",b){let m=b[h],q=m.getElement();m.on("paletteVisChange",function(){d(this,!1)});h in n&&m.setCollapseDownwards(!0);q.setAttribute("data-paletteName",h);l.push(q)}for(let h in b)n=b[h].getElement(),f.appendChild(n)}function gg(a,c){function d(f){let e,l=f.dataset.action,k="true"===f.dataset.checkbox;
a.isActionAllowed(l)&&(k?(f.classList.toggle("selected"),e=f.classList.contains("selected")):e=!1,a.actionPerformed({action:l,checkbox:k,selected:e}))}let b=document.createElement("nav");b.className="navbar navbar-expand-md bg-light";b.innerHTML='\n    <div class="navbar-upper">\n      <a class="navbar-brand" href="#">ChickenPaint Be</a>\n      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#chickenpaint-main-menu-content" aria-controls="chickenpaint-main-menu-content" aria-expanded="false" aria-label="Toggle main menu">\n        <span class="navbar-toggler-icon"></span>\n      </button>\n    </div>\n    <div class="collapse navbar-collapse" id="chickenpaint-main-menu-content">\n      <div class="navbar-nav"></div>\n    </div>\n    <div class="widget-nav" id="chickenpaint-palette-toggler-content"></div>\n  ';
let g=navigator.userAgent.toLowerCase().includes("mac os");b.addEventListener("touchmove",f=>f.preventDefault(),{passive:!1});b.addEventListener("click",f=>{let e=f.target.closest("a:not(.dropdown-toggle)");e&&(d(e),f.preventDefault())});!function(f,e){e.forEach(l=>{let k=document.createElement("div");k.className="nav-item dropdown";k.innerHTML=`
        <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">${S(l.name)}</a>
        <ul class="dropdown-menu"></ul>
      `;let h=k.querySelector(".dropdown-menu");k.querySelector(".dropdown-toggle").addEventListener("show.bs.dropdown",()=>function(m){m.querySelectorAll("[data-action]").forEach(r=>{let t=a.isActionAllowed(r.dataset.action);r.classList.toggle("disabled",!t);"true"===r.dataset.hideIfNotAvailable&&r.classList.toggle("hidden",!t)});m.querySelectorAll(".dropdown-divider").forEach(r=>r.classList.remove("hidden"));let q=null;Array.from(m.querySelectorAll(".dropdown-item:not(.hidden), .dropdown-divider:not(.hidden)")).forEach((r,
t)=>{r.classList.contains("dropdown-divider")?0===t||q?r.classList.add("hidden"):q=r:q=null});q&&q.classList.add("hidden")}(k));l.children.forEach(m=>{let q;if("-"===m.name)m=document.createElement("hr"),m.className="dropdown-divider",h.appendChild(m);else if(m.action&&a.isActionSupported(m.action)){if("CPSend"!==m.action||a.isActionSupported("CPContinue")||(m.name=S("Post Oekaki"),m.shortcut="ctrl+p"),(q=document.createElement("a")).className="dropdown-item",q.href="#",q.dataset.action=m.action,
q.innerHTML=`<span>${S(m.name)}</span>`,m.checkbox&&(q.dataset.checkbox="true",m.checked&&q.classList.add("selected")),m.hideIfNotAvailable&&(q.dataset.hideIfNotAvailable="true"),m.title&&(q.title=S(m.title)),m.shortcut){g&&(m.shortcut=m.shortcut.replace(/SHIFT/im,"\u21e7").replace(/ALT/im,"\u2325").replace(/CTRL/im,"\u2318"));let t=document.createElement("small");t.className="chickenpaint-shortcut";var r=(r=m.shortcut).toUpperCase().replace(/(,.+)$/,"").replace("=","+");t.textContent=g?r.replace(/([^+])\+/g,
"$1"):r.replace(/([^+])\+/g,"$1 ");q.appendChild(t);Ha(qb)(m.shortcut,u=>(d(q),u.preventDefault(),u.stopPropagation(),!1))}m=document.createElement("li");m.appendChild(q);h.appendChild(m)}});f.appendChild(k)})}(b.querySelector(".navbar-nav"),Xe);(function(f,e){e.filter(l=>l.mnemonic&&a.isActionSupported(l.action)).forEach(l=>{let k=document.createElement("button");k.className="widget-toggler selected";k.type="button";k.dataset.action=l.action;k.dataset.checkbox="true";k.dataset.selected=(!l.checked).toString();
k.innerHTML=`<span>${l.mnemonic}</span>`;k.addEventListener("click",h=>{d(k);h.preventDefault()});f.appendChild(k)})})(b.querySelector(".widget-nav"),Xe[5].children);c.getPaletteManager().on("paletteVisChange",function(f,e){f="CPPal"+f.charAt(0).toUpperCase()+f.slice(1);let l=document.getElementById("chickenpaint-palette-toggler-content");[...((null==l?void 0:l.querySelectorAll(`[data-action="${f}"]`))||[]),...((null==b?void 0:b.querySelectorAll(`[data-action="${f}"]`))||[])].forEach(k=>{k.classList.toggle("selected",
e)})});let n=b.querySelector(".dropdown-item[data-action=CPFullScreen]");a.on("fullScreen",f=>null==n?void 0:n.classList.toggle("selected",f));null==n||n.classList.toggle("selected",a.isFullScreen());this.getElement=()=>b}function wd(a,c){let d=document.createElement("div"),b=new nd(a),g=new vd(a),n,f=!1,e=this;this.togglePalettes=function(){g.togglePalettes()};this.arrangePalettes=function(){setTimeout(g.arrangePalettes.bind(g),0)};this.constrainPalettes=function(){g.constrainPalettes()};this.showPalette=
function(k,h){g.showPaletteByName(k,h)};this.getSwatches=function(){return g.palettes.swatches.getSwatches()};this.setSwatches=function(k){g.palettes.swatches.setSwatches(k)};this.getPaletteManager=function(){return g};this.setRotation90=function(k){b.setRotation(k*Math.PI/2);g.palettes.layers.setRotation90(k)};this.setFullScreenMode=function(k){f!==k&&(f=k,e.resize(),e.arrangePalettes())};this.resize=function(){let k=window.innerHeight,h=n.getElement().getBoundingClientRect().height;b.resize(f?k-
h:Math.min(Math.max(k-h-65,500),850),!1);e.constrainPalettes()};n=new gg(a,this);c.appendChild(n.getElement());d.className="chickenpaint-main-section";d.appendChild(b.getElement());d.appendChild(g.getElement());c.appendChild(d);b.on("canvasRotated90",function(k){g.palettes.layers.setRotation90(k)});screen.orientation&&screen.orientation.addEventListener("change",k=>{this.resize();a.actionPerformed({action:"CPArrangePalettes"});setTimeout(()=>{this.resize();a.actionPerformed({action:"CPArrangePalettes"})},
10);Promise.resolve().then(()=>{this.resize()}).then(()=>{a.actionPerformed({action:"CPArrangePalettes"})})});let l=document.getElementById("chickenpaint-main-menu-content");if(document.addEventListener("show.bs.modal",()=>{l&&l.classList.contains("show")&&(new Lb.Collapse(l,{toggle:!1})).hide()}),l){let k=document.querySelector(".chickenpaint .widget-nav");k&&(l.addEventListener("show.bs.collapse",h=>{k.classList.add("hidden")}),l.addEventListener("hidden.bs.collapse",h=>{k.classList.remove("hidden")}));
window.addEventListener("resize",()=>{k.classList.remove("hidden")})}document.addEventListener("hidden.bs.collapse",this.resize.bind(this));window.addEventListener("resize",this.resize.bind(this));a.on("fullScreen",k=>this.setFullScreenMode(k));a.on("unsavedChanges",k=>{c.classList.toggle("chickenpaint-unsaved",k)});setTimeout(this.resize.bind(this),0)}function hg(a){var c=document.createElement("div");c.classList.add("modal","fade","chickenpaint-about-dialog");c.setAttribute("tabindex","-1");c.setAttribute("role",
"dialog");c.innerHTML='\n        <div class="modal-dialog">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h5 class="modal-title">About ChickenPaint Be</h5>\n                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                </div>\n                <div class="modal-body">\n                    <a class="chickenpaint-on-github" target="_blank" href="https://github.com/satopian/ChickenPaint_Be" rel="noopener">\n                        <span class="icon-github"></span> ChickenPaint Be on GitHub\n                    </a>\n                    <p>\n                        ChickenPaint Be is a customized version of <a href="https://github.com/thenickdude/chickenpaint" target="_blank" rel="noopener">ChickenPaint</a> by satopian.\n                    </p>\n                    <p>\n                        Built on: 2025-04-09T10:39:42<br>\n                        <a href="https://www.gnu.org/licenses/" target="_blank" rel="noopener">GNU General Public License</a><br>\n                    </p>\n                    <a class="chickenpaint-on-github" target="_blank" href="https://github.com/thenickdude/chickenpaint" rel="noopener">\n                        <span class="icon-github"></span> ChickenPaint on GitHub\n                    </a>\n\n                    <p>\n                        ChickenPaint is a translation of <a href="https://github.com/thenickdude/chibipaint" target="_blank" rel="noopener">ChibiPaint</a>\n                        from Java to JavaScript by Nicholas Sherlock / Chicken Smoothie\n                    </p>\n                    <p>\n                        ChibiPaint is Copyright (c) 2006-2008 Marc Schefer. All Rights Reserved\n                    </p>\n                    <p>\n                        ChickenPaint is free software: you can redistribute it and/or modify\n                        it under the terms of the GNU General Public License as published by\n                        the Free Software Foundation, either version 3 of the License, or\n                        (at your option) any later version.\n                    </p>\n                    <p>\n                        ChickenPaint is distributed in the hope that it will be useful,\n                        but WITHOUT ANY WARRANTY; without even the implied warranty of\n                        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n                        <a target="_blank" href="https://www.gnu.org/licenses/" rel="noopener">GNU General Public License</a> for more details.\n                    </p>\n<pre class="pre-scrollable chickenpaint-third-party-licenses">Toolbar icons designed by <a target="_blank" href="https://github.com/Anteira" rel="noopener">Miglena Lapavicheva (Anteira)</a>\n    These icons are dual-licensed under <a target="_blank" href="https://spdx.org/licenses/GPL-3.0-or-later.html" rel="noopener">GPL-3.0-or-later</a> and <a target="_blank" href="https://creativecommons.org/licenses/by/3.0/" rel="noopener">CC-BY-3.0</a>\n\nIncludes these MIT-licensed libraries:\n\n    Includes the <a target="_blank" href="https://github.com/eligrey/FileSaver.js" rel="noopener">FileSaver.js library</a>\n    FileSaver.js Copyright \u00a9 2015 <a target="_blank" href="https://eligrey.com/" rel="noopener">Eli Grey</a>\n\n    Includes the <a target="_blank" href="https://github.com/nodeca/pako" rel="noopener">Pako zlib compression library</a>\n    Copyright (C) 2014-2015 by Vitaly Puzrin\n    \n    Includes the <a target="_blank" href="https://github.com/madrobby/keymaster" rel="noopener">keymaster.js</a> keyboard library\n    Copyright (c) 2011-2013 Thomas Fuchs\n\n    Includes the <a target="_blank" href="https://benalman.com/projects/jquery-throttle-debounce-plugin/" rel="noopener">jQuery throttle-debounce</a> library\n    Copyright (c) 2010 "Cowboy" Ben Alman\n    \n    Includes the <a href="https://getbootstrap.com/" target="_blank" rel="noopener">Bootstrap</a> \n    Copyright (c) 2011-2025 <a href="https://github.com/twbs/bootstrap/blob/main/LICENSE" target="_blank" rel="noopener">The Bootstrap Authors</a>\n\n    MIT License\n\n    Permission is hereby granted, free of charge, to any person\n    obtaining a copy of this software and associated documentation\n    files (the "Software"), to deal in the Software without\n    restriction, including without limitation the rights to use,\n    copy, modify, merge, publish, distribute, sublicense, and/or\n    sell copies of the Software, and to permit persons to whom the\n    Software is furnished to do so, subject to the following\n    conditions:\n\n    The above copyright notice and this permission notice shall be\n    included in all copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,\n    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT \n    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n    OTHER DEALINGS IN THE SOFTWARE.\n\nIncludes Font Awesome by Fonticons, Inc. - <a href="https://fontawesome.com/" target="_blank" rel="noopener">https://fontawesome.com/</a>\nIncludes Material Design icons by Google - <a href="https://fonts.google.com/" target="_blank" rel="noopener">https://fonts.google.com/</a>\n                    </pre>\n                </div>\n            </div>\n        </div>\n    ';
a.appendChild(c);var d=new Lb.Modal(c);return c.addEventListener("hidden.bs.modal",()=>{c.remove()}),{show:function(){d.show()}}}function xd(a,c){let d=document.createElement("div");d.classList.add("modal","fade");d.setAttribute("tabindex","-1");d.setAttribute("role","dialog");d.innerHTML=`
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">${S("Complete transform")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>
                        ${S("You need to finish transforming this layer before you can do that. What would you like to do with the transform?")}
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">${S("Cancel")}</button>
                    <button type="button" class="btn btn-light chickenpaint-reject-transform" data-bs-dismiss="modal">${S("Undo transform")}</button>
                    <button type="button" class="btn btn-primary chickenpaint-accept-transform" data-bs-dismiss="modal">${S("Apply transform")}</button>
                </div>
            </div>
        </div>
    `;let b=d.querySelector(".chickenpaint-accept-transform"),g=d.querySelector(".chickenpaint-reject-transform");b.addEventListener("click",function(f){c.actionPerformed({action:"CPTransformAccept"});that.emitEvent("accept")});g.addEventListener("click",function(f){c.actionPerformed({action:"CPTransformReject"});that.emitEvent("reject")});let n=new Lb.Modal(d);this.show=function(){n.show()};d.addEventListener("hidden.bs.modal",f=>{d.remove()});a.addEventListener("keydown",function l(e){"Enter"===
e.key&&(n.hide(),c.actionPerformed({action:"CPTransformAccept"}),that.emitEvent("accept"),a.removeEventListener("keydown",l))});a.appendChild(d)}function ig(a){let c=document.createElement("div");c.classList.add("modal","fade","chickenpaint-shortcuts-dialog");c.tabIndex=-1;c.role="dialog";c.innerHTML=`
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">${S("Shortcuts")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>${S("Many of the menu options and painting tools have keyboard shortcuts which are written next to them or appear when you hover.")}</p>
                    <p>${S("Here are some other shortcuts which are not as obvious!")}</p>
                    <div class="chickenpaint-shortcuts-sections">
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${S("Color swatches palette")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${S("Left")}</span></dt>
                                        <dd>${S("Use as the drawing color")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${S("Right")}</span></dt>
                                        <dd>${S("Remove or replace a color swatch")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${S("Line drawing mode")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Shift</span> + <span class="fa icon-mouse-pointer"></span> ${S("Left")}</span></dt>
                                        <dd>${S("Snap line to nearest 45 degrees")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${S("Painting tools")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">1</span> - <span class="chickenpaint-shortcut-key">9</span>, <span class="chickenpaint-shortcut-key">0</span></span></dt>
                                        <dd>${S("Change brush opacity")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">[</span>, <span class="chickenpaint-shortcut-key">]</span></span></dt>
                                        <dd>${S("Change brush size")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${S("Brush palette")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${S("Right")}</span><span class="chickenpaint-shortcut-alternate">${S("or")}</span><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Shift</span> + <span class="fa icon-mouse-pointer"></span> ${S("Left")}</span></dt>
                                        <dd>${S("Adjust brush sliders more precisely")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${S("Drawing canvas")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${S("Middle")}</span> <span class="chickenpaint-shortcut-alternate">${S("or")}</span> <span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Space</span> + <span class="fa icon-mouse-pointer"></span> ${S("Left")}</span></dt>
                                        <dd>${S("Move the canvas around")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">R</span> + <span class="fa icon-mouse-pointer"></span> ${S("Left")}</span></dt>
                                        <dd>${S("Rotate the canvas")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${S("Right")}</span><span class="chickenpaint-shortcut-alternate">${S("or")}</span><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Alt</span> + <span class="fa icon-mouse-pointer"></span> ${S("Left")}</span></dt>
                                        <dd>${S("Sample the color under the cursor")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                        <div class="chickenpaint-shortcuts-section">
                            <h5>${S("Layers palette")}</h5>
                            <ul class="chickenpaint-shortcuts-list list-unstyled">
                                <li>
                                    <dl>
                                        <dt><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${S("Double click")}</span><span class="chickenpaint-shortcut-alternate">${S("or")}</span><span class="chickenpaint-shortcut"><span class="fa icon-mouse-pointer"></span> ${S("Right")}</span></dt>
                                        <dd>${S("Rename layer")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Shift</span> + <span class="fa icon-mouse-pointer"></span> ${S("Left")}</span></dt>
                                        <dd>${S("Toggle mask enable/disable")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Alt</span> + <span class="fa icon-mouse-pointer"></span> ${S("Left")}</span></dt>
                                        <dd>${S("Toggle mask View")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">${Ye}</span> + <span class="fa icon-mouse-pointer"></span> ${S("Left")}</span></dt>
                                        <dd>${S("Apply layer mask")}</dd>
                                        <dt><span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">Shift</span> + <span class="chickenpaint-shortcut"><span class="chickenpaint-shortcut-key">${Ye}</span> + <span class="fa icon-mouse-pointer"></span> ${S("Left")}</span></dt>
                                        <dd>${S("Delete layer mask")}</dd>
                                    </dl>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;c.querySelector(".btn-close").addEventListener("click",()=>{c.remove()});let d=new Lb.Modal(c);a.appendChild(c);this.show=function(){d.show()}}function jg(a,c){let d=document.createElement("div");d.classList.add("modal","fade");d.setAttribute("tabindex","-1");d.setAttribute("role","dialog");d.innerHTML=`
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">${S("Box blur")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label>${S("Blur amount (pixels)")}</label>
                            <input type="number" class="form-control chickenpaint-blur-amount" value="3" min="1">
                        </div>
                        <div class="form-group">
                            <label>${S("Iterations (1-8, larger gives smoother blur)")}</label>
                            <input type="number" class="form-control chickenpaint-blur-iterations" value="1" min="1" max="8">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">${S("Cancel")}</button>
                    <button type="button" class="btn btn-primary chickenpaint-apply-box-blur" data-bs-dismiss="modal">${S("Ok")}</button>
                </div>
            </div>
        </div>
    `;let b=d.querySelector(".chickenpaint-blur-amount"),g=d.querySelector(".chickenpaint-blur-iterations"),n=d.querySelector(".chickenpaint-apply-box-blur"),f=new Lb.Modal(d);this.show=function(){let e=document.getElementById("chickenpaint-main-menu-content");e&&e.classList.contains("show")&&(new Lb.Collapse(e,{toggle:!1})).hide();f.show()};n.addEventListener("click",e=>{e=Math.max(parseInt(b.value,10),1);let l=Math.min(Math.max(parseInt(g.value,10),1),8);c.getArtwork().boxBlur(e,e,l);f.hide()});
d.addEventListener("hidden.bs.modal",()=>{document.activeElement.blur();d.remove()});d.addEventListener("shown.bs.modal",()=>{b.focus()});d.addEventListener("keydown",e=>{"Enter"===e.key&&d.classList.contains("show")&&(n.click(),e.preventDefault())});a.appendChild(d)}function Kc(){var a,c=null,d=this;this.isPen=function(){var b;return!!c&&(1==(b=c.pointerType)||3==b)};this.getPressure=function(){return c?c.pressure:1};this.pluginLoaded=function(){console.log("Wacom tablet support loaded!");c=a.penAPI};
this.isTabletPresent=function(){return!!c};this.detectTablet=function(){if(/Chrome/i.test(navigator.userAgent)&&!/OPR/.test(navigator.userAgent))console.log("Not attempting to load Wacom tablet plugin, since this is Chrome");else{if(console.log("Attempting to load Wacom tablet support..."),"classid"in(a=document.createElement("object")))a.classid="CLSID:092dfa86-5807-5a94-bf3b-5a53ba9e5308";else{var b=document.createElement("param");b.name="onload";b.value="onWacomPluginLoaded";a.appendChild(b);a.type=
"application/x-wacomtabletplugin"}a.style.position="absolute";a.style.visibility="hidden";a.onload="onWacomPluginLoaded";document.body.appendChild(a);setTimeout(function(){d.isTabletPresent()||console.log("Looks like the Wacom plugin isn't installed, or failed to load.")},5E3)}}}function kg(a){let c=document.createElement("div");c.classList.add("modal","fade");c.setAttribute("tabindex","-1");c.setAttribute("role","dialog");c.innerHTML='\n        <div class="modal-dialog" role="document">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h5 class="modal-title">Drawing tablet support</h5>\n                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                </div>\n                <div class="modal-body">\n                    <div class="chickenpaint-tablet-support chickenpaint-pointerevents-support">\n                        <h5>\n                            Built-in support for most tablets.\n                            <small>macOS, Windows 10 or newer</small>\n                        </h5>\n                        <div class="chickenpaint-supported-browsers">\n                            <div class="chickenpaint-supported-browser">\n                                <span class="icon-chrome"></span>\n                                Chrome\n                            </div>\n                            <div class="chickenpaint-supported-browser">\n                                <span class="icon-edge"></span>\n                                Edge (Windows 10)\n                            </div>\n                            <div class="chickenpaint-supported-browser">\n                                <span class="icon-firefox"></span>\n                                Firefox (<a href="https://github.com/satopian/ChickenPaint_Be/blob/main/help/Firefox%20pressure%20support.md" target="_blank" rel="noopener">help <i class="fa icon-external-link-alt"></i></a>)\n                            </div>\n                        </div>\n                        <p class="chickenpaint-not-supported">\n                            Your browser doesn\'t have built-in support for drawing tablets, please try\n                            one of the other browsers listed above.\n                        </p>\n                        <p class="chickenpaint-supported alert alert-success">\n                            Your browser has built-in support for drawing tablets!\n                        </p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ';
let d=c.querySelector(".chickenpaint-pointerevents-support"),b=!!window.hasNativePointerEvents;d.classList.toggle("supported",b);d.classList.toggle("not-supported",!b);c.addEventListener("hidden.bs.modal",n=>{c.remove()});let g=new Lb.Modal(c);a.appendChild(c);this.show=function(){g.show()}}function lg(a,c){let d=document.createElement("div");d.classList.add("modal","fade");d.setAttribute("tabindex","-1");d.setAttribute("role","dialog");d.innerHTML=`
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">${S("Grid options")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label>${S("Grid size")}</label>
                            <input type="number" class="form-control chickenpaint-grid-size" value="" min="3">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">${S("Cancel")}</button>
                    <button type="button" class="btn btn-primary chickenpaint-apply-grid-settings" data-bs-dismiss="modal">${S("Ok")}</button>
                </div>
            </div>
        </div>
    `;let b=d.querySelector(".chickenpaint-grid-size"),g=d.querySelector(".chickenpaint-apply-grid-settings"),n=new Lb.Modal(d);this.show=function(){let f=document.getElementById("chickenpaint-main-menu-content");f&&f.classList.contains("show")&&(new Lb.Collapse(f,{toggle:!1})).hide();n.show()};b.value=c.getGridSize();d.addEventListener("hidden.bs.modal",()=>{d.remove()});g.addEventListener("click",()=>{let f=parseInt(b.value,10);c.setGridSize(f);n.hide()});d.addEventListener("shown.bs.modal",()=>
{b.focus()});d.addEventListener("keydown",f=>{"Enter"===f.key&&(f.preventDefault(),g.click())});a.appendChild(d)}function yd(a,c,d){let b=document.createElement("div");b.className="modal fade chickenpaint-send-dialog";b.tabIndex=-1;b.setAttribute("role","dialog");b.innerHTML=`
        <div class="modal-dialog">
            <div class="modal-content" data-stage="saving">
                <div class="modal-header">
                    <h5 class="modal-title">${S("Saving drawing...")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="chickenpaint-saving-progress-message">${S("Preparing your drawing to be saved, please wait...")}</p>
                    <pre class="chickenpaint-saving-error-message pre-scrollable" style="display: none;"></pre>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light chickenpaint-send-cancel" data-bs-dismiss="modal">${S("Cancel")}</button>
                </div>
            </div>
            <div class="modal-content" data-stage="success-not-previously-posted" style="display:none">
                <div class="modal-header">
                    <h5 class="modal-title">${S("Drawing saved!")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body">
                    <p>${S("Your drawing has been saved, would you like to post it to the forum now?")}</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary chickenpaint-post-drawing" data-bs-dismiss="modal">${S("Yes, post it now")}</button>
                    <button type="button" class="btn btn-light chickenpaint-continue-drawing" data-bs-dismiss="modal">${S("No, keep drawing")}</button>
                    <button type="button" class="btn btn-light chickenpaint-exit" data-bs-dismiss="modal">${S("No, quit and I'll finish it later")}</button>
                </div>
            </div>
            <div class="modal-content" data-stage="success-already-posted" style="display:none">
                <div class="modal-header">
                    <h5 class="modal-title">${S("Drawing saved!")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body">
                    <p>${S("Your drawing has been saved, would you like to view it on the forum now?")}</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary chickenpaint-post-drawing" data-bs-dismiss="modal">${S("Yes, view the post")}</button>
                    <button type="button" class="btn btn-light chickenpaint-continue-drawing" data-bs-dismiss="modal">${S("No, keep drawing")}</button>
                </div>
            </div>
            <div class="modal-content" data-stage="success-redirect" style="display:none">
                <div class="modal-header">
                    <h5 class="modal-title">${S("Drawing saved!")}</h5>
                    <button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>${S("Your drawing has been saved, redirecting you to view your new post now...")}</p>
                </div>
            </div>
        </div>
    `;let g=b.querySelector(".chickenpaint-saving-progress-message"),n=b.querySelector(".chickenpaint-saving-error-message"),f=b.querySelector(".progress-bar"),e=new Lb.Modal(b),l=this;d.on("savingProgress",function(h,m){g.textContent=m;f.setAttribute("aria-valuenow",100*h);f.style.width=100*h+"%"});d.on("savingComplete",function(){b.querySelector(".modal-content[data-stage='saving']").style.display="none";a.isActionSupported("CPContinue")?a.isActionSupported("CPExit")?b.querySelector(".modal-content[data-stage='success-not-previously-posted']").style.display=
"block":b.querySelector(".modal-content[data-stage='success-already-posted']").style.display="block":b.querySelector(".modal-content[data-stage='success-redirect']").style.display="block"});d.on("savingFailure",function(h){f.classList.add("progress-bar-danger");let m=S("Sorry, your drawing could not be saved, please try again later.");h&&0<(h=h.replace(/^CHIBIERROR\s*/,"")).length&&(m+=`<br><br>${S("The error returned from the server was")}:`,n.textContent=h,n.style.display="block");g.innerHTML=m});
b.querySelector(".chickenpaint-send-cancel").addEventListener("click",function(){d.cancel()});var k=b.querySelector(".chickenpaint-post-drawing");k&&k.addEventListener("click",function(){a.actionPerformed({action:"CPPost"})});(k=b.querySelector(".chickenpaint-exit"))&&(k.style.display=a.isActionSupported("CPExit")?"":"none",k.addEventListener("click",function(){alert("When you want to come back and finish your drawing, just click the 'new drawing' button again and you can choose to continue this drawing.");
a.actionPerformed({action:"CPExit"})}));b.addEventListener("hidden.bs.modal",()=>{b.remove()});c.appendChild(b);this.show=function(){e.show();l.emitEvent("shown")}}function Y(a){function c(J){this.palName=J}function d(J){this.toolNum=J}function b(J){this.modeNum=J}function g(J){let ea;switch(y=J==Pb.EDITING_MODE_IMAGE?Y.COLOR_MODE_RGB:Y.COLOR_MODE_GREYSCALE,m.emitEvent("colorModeChange",[J==Pb.EDITING_MODE_IMAGE?"rgb":"greyscale"]),y){case Y.COLOR_MODE_RGB:ea=t.clone();break;case Y.COLOR_MODE_GREYSCALE:ea=
new Za(Za.greyToRGB(u))}m.artwork.setForegroundColor(ea.getRgb());m.emitEvent("colorChange",[ea])}function n(){m.emitEvent("toolChange",[A,N[A]])}function f(J){F!=J&&(J==Y.M_TRANSFORM&&(D=F),F=J,m.emitEvent("modeChange",[F]))}function e(J){f(Y.M_DRAW);A=J;m.artwork.setBrush(N[J]);n()}function l(J,ea){h&&(h.addEventListener("dblclick",function(Z){Z.preventDefault();Z.stopPropagation()}),m.artwork.on("editModeChanged",g),r=new wd(m,h),m.emitEvent("fullScreen",[P]),m.emitEvent("smallScreen",[E]),O.load(),
e(Y.T_PEN),r.arrangePalettes(),J&&r.setSwatches(J),ea&&r.setRotation90(ea),window.addEventListener("beforeunload",function(Z){m.artwork.getHasUnsavedChanges()&&Z.preventDefault()}),m.artwork.on("unsavedChanges",Z=>{a.allowMultipleSends&&m.emitEvent("unsavedChanges",[Z])}))}var k;!function(){try{if("undefined"!=typeof navigator){let J=navigator.languages;for(let ea of(Array.isArray(J)||(J=[J]),J)){let Z=/^(..)([-_].+)?$/.exec(ea);if(Z){if(Z[1]=Z[1].toLowerCase(),Z[1]in Yd){Xd(ea);break}if("en"===Z[1]){Xd("en");
break}}}}}catch(J){console.error(J)}}();a.language&&Xd(a.language);let h=a.uiElem;document.addEventListener("keydown",J=>{((J.ctrlKey||J.metaKey)&&"+;=-shro".split("").includes(J.key.toLowerCase())||"Enter"===J.key)&&J.preventDefault()});h.addEventListener("contextmenu",J=>{J.preventDefault();J.stopPropagation()},{passive:!1});let m=this,q,r,t=new Za(0),u=255,y=Y.COLOR_MODE_RGB,A=Y.T_PENCIL,F=Y.M_DRAW,D=F,G=[4278190080,4294967295],E=!1,P=!1,N=((k=Array(Y.T_MAX))[Y.T_PENCIL]=new ha({toolNb:Y.T_PENCIL,
size:16,alpha:255,isAA:!0,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,tip:ha.TIP_ROUND_AA,brushMode:ha.BRUSH_MODE_PAINT,paintMode:ha.PAINT_MODE_OPACITY}),k[Y.T_ERASER]=new ha({toolNb:Y.T_ERASER,size:16,alpha:255,isAA:!0,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!1,texture:0,tip:ha.TIP_ROUND_AA,brushMode:ha.BRUSH_MODE_ERASE,paintMode:ha.PAINT_MODE_OPACITY}),k[Y.T_PEN]=new ha({toolNb:Y.T_PEN,size:2,alpha:128,isAA:!0,minSpacing:.5,spacing:.05,pressureSize:!0,pressureAlpha:!1,
tip:ha.TIP_ROUND_AA,brushMode:ha.BRUSH_MODE_PAINT,paintMode:ha.PAINT_MODE_FLOW,alphaScale:.5}),k[Y.T_SOFTERASER]=new ha({toolNb:Y.T_SOFTERASER,size:16,alpha:64,isAA:!1,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,texture:1,tip:ha.TIP_ROUND_AIRBRUSH,brushMode:ha.BRUSH_MODE_ERASE,paintMode:ha.PAINT_MODE_FLOW,alphaScale:.125}),k[Y.T_AIRBRUSH]=new ha({toolNb:Y.T_AIRBRUSH,size:50,alpha:32,isAA:!1,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,tip:ha.TIP_ROUND_AIRBRUSH,brushMode:ha.BRUSH_MODE_PAINT,
paintMode:ha.PAINT_MODE_FLOW,alphaScale:.125}),k[Y.T_DODGE]=new ha({toolNb:Y.T_DODGE,size:30,alpha:32,isAA:!1,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,tip:ha.TIP_ROUND_AIRBRUSH,brushMode:ha.BRUSH_MODE_DODGE,paintMode:ha.PAINT_MODE_FLOW,alphaScale:.125}),k[Y.T_BURN]=new ha({toolNb:Y.T_BURN,size:30,alpha:32,isAA:!1,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,tip:ha.TIP_ROUND_AIRBRUSH,brushMode:ha.BRUSH_MODE_BURN,paintMode:ha.PAINT_MODE_FLOW,alphaScale:.125}),k[Y.T_WATER]=
new ha({toolNb:Y.T_WATER,size:30,alpha:70,isAA:!1,minSpacing:.5,spacing:.02,pressureSize:!1,pressureAlpha:!0,tip:ha.TIP_ROUND_AA,brushMode:ha.BRUSH_MODE_WATER,paintMode:ha.PAINT_MODE_FLOW,alphaScale:.125,resat:.3,bleed:.6}),k[Y.T_BLUR]=new ha({toolNb:Y.T_BLUR,size:20,alpha:255,isAA:!1,minSpacing:.5,spacing:.05,pressureSize:!1,pressureAlpha:!0,tip:ha.TIP_ROUND_PIXEL,brushMode:ha.BRUSH_MODE_BLUR,paintMode:ha.PAINT_MODE_FLOW,alphaScale:.125}),k[Y.T_SMUDGE]=new ha({toolNb:Y.T_SMUDGE,size:20,alpha:128,
isAA:!1,minSpacing:.5,spacing:.01,pressureSize:!1,pressureAlpha:!0,tip:ha.TIP_ROUND_AIRBRUSH,brushMode:ha.BRUSH_MODE_SMUDGE,paintMode:ha.PAINT_MODE_FLOW,alphaScale:.125,resat:0,bleed:1}),k[Y.T_BLENDER]=new ha({toolNb:Y.T_BLENDER,size:20,alpha:60,isAA:!1,minSpacing:.5,spacing:.1,pressureSize:!1,pressureAlpha:!0,tip:ha.TIP_ROUND_AIRBRUSH,brushMode:ha.BRUSH_MODE_OIL,paintMode:ha.PAINT_MODE_FLOW,alphaScale:.125,resat:0,bleed:.07}),k),O=new mg,U,da,la={CPFullScreen:{action:function(){m.setFullScreen(!P)},
isSupported:function(){return"disable"!==a.fullScreenMode&&"force"!==a.fullScreenMode&&!1!==a.allowFullScreen},modifies:{gui:!0}},CPZoomIn:{action:function(){q.zoomIn()},modifies:{gui:!0}},CPZoomOut:{action:function(){q.zoomOut()},modifies:{gui:!0}},CPZoom100:{action:function(){q.zoom100()},modifies:{gui:!0}},CPUndo:{action:function(){m.artwork.undo()},modifies:{document:!0},allowed:"isUndoAllowed"},CPRedo:{action:function(){m.artwork.redo()},modifies:{document:!0},allowed:"isRedoAllowed"},CPClearHistory:{action:function(){confirm(S("You're about to clear the current Undo/Redo history.\nThis operation cannot be undone, are you sure you want to do that?"))&&
m.artwork.clearHistory()},modifies:{document:!0}},CPPencil:new d(Y.T_PENCIL),CPPen:new d(Y.T_PEN),CPEraser:new d(Y.T_ERASER),CPSoftEraser:new d(Y.T_SOFTERASER),CPAirbrush:new d(Y.T_AIRBRUSH),CPDodge:new d(Y.T_DODGE),CPBurn:new d(Y.T_BURN),CPWater:new d(Y.T_WATER),CPBlur:new d(Y.T_BLUR),CPSmudge:new d(Y.T_SMUDGE),CPBlender:new d(Y.T_BLENDER),CPFloodFill:new b(Y.M_FLOODFILL),CPGradientFill:new b(Y.M_GRADIENTFILL),CPRectSelection:new b(Y.M_RECT_SELECTION),CPMoveTool:new b(Y.M_MOVE_TOOL),CPRotateCanvas:new b(Y.M_ROTATE_CANVAS),
CPPanCanvas:new b(Y.M_PAN_CANVAS),CPColorPicker:new b(Y.M_COLOR_PICKER),CPTransform:{action:function(){let J=m.artwork.getActiveLayer();null==m.artwork.transformAffineBegin()?m.showLayerNotification(J,S("Whoops! All of the selected pixels are transparent!"),"layer"):f(Y.M_TRANSFORM)},modifies:{mode:!0},allowed:function(){let J=m.artwork.getActiveLayer();if(J.visible)if(0==J.alpha)m.showLayerNotification(J,S("Whoops! This layer's opacity is currently 0%"),"opacity");else{if(null!=m.artwork.transformAffineBegin())return 0!=
J.getEffectiveAlpha();m.showLayerNotification(J,S("Whoops! All of the selected pixels are transparent!"),"layer")}else m.showLayerNotification(J,S("Whoops! This layer is currently hidden"),"layer")}},CPTransformAccept:{action:function(){F==Y.M_TRANSFORM&&(m.artwork.transformAffineFinish(),f(D))},modifies:{mode:!0}},CPTransformReject:{action:function(){F==Y.M_TRANSFORM&&(m.artwork.transformAffineAbort(),f(D))},modifies:{document:!0,mode:!0}},CPFreeHand:{action:function(){N[A].strokeMode=ha.STROKE_MODE_FREEHAND;
n()},modifies:{tool:!0}},CPLine:{action:function(){N[A].strokeMode=ha.STROKE_MODE_LINE;n()},modifies:{tool:!0}},CPBezier:{action:function(){N[A].strokeMode=ha.STROKE_MODE_BEZIER;n()},modifies:{tool:!0}},CPAbout:{action:function(){(new hg(h)).show()},modifies:{}},CPShortcuts:{action:function(){(new ig(h)).show()},modifies:{}},CPTabletSupport:{action:function(){(new kg(h)).show()},modifies:{}},CPLayerDuplicate:{action:function(){m.artwork.duplicateLayer()},modifies:{document:!0}},CPLayerMergeDown:{action:function(){m.artwork.mergeDown()},
modifies:{document:!0},allowed:"isMergeDownAllowed"},CPGroupMerge:{action:function(){m.artwork.mergeGroup()},modifies:{document:!0},allowed:"isMergeGroupAllowed"},CPLayerMergeAll:{action:function(){m.artwork.mergeAllLayers()},modifies:{document:!0},allowed:"isMergeAllLayersAllowed"},CPExpandLayerGroup:{action:function(J){m.artwork.expandLayerGroup(J.group,J.expand)},modifies:{document:!0}},CPFill:{action:function(){m.artwork.fill(4278190080|m.getCurColor().getRgb())},modifies:{document:!0},requiresDrawable:!0},
CPClear:{action:function(){m.artwork.clear()},modifies:{document:!0},requiresDrawable:!0},CPSelectAll:{action:function(){m.artwork.rectangleSelection(m.artwork.getBounds());q.repaintAll()},modifies:{document:!0}},CPDeselectAll:{action:function(){m.artwork.rectangleSelection(new ka(0,0,0,0));q.repaintAll()},modifies:{document:!0}},CPHFlip:{action:function(){m.artwork.hFlip()},modifies:{document:!0},requiresDrawable:!0},CPVFlip:{action:function(){m.artwork.vFlip()},modifies:{document:!0},requiresDrawable:!0},
CPMNoise:{action:function(){m.artwork.monochromaticNoise()},modifies:{document:!0},requiresDrawable:!0},CPCNoise:{action:function(){m.artwork.colorNoise()},modifies:{document:!0},allowed:"isColorNoiseAllowed"},CPFXBoxBlur:{action:function(){U||=new jg(h,m);U.show()},modifies:{document:!0},requiresDrawable:!0},CPFXInvert:{action:function(){m.artwork.invert()},modifies:{document:!0},requiresDrawable:!0},CPBrightnessToOpacity:{action:function(){m.artwork.brightnessToOpacity()},modifies:{document:!0},
requiresDrawable:!0},CPCut:{action:function(){m.artwork.cutSelection()},modifies:{document:!0},requiresDrawable:!0,allowed:"isCutSelectionAllowed"},CPCopy:{action:function(){m.artwork.copySelection()},modifies:{document:!0},requiresDrawable:!0,allowed:"isCopySelectionAllowed"},CPCopyMerged:{action:function(){m.artwork.copySelectionMerged()},modifies:{document:!0},allowed:"isCopySelectionMergedAllowed"},CPPaste:{action:function(){m.artwork.pasteClipboard()},modifies:{document:!0},allowed:"isPasteClipboardAllowed"},
CPToggleGrid:{action:function(J){q.showGrid(J.selected)},modifies:{gui:!0}},CPGridOptions:{action:function(){da||=new lg(h,q);da.show()},modifies:{gui:!0}},CPLinearInterpolation:{action:function(J){q.setInterpolation(J.selected)},modifies:{gui:!0},isSupported:function(){return!!Hd(Zb(0,0).getContext("2d"))}},CPResetCanvasRotation:{action:function(){q.resetRotation()},modifies:{gui:!0}},CPAddLayer:{action:function(){m.artwork.addLayer("layer")},modifies:{document:!0}},CPAddGroup:{action:function(){m.artwork.addLayer("group")},
modifies:{document:!0}},CPAddLayerMask:{action:function(){m.artwork.addLayerMask()},modifies:{document:!0},allowed:"isAddLayerMaskAllowed"},CPApplyLayerMask:{action:function(){m.artwork.applyLayerMask(!0)},modifies:{document:!0},allowed:"isApplyLayerMaskAllowed"},CPRemoveLayerMask:{action:function(){m.artwork.removeLayerMask()},modifies:{document:!0},allowed:"isRemoveLayerMaskAllowed"},CPRemoveLayer:{action:function(){m.artwork.removeLayer()||alert(S("Sorry, you can't remove the last remaining layer in the drawing."))},
modifies:{document:!0},allowed:"isRemoveLayerAllowed"},CPCreateClippingMask:{action:function(){m.artwork.createClippingMask()},modifies:{document:!0},allowed:"isCreateClippingMaskAllowed"},CPReleaseClippingMask:{action:function(){m.artwork.releaseClippingMask()},modifies:{document:!0},allowed:"isReleaseClippingMaskAllowed"},CPRelocateLayer:{action:function(J){m.artwork.relocateLayer(J.layer,J.toGroup,J.toIndex)},modifies:{document:!0}},CPSetActiveLayer:{action:function(J){J.mask&&J.layer.mask&&!J.layer.maskVisible&&
m.artwork.setLayerMaskVisible(J.layer,!0);m.artwork.setActiveLayer(J.layer,J.mask);m.artwork.performIdleTasks()},modifies:{document:!0}},CPToggleMaskView:{action:function(){let J=m.artwork.toggleMaskView();J&&m.emitEvent("maskViewOpened",[J])},modifies:{gui:!0}},CPSetMaskVisible:{action:function(J){m.artwork.setLayerMaskVisible(J.layer,J.visible)},modifies:{layerProp:!0}},CPSetLayerVisibility:{action:function(J){m.artwork.setLayerVisibility(J.layer,J.visible)},modifies:{layerProp:!0}},CPSetLayerName:{action:function(J){m.artwork.setLayerName(J.layer,
J.name)},modifies:{layerProp:!0}},CPSetLayerBlendMode:{action:function(J){m.artwork.setLayerBlendMode(J.blendMode)},modifies:{layerProp:!0}},CPSetLayerAlpha:{action:function(J){m.artwork.setLayerAlpha(J.alpha)},modifies:{layerProp:!0}},CPSetLayerLockAlpha:{action:function(J){m.artwork.setLayerLockAlpha(J.lock)},modifies:{layerProp:!0}},CPPalColor:new c("color"),CPPalBrush:new c("brush"),CPPalLayers:new c("layers"),CPPalStroke:new c("stroke"),CPPalSwatches:new c("swatches"),CPPalTool:new c("tool"),
CPPalMisc:new c("misc"),CPPalTextures:new c("textures"),CPTogglePalettes:{action:function(){r.togglePalettes()},modifies:{gui:!0}},CPArrangePalettes:{action:function(){r.arrangePalettes()},modifies:{gui:!0}},CPSave:{action:function(){let J;(J=new Wc({artwork:m.getArtwork(),rotation:q.getRotation90(),swatches:r.getSwatches()})).on("savingComplete",function(){m.artwork.setHasUnsavedChanges(!1)});J.on("savingFailure",function(){alert(S("Sorry, your drawing could not be saved, Please see the error message."))});
J.save()},isSupported:function(){return!1!==a.allowDownload},modifies:{document:!0}},CPSend:{action:function(){!function(){if(m.isActionSupported("CPContinue")||confirm(S("Are you sure you want to send your drawing to the server and finish drawing now?"))){var J=new Wc({artwork:m.getArtwork(),rotation:q.getRotation90(),swatches:r.getSwatches(),url:a.saveUrl,post_max_size:a.post_max_size}),ea=new yd(m,h,J);J.on("savingComplete",function(){m.artwork.setHasUnsavedChanges(!1);!m.isActionSupported("CPContinue")&&
m.isActionSupported("CPPost")&&m.actionPerformed({action:"CPPost"})});J.on("savingFailure",function(){alert(S("Sorry, your drawing could not be saved, Please see the error message."))});ea.on("shown",function(){J.save()});ea.show()}}()},isSupported:function(){return!!a.saveUrl},modifies:{document:!0}},CPPost:{action:function(){if("function"==typeof handleExit)return handleExit();window.location=a.postUrl},isSupported:function(){return!(!a.postUrl&&"function"!=typeof handleExit)},modifies:{document:!0}},
CPContinue:{action:function(){},isSupported:function(){return!!a.allowMultipleSends}},CPExit:{action:function(){window.location=a.exitUrl},isSupported:function(){return!!a.exitUrl},modifies:{}}};switch(c.prototype.action=function(J){r.showPalette(this.palName,J.selected)},c.prototype.modifies={gui:!0},d.prototype.action=function(){e(this.toolNum)},d.prototype.modifies={mode:!0,tool:!0},d.prototype.requiresDrawable=!0,b.prototype.action=function(){f(this.modeNum)},b.prototype.modifies={mode:!0},this.callToolListeners=
function(){n()},this.getArtwork=function(){return this.artwork},this.setCanvas=function(J){q=J},this.setTransformInterpolation=function(J){this.artwork.setTransformInterpolation(J)},this.setCurColor=function(J){switch(y){case Y.COLOR_MODE_RGB:t.isEqual(J)||(t.copyFrom(J),this.artwork.setForegroundColor(J.getRgb()),this.emitEvent("colorChange",[J]));break;case Y.COLOR_MODE_GREYSCALE:if(J=J.getValue(),u!=J){let ea=Za.greyToRGB(J);this.artwork.setForegroundColor(ea);u=J;this.emitEvent("colorChange",
[new Za(ea)])}}},this.getCurColor=function(){switch(y){case Y.COLOR_MODE_RGB:return t.clone();case Y.COLOR_MODE_GREYSCALE:return new Za(Za.greyToRGB(u))}},this.setCurGradient=function(J){G=J.slice(0);this.emitEvent("gradientChange",[G])},this.getCurGradient=function(){return G.slice(0)},this.setBrushSize=function(J){N[A].size=Math.max(1,Math.min(200,J));n()},this.getBrushSize=function(){return N[A].size},this.setAlpha=function(J){N[A].alpha=J;n()},this.getAlpha=function(){return N[A].alpha},this.getCurMode=
function(){return F},this.getCurTool=function(){return A},this.getBrushInfo=function(){return N[A]},this.isActionSupported=function(J){if(la[J]){let ea=typeof la[J].isSupported;return"function"==ea?la[J].isSupported():"undefined"==ea||la[J].isSupported}return!1},this.isActionAllowed=function(J){J=la[J];return!!J&&("function"==typeof J.allowed?J.allowed():"string"==typeof J.allowed?this.artwork[J.allowed]():!J.requiresDrawable||this.artwork.isActiveLayerDrawable())},this.showLayerNotification=function(J,
ea,Z){this.emitEvent("layerNotification",[J,ea,Z])},this.actionPerformed=function(J){if(null!=this.artwork&&null!=q){var ea=la[J.action];ea&&(F==Y.M_TRANSFORM&&(ea.modifies.document||ea.modifies.mode)&&-1==["CPTransformAccept","CPTransformReject"].indexOf(J.action)?"CPUndo"==J.action?la.CPTransformReject.action():"CPTransform"!=J.action&&(ea=new xd(h,this),ea.on("accept",this.actionPerformed.bind(this,J)),ea.on("reject",this.actionPerformed.bind(this,J)),ea.show()):ea.action(J))}},this.setSmallScreenMode=
function(J){E!==J&&(E=J,h.classList.toggle("chickenpaint-small-screen",E),m.emitEvent("smallScreen",[E]))},this.getSmallScreenMode=function(){return E},this.setFullScreen=function(J){P!==J&&(P=J,document.body.classList.toggle("chickenpaint-full-screen",P),h.classList.toggle("chickenpaint-full-screen",P),J=document.querySelectorAll('head meta[name="viewport"]').length,P&&0===J?(J=document.createElement("meta"),J.name="viewport",J.content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,,user-scalable=no",
document.head.appendChild(J),setTimeout(()=>m.emitEvent("fullScreen",[P]),200)):m.emitEvent("fullScreen",[P]))},this.isFullScreen=function(){return P},this.setToolbarStyle=function(J){O.set("toolbarStyle",J);O.save()},this.getToolbarStyle=function(){return O.get("toolbarStyle")},this.getResourcesRoot=function(){return a.resourcesRoot},!function(){var J;if(!((J=Zb(0,0)).getContext&&J.getContext("2d")&&"Uint8Array"in window))throw new Y.UnsupportedBrowserException;J=(-1!=navigator.userAgent.indexOf("iPad")||
-1!=navigator.userAgent.indexOf("iPod")||-1!=navigator.userAgent.indexOf("iPhone"))&&-1!=navigator.userAgent.indexOf(" OS 8_0 ");let ea=-1==navigator.userAgent.indexOf("CriOS")&&-1!=navigator.userAgent.indexOf("Safari");if(J&&ea)throw new Y.UnsupportedBrowserException("You are using Safari 8.0.0, which is unable to upload drawings. That bug was fixed in the iOS 8.0.2 update, or in Chrome for iOS.");}(),h&&(!(("string"==typeof document.body.style.flexBasis||"string"==typeof document.body.style.msFlexDirection)&&
!/Presto/.test(navigator.userAgent))&&(h.className+=" no-flexbox"),h.className+=" chickenpaint chickenpaint-lang-"+Zd),a.resourcesRoot=a.resourcesRoot||"chickenpaint/",this.setSmallScreenMode(!!("number"==typeof navigator.maxTouchPoints&&2<navigator.maxTouchPoints&&(820>=window.screen.width||820>=window.screen.height))),a.fullScreenMode){case "force":this.setFullScreen(!0);break;case "auto":this.setFullScreen(E)}(O.on("toolbarStyle",J=>this.emitEvent("toolbarStyleChange",[J])),a.loadImageUrl||a.loadChibiFileUrl)?
(k=new jd(a),new Zf(h,k,a.resourcesRoot),k.on("loadingComplete",function(J){m.artwork=J.layers||J.flat;l(J.swatches,a.rotation);a.onLoaded&&a.onLoaded(this)}),k.load()):(a.artwork?this.artwork=a.artwork:(this.artwork=new Pb(a.canvasWidth||800,a.canvasHeight||600),this.artwork.addBackgroundLayer(),this.artwork.addDefaultLayer()),l(),a.onLoaded&&a.onLoaded(this))}var Ze,$e,af,be,ce,zd="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=
typeof global?global:{};ha.STROKE_MODE_FREEHAND=0;ha.STROKE_MODE_LINE=1;ha.STROKE_MODE_BEZIER=2;ha.TIP_ROUND_PIXEL=0;ha.TIP_ROUND_AA=1;ha.TIP_ROUND_AIRBRUSH=2;ha.TIP_SQUARE_PIXEL=3;ha.TIP_SQUARE_AA=4;ha.BRUSH_MODE_PAINT=0;ha.BRUSH_MODE_ERASE=1;ha.BRUSH_MODE_DODGE=2;ha.BRUSH_MODE_BURN=3;ha.BRUSH_MODE_WATER=4;ha.BRUSH_MODE_BLUR=5;ha.BRUSH_MODE_SMUDGE=6;ha.BRUSH_MODE_OIL=7;ha.PAINT_MODE_OPACITY=0;ha.PAINT_MODE_FLOW=1;ha.DEFAULTS={isAA:!1,minSpacing:0,spacing:0,pressureSize:!0,pressureAlpha:!1,pressureScattering:!1,
alphaScale:1,tip:ha.TIP_ROUND_PIXEL,brushMode:ha.BRUSH_MODE_PAINT,paintMode:ha.PAINT_MODE_OPACITY,strokeMode:ha.STROKE_MODE_FREEHAND,resat:1,bleed:0,texture:1,size:0,curSize:0,alpha:0,curAlpha:0,scattering:0,curScattering:0,squeeze:0,curSqueeze:0,angle:Math.PI,curAngle:0,smoothing:0};ha.prototype.applyPressure=function(a){this.pressureSize&&this.brushMode!=ha.BRUSH_MODE_SMUDGE&&this.brushMode!=ha.BRUSH_MODE_OIL?this.curSize=Math.max(.1,this.size*a):this.curSize=Math.max(.1,this.size);16<this.curSize&&
(this.curSize=Math.floor(this.curSize));this.curSize=Math.min(this.curSize,400);this.curAlpha=this.pressureAlpha?Math.floor(this.alpha*Math.min(a,1)):this.alpha;this.curSqueeze=this.squeeze;this.curAngle=this.angle;this.curScattering=this.scattering*this.curSize*(this.pressureScattering?a:1)};ha.prototype.clone=function(){return new ha(this)};ka.prototype.makeEmpty=function(){this.bottom=this.right=this.top=this.left=0};ka.prototype.union=function(a){this.isEmpty()?this.set(a):a.isEmpty()||(this.left=
Math.min(this.left,a.left),this.top=Math.min(this.top,a.top),this.right=Math.max(this.right,a.right),this.bottom=Math.max(this.bottom,a.bottom))};ka.prototype.getUnion=function(a){var c=this.clone();return c.union(a),c};ka.prototype.getIntersection=function(a){return new ka(Math.max(this.left,a.left),Math.max(this.top,a.top),Math.min(this.right,a.right),Math.min(this.bottom,a.bottom))};ka.prototype.clipTo=function(a){return this.isEmpty()||(a.isEmpty()?this.makeEmpty():(this.left=Math.min(Math.max(this.left,
a.left),a.right),this.top=Math.min(Math.max(this.top,a.top),a.bottom),this.right=Math.max(Math.min(this.right,a.right),a.left),this.bottom=Math.max(Math.min(this.bottom,a.bottom),a.top))),this};ka.prototype.containsPoint=function(a){return!(a.x<this.left||a.y<this.top||a.x>=this.right||a.y>=this.bottom)};ka.prototype.isInside=function(a){return this.left>=a.left&&this.top>=a.top&&this.right<=a.right&&this.bottom<=a.bottom};ka.prototype.clipSourceDest=function(a,c){c.right=c.left+a.getWidth();c.bottom=
c.top+a.getHeight();this.isEmpty()||c.left>=this.right||c.top>=this.bottom||c.right<=this.left||c.bottom<=this.top?(a.makeEmpty(),c.makeEmpty()):(c.right>this.right&&(a.right-=c.right-this.right,c.right=this.right),c.bottom>this.bottom&&(a.bottom-=c.bottom-this.bottom,c.bottom=this.bottom),c.left<this.left&&(a.left+=this.left-c.left,c.left=this.left),c.top<this.top&&(a.top+=this.top-c.top,c.top=this.top))};ka.prototype.getWidth=function(){return this.right-this.left};ka.prototype.getHeight=function(){return this.bottom-
this.top};ka.prototype.getArea=function(){return this.getWidth()*this.getHeight()};ka.prototype.isEmpty=function(){return this.right<=this.left||this.bottom<=this.top};ka.prototype.set=function(a){this.left=a.left;this.top=a.top;this.right=a.right;this.bottom=a.bottom};ka.prototype.clone=function(){return new ka(this.left,this.top,this.right,this.bottom)};ka.prototype.translate=function(a,c){return this.left+=a,this.right+=a,this.top+=c,this.bottom+=c,this};ka.prototype.getTranslated=function(a,c){var d=
this.clone();return d.translate(a,c),d};ka.prototype.moveTo=function(a,c){this.translate(a-this.left,c-this.top)};ka.prototype.equals=function(a){return this.left==a.left&&this.right==a.right&&this.top==a.top&&this.bottom==a.bottom};ka.prototype.grow=function(a,c){this.left-=a;this.right+=a;this.top-=c;this.bottom+=c};ka.prototype.toString=function(){return"("+this.left+","+this.top+","+this.right+","+this.bottom+")"};ka.prototype.toPoints=function(){return[{x:this.left,y:this.top},{x:this.right,
y:this.top},{x:this.right,y:this.bottom},{x:this.left,y:this.bottom}]};ka.prototype.roundNearest=function(){return this.left=Math.round(this.left),this.top=Math.round(this.top),this.right=Math.round(this.right),this.bottom=Math.round(this.bottom),this};ka.prototype.roundContain=function(){return this.left=Math.floor(this.left),this.top=Math.floor(this.top),this.right=Math.ceil(this.right),this.bottom=Math.ceil(this.bottom),this};ka.createBoundingBox=function(a){if(0===a.length)return new ka(0,0,0,
0);let c=new ka(a[0].x,a[0].y,a[0].x,a[0].y);for(let d=1;d<a.length;d++)c.left=Math.min(c.left,a[d].x),c.top=Math.min(c.top,a[d].y),c.right=Math.max(c.right,a[d].x),c.bottom=Math.max(c.bottom,a[d].y);return c};ka.prototype.subtract=function(a){return ka.subtract(this,a)};ka.subtract=function(a,c){a instanceof ka&&(a=[a]);c instanceof ka&&(c=[c]);a=a.slice(0);for(let b=0;b<c.length;b++){let g=c[b],n=a.length;for(let f=0;f<n;f++){var d=a[f];if(!d)continue;let e=d.getIntersection(g);if(!e.isEmpty()){let l=
[];if(d.top<g.top&&l.push(new ka(d.left,d.top,d.right,e.top)),d.bottom>g.bottom&&l.push(new ka(d.left,e.bottom,d.right,d.bottom)),d.left<g.left&&l.push(new ka(d.left,e.top,e.left,e.bottom)),d.right>g.right&&l.push(new ka(e.right,e.top,d.right,e.bottom)),0<(l=l.filter(k=>!k.isEmpty())).length)for(a[f]=l[0],d=1;d<l.length;d++)a.push(l[d]);else a[f]=null}}}return a.filter(b=>null!=b)};ka.union=function(a){if(a instanceof ka)a=[a];else{a=a.slice(0);for(let d=0;d<a.length;d++){let b=a[d],g=a.length;if(b)for(let n=
d+1;n<g;n++){var c=a[n];if(c&&!b.getIntersection(c).isEmpty()){c=ka.subtract(c,b);a[n]=c[0];for(let f=1;f<c.length;f++)a.push(c[f])}}}}return a.filter(d=>d&&!d.isEmpty())};"object"==typeof window&&(window.cpRectGarbage=new ka(1.5,2.5,3.5,4.5));sc.prototype.getBounds=function(){return new ka(0,0,this.width,this.height)};sc.prototype.isInside=function(a,c){return 0<=a&&0<=c&&a<this.width&&c<this.height};z.prototype=Object.create(sc.prototype);z.prototype.constructor=z;z.BYTES_PER_PIXEL=4;z.RED_BYTE_OFFSET=
0;z.GREEN_BYTE_OFFSET=1;z.BLUE_BYTE_OFFSET=2;z.ALPHA_BYTE_OFFSET=3;z.prototype.clone=function(){return this.cloneRect(this.getBounds())};z.prototype.cloneRect=function(a){var c=new z(a.getWidth(),a.getHeight());return c.copyBitmapRect(this,0,0,a),c};z.prototype.getPixel=function(a,c){a=Math.max(0,Math.min(this.width-1,a));c=Math.max(0,Math.min(this.height-1,c));a=this.offsetOfPixel(a,c);return this.data[a+z.ALPHA_BYTE_OFFSET]<<24|this.data[a+z.RED_BYTE_OFFSET]<<16|this.data[a+z.GREEN_BYTE_OFFSET]<<
8|this.data[a+z.BLUE_BYTE_OFFSET]};z.prototype.copyRectXOR=function(a,c){var d=(c=this.getBounds().clipTo(c)).getWidth(),b=new Uint8Array(d*c.getHeight()*z.BYTES_PER_PIXEL),g=0,n=this.offsetOfPixel(c.left,c.top),f=a.offsetOfPixel(c.left,c.top),e=(this.width-d)*z.BYTES_PER_PIXEL,l=(a.width-d)*z.BYTES_PER_PIXEL;d*=z.BYTES_PER_PIXEL;for(var k=c.top;k<c.bottom;k++,n+=e,f+=l)for(var h=0;h<d;h++,g++,n++,f++)b[g]=this.data[n]^a.data[f];return b};z.prototype.setRectXOR=function(a,c){var d=(c=this.getBounds().clipTo(c)).getWidth(),
b=c.getHeight();c=this.offsetOfPixel(c.left,c.top);var g=0,n=(this.width-d)*z.BYTES_PER_PIXEL;d*=z.BYTES_PER_PIXEL;for(var f=0;f<b;f++){for(var e=0;e<d;e++)this.data[c++]^=a[g++];c+=n}};z.prototype.copyBitmapRect=function(a,c,d,b){var g=new ka(c,d,0,0);b=b.clone();this.getBounds().clipSourceDest(b,g);c=0|g.getWidth();d=0|g.getHeight();if(0==g.left&&0==g.top&&c==this.width&&d==this.height&&c==a.width&&d==a.height)this.copyPixelsFrom(a);else{g=this.offsetOfPixel(g.left,g.top);var n=(this.width-c)*z.BYTES_PER_PIXEL;
b=a.offsetOfPixel(b.left,b.top);for(var f=(a.width-c)*z.BYTES_PER_PIXEL,e=0;e<d;e++,b+=f,g+=n)for(var l=0;l<c;l++,b+=z.BYTES_PER_PIXEL,g+=z.BYTES_PER_PIXEL)this.data[g]=a.data[b],this.data[g+1]=a.data[b+1],this.data[g+2]=a.data[b+2],this.data[g+3]=a.data[b+3]}};z.prototype.copyAlphaFrom=function(a,c){var d=0|(c=this.getBounds().clipTo(c)).getWidth(),b=0|c.getHeight();c=this.offsetOfPixel(c.left,c.top)+z.ALPHA_BYTE_OFFSET|0;for(var g=(this.width-d)*z.BYTES_PER_PIXEL|0,n=0;n<b;n++,c+=g)for(var f=0;f<
d;f++,c+=z.BYTES_PER_PIXEL)this.data[c]=a.data[c]};z.prototype.setToSize=function(a){(a.width!=this.width||a.height!=this.height)&&(this.width=a.width,this.height=a.height,this.imageData=Ed(this.width,this.height),this.data=this.imageData.data)};z.prototype.copyPixelsFrom=function(a){if(this.setToSize(a),"set"in this.data)this.data.set(a.data);else for(var c=0;c<this.data.length;c++)this.data[c]=a.data[c]};z.prototype.copyPixelsFromGreyscale=function(a){var c,d=0,b=a.width*a.height;this.setToSize(a);
for(c=0;c<b;c++,d+=z.BYTES_PER_PIXEL)this.data[d+z.RED_BYTE_OFFSET]=a.data[c],this.data[d+z.GREEN_BYTE_OFFSET]=a.data[c],this.data[d+z.BLUE_BYTE_OFFSET]=a.data[c],this.data[d+z.ALPHA_BYTE_OFFSET]=255};z.prototype.copyScaledNearestNeighbor=function(a){for(var c,d=0,b=a.width/this.width,g=a.height/this.height,n=0,f=0;n<this.height;n++,f+=g){c=a.offsetOfPixel(0,Math.round(f));for(var e=0,l=0;e<this.width;e++,d+=z.BYTES_PER_PIXEL,l+=b){var k=c+Math.round(l)*z.BYTES_PER_PIXEL;this.data[d]=a.data[k];this.data[d+
1]=a.data[k+1];this.data[d+2]=a.data[k+2];this.data[d+z.ALPHA_BYTE_OFFSET]=a.data[k+z.ALPHA_BYTE_OFFSET]}}};z.prototype.createThumbnailFrom=function(a){let c=Math.min(Math.floor(a.width/this.width),3);if(2>c)this.copyScaledNearestNeighbor(a);else{var d=new Uint16Array(5*this.width),b=a.width*z.BYTES_PER_PIXEL,g=Math.floor(a.width/this.width)*z.BYTES_PER_PIXEL,n=Math.floor(a.width/this.width/c)*z.BYTES_PER_PIXEL,f=g-n*c,e=Math.floor(a.height/this.height/c);g=e*b-g*this.width;b*=Math.floor(a.height/
this.height)-e*c;var l=e=0;for(let q=0;q<this.height;q++,e+=b){let r;d.fill(0);for(var k=0;k<c;k++,e+=g){r=0;for(var h=0;h<this.width;h++,r+=5,e+=f)for(var m=0;m<c;m++,e+=n){let t=a.data[e+z.ALPHA_BYTE_OFFSET],u=t/255;d[r]+=a.data[e]*u;d[r+1]+=a.data[e+1]*u;d[r+2]+=a.data[e+2]*u;d[r+z.ALPHA_BYTE_OFFSET]+=t;d[r+4]=Math.max(d[r+4],t)}}r=0;for(k=0;k<this.width;k++,r+=5,l+=z.BYTES_PER_PIXEL)h=d[r+4],0==h?this.data[l+z.ALPHA_BYTE_OFFSET]=0:(m=h/d[r+z.ALPHA_BYTE_OFFSET],this.data[l]=d[r]*m,this.data[l+
1]=d[r+1]*m,this.data[l+2]=d[r+2]*m,this.data[l+z.ALPHA_BYTE_OFFSET]=h)}}};z.prototype.floodFill=function(a,c,d){if(this.isInside(a,c)){var b=this.getPixel(a,c),g=b>>24&255,n=b>>16&255,f=b>>8&255,e=255&b,l=d>>24&255,k=d>>16&255,h=d>>8&255,m=255&d,q=[],r=this.getBounds(),t=this.data;if(r.left*=z.BYTES_PER_PIXEL,r.right*=z.BYTES_PER_PIXEL,q.push({x1:a*z.BYTES_PER_PIXEL,x2:a*z.BYTES_PER_PIXEL,y:c,dy:-1}),q.push({x1:a*z.BYTES_PER_PIXEL,x2:a*z.BYTES_PER_PIXEL,y:c+1,dy:1}),0==g){if(0!=l)for(;0<q.length;)if(n=
q.pop(),!(n.y<r.top||n.y>=r.bottom)){f=this.offsetOfPixel(0,n.y);for(e=n.x1;e>=r.left&&0==t[e+f+z.ALPHA_BYTE_OFFSET];)t[e+f+z.RED_BYTE_OFFSET]=k,t[e+f+z.GREEN_BYTE_OFFSET]=h,t[e+f+z.BLUE_BYTE_OFFSET]=m,t[e+f+z.ALPHA_BYTE_OFFSET]=l,e-=z.BYTES_PER_PIXEL;if(e>=n.x1){for(;e<=n.x2&&t[e+f+z.ALPHA_BYTE_OFFSET]!=g;)e+=z.BYTES_PER_PIXEL;if(a=e+z.BYTES_PER_PIXEL,e>n.x2)continue}else(e+=z.BYTES_PER_PIXEL)<n.x1&&q.push({x1:e,x2:n.x1-z.BYTES_PER_PIXEL,y:n.y-n.dy,dy:-n.dy}),a=n.x1+z.BYTES_PER_PIXEL;do{t[e+f+z.RED_BYTE_OFFSET]=
k;t[e+f+z.GREEN_BYTE_OFFSET]=h;t[e+f+z.BLUE_BYTE_OFFSET]=m;for(t[e+f+z.ALPHA_BYTE_OFFSET]=l;a<r.right&&t[a+f+z.ALPHA_BYTE_OFFSET]==g;)t[a+f+z.RED_BYTE_OFFSET]=k,t[a+f+z.GREEN_BYTE_OFFSET]=h,t[a+f+z.BLUE_BYTE_OFFSET]=m,t[a+f+z.ALPHA_BYTE_OFFSET]=l,a+=z.BYTES_PER_PIXEL;q.push({x1:e,x2:a-z.BYTES_PER_PIXEL,y:n.y+n.dy,dy:n.dy});a-z.BYTES_PER_PIXEL>n.x2&&q.push({x1:n.x2+z.BYTES_PER_PIXEL,x2:a-z.BYTES_PER_PIXEL,y:n.y-n.dy,dy:-n.dy});for(e=a+z.BYTES_PER_PIXEL;e<=n.x2&&t[e+f+z.ALPHA_BYTE_OFFSET]!=g;)e+=z.BYTES_PER_PIXEL;
a=e+z.BYTES_PER_PIXEL}while(e<=n.x2)}}else if(d!=b)for(;0<q.length;)if(a=q.pop(),!(a.y<r.top||a.y>=r.bottom)){c=this.offsetOfPixel(0,a.y);for(d=a.x1;d>=r.left&&t[d+c+z.RED_BYTE_OFFSET]==n&&t[d+c+z.GREEN_BYTE_OFFSET]==f&&t[d+c+z.BLUE_BYTE_OFFSET]==e&&t[d+c+z.ALPHA_BYTE_OFFSET]==g;)t[d+c+z.RED_BYTE_OFFSET]=k,t[d+c+z.GREEN_BYTE_OFFSET]=h,t[d+c+z.BLUE_BYTE_OFFSET]=m,t[d+c+z.ALPHA_BYTE_OFFSET]=l,d-=z.BYTES_PER_PIXEL;if(d>=a.x1){for(;d<=a.x2&&(t[d+c+z.RED_BYTE_OFFSET]!=n||t[d+c+z.GREEN_BYTE_OFFSET]!=f||
t[d+c+z.BLUE_BYTE_OFFSET]!=e||t[d+c+z.ALPHA_BYTE_OFFSET]!=g);)d+=z.BYTES_PER_PIXEL;if(b=d+z.BYTES_PER_PIXEL,d>a.x2)continue}else(d+=z.BYTES_PER_PIXEL)<a.x1&&q.push({x1:d,x2:a.x1-z.BYTES_PER_PIXEL,y:a.y-a.dy,dy:-a.dy}),b=a.x1+z.BYTES_PER_PIXEL;do{t[d+c+z.RED_BYTE_OFFSET]=k;t[d+c+z.GREEN_BYTE_OFFSET]=h;t[d+c+z.BLUE_BYTE_OFFSET]=m;for(t[d+c+z.ALPHA_BYTE_OFFSET]=l;b<r.right&&t[b+c+z.RED_BYTE_OFFSET]==n&&t[b+c+z.GREEN_BYTE_OFFSET]==f&&t[b+c+z.BLUE_BYTE_OFFSET]==e&&t[b+c+z.ALPHA_BYTE_OFFSET]==g;)t[b+c+
z.RED_BYTE_OFFSET]=k,t[b+c+z.GREEN_BYTE_OFFSET]=h,t[b+c+z.BLUE_BYTE_OFFSET]=m,t[b+c+z.ALPHA_BYTE_OFFSET]=l,b+=z.BYTES_PER_PIXEL;q.push({x1:d,x2:b-z.BYTES_PER_PIXEL,y:a.y+a.dy,dy:a.dy});b-z.BYTES_PER_PIXEL>a.x2&&q.push({x1:a.x2+z.BYTES_PER_PIXEL,x2:b-z.BYTES_PER_PIXEL,y:a.y-a.dy,dy:-a.dy});for(d=b+z.BYTES_PER_PIXEL;d<=a.x2&&(t[d+c+z.RED_BYTE_OFFSET]!=n||t[d+c+z.GREEN_BYTE_OFFSET]!=f||t[d+c+z.BLUE_BYTE_OFFSET]!=e||t[d+c+z.ALPHA_BYTE_OFFSET]!=g);)d+=z.BYTES_PER_PIXEL;b=d+z.BYTES_PER_PIXEL}while(d<=a.x2)}}};
z.prototype.copyPixelColumnToArray=function(a,c,d,b){var g=(this.width-1)*z.BYTES_PER_PIXEL,n=0;a=this.offsetOfPixel(a,c);for(c=0;c<d;c++){for(var f=0;f<z.BYTES_PER_PIXEL;f++)b[n++]=this.data[a++];a+=g}};z.prototype.copyArrayToPixelColumn=function(a,c,d,b){var g=(this.width-1)*z.BYTES_PER_PIXEL,n=0;a=this.offsetOfPixel(a,c);for(c=0;c<d;c++){for(var f=0;f<z.BYTES_PER_PIXEL;f++)this.data[a++]=b[n++];a+=g}};z.prototype.boxBlur=function(a,c,d){let b=(a=this.getBounds().clipTo(a)).getWidth(),g=b*z.BYTES_PER_PIXEL,
n=a.getHeight();var f=Math.max(b,n);let e=new Uint8Array(f*z.BYTES_PER_PIXEL);f=new Uint8Array(f*z.BYTES_PER_PIXEL);for(let h=a.top;h<a.bottom;h++){var l=this.offsetOfPixel(a.left,h);for(var k=0;k<g;k++)e[k]=this.data[l++];!function(m,q){for(var r=0,t=0;t<q;t++){for(var u=m[r+z.ALPHA_BYTE_OFFSET],y=0;3>y;y++,r++)m[r]=Math.round(m[r]*u/255);r++}}(e,b);me(e,f,b,c);l=this.offsetOfPixel(a.left,h);for(k=0;k<g;k++)this.data[l++]=f[k]}for(c=a.left;c<a.right;c++)this.copyPixelColumnToArray(c,a.top,n,e),me(e,
f,n,d),function(h,m){for(var q=0,r=0;r<m;r++){var t=h[q+z.ALPHA_BYTE_OFFSET];if(0!=t){t=255/t;for(var u=0;3>u;u++,q++)h[q]=Math.min(Math.round(h[q]*t),255);q++}else q+=z.BYTES_PER_PIXEL}}(f,n),this.copyArrayToPixelColumn(c,a.top,n,f)};z.prototype.offsetOfPixel=function(a,c){return 4*(c*this.width+a)|0};z.prototype.getMemorySize=function(){return this.data.length};z.prototype.getImageData=function(){return this.imageData};z.prototype.setImageData=function(a){this.width=a.width;this.height=a.height;
this.imageData=a;this.data=a.data};z.prototype.clearAll=function(a){if(0==a&&"fill"in this.data)this.data.fill(0);else{var c=a>>24&255,d=a>>16&255,b=a>>8&255;a&=255;for(var g=0;g<this.width*this.height*z.BYTES_PER_PIXEL;)this.data[g++]=d,this.data[g++]=b,this.data[g++]=a,this.data[g++]=c}};z.prototype.clearRect=function(a,c){a=this.getBounds().clipTo(a);var d=c>>24&255,b=c>>16&255,g=c>>8&255;c&=255;for(var n=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,f=this.offsetOfPixel(a.left,a.top),e=a.top;e<
a.bottom;e++,f+=n)for(var l=a.left;l<a.right;l++)this.data[f++]=b,this.data[f++]=g,this.data[f++]=c,this.data[f++]=d};z.prototype.copyRegionHFlip=function(a,c){a=this.getBounds().clipTo(a);for(var d=a.top;d<a.bottom;d++)for(var b=this.offsetOfPixel(a.left,d),g=c.offsetOfPixel(a.right-1,d),n=a.left;n<a.right;n++,g-=2*z.BYTES_PER_PIXEL)for(var f=0;f<z.BYTES_PER_PIXEL;f++)this.data[b++]=c.data[g++]};z.prototype.copyRegionVFlip=function(a,c){for(var d=(a=this.getBounds().clipTo(a)).getWidth()*z.BYTES_PER_PIXEL,
b=a.top;b<a.bottom;b++)for(var g=this.offsetOfPixel(a.left,b),n=c.offsetOfPixel(a.left,a.bottom-1-(b-a.top)),f=0;f<d;f++)this.data[g++]=c.data[n++]};z.prototype.fillWithNoise=function(a){a=this.getBounds().clipTo(a);for(var c,d=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,b=this.offsetOfPixel(a.left,a.top),g=a.top;g<a.bottom;g++,b+=d)for(var n=a.left;n<a.right;n++,b+=z.BYTES_PER_PIXEL)c=256*Math.random()|0,this.data[b+z.RED_BYTE_OFFSET]=c,this.data[b+z.GREEN_BYTE_OFFSET]=c,this.data[b+z.BLUE_BYTE_OFFSET]=
c,this.data[b+z.ALPHA_BYTE_OFFSET]=255};z.prototype.gradientHorzReplace=function(a,c,d,b){var g={r:b[0]>>16&255,g:b[0]>>8&255,b:255&b[0],a:b[0]>>24&255};b={r:b[1]>>16&255,g:b[1]>>8&255,b:255&b[1],a:b[1]>>24&255};var n=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,f=0|this.offsetOfPixel(a.left,a.top),e=a.bottom-a.top|0;if(d<c){var l=d;d=c;c=l;l=g;g=b;b=l}var k=d-c|0;l=(b.r-g.r)/k;var h=(b.g-g.g)/k,m=(b.b-g.b)/k;k=(b.a-g.a)/k;for(var q=Math.max(a.left-c,0),r=0;r<e;r++,f+=n){for(var t=a.left,u=0|Math.min(c,
a.right);t<u;t++,f+=z.BYTES_PER_PIXEL)this.data[f+z.RED_BYTE_OFFSET]=g.r,this.data[f+z.GREEN_BYTE_OFFSET]=g.g,this.data[f+z.BLUE_BYTE_OFFSET]=g.b,this.data[f+z.ALPHA_BYTE_OFFSET]=g.a;var y=g.r+l*q,A=g.g+h*q,F=g.b+m*q,D=g.a+k*q;for(u=0|Math.min(d,a.right);t<u;t++,f+=z.BYTES_PER_PIXEL)this.data[f+z.RED_BYTE_OFFSET]=y,this.data[f+z.GREEN_BYTE_OFFSET]=A,this.data[f+z.BLUE_BYTE_OFFSET]=F,this.data[f+z.ALPHA_BYTE_OFFSET]=D,y+=l,A+=h,F+=m,D+=k;for(;t<a.right;t++,f+=z.BYTES_PER_PIXEL)this.data[f+z.RED_BYTE_OFFSET]=
b.r,this.data[f+z.GREEN_BYTE_OFFSET]=b.g,this.data[f+z.BLUE_BYTE_OFFSET]=b.b,this.data[f+z.ALPHA_BYTE_OFFSET]=b.a}};z.prototype.gradientVertReplace=function(a,c,d,b){var g={r:b[0]>>16&255,g:b[0]>>8&255,b:255&b[0],a:b[0]>>24&255};b={r:b[1]>>16&255,g:b[1]>>8&255,b:255&b[1],a:b[1]>>24&255};let n=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,f=0|this.offsetOfPixel(a.left,a.top),e=a.right-a.left|0;if(d<c){var l=d;d=c;c=l;l=g;g=b;b=l}l=a.top;for(var k=0|Math.min(a.bottom,c);l<k;l++,f+=n)for(var h=0;h<e;h++,
f+=z.BYTES_PER_PIXEL)this.data[f+z.RED_BYTE_OFFSET]=g.r,this.data[f+z.GREEN_BYTE_OFFSET]=g.g,this.data[f+z.BLUE_BYTE_OFFSET]=g.b,this.data[f+z.ALPHA_BYTE_OFFSET]=g.a;var m=d-c|0;k=(b.r-g.r)/m;h=(b.g-g.g)/m;var q=(b.b-g.b)/m;m=(b.a-g.a)/m;var r=Math.max(l-c,0);c=g.r+k*r;var t=g.g+h*r,u=g.b+q*r;g=g.a+m*r;for(d=0|Math.min(a.bottom,d);l<d;l++,f+=n){for(r=0;r<e;r++,f+=z.BYTES_PER_PIXEL)this.data[f+z.RED_BYTE_OFFSET]=c,this.data[f+z.GREEN_BYTE_OFFSET]=t,this.data[f+z.BLUE_BYTE_OFFSET]=u,this.data[f+z.ALPHA_BYTE_OFFSET]=
g;c+=k;t+=h;u+=q;g+=m}for(;l<a.bottom;l++,f+=n)for(d=0;d<e;d++,f+=z.BYTES_PER_PIXEL)this.data[f+z.RED_BYTE_OFFSET]=b.r,this.data[f+z.GREEN_BYTE_OFFSET]=b.g,this.data[f+z.BLUE_BYTE_OFFSET]=b.b,this.data[f+z.ALPHA_BYTE_OFFSET]=b.a};z.prototype.gradientReplace=function(a,c,d,b,g,n){var f=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,e=0|this.offsetOfPixel(a.left,a.top),l=a.right-a.left|0,k=n[0]>>16&255,h=n[0]>>8&255,m=255&n[0],q=n[0]>>24&255,r=n[1]>>16&255,t=n[1]>>8&255,u=255&n[1];n=n[1]>>24&255;var y=
g-d+(b-c)*(b-c)/(g-d);b=b-c+(g-d)*(g-d)/(b-c);g=1/b;for(var A=a.top;A<a.bottom;A++,e+=f)for(var F=(a.left-c)/b+(A-d)/y,D=0;D<l;D++,e+=z.BYTES_PER_PIXEL){var G=Math.min(Math.max(F,0),1),E=1-G;this.data[e+z.RED_BYTE_OFFSET]=k*E+r*G;this.data[e+z.GREEN_BYTE_OFFSET]=h*E+t*G;this.data[e+z.BLUE_BYTE_OFFSET]=m*E+u*G;this.data[e+z.ALPHA_BYTE_OFFSET]=q*E+n*G;F+=g}};z.prototype.gradientAlpha=function(a,c,d,b,g,n){var f=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,e=0|this.offsetOfPixel(a.left,a.top),l=a.right-
a.left|0,k=n[0]>>16&255,h=n[0]>>8&255,m=255&n[0],q=n[0]>>24&255,r=n[1]>>16&255,t=n[1]>>8&255,u=255&n[1];n=n[1]>>24&255;var y=g-d+(b-c)*(b-c)/(g-d);b=b-c+(g-d)*(g-d)/(b-c);g=1/b;for(var A=a.top;A<a.bottom;A++,e+=f)for(var F=(a.left-c)/b+(A-d)/y,D=0;D<l;D++,e+=z.BYTES_PER_PIXEL){var G=Math.min(Math.max(F,0),1),E=1-G,P=k*E+r*G,N=h*E+t*G,O=m*E+u*G;E=q*E+n*G;G=this.data[e+z.ALPHA_BYTE_OFFSET];G=E+G-E*G/255|0;if(0<G){E=255*E/G|0;var U=255-E;this.data[e+z.RED_BYTE_OFFSET]=(P*E+this.data[e+z.RED_BYTE_OFFSET]*
U)/255|0;this.data[e+z.GREEN_BYTE_OFFSET]=(N*E+this.data[e+z.GREEN_BYTE_OFFSET]*U)/255|0;this.data[e+z.BLUE_BYTE_OFFSET]=(O*E+this.data[e+z.BLUE_BYTE_OFFSET]*U)/255|0;this.data[e+z.ALPHA_BYTE_OFFSET]=G}F+=g}};z.prototype.gradient=function(a,c,d,b,g,n,f){a=this.getBounds().clipTo(a);(c!=b||d!=g)&&(f||255==n[0]>>>24&&255==n[1]>>>24?c==b?this.gradientVertReplace(a,d,g,n):d==g?this.gradientHorzReplace(a,c,b,n):this.gradientReplace(a,c,d,b,g,n):this.gradientAlpha(a,c,d,b,g,n))};z.prototype.fillWithColorNoise=
function(a){a=this.getBounds().clipTo(a);for(var c,d=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,b=this.offsetOfPixel(a.left,a.top),g=a.top;g<a.bottom;g++,b+=d)for(var n=a.left;n<a.right;n++,b+=z.BYTES_PER_PIXEL)c=16777216*Math.random()|0,this.data[b+z.RED_BYTE_OFFSET]=c>>16&255,this.data[b+z.GREEN_BYTE_OFFSET]=c>>8&255,this.data[b+z.BLUE_BYTE_OFFSET]=255&c,this.data[b+z.ALPHA_BYTE_OFFSET]=255};z.prototype.invert=function(a){a=this.getBounds().clipTo(a);for(var c=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,
d=this.offsetOfPixel(a.left,a.top),b=a.top;b<a.bottom;b++,d+=c)for(var g=a.left;g<a.right;g++,d+=z.BYTES_PER_PIXEL)this.data[d+z.RED_BYTE_OFFSET]^=255,this.data[d+z.GREEN_BYTE_OFFSET]^=255,this.data[d+z.BLUE_BYTE_OFFSET]^=255};z.prototype.brightnessToOpacity=function(a){a=this.getBounds().clipTo(a);let c=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,d=this.offsetOfPixel(a.left,a.top);for(let g=a.top;g<a.bottom;g++,d+=c)for(let n=a.left;n<a.right;n++,d+=z.BYTES_PER_PIXEL){var b=void 0;b=(this.data[d+
z.RED_BYTE_OFFSET]+this.data[d+z.GREEN_BYTE_OFFSET]+this.data[d+z.BLUE_BYTE_OFFSET])/3;let f=this.data[d+z.ALPHA_BYTE_OFFSET]/255;b=250<b?0:Math.round(255*(1-b/250));this.data[d+z.ALPHA_BYTE_OFFSET]=Math.round(b*f);0<b&&(this.data[d+z.RED_BYTE_OFFSET]=0,this.data[d+z.GREEN_BYTE_OFFSET]=0,this.data[d+z.BLUE_BYTE_OFFSET]=0)}};z.prototype.getNonTransparentBounds=function(a){var c,d,b=a.clone();var g=(this.width-b.getWidth())*z.BYTES_PER_PIXEL;a=this.offsetOfPixel(b.left,b.top)+z.ALPHA_BYTE_OFFSET;for(d=
b.top;d<b.bottom;d++,a+=g){var n=0;for(c=b.left;c<b.right;c++,a+=z.BYTES_PER_PIXEL)n|=this.data[a];if(0!=n)break}if(b.top=d,b.top==b.bottom)return b;a=this.offsetOfPixel(b.right-1,b.bottom-1)+z.ALPHA_BYTE_OFFSET;for(d=b.bottom-1;d>=b.top;d--,a-=g){n=0;for(c=b.right-1;c>=b.left;c--,a-=z.BYTES_PER_PIXEL)n|=this.data[a];if(0!=n)break}b.bottom=d+1;g=z.BYTES_PER_PIXEL*this.width;for(c=b.left;c<b.right;c++){a=this.offsetOfPixel(c,b.top)+z.ALPHA_BYTE_OFFSET;n=0;for(d=b.top;d<b.bottom;d++,a+=g)n|=this.data[a];
if(0!=n)break}b.left=c;for(c=b.right-1;c>=b.left;c--){a=this.offsetOfPixel(c,b.top)+z.ALPHA_BYTE_OFFSET;n=0;for(d=b.top;d<b.bottom;d++,a+=g)n|=this.data[a];if(0!=n)break}return b.right=c+1,b};z.prototype.getAsCanvas=function(a){var c=Zb(this.imageData.width,this.imageData.height);return c.getContext("2d").putImageData(this.imageData,0,0),ne(c,a||0)};z.prototype.getAsPNG=function(a){var c;return"string"==typeof(c=this.getAsCanvas(a).toDataURL("image/png"))&&!!c.match(/^data:image\/png;base64,/i)&&
window.atob(c.substring(22))};z.prototype.getAsPNGBuffer=function(a){return this.getAsCanvas(a).toBuffer("image/png")};z.prototype.hasAlphaInRect=function(a){a=this.getBounds().clipTo(a);for(var c=(this.width-a.getWidth())*z.BYTES_PER_PIXEL,d=this.offsetOfPixel(a.left,a.top)+z.ALPHA_BYTE_OFFSET,b=a.top;b<a.bottom;b++,d+=c){for(var g=255,n=a.left;n<a.right;n++,d+=z.BYTES_PER_PIXEL)g&=this.data[d];if(255!=g)return!0}return!1};z.prototype.hasAlpha=function(){return this.hasAlphaInRect(this.getBounds())};
z.createFromImage=function(a){var c=Zb(a.width,a.height).getContext("2d");return c.globalCompositeOperation="copy",c.drawImage(a,0,0),new z(c.getImageData(0,0,a.width,a.height))};z.prototype.equals=function(a){if(this.width!=a.width||this.height!=a.height)return!1;for(let c=0;c<this.data.length;c+=z.BYTES_PER_PIXEL)if(!(0==this.data[c+z.ALPHA_BYTE_OFFSET]&&0==a.data[c+z.ALPHA_BYTE_OFFSET]||this.data[c]==a.data[c]&&this.data[c+1]==a.data[c+1]&&this.data[c+2]==a.data[c+2]&&this.data[c+3]==a.data[c+
3]))return!1;return!0};Qa.prototype=Object.create(Ta.prototype);Qa.prototype.constructor=Qa;Qa.prototype.getLinearizedLayerList=function(a,c){for(let d of(c=c||[],this.layers))d instanceof Qa&&(d.expanded||!a)&&d.getLinearizedLayerList(a,c),c.push(d);return c};Qa.prototype.clearLayers=function(){this.layers=[]};Qa.prototype.addLayer=function(a){a.parent=this;this.layers.push(a)};Qa.prototype.insertLayer=function(a,c){c.parent=this;this.layers.splice(a,0,c)};Qa.prototype.removeLayer=function(a){a=
this.layers.indexOf(a);-1<a&&this.layers.splice(a,1)};Qa.prototype.removeLayerAtIndex=function(a){var c=this.layers[a];return c&&this.layers.splice(a,1),c};Qa.prototype.setLayerAtIndex=function(a,c){var d=this.layers[a];return c.parent=this,this.layers[a]=c,d};Qa.prototype.setExpanded=function(a){this.expanded=a};Qa.prototype.getExpanded=function(){return this.expanded};Qa.prototype.indexOf=function(a){return this.layers.indexOf(a)};Qa.prototype.getMemoryUsed=function(){return this.layers.map(a=>
a.getMemoryUsed()).reduce(Hf,0)};Qa.prototype.clone=function(){var a=new Qa(this.name,this.blendMode);return Ta.prototype.copyFrom.call(a,this),a.expanded=this.expanded,a.layers=this.layers.map(c=>c.clone()),a.layers.forEach(c=>c.parent=a),a};Qa.prototype.getNonTransparentBounds=function(a){var c=new ka(0,0,0,0);return this.layers.forEach(d=>c.union(d.getNonTransparentBounds(a))),c};ya.prototype=Object.create(sc.prototype);ya.prototype.constructor=ya;ya.prototype.createBitmap=function(a,c,d){switch(this.bitDepth=
d,d){case 32:this.data=new Uint32Array(a*c);break;case 16:this.data=new Uint16Array(a*c);break;default:this.data=new Uint8Array(a*c)}};ya.prototype.clone=function(){var a=new ya(this.width,this.height,this.bitDepth);return a.copyPixelsFrom(this),a};ya.prototype.cloneRect=function(a){var c=new ya(a.getWidth(),a.getHeight(),this.bitDepth);return c.copyBitmapRect(this,0,0,a),c};ya.prototype.getPixel=function(a,c){return a=Math.max(0,Math.min(this.width-1,a)),c=Math.max(0,Math.min(this.height-1,c)),this.data[this.offsetOfPixel(a,
c)]};ya.prototype.clearAll=function(a){this.data.fill(a)};ya.prototype.clearRect=function(a,c){if((a=this.getBounds().clipTo(a)).equals(this.getBounds()))this.clearAll(c);else{let d=this.width,b=a.right-a.left,g=this.offsetOfPixel(a.left,a.top);for(let n=a.top;n<a.bottom;n++,g+=d)this.data.fill(c,g,g+b)}};ya.prototype.copyScaledNearestNeighbor=function(a){for(var c,d=0,b=a.width/this.width,g=a.height/this.height,n=0,f=0;n<this.height;n++,f+=g){c=a.offsetOfPixel(0,Math.round(f));for(var e=0,l=0;e<
this.width;e++,d++,l+=b)this.data[d]=a.data[c+Math.round(l)]}};ya.prototype.floodFill=function(a,c,d){if(this.isInside(a,c)){d&=255;var b=this.getPixel(a,c),g=[],n=this.getBounds(),f=this.data;if(g.push({x1:a,x2:a,y:c,dy:-1}),g.push({x1:a,x2:a,y:c+1,dy:1}),d!=b)for(;0<g.length;){a=g.pop();if(a.y<n.top||a.y>=n.bottom)continue;c=this.offsetOfPixel(0,a.y);let e=a.x1,l;for(;e>=n.left&&f[e+c]==b;)f[e+c]=d,e--;if(e>=a.x1){for(;e<=a.x2&&f[e+c]!=b;)e++;if(l=e+1,e>a.x2)continue}else++e<a.x1&&g.push({x1:e,
x2:a.x1-1,y:a.y-a.dy,dy:-a.dy}),l=a.x1+1;do{for(f[e+c]=d;l<n.right&&f[l+c]==b;)f[l+c]=d,l++;g.push({x1:e,x2:l-1,y:a.y+a.dy,dy:a.dy});l-1>a.x2&&g.push({x1:a.x2+1,x2:l-1,y:a.y-a.dy,dy:-a.dy});for(e=l+1;e<=a.x2&&f[e+c]!=b;)e++;l=e+1}while(e<=a.x2)}}};ya.prototype.createThumbnailFrom=function(a){let c=Math.min(Math.floor(a.width/this.width),3);if(2>c)this.copyScaledNearestNeighbor(a);else{var d=new Uint16Array(this.width),b=a.width,g=Math.floor(a.width/this.width),n=Math.floor(a.width/this.width/c),f=
g-n*c,e=Math.floor(a.height/this.height/c);g=e*b-g*this.width;b*=Math.floor(a.height/this.height)-e*c;var l=e=0;for(let h=0;h<this.height;h++,e+=b){let m;d.fill(0);for(var k=0;k<c;k++,e+=g){m=0;for(let q=0;q<this.width;q++,m++,e+=f)for(let r=0;r<c;r++,e+=n)d[m]+=a.data[e]}m=0;for(k=0;k<this.width;k++,m++,l++)this.data[l]=d[m]/(c*c)}}};ya.prototype.mirrorHorizontally=function(){let a=this.width,c=this.height,d=new Uint8Array(a*c),b=0,g=a;for(let n=0;n<c;n++,g+=a+a)for(let f=0;f<a;f++)d[b++]=this.data[--g];
this.data=d};ya.prototype.applyLUT=function(a){for(var c=0;c<this.data.length;c++)this.data[c]=a.table[this.data[c]]};ya.prototype.getAsCanvas=function(a){var c=this.getImageData(0,0,this.width,this.height),d=Zb(this.width,this.height);return d.getContext("2d").putImageData(c,0,0),ne(d,a||0)};ya.prototype.getImageData=function(a,c,d,b){let g=Ed(d,b);a=this.offsetOfPixel(a,c);c=0;let n=this.width-d;for(let f=0;f<b;f++,a+=n)for(let e=0;e<d;e++,a++)g.data[c++]=this.data[a],g.data[c++]=this.data[a],g.data[c++]=
this.data[a],g.data[c++]=255;return g};ya.prototype.pasteImageData=function(a,c,d){let b=0;c=this.offsetOfPixel(c,d);d=this.width-a.width;for(let g=0;g<a.height;g++,c+=d)for(let n=0;n<a.width;n++,b+=4,c++)this.data[c]=a.data[b];return a};ya.prototype.copyPixelsFrom=function(a){a.width!=this.width||a.height!=this.height||a.bitDepth!=this.bitDepth?(this.data=a.data.slice(0),this.width=a.width,this.height=a.height,this.bitDepth=a.bitDepth):this.data.set(a.data)};ya.prototype.copyRectXOR=function(a,c){for(var d=
(c=this.getBounds().clipTo(c)).getWidth(),b=new Uint8Array(d*c.getHeight()),g=0,n=this.offsetOfPixel(c.left,c.top),f=a.offsetOfPixel(c.left,c.top),e=this.width-d,l=a.width-d,k=c.top;k<c.bottom;k++,n+=e,f+=l)for(var h=0;h<d;h++,g++,n++,f++)b[g]=this.data[n]^a.data[f];return b};ya.prototype.setRectXOR=function(a,c){var d=(c=this.getBounds().clipTo(c)).getWidth(),b=c.getHeight();c=this.offsetOfPixel(c.left,c.top);for(var g=0,n=this.width-d,f=0;f<b;f++){for(var e=0;e<d;e++)this.data[c++]^=a[g++];c+=n}};
ya.prototype.copyBitmapRect=function(a,c,d,b){var g=new ka(c,d,0,0);b=b.clone();this.getBounds().clipSourceDest(b,g);c=0|g.getWidth();d=0|g.getHeight();if(0==g.left&&0==g.top&&c==this.width&&d==this.height&&c==a.width&&d==a.height)this.copyPixelsFrom(a);else{g=this.offsetOfPixel(g.left,g.top);var n=this.width-c;b=a.offsetOfPixel(b.left,b.top);for(var f=a.width-c,e=0;e<d;e++,b+=f,g+=n)for(var l=0;l<c;l++,b++,g++)this.data[g]=a.data[b]}};ya.prototype.copyRegionHFlip=function(a,c){a=this.getBounds().clipTo(a);
for(var d=a.top;d<a.bottom;d++)for(var b=this.offsetOfPixel(a.left,d),g=c.offsetOfPixel(a.right-1,d),n=a.left;n<a.right;n++,g-=2)this.data[b++]=c.data[g++]};ya.prototype.copyRegionVFlip=function(a,c){for(var d=(a=this.getBounds().clipTo(a)).getWidth(),b=a.top;b<a.bottom;b++)for(var g=this.offsetOfPixel(a.left,b),n=c.offsetOfPixel(a.left,a.bottom-1-(b-a.top)),f=0;f<d;f++)this.data[g++]=c.data[n++]};ya.prototype.copyPixelColumnToArray=function(a,c,d,b){var g=this.width,n=0;a=this.offsetOfPixel(a,c);
for(c=0;c<d;c++)b[n]=this.data[a],a+=g,n++};ya.prototype.copyArrayToPixelColumn=function(a,c,d,b){var g=this.width,n=0;a=this.offsetOfPixel(a,c);for(c=0;c<d;c++)this.data[a]=b[n],a+=g,n++};ya.prototype.boxBlur=function(a,c,d){let b=(a=this.getBounds().clipTo(a)).getWidth(),g=a.getHeight();var n=Math.max(b,g);let f=new this.data.constructor(n);n=new this.data.constructor(n);for(let k=a.top;k<a.bottom;k++){var e=this.offsetOfPixel(a.left,k);for(var l=0;l<b;l++)f[l]=this.data[e++];oe(f,n,b,c);e=this.offsetOfPixel(a.left,
k);for(l=0;l<b;l++)this.data[e++]=n[l]}for(c=a.left;c<a.right;c++)this.copyPixelColumnToArray(c,a.top,g,f),oe(f,n,g,d),this.copyArrayToPixelColumn(c,a.top,g,n)};ya.prototype.offsetOfPixel=function(a,c){return c*this.width+a};ya.prototype.fillWithNoise=function(a){a=this.getBounds().clipTo(a);for(var c=this.width-a.getWidth(),d=this.offsetOfPixel(a.left,a.top),b=a.top;b<a.bottom;b++,d+=c)for(var g=a.left;g<a.right;g++,d++)this.data[d]=256*Math.random()|0};ya.prototype.invert=function(a){a=this.getBounds().clipTo(a);
for(var c=this.width-a.getWidth(),d=this.offsetOfPixel(a.left,a.top),b=a.top;b<a.bottom;b++,d+=c)for(var g=a.left;g<a.right;g++,d++)this.data[d]=~this.data[d]};ya.prototype.brightnessToOpacity=function(a){a=this.getBounds().clipTo(a);let c=(this.width-a.getWidth())*ya.BYTES_PER_PIXEL,d=this.offsetOfPixel(a.left,a.top);for(let g=a.top;g<a.bottom;g++,d+=c)for(let n=a.left;n<a.right;n++,d++){var b=void 0;b=this.data[d];let f=this.data[d+ya.ALPHA_BYTE_OFFSET]/255;b=250<b?0:Math.round(255*(1-b/250));this.data[d+
ya.ALPHA_BYTE_OFFSET]=Math.round(b*f);0<b&&(this.data[d]=0)}};ya.prototype.getValueBounds=function(a,c){var d,b,g=a.clone();var n=this.width-g.getWidth();a=this.offsetOfPixel(g.left,g.top);for(b=g.top;b<g.bottom;b++,a+=n){var f=!1;for(d=g.left;d<g.right;d++,a++)if(this.data[a]!=c){f=!0;break}if(f)break}if(g.top=b,g.top==g.bottom)return g;a=this.offsetOfPixel(g.right-1,g.bottom-1);for(b=g.bottom-1;b>=g.top;b--,a-=n){f=!1;for(d=g.right-1;d>=g.left;d--,a--)if(this.data[a]!=c){f=!0;break}if(f)break}g.bottom=
b+1;n=this.width;for(d=g.left;d<g.right;d++){a=this.offsetOfPixel(d,g.top);f=!1;for(b=g.top;b<g.bottom;b++,a+=n)if(this.data[a]!=c){f=!0;break}if(f)break}g.left=d;for(d=g.right-1;d>=g.left;d--){a=this.offsetOfPixel(d,g.top);f=!1;for(b=g.top;b<g.bottom;b++,a+=n)if(this.data[a]!=c){f=!0;break}if(f)break}return g.right=d+1,g};ya.prototype.gradientHorzReplace=function(a,c,d,b){var g=255&b[0];b=255&b[1];var n=this.width-a.getWidth(),f=0|this.offsetOfPixel(a.left,a.top),e=a.bottom-a.top|0;if(d<c){var l=
d;d=c;c=l;l=g;g=b;b=l}l=(b-g)/(d-c|0);for(var k=Math.max(a.left-c,0),h=0;h<e;h++,f+=n){for(var m=a.left,q=0|Math.min(c,a.right);m<q;m++,f++)this.data[f]=g;var r=g+l*k;for(q=0|Math.min(d,a.right);m<q;m++,f++)this.data[f]=r,r+=l;for(;m<a.right;m++,f++)this.data[f]=b}};ya.prototype.gradientVertReplace=function(a,c,d,b){var g=255&b[0];b=255&b[1];let n=this.width-a.getWidth(),f=0|this.offsetOfPixel(a.left,a.top),e=a.right-a.left|0;if(d<c){var l=d;d=c;c=l;l=g;g=b;b=l}l=a.top;for(var k=0|Math.min(a.bottom,
c);l<k;l++,f+=n)for(let h=0;h<e;h++,f++)this.data[f]=g;k=(b-g)/(d-c|0);c=g+k*Math.max(l-c,0);for(d=0|Math.min(a.bottom,d);l<d;l++,f+=n){for(g=0;g<e;g++,f++)this.data[f]=c;c+=k}for(;l<a.bottom;l++,f+=n)for(d=0;d<e;d++,f++)this.data[f]=b};ya.prototype.gradientReplace=function(a,c,d,b,g,n){var f=this.width-a.getWidth(),e=0|this.offsetOfPixel(a.left,a.top),l=a.right-a.left|0,k=255&n[0];n=255&n[1];var h=g-d+(b-c)*(b-c)/(g-d);b=b-c+(g-d)*(g-d)/(b-c);g=1/b;for(var m=a.top;m<a.bottom;m++,e+=f)for(var q=(a.left-
c)/b+(m-d)/h,r=0;r<l;r++,e++){var t=Math.min(Math.max(q,0),1);this.data[e]=k*(1-t)+n*t;q+=g}};ya.prototype.gradientAlpha=function(a,c,d,b,g,n){var f=this.width-a.getWidth(),e=0|this.offsetOfPixel(a.left,a.top),l=a.right-a.left|0,k=255&n[0],h=n[0]>>24&255,m=255&n[1];n=n[1]>>24&255;var q=g-d+(b-c)*(b-c)/(g-d);b=b-c+(g-d)*(g-d)/(b-c);g=1/b;for(var r=a.top;r<a.bottom;r++,e+=f)for(var t=(a.left-c)/b+(r-d)/q,u=0;u<l;u++,e++){var y=Math.min(Math.max(t,0),1),A=1-y,F=h*A+n*y;this.data[e]=((k*A+m*y)*F+this.data[e]*
(255-F))/255|0;t+=g}};ya.prototype.gradient=function(a,c,d,b,g,n,f){a=this.getBounds().clipTo(a);(c!=b||d!=g)&&(f||255==n[0]>>>24&&255==n[1]>>>24?c==b?this.gradientVertReplace(a,d,g,n):d==g?this.gradientHorzReplace(a,c,b,n):this.gradientReplace(a,c,d,b,g,n):this.gradientAlpha(a,c,d,b,g,n))};ya.prototype.equals=function(a){if(this.width!=a.width||this.height!=a.height)return!1;for(let c=0;c<this.data.length;c++)if(this.data[c]!=a.data[c])return!1;return!0};let mb=Array(256),nb=Array(256);L.multiplyOntoOpaqueFusionWithOpaqueLayer=
function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3],k;l&&(k=a.data[b],a.data[b]=k-((255^c.data[b])*k*l/65025|0),k=a.data[b+1],a.data[b+1]=k-((255^c.data[b+1])*k*l/65025|0),k=a.data[b+2],a.data[b+2]=k-((255^c.data[b+2])*k*l/65025|0))}};L.multiplyOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,
b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h;k&&(h=a.data[b],a.data[b]=h-((255^c.data[b])*h*k/65025|0),h=a.data[b+1],a.data[b+1]=h-((255^c.data[b+1])*h*k/65025|0),h=a.data[b+2],a.data[b+2]=h-((255^c.data[b+2])*h*k/65025|0))}};L.multiplyOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let l=0;l<g;l++,b+=4){var f=c.data[b+3];let k,h;if(f){let m=
f+(k=a.data[b+3])-(f*k/255|0)|0,q=f*k/255|0,r=f*(255^k)/255|0,t=(255^f)*k/255|0;f=c.data[b];h=a.data[b];a.data[b]=(f*r+h*t+(f*h*q/255|0))/m|0;f=c.data[b+1];h=a.data[b+1];a.data[b+1]=(f*r+h*t+(f*h*q/255|0))/m|0;f=c.data[b+2];h=a.data[b+2];a.data[b+2]=(f*r+h*t+(f*h*q/255|0))/m|0;a.data[b+3]=m}}};L.multiplyOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let l=0;l<g;l++,b+=f)for(let k=0;k<n;k++,
b+=4){var e=c.data[b+3]*d/100|0;let h,m;if(e){let q=e+(h=a.data[b+3])-(e*h/255|0)|0,r=e*h/255|0,t=e*(255^h)/255|0,u=(255^e)*h/255|0;e=c.data[b];m=a.data[b];a.data[b]=(e*t+m*u+(e*m*r/255|0))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(e*t+m*u+(e*m*r/255|0))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(e*t+m*u+(e*m*r/255|0))/q|0;a.data[b+3]=q}}};L.multiplyOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),
l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0,q;m&&(q=a.data[e],a.data[e]=q-((255^c.data[e])*q*m/65025|0),q=a.data[e+1],a.data[e+1]=q-((255^c.data[e+1])*q*m/65025|0),q=a.data[e+2],a.data[e+2]=q-((255^c.data[e+2])*q*m/65025|0))}};L.multiplyOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|
0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0,r;q&&(r=a.data[l],a.data[l]=r-((255^c.data[l])*r*q/65025|0),r=a.data[l+1],a.data[l+1]=r-((255^c.data[l+1])*r*q/65025|0),r=a.data[l+2],a.data[l+2]=r-((255^c.data[l+2])*r*q/65025|0))}};L.multiplyOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,
b.top);for(let h=0;h<d;h++,e+=f,b+=l)for(let m=0;m<n;m++,e+=4,b++){var k=c.data[e+3]*g.data[b]/255|0;let q,r;if(k){let t=k+(q=a.data[e+3])-(k*q/255|0)|0,u=k*q/255|0,y=k*(255^q)/255|0,A=(255^k)*q/255|0;k=c.data[e];r=a.data[e];a.data[e]=(k*y+r*A+(k*r*u/255|0))/t|0;k=c.data[e+1];r=a.data[e+1];a.data[e+1]=(k*y+r*A+(k*r*u/255|0))/t|0;k=c.data[e+2];r=a.data[e+2];a.data[e+2]=(k*y+r*A+(k*r*u/255|0))/t|0;a.data[e+3]=t}}};L.multiplyOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|
b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,l+=e,b+=k)for(let q=0;q<f;q++,l+=4,b++){var h=c.data[l+3]*g.data[b]*d/25500|0;let r,t;if(h){let u=h+(r=a.data[l+3])-(h*r/255|0)|0,y=h*r/255|0,A=h*(255^r)/255|0,F=(255^h)*r/255|0;h=c.data[l];t=a.data[l];a.data[l]=(h*A+t*F+(h*t*y/255|0))/u|0;h=c.data[l+1];t=a.data[l+1];a.data[l+1]=(h*A+t*F+(h*t*y/255|0))/u|0;h=c.data[l+2];t=a.data[l+2];a.data[l+2]=(h*
A+t*F+(h*t*y/255|0))/u|0;a.data[l+3]=u}}};L.multiply2OntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3],k;l&&(k=a.data[b],a.data[b]=k-Math.ceil((255^c.data[b])*k*l/65025),k=a.data[b+1],a.data[b+1]=k-Math.ceil((255^c.data[b+1])*k*l/65025),k=a.data[b+2],a.data[b+2]=k-Math.ceil((255^c.data[b+2])*k*l/65025))}};L.multiply2OntoOpaqueFusionWithTransparentLayer=
function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h;k&&(h=a.data[b],a.data[b]=h-Math.ceil((255^c.data[b])*h*k/65025),h=a.data[b+1],a.data[b+1]=h-Math.ceil((255^c.data[b+1])*h*k/65025),h=a.data[b+2],a.data[b+2]=h-Math.ceil((255^c.data[b+2])*h*k/65025))}};L.multiply2OntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-
g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let l=0;l<g;l++,b+=4){var f=c.data[b+3];let k,h;if(f){let m=f+(k=a.data[b+3])-(f*k/255|0)|0,q=f*k/255|0,r=f*(255^k)/255|0,t=(255^f)*k/255|0;f=c.data[b];h=a.data[b];a.data[b]=(f*r+h*t+(f*h*q/255|0))/m|0;f=c.data[b+1];h=a.data[b+1];a.data[b+1]=(f*r+h*t+(f*h*q/255|0))/m|0;f=c.data[b+2];h=a.data[b+2];a.data[b+2]=(f*r+h*t+(f*h*q/255|0))/m|0;a.data[b+3]=m}}};L.multiply2OntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let g=0|
b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let l=0;l<g;l++,b+=f)for(let k=0;k<n;k++,b+=4){var e=c.data[b+3]*d/100|0;let h,m;if(e){let q=e+(h=a.data[b+3])-(e*h/255|0)|0,r=e*h/255|0,t=e*(255^h)/255|0,u=(255^e)*h/255|0;e=c.data[b];m=a.data[b];a.data[b]=(e*t+m*u+(e*m*r/255|0))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(e*t+m*u+(e*m*r/255|0))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(e*t+m*u+(e*m*r/255|0))/q|0;a.data[b+3]=q}}};L.multiply2OntoOpaqueFusionWithOpaqueLayerMasked=
function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0,q;m&&(q=a.data[e],a.data[e]=q-Math.ceil((255^c.data[e])*q*m/65025),q=a.data[e+1],a.data[e+1]=q-Math.ceil((255^c.data[e+1])*q*m/65025),q=a.data[e+2],a.data[e+2]=q-Math.ceil((255^c.data[e+2])*q*m/65025))}};L.multiply2OntoOpaqueFusionWithTransparentLayerMasked=
function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0,r;q&&(r=a.data[l],a.data[l]=r-Math.ceil((255^c.data[l])*r*q/65025),r=a.data[l+1],a.data[l+1]=r-Math.ceil((255^c.data[l+1])*r*q/65025),r=a.data[l+2],a.data[l+2]=r-Math.ceil((255^c.data[l+2])*r*q/65025))}};L.multiply2OntoTransparentFusionWithOpaqueLayerMasked=
function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<d;h++,e+=f,b+=l)for(let m=0;m<n;m++,e+=4,b++){var k=c.data[e+3]*g.data[b]/255|0;let q,r;if(k){let t=k+(q=a.data[e+3])-(k*q/255|0)|0,u=k*q/255|0,y=k*(255^q)/255|0,A=(255^k)*q/255|0;k=c.data[e];r=a.data[e];a.data[e]=(k*y+r*A+(k*r*u/255|0))/t|0;k=c.data[e+1];r=a.data[e+1];a.data[e+1]=(k*y+r*A+(k*r*u/255|0))/t|0;k=c.data[e+2];r=a.data[e+
2];a.data[e+2]=(k*y+r*A+(k*r*u/255|0))/t|0;a.data[e+3]=t}}};L.multiply2OntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,l+=e,b+=k)for(let q=0;q<f;q++,l+=4,b++){var h=c.data[l+3]*g.data[b]*d/25500|0;let r,t;if(h){let u=h+(r=a.data[l+3])-(h*r/255|0)|0,y=h*r/255|0,A=h*(255^r)/255|0,F=(255^h)*r/255|0;h=c.data[l];t=a.data[l];a.data[l]=
(h*A+t*F+(h*t*y/255|0))/u|0;h=c.data[l+1];t=a.data[l+1];a.data[l+1]=(h*A+t*F+(h*t*y/255|0))/u|0;h=c.data[l+2];t=a.data[l+2];a.data[l+2]=(h*A+t*F+(h*t*y/255|0))/u|0;a.data[l+3]=u}}};L.normalOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3],k;if(l)if(255==l)a.data[b]=c.data[b],a.data[b+1]=c.data[b+1],a.data[b+2]=c.data[b+2];else{let h=255-l;
k=c.data[b];a.data[b]=(k*l+a.data[b]*h)/255|0;k=c.data[b+1];a.data[b+1]=(k*l+a.data[b+1]*h)/255|0;k=c.data[b+2];a.data[b+2]=(k*l+a.data[b+2]*h)/255|0}}};L.normalOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h;if(k){let m=255-k;h=c.data[b];a.data[b]=(h*k+a.data[b]*m)/255|0;h=c.data[b+1];a.data[b+1]=(h*k+a.data[b+1]*m)/255|0;
h=c.data[b+2];a.data[b+2]=(h*k+a.data[b+2]*m)/255|0}}};L.normalOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let l=0;l<g;l++,b+=4){var f=c.data[b+3];let k;if(f){let h=f+(k=a.data[b+3])-(f*k/255|0)|0;f=255*f/h|0;let m=255-f;a.data[b]=(c.data[b]*f+a.data[b]*m)/255|0;a.data[b+1]=(c.data[b+1]*f+a.data[b+1]*m)/255|0;a.data[b+2]=(c.data[b+2]*f+a.data[b+2]*m)/255|0;a.data[b+3]=
h}}};L.normalOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let l=0;l<g;l++,b+=f)for(let k=0;k<n;k++,b+=4){var e=c.data[b+3]*d/100|0;let h;if(e){let m=e+(h=a.data[b+3])-(e*h/255|0)|0;e=255*e/m|0;let q=255-e;a.data[b]=(c.data[b]*e+a.data[b]*q)/255|0;a.data[b+1]=(c.data[b+1]*e+a.data[b+1]*q)/255|0;a.data[b+2]=(c.data[b+2]*e+a.data[b+2]*q)/255|0;a.data[b+3]=m}}};L.normalOntoOpaqueFusionWithOpaqueLayerMasked=
function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0,q;if(m)if(255==m)a.data[e]=c.data[e],a.data[e+1]=c.data[e+1],a.data[e+2]=c.data[e+2];else{let r=255-m;q=c.data[e];a.data[e]=(q*m+a.data[e]*r)/255|0;q=c.data[e+1];a.data[e+1]=(q*m+a.data[e+1]*r)/255|0;q=c.data[e+2];a.data[e+2]=(q*m+a.data[e+2]*r)/255|
0}}};L.normalOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0,r;if(q){let t=255-q;r=c.data[l];a.data[l]=(r*q+a.data[l]*t)/255|0;r=c.data[l+1];a.data[l+1]=(r*q+a.data[l+1]*t)/255|0;r=c.data[l+2];a.data[l+2]=(r*q+a.data[l+2]*t)/255|0}}};L.normalOntoTransparentFusionWithOpaqueLayerMasked=
function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<d;h++,e+=f,b+=l)for(let m=0;m<n;m++,e+=4,b++){var k=c.data[e+3]*g.data[b]/255|0;let q;if(k){let r=k+(q=a.data[e+3])-(k*q/255|0)|0;k=255*k/r|0;let t=255-k;a.data[e]=(c.data[e]*k+a.data[e]*t)/255|0;a.data[e+1]=(c.data[e+1]*k+a.data[e+1]*t)/255|0;a.data[e+2]=(c.data[e+2]*k+a.data[e+2]*t)/255|0;a.data[e+3]=r}}};L.normalOntoTransparentFusionWithTransparentLayerMasked=
function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,l+=e,b+=k)for(let q=0;q<f;q++,l+=4,b++){var h=c.data[l+3]*g.data[b]*d/25500|0;let r;if(h){let t=h+(r=a.data[l+3])-(h*r/255|0)|0;h=255*h/t|0;let u=255-h;a.data[l]=(c.data[l]*h+a.data[l]*u)/255|0;a.data[l+1]=(c.data[l+1]*h+a.data[l+1]*u)/255|0;a.data[l+2]=(c.data[l+2]*h+a.data[l+2]*u)/255|0;a.data[l+3]=t}}};L.addOntoOpaqueFusionWithOpaqueLayer=
function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3];l&&(a.data[b]=a.data[b]+l*c.data[b]/255|0,a.data[b+1]=a.data[b+1]+l*c.data[b+1]/255|0,a.data[b+2]=a.data[b+2]+l*c.data[b+2]/255|0)}};L.addOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<
n;l++,b+=4){let k=c.data[b+3]*d/100|0;k&&(a.data[b]=a.data[b]+k*c.data[b]/255|0,a.data[b+1]=a.data[b+1]+k*c.data[b+1]/255|0,a.data[b+2]=a.data[b+2]+k*c.data[b+2]/255|0)}};L.addOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3],k;if(l){let h=l+(k=a.data[b+3])-(l*k/255|0)|0;a.data[b]=(k*a.data[b]+l*c.data[b])/h|0;a.data[b+1]=(k*a.data[b+
1]+l*c.data[b+1])/h|0;a.data[b+2]=(k*a.data[b+2]+l*c.data[b+2])/h|0;a.data[b+3]=h}}};L.addOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h;if(k){let m=k+(h=a.data[b+3])-(k*h/255|0)|0;a.data[b]=(h*a.data[b]+k*c.data[b])/m|0;a.data[b+1]=(h*a.data[b+1]+k*c.data[b+1])/m|0;a.data[b+2]=(h*a.data[b+2]+k*c.data[b+2])/m|0;a.data[b+
3]=m}}};L.addOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0;m&&(a.data[e]=a.data[e]+m*c.data[e]/255|0,a.data[e+1]=a.data[e+1]+m*c.data[e+1]/255|0,a.data[e+2]=a.data[e+2]+m*c.data[e+2]/255|0)}};L.addOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,
g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0;q&&(a.data[l]=a.data[l]+q*c.data[l]/255|0,a.data[l+1]=a.data[l+1]+q*c.data[l+1]/255|0,a.data[l+2]=a.data[l+2]+q*c.data[l+2]/255|0)}};L.addOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|
c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0,q;if(m){let r=m+(q=a.data[e+3])-(m*q/255|0)|0;a.data[e]=(q*a.data[e]+m*c.data[e])/r|0;a.data[e+1]=(q*a.data[e+1]+m*c.data[e+1])/r|0;a.data[e+2]=(q*a.data[e+2]+m*c.data[e+2])/r|0;a.data[e+3]=r}}};L.addOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|
c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0,r;if(q){let t=q+(r=a.data[l+3])-(q*r/255|0)|0;a.data[l]=(r*a.data[l]+q*c.data[l])/t|0;a.data[l+1]=(r*a.data[l+1]+q*c.data[l+1])/t|0;a.data[l+2]=(r*a.data[l+2]+q*c.data[l+2])/t|0;a.data[l+3]=t}}};L.subtractOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,
b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3];l&&(a.data[b]=a.data[b]+l*c.data[b]/255-l|0,a.data[b+1]=a.data[b+1]+l*c.data[b+1]/255-l|0,a.data[b+2]=a.data[b+2]+l*c.data[b+2]/255-l|0)}};L.subtractOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0;k&&(a.data[b]=a.data[b]+k*c.data[b]/255-k|0,a.data[b+
1]=a.data[b+1]+k*c.data[b+1]/255-k|0,a.data[b+2]=a.data[b+2]+k*c.data[b+2]/255-k|0)}};L.subtractOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3],k;if(l){let h=l+(k=a.data[b+3])-(l*k/255|0)|0,m=l*k;a.data[b]=(k*a.data[b]+l*c.data[b]-m)/h|0;a.data[b+1]=(k*a.data[b+1]+l*c.data[b+1]-m)/h|0;a.data[b+2]=(k*a.data[b+2]+l*c.data[b+2]-m)/h|0;
a.data[b+3]=h}}};L.subtractOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h;if(k){let m=k+(h=a.data[b+3])-(k*h/255|0)|0,q=k*h;a.data[b]=(h*a.data[b]+k*c.data[b]-q)/m|0;a.data[b+1]=(h*a.data[b+1]+k*c.data[b+1]-q)/m|0;a.data[b+2]=(h*a.data[b+2]+k*c.data[b+2]-q)/m|0;a.data[b+3]=m}}};L.subtractOntoOpaqueFusionWithOpaqueLayerMasked=
function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0;m&&(a.data[e]=a.data[e]+m*c.data[e]/255-m|0,a.data[e+1]=a.data[e+1]+m*c.data[e+1]/255-m|0,a.data[e+2]=a.data[e+2]+m*c.data[e+2]/255-m|0)}};L.subtractOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),
e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0;q&&(a.data[l]=a.data[l]+q*c.data[l]/255-q|0,a.data[l+1]=a.data[l+1]+q*c.data[l+1]/255-q|0,a.data[l+2]=a.data[l+2]+q*c.data[l+2]/255-q|0)}};L.subtractOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),
l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0,q;if(m){let r=m+(q=a.data[e+3])-(m*q/255|0)|0,t=m*q;a.data[e]=(q*a.data[e]+m*c.data[e]-t)/r|0;a.data[e+1]=(q*a.data[e+1]+m*c.data[e+1]-t)/r|0;a.data[e+2]=(q*a.data[e+2]+m*c.data[e+2]-t)/r|0;a.data[e+3]=r}}};L.subtractOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,
b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0,r;if(q){let t=q+(r=a.data[l+3])-(q*r/255|0)|0,u=q*r;a.data[l]=(r*a.data[l]+q*c.data[l]-u)/t|0;a.data[l+1]=(r*a.data[l+1]+q*c.data[l+1]-u)/t|0;a.data[l+2]=(r*a.data[l+2]+q*c.data[l+2]-u)/t|0;a.data[l+3]=t}}};L.screenOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,
b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3],k;if(l){let h=255^l;k=a.data[b];a.data[b]=255^((255^k)*h+(255^c.data[b])*(255^k)*l/255)/255;k=a.data[b+1];a.data[b+1]=255^((255^k)*h+(255^c.data[b+1])*(255^k)*l/255)/255;k=a.data[b+2];a.data[b+2]=255^((255^k)*h+(255^c.data[b+2])*(255^k)*l/255)/255}}};L.screenOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,
b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h;if(k){let m=255^k;h=a.data[b];a.data[b]=255^((255^h)*m+(255^c.data[b])*(255^h)*k/255)/255;h=a.data[b+1];a.data[b+1]=255^((255^h)*m+(255^c.data[b+1])*(255^h)*k/255)/255;h=a.data[b+2];a.data[b+2]=255^((255^h)*m+(255^c.data[b+2])*(255^h)*k/255)/255}}};L.screenOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let l=0;l<
g;l++,b+=4){var f=c.data[b+3];let k,h;if(f){let m=f+(k=a.data[b+3])-(f*k/255|0)|0,q=f*k/255|0,r=f*(255^k)/255|0,t=(255^f)*k/255|0;f=c.data[b];h=a.data[b];a.data[b]=255^((255^f)*r+(255^h)*t+(255^f)*(255^h)*q/255)/m;f=c.data[b+1];h=a.data[b+1];a.data[b+1]=255^((255^f)*r+(255^h)*t+(255^f)*(255^h)*q/255)/m;f=c.data[b+2];h=a.data[b+2];a.data[b+2]=255^((255^f)*r+(255^h)*t+(255^f)*(255^h)*q/255)/m;a.data[b+3]=m}}};L.screenOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),
n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let l=0;l<g;l++,b+=f)for(let k=0;k<n;k++,b+=4){var e=c.data[b+3]*d/100|0;let h,m;if(e){let q=e+(h=a.data[b+3])-(e*h/255|0)|0,r=e*h/255|0,t=e*(255^h)/255|0,u=(255^e)*h/255|0;e=c.data[b];m=a.data[b];a.data[b]=255^((255^e)*t+(255^m)*u+(255^e)*(255^m)*r/255)/q;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=255^((255^e)*t+(255^m)*u+(255^e)*(255^m)*r/255)/q;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=255^((255^e)*t+(255^m)*u+(255^e)*(255^m)*
r/255)/q;a.data[b+3]=q}}};L.screenOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0,q;if(m){let r=255^m;q=a.data[e];a.data[e]=255^((255^q)*r+(255^c.data[e])*(255^q)*m/255)/255;q=a.data[e+1];a.data[e+1]=255^((255^q)*r+(255^c.data[e+1])*(255^q)*m/255)/255;q=a.data[e+
2];a.data[e+2]=255^((255^q)*r+(255^c.data[e+2])*(255^q)*m/255)/255}}};L.screenOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0,r;if(q){let t=255^q;r=a.data[l];a.data[l]=255^((255^r)*t+(255^c.data[l])*(255^r)*q/255)/255;r=a.data[l+1];a.data[l+1]=255^((255^
r)*t+(255^c.data[l+1])*(255^r)*q/255)/255;r=a.data[l+2];a.data[l+2]=255^((255^r)*t+(255^c.data[l+2])*(255^r)*q/255)/255}}};L.screenOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<d;h++,e+=f,b+=l)for(let m=0;m<n;m++,e+=4,b++){var k=c.data[e+3]*g.data[b]/255|0;let q,r;if(k){let t=k+(q=a.data[e+3])-(k*q/255|0)|0,u=k*q/255|0,y=k*(255^q)/
255|0,A=(255^k)*q/255|0;k=c.data[e];r=a.data[e];a.data[e]=255^((255^k)*y+(255^r)*A+(255^k)*(255^r)*u/255)/t;k=c.data[e+1];r=a.data[e+1];a.data[e+1]=255^((255^k)*y+(255^r)*A+(255^k)*(255^r)*u/255)/t;k=c.data[e+2];r=a.data[e+2];a.data[e+2]=255^((255^k)*y+(255^r)*A+(255^k)*(255^r)*u/255)/t;a.data[e+3]=t}}};L.screenOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,
b.top);for(let m=0;m<n;m++,l+=e,b+=k)for(let q=0;q<f;q++,l+=4,b++){var h=c.data[l+3]*g.data[b]*d/25500|0;let r,t;if(h){let u=h+(r=a.data[l+3])-(h*r/255|0)|0,y=h*r/255|0,A=h*(255^r)/255|0,F=(255^h)*r/255|0;h=c.data[l];t=a.data[l];a.data[l]=255^((255^h)*A+(255^t)*F+(255^h)*(255^t)*y/255)/u;h=c.data[l+1];t=a.data[l+1];a.data[l+1]=255^((255^h)*A+(255^t)*F+(255^h)*(255^t)*y/255)/u;h=c.data[l+2];t=a.data[l+2];a.data[l+2]=255^((255^h)*A+(255^t)*F+(255^h)*(255^t)*y/255)/u;a.data[l+3]=u}}};L.lightenOntoOpaqueFusionWithOpaqueLayer=
function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3],k,h;if(l){let m=255^l;k=c.data[b];h=a.data[b];a.data[b]=h>=k?h:(h*m+k*l)/255|0;k=c.data[b+1];h=a.data[b+1];a.data[b+1]=h>=k?h:(h*m+k*l)/255|0;k=c.data[b+2];h=a.data[b+2];a.data[b+2]=h>=k?h:(h*m+k*l)/255|0}}};L.lightenOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-
n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h,m;if(k){let q=255^k;h=c.data[b];m=a.data[b];a.data[b]=m>=h?m:(m*q+h*k)/255|0;h=c.data[b+1];m=a.data[b+1];a.data[b+1]=m>=h?m:(m*q+h*k)/255|0;h=c.data[b+2];m=a.data[b+2];a.data[b+2]=m>=h?m:(m*q+h*k)/255|0}}};L.lightenOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=
n)for(let l=0;l<g;l++,b+=4){var f=c.data[b+3];let k,h;if(f){let m=f+(k=a.data[b+3])-(f*k/255|0)|0,q=k*(255^f)/m|0,r=255^q,t=f*(255^k)/m|0,u=255^t;f=c.data[b];h=a.data[b];a.data[b]=(h>=f?f*t+h*u:h*q+f*r)/255|0;f=c.data[b+1];h=a.data[b+1];a.data[b+1]=(h>=f?f*t+h*u:h*q+f*r)/255|0;f=c.data[b+2];h=a.data[b+2];a.data[b+2]=(h>=f?f*t+h*u:h*q+f*r)/255|0;a.data[b+3]=m}}};L.lightenOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,
b.top);for(let l=0;l<g;l++,b+=f)for(let k=0;k<n;k++,b+=4){var e=c.data[b+3]*d/100|0;let h,m;if(e){let q=e+(h=a.data[b+3])-(e*h/255|0)|0,r=h*(255^e)/q|0,t=255^r,u=e*(255^h)/q|0,y=255^u;e=c.data[b];m=a.data[b];a.data[b]=(m>=e?e*u+m*y:m*r+e*t)/255|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(m>=e?e*u+m*y:m*r+e*t)/255|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(m>=e?e*u+m*y:m*r+e*t)/255|0;a.data[b+3]=q}}};L.lightenOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),
f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0,q,r;if(m){let t=255^m;q=c.data[e];r=a.data[e];a.data[e]=r>=q?r:(r*t+q*m)/255|0;q=c.data[e+1];r=a.data[e+1];a.data[e+1]=r>=q?r:(r*t+q*m)/255|0;q=c.data[e+2];r=a.data[e+2];a.data[e+2]=r>=q?r:(r*t+q*m)/255|0}}};L.lightenOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),
e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0,r,t;if(q){let u=255^q;r=c.data[l];t=a.data[l];a.data[l]=t>=r?t:(t*u+r*q)/255|0;r=c.data[l+1];t=a.data[l+1];a.data[l+1]=t>=r?t:(t*u+r*q)/255|0;r=c.data[l+2];t=a.data[l+2];a.data[l+2]=t>=r?t:(t*u+r*q)/255|0}}};L.lightenOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=
0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<d;h++,e+=f,b+=l)for(let m=0;m<n;m++,e+=4,b++){var k=c.data[e+3]*g.data[b]/255|0;let q,r;if(k){let t=k+(q=a.data[e+3])-(k*q/255|0)|0,u=q*(255^k)/t|0,y=255^u,A=k*(255^q)/t|0,F=255^A;k=c.data[e];r=a.data[e];a.data[e]=(r>=k?k*A+r*F:r*u+k*y)/255|0;k=c.data[e+1];r=a.data[e+1];a.data[e+1]=(r>=k?k*A+r*F:r*u+k*y)/255|0;k=c.data[e+2];r=a.data[e+2];a.data[e+2]=(r>=k?k*A+r*F:r*u+k*
y)/255|0;a.data[e+3]=t}}};L.lightenOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,l+=e,b+=k)for(let q=0;q<f;q++,l+=4,b++){var h=c.data[l+3]*g.data[b]*d/25500|0;let r,t;if(h){let u=h+(r=a.data[l+3])-(h*r/255|0)|0,y=r*(255^h)/u|0,A=255^y,F=h*(255^r)/u|0,D=255^F;h=c.data[l];t=a.data[l];a.data[l]=(t>=h?h*F+t*D:t*y+h*A)/255|
0;h=c.data[l+1];t=a.data[l+1];a.data[l+1]=(t>=h?h*F+t*D:t*y+h*A)/255|0;h=c.data[l+2];t=a.data[l+2];a.data[l+2]=(t>=h?h*F+t*D:t*y+h*A)/255|0;a.data[l+3]=u}}};L.darkenOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3],k,h;if(l){let m=255^l;k=c.data[b];h=a.data[b];a.data[b]=h>=k?(h*m+k*l)/255|0:h;k=c.data[b+1];h=a.data[b+1];a.data[b+1]=h>=k?(h*
m+k*l)/255|0:h;k=c.data[b+2];h=a.data[b+2];a.data[b+2]=h>=k?(h*m+k*l)/255|0:h}}};L.darkenOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h,m;if(k){let q=255^k;h=c.data[b];m=a.data[b];a.data[b]=m>=h?(m*q+h*k)/255|0:m;h=c.data[b+1];m=a.data[b+1];a.data[b+1]=m>=h?(m*q+h*k)/255|0:m;h=c.data[b+2];m=a.data[b+2];a.data[b+2]=m>=h?(m*
q+h*k)/255|0:m}}};L.darkenOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let l=0;l<g;l++,b+=4){var f=c.data[b+3];let k,h;if(f){let m=f+(k=a.data[b+3])-(f*k/255|0)|0,q=f*(255^k)/m|0,r=255^q,t=k*(255^f)/m|0,u=255^t;f=c.data[b];h=a.data[b];a.data[b]=(h>=f?h*t+f*u:f*q+h*r)/255|0;f=c.data[b+1];h=a.data[b+1];a.data[b+1]=(h>=f?h*t+f*u:f*q+h*r)/255|0;f=c.data[b+2];h=a.data[b+2];
a.data[b+2]=(h>=f?h*t+f*u:f*q+h*r)/255|0;a.data[b+3]=m}}};L.darkenOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let l=0;l<g;l++,b+=f)for(let k=0;k<n;k++,b+=4){var e=c.data[b+3]*d/100|0;let h,m;if(e){let q=e+(h=a.data[b+3])-(e*h/255|0)|0,r=e*(255^h)/q|0,t=255^r,u=h*(255^e)/q|0,y=255^u;e=c.data[b];m=a.data[b];a.data[b]=(m>=e?m*u+e*y:e*r+m*t)/255|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(m>=
e?m*u+e*y:e*r+m*t)/255|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(m>=e?m*u+e*y:e*r+m*t)/255|0;a.data[b+3]=q}}};L.darkenOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0,q,r;if(m){let t=255^m;q=c.data[e];r=a.data[e];a.data[e]=r>=q?(r*t+q*m)/255|0:r;q=c.data[e+1];
r=a.data[e+1];a.data[e+1]=r>=q?(r*t+q*m)/255|0:r;q=c.data[e+2];r=a.data[e+2];a.data[e+2]=r>=q?(r*t+q*m)/255|0:r}}};L.darkenOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0,r,t;if(q){let u=255^q;r=c.data[l];t=a.data[l];a.data[l]=t>=r?(t*u+r*q)/255|0:t;
r=c.data[l+1];t=a.data[l+1];a.data[l+1]=t>=r?(t*u+r*q)/255|0:t;r=c.data[l+2];t=a.data[l+2];a.data[l+2]=t>=r?(t*u+r*q)/255|0:t}}};L.darkenOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<d;h++,e+=f,b+=l)for(let m=0;m<n;m++,e+=4,b++){var k=c.data[e+3]*g.data[b]/255|0;let q,r;if(k){let t=k+(q=a.data[e+3])-(k*q/255|0)|0,u=k*(255^q)/t|0,
y=255^u,A=q*(255^k)/t|0,F=255^A;k=c.data[e];r=a.data[e];a.data[e]=(r>=k?r*A+k*F:k*u+r*y)/255|0;k=c.data[e+1];r=a.data[e+1];a.data[e+1]=(r>=k?r*A+k*F:k*u+r*y)/255|0;k=c.data[e+2];r=a.data[e+2];a.data[e+2]=(r>=k?r*A+k*F:k*u+r*y)/255|0;a.data[e+3]=t}}};L.darkenOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,l+=e,b+=k)for(let q=
0;q<f;q++,l+=4,b++){var h=c.data[l+3]*g.data[b]*d/25500|0;let r,t;if(h){let u=h+(r=a.data[l+3])-(h*r/255|0)|0,y=h*(255^r)/u|0,A=255^y,F=r*(255^h)/u|0,D=255^F;h=c.data[l];t=a.data[l];a.data[l]=(t>=h?t*F+h*D:h*y+t*A)/255|0;h=c.data[l+1];t=a.data[l+1];a.data[l+1]=(t>=h?t*F+h*D:h*y+t*A)/255|0;h=c.data[l+2];t=a.data[l+2];a.data[l+2]=(t>=h?t*F+h*D:h*y+t*A)/255|0;a.data[l+3]=u}}};L.dodgeOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,
b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3],k,h;if(l){let m=255^l;k=c.data[b];h=a.data[b];a.data[b]=(h*m+l*(255==k?255:Math.min(255,255*h/(255^k)|0)))/255|0;k=c.data[b+1];h=a.data[b+1];a.data[b+1]=(h*m+l*(255==k?255:Math.min(255,255*h/(255^k)|0)))/255|0;k=c.data[b+2];h=a.data[b+2];a.data[b+2]=(h*m+l*(255==k?255:Math.min(255,255*h/(255^k)|0)))/255|0}}};L.dodgeOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|
0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h,m;if(k){let q=255^k;h=c.data[b];m=a.data[b];a.data[b]=(m*q+k*(255==h?255:Math.min(255,255*m/(255^h)|0)))/255|0;h=c.data[b+1];m=a.data[b+1];a.data[b+1]=(m*q+k*(255==h?255:Math.min(255,255*m/(255^h)|0)))/255|0;h=c.data[b+2];m=a.data[b+2];a.data[b+2]=(m*q+k*(255==h?255:Math.min(255,255*m/(255^h)|0)))/255|0}}};L.dodgeOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();
let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let l=0;l<g;l++,b+=4){var f=c.data[b+3];let k,h;if(f){let m=f+(k=a.data[b+3])-(f*k/255|0)|0,q=f*k/255|0,r=f*(255^k)/255|0,t=(255^f)*k/255|0;f=c.data[b];h=a.data[b];a.data[b]=(f*r+h*t+q*(255==f?255:Math.min(255,255*h/(255^f)|0)))/m|0;f=c.data[b+1];h=a.data[b+1];a.data[b+1]=(f*r+h*t+q*(255==f?255:Math.min(255,255*h/(255^f)|0)))/m|0;f=c.data[b+2];h=a.data[b+2];a.data[b+2]=(f*r+h*t+q*(255==f?255:Math.min(255,
255*h/(255^f)|0)))/m|0;a.data[b+3]=m}}};L.dodgeOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let l=0;l<g;l++,b+=f)for(let k=0;k<n;k++,b+=4){var e=c.data[b+3]*d/100|0;let h,m;if(e){let q=e+(h=a.data[b+3])-(e*h/255|0)|0,r=e*h/255|0,t=e*(255^h)/255|0,u=(255^e)*h/255|0;e=c.data[b];m=a.data[b];a.data[b]=(e*t+m*u+r*(255==e?255:Math.min(255,255*m/(255^e)|0)))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+
1]=(e*t+m*u+r*(255==e?255:Math.min(255,255*m/(255^e)|0)))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(e*t+m*u+r*(255==e?255:Math.min(255,255*m/(255^e)|0)))/q|0;a.data[b+3]=q}}};L.dodgeOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0,q,r;if(m){let t=255^m;q=c.data[e];
r=a.data[e];a.data[e]=(r*t+m*(255==q?255:Math.min(255,255*r/(255^q)|0)))/255|0;q=c.data[e+1];r=a.data[e+1];a.data[e+1]=(r*t+m*(255==q?255:Math.min(255,255*r/(255^q)|0)))/255|0;q=c.data[e+2];r=a.data[e+2];a.data[e+2]=(r*t+m*(255==q?255:Math.min(255,255*r/(255^q)|0)))/255|0}}};L.dodgeOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,
l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0,r,t;if(q){let u=255^q;r=c.data[l];t=a.data[l];a.data[l]=(t*u+q*(255==r?255:Math.min(255,255*t/(255^r)|0)))/255|0;r=c.data[l+1];t=a.data[l+1];a.data[l+1]=(t*u+q*(255==r?255:Math.min(255,255*t/(255^r)|0)))/255|0;r=c.data[l+2];t=a.data[l+2];a.data[l+2]=(t*u+q*(255==r?255:Math.min(255,255*t/(255^r)|0)))/255|0}}};L.dodgeOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*
(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<d;h++,e+=f,b+=l)for(let m=0;m<n;m++,e+=4,b++){var k=c.data[e+3]*g.data[b]/255|0;let q,r;if(k){let t=k+(q=a.data[e+3])-(k*q/255|0)|0,u=k*q/255|0,y=k*(255^q)/255|0,A=(255^k)*q/255|0;k=c.data[e];r=a.data[e];a.data[e]=(k*y+r*A+u*(255==k?255:Math.min(255,255*r/(255^k)|0)))/t|0;k=c.data[e+1];r=a.data[e+1];a.data[e+1]=(k*y+r*A+u*(255==k?255:Math.min(255,255*r/(255^k)|0)))/t|0;k=c.data[e+2];r=a.data[e+
2];a.data[e+2]=(k*y+r*A+u*(255==k?255:Math.min(255,255*r/(255^k)|0)))/t|0;a.data[e+3]=t}}};L.dodgeOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,l+=e,b+=k)for(let q=0;q<f;q++,l+=4,b++){var h=c.data[l+3]*g.data[b]*d/25500|0;let r,t;if(h){let u=h+(r=a.data[l+3])-(h*r/255|0)|0,y=h*r/255|0,A=h*(255^r)/255|0,F=(255^h)*r/255|
0;h=c.data[l];t=a.data[l];a.data[l]=(h*A+t*F+y*(255==h?255:Math.min(255,255*t/(255^h)|0)))/u|0;h=c.data[l+1];t=a.data[l+1];a.data[l+1]=(h*A+t*F+y*(255==h?255:Math.min(255,255*t/(255^h)|0)))/u|0;h=c.data[l+2];t=a.data[l+2];a.data[l+2]=(h*A+t*F+y*(255==h?255:Math.min(255,255*t/(255^h)|0)))/u|0;a.data[l+3]=u}}};L.burnOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,
b+=4){let l=c.data[b+3],k,h;if(l){let m=255^l;k=c.data[b];h=a.data[b];a.data[b]=(h*m+l*(0==k?0:255^Math.min(255,255*(255^h)/k)))/255|0;k=c.data[b+1];h=a.data[b+1];a.data[b+1]=(h*m+l*(0==k?0:255^Math.min(255,255*(255^h)/k)))/255|0;k=c.data[b+2];h=a.data[b+2];a.data[b+2]=(h*m+l*(0==k?0:255^Math.min(255,255*(255^h)/k)))/255|0}}};L.burnOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=
f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h,m;if(k){let q=255^k;h=c.data[b];m=a.data[b];a.data[b]=(m*q+k*(0==h?0:255^Math.min(255,255*(255^m)/h)))/255|0;h=c.data[b+1];m=a.data[b+1];a.data[b+1]=(m*q+k*(0==h?0:255^Math.min(255,255*(255^m)/h)))/255|0;h=c.data[b+2];m=a.data[b+2];a.data[b+2]=(m*q+k*(0==h?0:255^Math.min(255,255*(255^m)/h)))/255|0}}};L.burnOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,
b.top);for(let e=0;e<d;e++,b+=n)for(let l=0;l<g;l++,b+=4){var f=c.data[b+3];let k,h;if(f){let m=f+(k=a.data[b+3])-(f*k/255|0)|0,q=f*k/255|0,r=f*(255^k)/255|0,t=(255^f)*k/255|0;f=c.data[b];h=a.data[b];a.data[b]=(f*r+h*t+q*(0==f?0:255^Math.min(255,255*(255^h)/f)))/m|0;f=c.data[b+1];h=a.data[b+1];a.data[b+1]=(f*r+h*t+q*(0==f?0:255^Math.min(255,255*(255^h)/f)))/m|0;f=c.data[b+2];h=a.data[b+2];a.data[b+2]=(f*r+h*t+q*(0==f?0:255^Math.min(255,255*(255^h)/f)))/m|0;a.data[b+3]=m}}};L.burnOntoTransparentFusionWithTransparentLayer=
function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let l=0;l<g;l++,b+=f)for(let k=0;k<n;k++,b+=4){var e=c.data[b+3]*d/100|0;let h,m;if(e){let q=e+(h=a.data[b+3])-(e*h/255|0)|0,r=e*h/255|0,t=e*(255^h)/255|0,u=(255^e)*h/255|0;e=c.data[b];m=a.data[b];a.data[b]=(e*t+m*u+r*(0==e?0:255^Math.min(255,255*(255^m)/e)))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(e*t+m*u+r*(0==e?0:255^Math.min(255,255*(255^m)/e)))/q|0;e=c.data[b+2];m=a.data[b+2];
a.data[b+2]=(e*t+m*u+r*(0==e?0:255^Math.min(255,255*(255^m)/e)))/q|0;a.data[b+3]=q}}};L.burnOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0,q,r;if(m){let t=255^m;q=c.data[e];r=a.data[e];a.data[e]=(r*t+m*(0==q?0:255^Math.min(255,255*(255^r)/q)))/255|0;q=c.data[e+
1];r=a.data[e+1];a.data[e+1]=(r*t+m*(0==q?0:255^Math.min(255,255*(255^r)/q)))/255|0;q=c.data[e+2];r=a.data[e+2];a.data[e+2]=(r*t+m*(0==q?0:255^Math.min(255,255*(255^r)/q)))/255|0}}};L.burnOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0,r,t;if(q){let u=
255^q;r=c.data[l];t=a.data[l];a.data[l]=(t*u+q*(0==r?0:255^Math.min(255,255*(255^t)/r)))/255|0;r=c.data[l+1];t=a.data[l+1];a.data[l+1]=(t*u+q*(0==r?0:255^Math.min(255,255*(255^t)/r)))/255|0;r=c.data[l+2];t=a.data[l+2];a.data[l+2]=(t*u+q*(0==r?0:255^Math.min(255,255*(255^t)/r)))/255|0}}};L.burnOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=
0;h<d;h++,e+=f,b+=l)for(let m=0;m<n;m++,e+=4,b++){var k=c.data[e+3]*g.data[b]/255|0;let q,r;if(k){let t=k+(q=a.data[e+3])-(k*q/255|0)|0,u=k*q/255|0,y=k*(255^q)/255|0,A=(255^k)*q/255|0;k=c.data[e];r=a.data[e];a.data[e]=(k*y+r*A+u*(0==k?0:255^Math.min(255,255*(255^r)/k)))/t|0;k=c.data[e+1];r=a.data[e+1];a.data[e+1]=(k*y+r*A+u*(0==k?0:255^Math.min(255,255*(255^r)/k)))/t|0;k=c.data[e+2];r=a.data[e+2];a.data[e+2]=(k*y+r*A+u*(0==k?0:255^Math.min(255,255*(255^r)/k)))/t|0;a.data[e+3]=t}}};L.burnOntoTransparentFusionWithTransparentLayerMasked=
function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,l+=e,b+=k)for(let q=0;q<f;q++,l+=4,b++){var h=c.data[l+3]*g.data[b]*d/25500|0;let r,t;if(h){let u=h+(r=a.data[l+3])-(h*r/255|0)|0,y=h*r/255|0,A=h*(255^r)/255|0,F=(255^h)*r/255|0;h=c.data[l];t=a.data[l];a.data[l]=(h*A+t*F+y*(0==h?0:255^Math.min(255,255*(255^t)/h)))/u|0;h=c.data[l+1];t=a.data[l+1];a.data[l+1]=(h*A+t*F+y*(0==
h?0:255^Math.min(255,255*(255^t)/h)))/u|0;h=c.data[l+2];t=a.data[l+2];a.data[l+2]=(h*A+t*F+y*(0==h?0:255^Math.min(255,255*(255^t)/h)))/u|0;a.data[l+3]=u}}};L.overlayOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3],k,h;if(l){let m=255^l;k=c.data[b];h=a.data[b];a.data[b]=(m*h+(127>=h?2*l*k*h/255:l*(2*(255^k)*(255^h)/255^255)))/255|0;k=c.data[b+
1];h=a.data[b+1];a.data[b+1]=(m*h+(127>=h?2*l*k*h/255:l*(2*(255^k)*(255^h)/255^255)))/255|0;k=c.data[b+2];h=a.data[b+2];a.data[b+2]=(m*h+(127>=h?2*l*k*h/255:l*(2*(255^k)*(255^h)/255^255)))/255|0}}};L.overlayOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h,m;if(k){let q=255^k;h=c.data[b];m=a.data[b];a.data[b]=(q*m+(127>=m?2*
k*h*m/255:k*(2*(255^h)*(255^m)/255^255)))/255|0;h=c.data[b+1];m=a.data[b+1];a.data[b+1]=(q*m+(127>=m?2*k*h*m/255:k*(2*(255^h)*(255^m)/255^255)))/255|0;h=c.data[b+2];m=a.data[b+2];a.data[b+2]=(q*m+(127>=m?2*k*h*m/255:k*(2*(255^h)*(255^m)/255^255)))/255|0}}};L.overlayOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let l=0;l<g;l++,b+=4){var f=c.data[b+3];let k,h;if(f){let m=
f+(k=a.data[b+3])-(f*k/255|0)|0,q=f*k/255|0,r=f*(255^k)/255|0,t=(255^f)*k/255|0;f=c.data[b];h=a.data[b];a.data[b]=(r*f+t*h+(127>=h?2*q*f*h/255:q*(2*(255^f)*(255^h)/255^255)))/m|0;f=c.data[b+1];h=a.data[b+1];a.data[b+1]=(r*f+t*h+(127>=h?2*q*f*h/255:q*(2*(255^f)*(255^h)/255^255)))/m|0;f=c.data[b+2];h=a.data[b+2];a.data[b+2]=(r*f+t*h+(127>=h?2*q*f*h/255:q*(2*(255^f)*(255^h)/255^255)))/m|0;a.data[b+3]=m}}};L.overlayOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|
b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let l=0;l<g;l++,b+=f)for(let k=0;k<n;k++,b+=4){var e=c.data[b+3]*d/100|0;let h,m;if(e){let q=e+(h=a.data[b+3])-(e*h/255|0)|0,r=e*h/255|0,t=e*(255^h)/255|0,u=(255^e)*h/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+u*m+(127>=m?2*r*e*m/255:r*(2*(255^e)*(255^m)/255^255)))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(t*e+u*m+(127>=m?2*r*e*m/255:r*(2*(255^e)*(255^m)/255^255)))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(t*e+u*m+(127>=
m?2*r*e*m/255:r*(2*(255^e)*(255^m)/255^255)))/q|0;a.data[b+3]=q}}};L.overlayOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0,q,r;if(m){let t=255^m;q=c.data[e];r=a.data[e];a.data[e]=(t*r+(127>=r?2*m*q*r/255:m*(2*(255^q)*(255^r)/255^255)))/255|0;q=c.data[e+1];r=
a.data[e+1];a.data[e+1]=(t*r+(127>=r?2*m*q*r/255:m*(2*(255^q)*(255^r)/255^255)))/255|0;q=c.data[e+2];r=a.data[e+2];a.data[e+2]=(t*r+(127>=r?2*m*q*r/255:m*(2*(255^q)*(255^r)/255^255)))/255|0}}};L.overlayOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0,
r,t;if(q){let u=255^q;r=c.data[l];t=a.data[l];a.data[l]=(u*t+(127>=t?2*q*r*t/255:q*(2*(255^r)*(255^t)/255^255)))/255|0;r=c.data[l+1];t=a.data[l+1];a.data[l+1]=(u*t+(127>=t?2*q*r*t/255:q*(2*(255^r)*(255^t)/255^255)))/255|0;r=c.data[l+2];t=a.data[l+2];a.data[l+2]=(u*t+(127>=t?2*q*r*t/255:q*(2*(255^r)*(255^t)/255^255)))/255|0}}};L.overlayOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-
n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<d;h++,e+=f,b+=l)for(let m=0;m<n;m++,e+=4,b++){var k=c.data[e+3]*g.data[b]/255|0;let q,r;if(k){let t=k+(q=a.data[e+3])-(k*q/255|0)|0,u=k*q/255|0,y=k*(255^q)/255|0,A=(255^k)*q/255|0;k=c.data[e];r=a.data[e];a.data[e]=(y*k+A*r+(127>=r?2*u*k*r/255:u*(2*(255^k)*(255^r)/255^255)))/t|0;k=c.data[e+1];r=a.data[e+1];a.data[e+1]=(y*k+A*r+(127>=r?2*u*k*r/255:u*(2*(255^k)*(255^r)/255^255)))/t|0;k=c.data[e+2];r=a.data[e+2];a.data[e+2]=(y*k+A*r+(127>=r?2*u*k*r/
255:u*(2*(255^k)*(255^r)/255^255)))/t|0;a.data[e+3]=t}}};L.overlayOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,l+=e,b+=k)for(let q=0;q<f;q++,l+=4,b++){var h=c.data[l+3]*g.data[b]*d/25500|0;let r,t;if(h){let u=h+(r=a.data[l+3])-(h*r/255|0)|0,y=h*r/255|0,A=h*(255^r)/255|0,F=(255^h)*r/255|0;h=c.data[l];t=a.data[l];a.data[l]=
(A*h+F*t+(127>=t?2*y*h*t/255:y*(2*(255^h)*(255^t)/255^255)))/u|0;h=c.data[l+1];t=a.data[l+1];a.data[l+1]=(A*h+F*t+(127>=t?2*y*h*t/255:y*(2*(255^h)*(255^t)/255^255)))/u|0;h=c.data[l+2];t=a.data[l+2];a.data[l+2]=(A*h+F*t+(127>=t?2*y*h*t/255:y*(2*(255^h)*(255^t)/255^255)))/u|0;a.data[l+3]=u}}};L.hardLightOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=
c.data[b+3],k,h;if(l){let m=255^l;k=c.data[b];h=a.data[b];a.data[b]=(m*h+(127>=k?2*l*k*h/255:l*(2*(255^k)*(255^h)/255^255)))/255|0;k=c.data[b+1];h=a.data[b+1];a.data[b+1]=(m*h+(127>=k?2*l*k*h/255:l*(2*(255^k)*(255^h)/255^255)))/255|0;k=c.data[b+2];h=a.data[b+2];a.data[b+2]=(m*h+(127>=k?2*l*k*h/255:l*(2*(255^k)*(255^h)/255^255)))/255|0}}};L.hardLightOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=
0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h,m;if(k){let q=255^k;h=c.data[b];m=a.data[b];a.data[b]=(q*m+(127>=h?2*k*h*m/255:k*(2*(255^h)*(255^m)/255^255)))/255|0;h=c.data[b+1];m=a.data[b+1];a.data[b+1]=(q*m+(127>=h?2*k*h*m/255:k*(2*(255^h)*(255^m)/255^255)))/255|0;h=c.data[b+2];m=a.data[b+2];a.data[b+2]=(q*m+(127>=h?2*k*h*m/255:k*(2*(255^h)*(255^m)/255^255)))/255|0}}};L.hardLightOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=
4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let l=0;l<g;l++,b+=4){var f=c.data[b+3];let k,h;if(f){let m=f+(k=a.data[b+3])-(f*k/255|0)|0,q=f*k/255|0,r=f*(255^k)/255|0,t=(255^f)*k/255|0;f=c.data[b];h=a.data[b];a.data[b]=(r*f+t*h+(127>=f?2*q*f*h/255:q*(2*(255^f)*(255^h)/255^255)))/m|0;f=c.data[b+1];h=a.data[b+1];a.data[b+1]=(r*f+t*h+(127>=f?2*q*f*h/255:q*(2*(255^f)*(255^h)/255^255)))/m|0;f=c.data[b+2];h=a.data[b+2];a.data[b+2]=(r*f+t*h+(127>=f?2*q*f*h/255:q*(2*(255^
f)*(255^h)/255^255)))/m|0;a.data[b+3]=m}}};L.hardLightOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let l=0;l<g;l++,b+=f)for(let k=0;k<n;k++,b+=4){var e=c.data[b+3]*d/100|0;let h,m;if(e){let q=e+(h=a.data[b+3])-(e*h/255|0)|0,r=e*h/255|0,t=e*(255^h)/255|0,u=(255^e)*h/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+u*m+(127>=e?2*r*e*m/255:r*(2*(255^e)*(255^m)/255^255)))/q|0;e=c.data[b+1];m=a.data[b+
1];a.data[b+1]=(t*e+u*m+(127>=e?2*r*e*m/255:r*(2*(255^e)*(255^m)/255^255)))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(t*e+u*m+(127>=e?2*r*e*m/255:r*(2*(255^e)*(255^m)/255^255)))/q|0;a.data[b+3]=q}}};L.hardLightOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|
0,q,r;if(m){let t=255^m;q=c.data[e];r=a.data[e];a.data[e]=(t*r+(127>=q?2*m*q*r/255:m*(2*(255^q)*(255^r)/255^255)))/255|0;q=c.data[e+1];r=a.data[e+1];a.data[e+1]=(t*r+(127>=q?2*m*q*r/255:m*(2*(255^q)*(255^r)/255^255)))/255|0;q=c.data[e+2];r=a.data[e+2];a.data[e+2]=(t*r+(127>=q?2*m*q*r/255:m*(2*(255^q)*(255^r)/255^255)))/255|0}}};L.hardLightOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-
f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0,r,t;if(q){let u=255^q;r=c.data[l];t=a.data[l];a.data[l]=(u*t+(127>=r?2*q*r*t/255:q*(2*(255^r)*(255^t)/255^255)))/255|0;r=c.data[l+1];t=a.data[l+1];a.data[l+1]=(u*t+(127>=r?2*q*r*t/255:q*(2*(255^r)*(255^t)/255^255)))/255|0;r=c.data[l+2];t=a.data[l+2];a.data[l+2]=(u*t+(127>=r?2*q*r*t/255:q*(2*(255^r)*(255^t)/255^255)))/255|0}}};L.hardLightOntoTransparentFusionWithOpaqueLayerMasked=
function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<d;h++,e+=f,b+=l)for(let m=0;m<n;m++,e+=4,b++){var k=c.data[e+3]*g.data[b]/255|0;let q,r;if(k){let t=k+(q=a.data[e+3])-(k*q/255|0)|0,u=k*q/255|0,y=k*(255^q)/255|0,A=(255^k)*q/255|0;k=c.data[e];r=a.data[e];a.data[e]=(y*k+A*r+(127>=k?2*u*k*r/255:u*(2*(255^k)*(255^r)/255^255)))/t|0;k=c.data[e+1];r=a.data[e+1];a.data[e+1]=(y*k+A*r+
(127>=k?2*u*k*r/255:u*(2*(255^k)*(255^r)/255^255)))/t|0;k=c.data[e+2];r=a.data[e+2];a.data[e+2]=(y*k+A*r+(127>=k?2*u*k*r/255:u*(2*(255^k)*(255^r)/255^255)))/t|0;a.data[e+3]=t}}};L.hardLightOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,l+=e,b+=k)for(let q=0;q<f;q++,l+=4,b++){var h=c.data[l+3]*g.data[b]*d/25500|0;let r,t;
if(h){let u=h+(r=a.data[l+3])-(h*r/255|0)|0,y=h*r/255|0,A=h*(255^r)/255|0,F=(255^h)*r/255|0;h=c.data[l];t=a.data[l];a.data[l]=(A*h+F*t+(127>=h?2*y*h*t/255:y*(2*(255^h)*(255^t)/255^255)))/u|0;h=c.data[l+1];t=a.data[l+1];a.data[l+1]=(A*h+F*t+(127>=h?2*y*h*t/255:y*(2*(255^h)*(255^t)/255^255)))/u|0;h=c.data[l+2];t=a.data[l+2];a.data[l+2]=(A*h+F*t+(127>=h?2*y*h*t/255:y*(2*(255^h)*(255^t)/255^255)))/u|0;a.data[l+3]=u}}};L.softLightOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=
0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3],k,h;if(l){let m=255^l;k=c.data[b];h=a.data[b];a.data[b]=(m*h+l*(127>=k?((2*k-255)*mb[h]/255|0)+h:((2*k-255)*nb[h]/255|0)+h))/255|0;k=c.data[b+1];h=a.data[b+1];a.data[b+1]=(m*h+l*(127>=k?((2*k-255)*mb[h]/255|0)+h:((2*k-255)*nb[h]/255|0)+h))/255|0;k=c.data[b+2];h=a.data[b+2];a.data[b+2]=(m*h+l*(127>=k?((2*k-255)*mb[h]/255|0)+h:((2*k-255)*nb[h]/255|0)+h))/255|0}}};L.softLightOntoOpaqueFusionWithTransparentLayer=
function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h,m;if(k){let q=255^k;h=c.data[b];m=a.data[b];a.data[b]=(q*m+k*(127>=h?((2*h-255)*mb[m]/255|0)+m:((2*h-255)*nb[m]/255|0)+m))/255|0;h=c.data[b+1];m=a.data[b+1];a.data[b+1]=(q*m+k*(127>=h?((2*h-255)*mb[m]/255|0)+m:((2*h-255)*nb[m]/255|0)+m))/255|0;h=c.data[b+2];m=a.data[b+2];a.data[b+2]=(q*m+k*(127>=h?((2*h-255)*mb[m]/
255|0)+m:((2*h-255)*nb[m]/255|0)+m))/255|0}}};L.softLightOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let l=0;l<g;l++,b+=4){var f=c.data[b+3];let k,h;if(f){let m=f+(k=a.data[b+3])-(f*k/255|0)|0,q=f*k/255|0,r=f*(255^k)/255|0,t=(255^f)*k/255|0;f=c.data[b];h=a.data[b];a.data[b]=(r*f+t*h+(127>=f?q*(((2*f-255)*mb[h]/255|0)+h):q*(((2*f-255)*nb[h]/255|0)+h)))/m|0;f=c.data[b+1];
h=a.data[b+1];a.data[b+1]=(r*f+t*h+(127>=f?q*(((2*f-255)*mb[h]/255|0)+h):q*(((2*f-255)*nb[h]/255|0)+h)))/m|0;f=c.data[b+2];h=a.data[b+2];a.data[b+2]=(r*f+t*h+(127>=f?q*(((2*f-255)*mb[h]/255|0)+h):q*(((2*f-255)*nb[h]/255|0)+h)))/m|0;a.data[b+3]=m}}};L.softLightOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let l=0;l<g;l++,b+=f)for(let k=0;k<n;k++,b+=4){var e=c.data[b+3]*d/100|0;let h,m;if(e){let q=
e+(h=a.data[b+3])-(e*h/255|0)|0,r=e*h/255|0,t=e*(255^h)/255|0,u=(255^e)*h/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+u*m+(127>=e?r*(((2*e-255)*mb[m]/255|0)+m):r*(((2*e-255)*nb[m]/255|0)+m)))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(t*e+u*m+(127>=e?r*(((2*e-255)*mb[m]/255|0)+m):r*(((2*e-255)*nb[m]/255|0)+m)))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(t*e+u*m+(127>=e?r*(((2*e-255)*mb[m]/255|0)+m):r*(((2*e-255)*nb[m]/255|0)+m)))/q|0;a.data[b+3]=q}}};L.softLightOntoOpaqueFusionWithOpaqueLayerMasked=
function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0,q,r;if(m){let t=255^m;q=c.data[e];r=a.data[e];a.data[e]=(t*r+m*(127>=q?((2*q-255)*mb[r]/255|0)+r:((2*q-255)*nb[r]/255|0)+r))/255|0;q=c.data[e+1];r=a.data[e+1];a.data[e+1]=(t*r+m*(127>=q?((2*q-255)*mb[r]/255|0)+r:((2*q-255)*nb[r]/255|0)+r))/255|0;q=
c.data[e+2];r=a.data[e+2];a.data[e+2]=(t*r+m*(127>=q?((2*q-255)*mb[r]/255|0)+r:((2*q-255)*nb[r]/255|0)+r))/255|0}}};L.softLightOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0,r,t;if(q){let u=255^q;r=c.data[l];t=a.data[l];a.data[l]=(u*t+q*(127>=r?((2*
r-255)*mb[t]/255|0)+t:((2*r-255)*nb[t]/255|0)+t))/255|0;r=c.data[l+1];t=a.data[l+1];a.data[l+1]=(u*t+q*(127>=r?((2*r-255)*mb[t]/255|0)+t:((2*r-255)*nb[t]/255|0)+t))/255|0;r=c.data[l+2];t=a.data[l+2];a.data[l+2]=(u*t+q*(127>=r?((2*r-255)*mb[t]/255|0)+t:((2*r-255)*nb[t]/255|0)+t))/255|0}}};L.softLightOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);
for(let h=0;h<d;h++,e+=f,b+=l)for(let m=0;m<n;m++,e+=4,b++){var k=c.data[e+3]*g.data[b]/255|0;let q,r;if(k){let t=k+(q=a.data[e+3])-(k*q/255|0)|0,u=k*q/255|0,y=k*(255^q)/255|0,A=(255^k)*q/255|0;k=c.data[e];r=a.data[e];a.data[e]=(y*k+A*r+(127>=k?u*(((2*k-255)*mb[r]/255|0)+r):u*(((2*k-255)*nb[r]/255|0)+r)))/t|0;k=c.data[e+1];r=a.data[e+1];a.data[e+1]=(y*k+A*r+(127>=k?u*(((2*k-255)*mb[r]/255|0)+r):u*(((2*k-255)*nb[r]/255|0)+r)))/t|0;k=c.data[e+2];r=a.data[e+2];a.data[e+2]=(y*k+A*r+(127>=k?u*(((2*k-255)*
mb[r]/255|0)+r):u*(((2*k-255)*nb[r]/255|0)+r)))/t|0;a.data[e+3]=t}}};L.softLightOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,l+=e,b+=k)for(let q=0;q<f;q++,l+=4,b++){var h=c.data[l+3]*g.data[b]*d/25500|0;let r,t;if(h){let u=h+(r=a.data[l+3])-(h*r/255|0)|0,y=h*r/255|0,A=h*(255^r)/255|0,F=(255^h)*r/255|0;h=c.data[l];t=a.data[l];
a.data[l]=(A*h+F*t+(127>=h?y*(((2*h-255)*mb[t]/255|0)+t):y*(((2*h-255)*nb[t]/255|0)+t)))/u|0;h=c.data[l+1];t=a.data[l+1];a.data[l+1]=(A*h+F*t+(127>=h?y*(((2*h-255)*mb[t]/255|0)+t):y*(((2*h-255)*nb[t]/255|0)+t)))/u|0;h=c.data[l+2];t=a.data[l+2];a.data[l+2]=(A*h+F*t+(127>=h?y*(((2*h-255)*mb[t]/255|0)+t):y*(((2*h-255)*nb[t]/255|0)+t)))/u|0;a.data[l+3]=u}}};L.vividLightOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,
b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3],k,h;if(l){let m=255^l;k=c.data[b];h=a.data[b];a.data[b]=(m*h+(127>=k?l*(0==k?0:255-Math.min(255,255*(255-h)/(2*k)|0)):l*(255==k?255:Math.min(255,255*h/(2*(255-k))|0))))/255|0;k=c.data[b+1];h=a.data[b+1];a.data[b+1]=(m*h+(127>=k?l*(0==k?0:255-Math.min(255,255*(255-h)/(2*k)|0)):l*(255==k?255:Math.min(255,255*h/(2*(255-k))|0))))/255|0;k=c.data[b+2];h=a.data[b+2];a.data[b+2]=(m*h+(127>=k?l*(0==k?0:255-Math.min(255,255*(255-h)/
(2*k)|0)):l*(255==k?255:Math.min(255,255*h/(2*(255-k))|0))))/255|0}}};L.vividLightOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h,m;if(k){let q=255^k;h=c.data[b];m=a.data[b];a.data[b]=(q*m+(127>=h?k*(0==h?0:255-Math.min(255,255*(255-m)/(2*h)|0)):k*(255==h?255:Math.min(255,255*m/(2*(255-h))|0))))/255|0;h=c.data[b+1];m=a.data[b+
1];a.data[b+1]=(q*m+(127>=h?k*(0==h?0:255-Math.min(255,255*(255-m)/(2*h)|0)):k*(255==h?255:Math.min(255,255*m/(2*(255-h))|0))))/255|0;h=c.data[b+2];m=a.data[b+2];a.data[b+2]=(q*m+(127>=h?k*(0==h?0:255-Math.min(255,255*(255-m)/(2*h)|0)):k*(255==h?255:Math.min(255,255*m/(2*(255-h))|0))))/255|0}}};L.vividLightOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let l=0;l<g;l++,b+=
4){var f=c.data[b+3];let k,h;if(f){let m=f+(k=a.data[b+3])-(f*k/255|0)|0,q=f*k/255|0,r=f*(255^k)/255|0,t=(255^f)*k/255|0;f=c.data[b];h=a.data[b];a.data[b]=(r*f+t*h+(127>=f?q*(0==f?0:255-Math.min(255,255*(255-h)/(2*f)|0)):q*(255==f?255:Math.min(255,255*h/(2*(255-f))|0))))/m|0;f=c.data[b+1];h=a.data[b+1];a.data[b+1]=(r*f+t*h+(127>=f?q*(0==f?0:255-Math.min(255,255*(255-h)/(2*f)|0)):q*(255==f?255:Math.min(255,255*h/(2*(255-f))|0))))/m|0;f=c.data[b+2];h=a.data[b+2];a.data[b+2]=(r*f+t*h+(127>=f?q*(0==f?
0:255-Math.min(255,255*(255-h)/(2*f)|0)):q*(255==f?255:Math.min(255,255*h/(2*(255-f))|0))))/m|0;a.data[b+3]=m}}};L.vividLightOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let l=0;l<g;l++,b+=f)for(let k=0;k<n;k++,b+=4){var e=c.data[b+3]*d/100|0;let h,m;if(e){let q=e+(h=a.data[b+3])-(e*h/255|0)|0,r=e*h/255|0,t=e*(255^h)/255|0,u=(255^e)*h/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+u*m+(127>=
e?r*(0==e?0:255-Math.min(255,255*(255-m)/(2*e)|0)):r*(255==e?255:Math.min(255,255*m/(2*(255-e))|0))))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(t*e+u*m+(127>=e?r*(0==e?0:255-Math.min(255,255*(255-m)/(2*e)|0)):r*(255==e?255:Math.min(255,255*m/(2*(255-e))|0))))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(t*e+u*m+(127>=e?r*(0==e?0:255-Math.min(255,255*(255-m)/(2*e)|0)):r*(255==e?255:Math.min(255,255*m/(2*(255-e))|0))))/q|0;a.data[b+3]=q}}};L.vividLightOntoOpaqueFusionWithOpaqueLayerMasked=function(a,
c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0,q,r;if(m){let t=255^m;q=c.data[e];r=a.data[e];a.data[e]=(t*r+(127>=q?m*(0==q?0:255-Math.min(255,255*(255-r)/(2*q)|0)):m*(255==q?255:Math.min(255,255*r/(2*(255-q))|0))))/255|0;q=c.data[e+1];r=a.data[e+1];a.data[e+1]=(t*r+(127>=q?m*(0==q?0:255-Math.min(255,255*
(255-r)/(2*q)|0)):m*(255==q?255:Math.min(255,255*r/(2*(255-q))|0))))/255|0;q=c.data[e+2];r=a.data[e+2];a.data[e+2]=(t*r+(127>=q?m*(0==q?0:255-Math.min(255,255*(255-r)/(2*q)|0)):m*(255==q?255:Math.min(255,255*r/(2*(255-q))|0))))/255|0}}};L.vividLightOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,
l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0,r,t;if(q){let u=255^q;r=c.data[l];t=a.data[l];a.data[l]=(u*t+(127>=r?q*(0==r?0:255-Math.min(255,255*(255-t)/(2*r)|0)):q*(255==r?255:Math.min(255,255*t/(2*(255-r))|0))))/255|0;r=c.data[l+1];t=a.data[l+1];a.data[l+1]=(u*t+(127>=r?q*(0==r?0:255-Math.min(255,255*(255-t)/(2*r)|0)):q*(255==r?255:Math.min(255,255*t/(2*(255-r))|0))))/255|0;r=c.data[l+2];t=a.data[l+2];a.data[l+2]=(u*t+(127>=r?q*(0==r?0:255-Math.min(255,255*(255-t)/(2*r)|0)):q*(255==r?255:Math.min(255,
255*t/(2*(255-r))|0))))/255|0}}};L.vividLightOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<d;h++,e+=f,b+=l)for(let m=0;m<n;m++,e+=4,b++){var k=c.data[e+3]*g.data[b]/255|0;let q,r;if(k){let t=k+(q=a.data[e+3])-(k*q/255|0)|0,u=k*q/255|0,y=k*(255^q)/255|0,A=(255^k)*q/255|0;k=c.data[e];r=a.data[e];a.data[e]=(y*k+A*r+(127>=k?u*(0==k?0:
255-Math.min(255,255*(255-r)/(2*k)|0)):u*(255==k?255:Math.min(255,255*r/(2*(255-k))|0))))/t|0;k=c.data[e+1];r=a.data[e+1];a.data[e+1]=(y*k+A*r+(127>=k?u*(0==k?0:255-Math.min(255,255*(255-r)/(2*k)|0)):u*(255==k?255:Math.min(255,255*r/(2*(255-k))|0))))/t|0;k=c.data[e+2];r=a.data[e+2];a.data[e+2]=(y*k+A*r+(127>=k?u*(0==k?0:255-Math.min(255,255*(255-r)/(2*k)|0)):u*(255==k?255:Math.min(255,255*r/(2*(255-k))|0))))/t|0;a.data[e+3]=t}}};L.vividLightOntoTransparentFusionWithTransparentLayerMasked=function(a,
c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,l+=e,b+=k)for(let q=0;q<f;q++,l+=4,b++){var h=c.data[l+3]*g.data[b]*d/25500|0;let r,t;if(h){let u=h+(r=a.data[l+3])-(h*r/255|0)|0,y=h*r/255|0,A=h*(255^r)/255|0,F=(255^h)*r/255|0;h=c.data[l];t=a.data[l];a.data[l]=(A*h+F*t+(127>=h?y*(0==h?0:255-Math.min(255,255*(255-t)/(2*h)|0)):y*(255==h?255:Math.min(255,255*t/(2*(255-h))|0))))/u|0;
h=c.data[l+1];t=a.data[l+1];a.data[l+1]=(A*h+F*t+(127>=h?y*(0==h?0:255-Math.min(255,255*(255-t)/(2*h)|0)):y*(255==h?255:Math.min(255,255*t/(2*(255-h))|0))))/u|0;h=c.data[l+2];t=a.data[l+2];a.data[l+2]=(A*h+F*t+(127>=h?y*(0==h?0:255-Math.min(255,255*(255-t)/(2*h)|0)):y*(255==h?255:Math.min(255,255*t/(2*(255-h))|0))))/u|0;a.data[l+3]=u}}};L.linearLightOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=
0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3],k;if(l){let h=255^l;k=a.data[b];a.data[b]=(h*k+l*Math.min(255,Math.max(0,k+2*c.data[b]-255)))/255|0;k=a.data[b+1];a.data[b+1]=(h*k+l*Math.min(255,Math.max(0,k+2*c.data[b+1]-255)))/255|0;k=a.data[b+2];a.data[b+2]=(h*k+l*Math.min(255,Math.max(0,k+2*c.data[b+2]-255)))/255|0}}};L.linearLightOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=
0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h;if(k){let m=255^k;h=a.data[b];a.data[b]=(m*h+k*Math.min(255,Math.max(0,h+2*c.data[b]-255)))/255|0;h=a.data[b+1];a.data[b+1]=(m*h+k*Math.min(255,Math.max(0,h+2*c.data[b+1]-255)))/255|0;h=a.data[b+2];a.data[b+2]=(m*h+k*Math.min(255,Math.max(0,h+2*c.data[b+2]-255)))/255|0}}};L.linearLightOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);
for(let e=0;e<d;e++,b+=n)for(let l=0;l<g;l++,b+=4){var f=c.data[b+3];let k,h;if(f){let m=f+(k=a.data[b+3])-(f*k/255|0)|0,q=f*k/255|0,r=f*(255^k)/255|0,t=(255^f)*k/255|0;f=c.data[b];h=a.data[b];a.data[b]=(r*f+t*h+q*Math.min(255,Math.max(0,h+2*f-255)))/m|0;f=c.data[b+1];h=a.data[b+1];a.data[b+1]=(r*f+t*h+q*Math.min(255,Math.max(0,h+2*f-255)))/m|0;f=c.data[b+2];h=a.data[b+2];a.data[b+2]=(r*f+t*h+q*Math.min(255,Math.max(0,h+2*f-255)))/m|0;a.data[b+3]=m}}};L.linearLightOntoTransparentFusionWithTransparentLayer=
function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let l=0;l<g;l++,b+=f)for(let k=0;k<n;k++,b+=4){var e=c.data[b+3]*d/100|0;let h,m;if(e){let q=e+(h=a.data[b+3])-(e*h/255|0)|0,r=e*h/255|0,t=e*(255^h)/255|0,u=(255^e)*h/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+u*m+r*Math.min(255,Math.max(0,m+2*e-255)))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(t*e+u*m+r*Math.min(255,Math.max(0,m+2*e-255)))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+
2]=(t*e+u*m+r*Math.min(255,Math.max(0,m+2*e-255)))/q|0;a.data[b+3]=q}}};L.linearLightOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0,q;if(m){let r=255^m;q=a.data[e];a.data[e]=(r*q+m*Math.min(255,Math.max(0,q+2*c.data[e]-255)))/255|0;q=a.data[e+1];a.data[e+1]=
(r*q+m*Math.min(255,Math.max(0,q+2*c.data[e+1]-255)))/255|0;q=a.data[e+2];a.data[e+2]=(r*q+m*Math.min(255,Math.max(0,q+2*c.data[e+2]-255)))/255|0}}};L.linearLightOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0,r;if(q){let t=255^q;r=a.data[l];a.data[l]=
(t*r+q*Math.min(255,Math.max(0,r+2*c.data[l]-255)))/255|0;r=a.data[l+1];a.data[l+1]=(t*r+q*Math.min(255,Math.max(0,r+2*c.data[l+1]-255)))/255|0;r=a.data[l+2];a.data[l+2]=(t*r+q*Math.min(255,Math.max(0,r+2*c.data[l+2]-255)))/255|0}}};L.linearLightOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<d;h++,e+=f,b+=l)for(let m=0;m<n;m++,e+=
4,b++){var k=c.data[e+3]*g.data[b]/255|0;let q,r;if(k){let t=k+(q=a.data[e+3])-(k*q/255|0)|0,u=k*q/255|0,y=k*(255^q)/255|0,A=(255^k)*q/255|0;k=c.data[e];r=a.data[e];a.data[e]=(y*k+A*r+u*Math.min(255,Math.max(0,r+2*k-255)))/t|0;k=c.data[e+1];r=a.data[e+1];a.data[e+1]=(y*k+A*r+u*Math.min(255,Math.max(0,r+2*k-255)))/t|0;k=c.data[e+2];r=a.data[e+2];a.data[e+2]=(y*k+A*r+u*Math.min(255,Math.max(0,r+2*k-255)))/t|0;a.data[e+3]=t}}};L.linearLightOntoTransparentFusionWithTransparentLayerMasked=function(a,c,
d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,l+=e,b+=k)for(let q=0;q<f;q++,l+=4,b++){var h=c.data[l+3]*g.data[b]*d/25500|0;let r,t;if(h){let u=h+(r=a.data[l+3])-(h*r/255|0)|0,y=h*r/255|0,A=h*(255^r)/255|0,F=(255^h)*r/255|0;h=c.data[l];t=a.data[l];a.data[l]=(A*h+F*t+y*Math.min(255,Math.max(0,t+2*h-255)))/u|0;h=c.data[l+1];t=a.data[l+1];a.data[l+1]=(A*h+F*t+y*Math.min(255,Math.max(0,
t+2*h-255)))/u|0;h=c.data[l+2];t=a.data[l+2];a.data[l+2]=(A*h+F*t+y*Math.min(255,Math.max(0,t+2*h-255)))/u|0;a.data[l+3]=u}}};L.pinLightOntoOpaqueFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3],k,h;if(l){let m=255^l;k=c.data[b];h=a.data[b];a.data[b]=(m*h+l*(h>=2*k?2*k:h<=2*k-255?2*k-255:h))/255|0;k=c.data[b+1];h=a.data[b+1];a.data[b+1]=(m*h+l*(h>=
2*k?2*k:h<=2*k-255?2*k-255:h))/255|0;k=c.data[b+2];h=a.data[b+2];a.data[b+2]=(m*h+l*(h>=2*k?2*k:h<=2*k-255?2*k-255:h))/255|0}}};L.pinLightOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h,m;if(k){let q=255^k;h=c.data[b];m=a.data[b];a.data[b]=(q*m+k*(m>=2*h?2*h:m<=2*h-255?2*h-255:m))/255|0;h=c.data[b+1];m=a.data[b+1];a.data[b+
1]=(q*m+k*(m>=2*h?2*h:m<=2*h-255?2*h-255:m))/255|0;h=c.data[b+2];m=a.data[b+2];a.data[b+2]=(q*m+k*(m>=2*h?2*h:m<=2*h-255?2*h-255:m))/255|0}}};L.pinLightOntoTransparentFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<d;e++,b+=n)for(let l=0;l<g;l++,b+=4){var f=c.data[b+3];let k,h;if(f){let m=f+(k=a.data[b+3])-(f*k/255|0)|0,q=f*k/255|0,r=f*(255^k)/255|0,t=(255^f)*k/255|0;f=c.data[b];h=a.data[b];a.data[b]=
(r*f+t*h+q*(h>=2*f?2*f:h<=2*f-255?2*f-255:h))/m|0;f=c.data[b+1];h=a.data[b+1];a.data[b+1]=(r*f+t*h+q*(h>=2*f?2*f:h<=2*f-255?2*f-255:h))/m|0;f=c.data[b+2];h=a.data[b+2];a.data[b+2]=(r*f+t*h+q*(h>=2*f?2*f:h<=2*f-255?2*f-255:h))/m|0;a.data[b+3]=m}}};L.pinLightOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let l=0;l<g;l++,b+=f)for(let k=0;k<n;k++,b+=4){var e=c.data[b+3]*d/100|0;let h,m;if(e){let q=
e+(h=a.data[b+3])-(e*h/255|0)|0,r=e*h/255|0,t=e*(255^h)/255|0,u=(255^e)*h/255|0;e=c.data[b];m=a.data[b];a.data[b]=(t*e+u*m+r*(m>=2*e?2*e:m<=2*e-255?2*e-255:m))/q|0;e=c.data[b+1];m=a.data[b+1];a.data[b+1]=(t*e+u*m+r*(m>=2*e?2*e:m<=2*e-255?2*e-255:m))/q|0;e=c.data[b+2];m=a.data[b+2];a.data[b+2]=(t*e+u*m+r*(m>=2*e?2*e:m<=2*e-255?2*e-255:m))/q|0;a.data[b+3]=q}}};L.pinLightOntoOpaqueFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,
b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0,q,r;if(m){let t=255^m;q=c.data[e];r=a.data[e];a.data[e]=(t*r+m*(r>=2*q?2*q:r<=2*q-255?2*q-255:r))/255|0;q=c.data[e+1];r=a.data[e+1];a.data[e+1]=(t*r+m*(r>=2*q?2*q:r<=2*q-255?2*q-255:r))/255|0;q=c.data[e+2];r=a.data[e+2];a.data[e+2]=(t*r+m*(r>=2*q?2*q:r<=2*q-255?2*q-255:r))/255|0}}};L.pinLightOntoOpaqueFusionWithTransparentLayerMasked=function(a,c,d,b,
g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3]*g.data[b]*d/25500|0,r,t;if(q){let u=255^q;r=c.data[l];t=a.data[l];a.data[l]=(u*t+q*(t>=2*r?2*r:t<=2*r-255?2*r-255:t))/255|0;r=c.data[l+1];t=a.data[l+1];a.data[l+1]=(u*t+q*(t>=2*r?2*r:t<=2*r-255?2*r-255:t))/255|0;r=c.data[l+2];t=a.data[l+2];a.data[l+2]=(u*t+q*(t>=2*r?2*r:t<=2*r-255?
2*r-255:t))/255|0}}};L.pinLightOntoTransparentFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<d;h++,e+=f,b+=l)for(let m=0;m<n;m++,e+=4,b++){var k=c.data[e+3]*g.data[b]/255|0;let q,r;if(k){let t=k+(q=a.data[e+3])-(k*q/255|0)|0,u=k*q/255|0,y=k*(255^q)/255|0,A=(255^k)*q/255|0;k=c.data[e];r=a.data[e];a.data[e]=(y*k+A*r+u*(r>=2*k?2*k:r<=2*k-255?2*k-255:
r))/t|0;k=c.data[e+1];r=a.data[e+1];a.data[e+1]=(y*k+A*r+u*(r>=2*k?2*k:r<=2*k-255?2*k-255:r))/t|0;k=c.data[e+2];r=a.data[e+2];a.data[e+2]=(y*k+A*r+u*(r>=2*k?2*k:r<=2*k-255?2*k-255:r))/t|0;a.data[e+3]=t}}};L.pinLightOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let m=0;m<n;m++,l+=e,b+=k)for(let q=0;q<f;q++,l+=4,b++){var h=c.data[l+3]*g.data[b]*
d/25500|0;let r,t;if(h){let u=h+(r=a.data[l+3])-(h*r/255|0)|0,y=h*r/255|0,A=h*(255^r)/255|0,F=(255^h)*r/255|0;h=c.data[l];t=a.data[l];a.data[l]=(A*h+F*t+y*(t>=2*h?2*h:t<=2*h-255?2*h-255:t))/u|0;h=c.data[l+1];t=a.data[l+1];a.data[l+1]=(A*h+F*t+y*(t>=2*h?2*h:t<=2*h-255?2*h-255:t))/u|0;h=c.data[l+2];t=a.data[l+2];a.data[l+2]=(A*h+F*t+y*(t>=2*h?2*h:t<=2*h-255?2*h-255:t))/u|0;a.data[l+3]=u}}};L.passthroughOntoOpaqueFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*
(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3],h=d/100,m=1-h,q=k*h+255*m;a.data[b]=(c.data[b]*k*h+255*a.data[b]*m)/q|0;a.data[b+1]=(c.data[b+1]*k*h+255*a.data[b+1]*m)/q|0;a.data[b+2]=(c.data[b+2]*k*h+255*a.data[b+2]*m)/q|0;a.data[b+3]=q}};L.passthroughOntoOpaqueFusionWithOpaqueLayer=L.passthroughOntoOpaqueFusionWithTransparentLayer;L.passthroughOntoTransparentFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=
0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3],h=a.data[b+3],m=d/100,q=1-m,r=k*m+h*q;a.data[b]=(c.data[b]*k*m+a.data[b]*h*q)/r|0;a.data[b+1]=(c.data[b+1]*k*m+a.data[b+1]*h*q)/r|0;a.data[b+2]=(c.data[b+2]*k*m+a.data[b+2]*h*q)/r|0;a.data[b+3]=r}};L.passthroughOntoTransparentFusionWithOpaqueLayer=L.passthroughOntoTransparentFusionWithTransparentLayer;L.passthroughOntoOpaqueFusionWithTransparentLayerMasked=function(a,
c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3],r=g.data[b]*d/25500,t=1-r,u=q*r+255*t;a.data[l]=(c.data[l]*q*r+255*a.data[l]*t)/u|0;a.data[l+1]=(c.data[l+1]*q*r+255*a.data[l+1]*t)/u|0;a.data[l+2]=(c.data[l+2]*q*r+255*a.data[l+2]*t)/u|0;a.data[l+3]=u}};L.passthroughOntoOpaqueFusionWithOpaqueLayerMasked=L.passthroughOntoOpaqueFusionWithTransparentLayerMasked;
L.passthroughOntoTransparentFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+3],r=a.data[l+3],t=g.data[b]*d/25500,u=1-t,y=q*t+r*u;a.data[l]=(c.data[l]*q*t+a.data[l]*r*u)/y|0;a.data[l+1]=(c.data[l+1]*q*t+a.data[l+1]*r*u)/y|0;a.data[l+2]=(c.data[l+2]*q*t+a.data[l+2]*r*u)/y|0;a.data[l+
3]=y}};L.passthroughOntoTransparentFusionWithOpaqueLayerMasked=L.passthroughOntoTransparentFusionWithTransparentLayerMasked;L.replaceOntoFusionWithTransparentLayer=function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0;a.data[b]=c.data[b];a.data[b+1]=c.data[b+1];a.data[b+2]=c.data[b+2];a.data[b+3]=k}};L.replaceOntoFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();
let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3];a.data[b]=c.data[b];a.data[b+1]=c.data[b+1];a.data[b+2]=c.data[b+2];a.data[b+3]=l}};L.replaceOntoFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++){let q=c.data[l+
3]*g.data[b]*d/25500|0;a.data[l]=c.data[l];a.data[l+1]=c.data[l+1];a.data[l+2]=c.data[l+2];a.data[l+3]=q}};L.replaceOntoFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++){let m=c.data[e+3]*g.data[b]/255|0;a.data[e]=c.data[e];a.data[e+1]=c.data[e+1];a.data[e+2]=c.data[e+2];a.data[e+3]=m}};L.replaceAlphaOntoFusionWithTransparentLayer=
function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4)a.data[b+3]=c.data[b+3]*d/100|0};L.replaceAlphaOntoFusionWithTransparentLayerMasked=function(a,c,d,b,g){let n=0|b.getHeight(),f=0|b.getWidth(),e=4*(c.width-f)|0,l=0|c.offsetOfPixel(b.left,b.top),k=g.width-f|0;b=0|g.offsetOfPixel(b.left,b.top);for(let h=0;h<n;h++,l+=e,b+=k)for(let m=0;m<f;m++,l+=4,b++)a.data[l+3]=c.data[l+3]*g.data[b]*d/25500|
0};L.replaceAlphaOntoFusionWithOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4)a.data[b+3]=c.data[b+3]};L.replaceAlphaOntoFusionWithOpaqueLayerMasked=function(a,c,d,b,g){d=0|b.getHeight();let n=0|b.getWidth(),f=4*(c.width-n)|0,e=0|c.offsetOfPixel(b.left,b.top),l=g.width-n|0;b=0|g.offsetOfPixel(b.left,b.top);for(let k=0;k<d;k++,e+=f,b+=l)for(let h=0;h<n;h++,e+=4,b++)a.data[e+3]=
c.data[e+3]*g.data[b]/255|0};L.upgradeMultiplyOfOpaqueLayer=function(a,c,d,b){d=0|b.getHeight();let g=0|b.getWidth(),n=4*(c.width-g)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let f=0;f<d;f++,b+=n)for(let e=0;e<g;e++,b+=4){let l=c.data[b+3],k,h;l&&(k=c.data[b],h=a.data[b],c.data[b]=k+Math.ceil((255-k)*h*l%65025/(h*l)),k=c.data[b+1],h=a.data[b+1],c.data[b+1]=k+Math.ceil((255-k)*h*l%65025/(h*l)),k=c.data[b+2],h=a.data[b+2],c.data[b+2]=k+Math.ceil((255-k)*h*l%65025/(h*l)))}};L.upgradeMultiplyOfTransparentLayer=
function(a,c,d,b){let g=0|b.getHeight(),n=0|b.getWidth(),f=4*(c.width-n)|0;b=0|c.offsetOfPixel(b.left,b.top);for(let e=0;e<g;e++,b+=f)for(let l=0;l<n;l++,b+=4){let k=c.data[b+3]*d/100|0,h,m;k&&(h=c.data[b],m=a.data[b],c.data[b]=h+Math.ceil((255-h)*m*k%65025/(m*k)),h=c.data[b+1],m=a.data[b+1],c.data[b+1]=h+Math.ceil((255-h)*m*k%65025/(m*k)),h=c.data[b+2],m=a.data[b+2],c.data[b+2]=h+Math.ceil((255-h)*m*k%65025/(m*k)))}};L._normalFuseImageOntoImageAtPosition=function(a,c,d,b,g,n){d=0|b.getHeight();let f=
0|b.getWidth(),e=4*(c.width-f)|0;b=0|c.offsetOfPixel(b.left,b.top);let l=4*(a.width-f)|0;g=0|a.offsetOfPixel(g,n);for(n=0;n<d;n++,b+=e,g+=l)for(let h=0;h<f;h++,b+=4,g+=4){var k=c.data[b+3];let m;if(k){let q=k+(m=a.data[g+3])-(k*m/255|0)|0;k=255*k/q|0;let r=255-k;a.data[g]=(c.data[b]*k+a.data[g]*r)/255|0;a.data[g+1]=(c.data[b+1]*k+a.data[g+1]*r)/255|0;a.data[g+2]=(c.data[b+2]*k+a.data[g+2]*r)/255|0;a.data[g+3]=q}}};L.LM_NORMAL=0;L.LM_MULTIPLY=1;L.LM_ADD=2;L.LM_SCREEN=3;L.LM_LIGHTEN=4;L.LM_DARKEN=5;
L.LM_SUBTRACT=6;L.LM_DODGE=7;L.LM_BURN=8;L.LM_OVERLAY=9;L.LM_HARDLIGHT=10;L.LM_SOFTLIGHT=11;L.LM_VIVIDLIGHT=12;L.LM_LINEARLIGHT=13;L.LM_PINLIGHT=14;L.LM_PASSTHROUGH=15;L.LM_MULTIPLY2=16;L.LM_FIRST=0;L.LM_LAST=16;L.LM_LAST_CHIBIPAINT=L.LM_PINLIGHT;L.BLEND_MODE_CODENAMES="normal multiply add screen lighten darken subtract dodge burn overlay hardLight softLight vividLight linearLight pinLight passthrough multiply2".split(" ");L.BLEND_MODE_DISPLAY_NAMES="Normal;Multiply;Add;Screen;Lighten;Darken;Subtract;Dodge;Burn;Overlay;Hard Light;Soft Light;Vivid Light;Linear Light;Pin Light;Passthrough;Multiply".split(";");
for(let a=0;256>a;a++){let c=a/255;mb[a]=255*(c-c*c)|0}for(let a=0;256>a;a++){let c=a/255;nb[a]=255*(Math.sqrt(c)-c)|0}Ta.prototype.copyFrom=function(a){this.name=a.name;this.blendMode=a.blendMode;this.useLegacyMultiply=a.useLegacyMultiply;this.alpha=a.alpha;this.visible=a.visible;this.parent=a.parent;this.lockAlpha=a.lockAlpha;a.mask?this.mask?this.mask.copyPixelsFrom(a.mask):this.mask=a.mask.clone():this.mask=null;this.maskLinked=a.maskLinked;this.maskVisible=a.maskVisible;a.maskThumbnail?this.maskThumbnail?
this.maskThumbnail.copyPixelsFrom(a.maskThumbnail):this.maskThumbnail=a.maskThumbnail.clone():this.maskThumbnail=null};Ta.prototype.setMask=function(a){(this.mask=a)||(this.maskThumbnail=null)};Ta.prototype.setAlpha=function(a){this.alpha=a};Ta.prototype.getAlpha=function(){return this.alpha};Ta.prototype.getEffectiveAlpha=function(){return this.visible?this.alpha:0};Ta.prototype.getEffectiveMask=function(){return this.maskVisible?this.mask:null};Ta.prototype.setName=function(a){this.name=a};Ta.prototype.getName=
function(){return this.name};Ta.prototype.setBlendMode=function(a){this.blendMode=a;a===L.LM_MULTIPLY?this.useLegacyMultiply=!0:a===L.LM_MULTIPLY2&&(this.useLegacyMultiply=!1)};Ta.prototype.getBlendMode=function(){return this.blendMode};Ta.prototype.getLockAlpha=function(){return this.lockAlpha};Ta.prototype.setLockAlpha=function(a){this.lockAlpha=a};Ta.prototype.setVisible=function(a){this.visible=a};Ta.prototype.getVisible=function(){return this.visible};Ta.prototype.isVisible=Ta.prototype.getVisible;
Ta.prototype.setMaskLinked=function(a){this.maskLinked=a};Ta.prototype.getMaskLinked=function(){return this.maskLinked};Ta.prototype.setMaskVisible=function(a){this.maskVisible=a};Ta.prototype.getMaskVisible=function(){return this.maskVisible};Ta.prototype.getMemoryUsed=function(){return 0};Ta.prototype.getDepth=function(){return null==this.parent?0:this.parent.getDepth()+1};Ta.prototype.ancestorsAreVisible=function(){return null==this.parent||this.parent.visible&&this.parent.ancestorsAreVisible()};
Ta.prototype.hasAncestor=function(a){return this.parent==a||this.parent&&this.parent.hasAncestor(a)};Ta.prototype.clone=function(){throw"Pure virtual CPLayer.clone() call";};Ta.prototype.getNonTransparentBounds=function(a){return new ka(0,0,0,0)};Ta.prototype.rebuildMaskThumbnail=function(){if(this.mask){if(!this.maskThumbnail){var a=Math.ceil(Math.max(this.mask.width/Ta.LAYER_THUMBNAIL_WIDTH,this.mask.height/Ta.LAYER_THUMBNAIL_HEIGHT));this.maskThumbnail=new ya(Math.floor(this.mask.width/a),Math.floor(this.mask.height/
a),8)}this.maskThumbnail.createThumbnailFrom(this.mask)}else this.maskThumbnail=null};Ta.prototype.getMaskThumbnail=function(){return!this.maskThumbnail&&this.mask&&this.rebuildMaskThumbnail(),this.maskThumbnail};Ta.LAYER_THUMBNAIL_WIDTH=80;Ta.LAYER_THUMBNAIL_HEIGHT=50;qa.prototype=Object.create(Ta.prototype);qa.prototype.constructor=qa;qa.createFromImage=function(a,c){c=new qa(0,0,c);return c.image=a,c};qa.prototype.clone=function(){var a=new qa(0,0,this.name);return a.copyFrom(this),a};qa.prototype.copyFrom=
function(a){Ta.prototype.copyFrom.call(this,a);this.clip=a.clip;this.image?this.image.copyPixelsFrom(a.image):this.image=a.image.clone()};qa.prototype.hasAlpha=function(){return 100!=this.alpha||this.image.hasAlpha()};qa.prototype.hasAlphaInRect=function(a){return 100!=this.alpha||this.image.hasAlphaInRect(a)};qa.prototype.copyImageFrom=function(a){this.image.copyPixelsFrom(a)};qa.prototype.getClippingBase=function(){if(this.clip&&this.parent)for(var a=this.parent.indexOf(this)-1;0<=a;a--)if(this.parent.layers[a]instanceof
qa){if(!this.parent.layers[a].clip)return this.parent.layers[a]}else break;return null};qa.prototype.getClip=function(){return this.clip};qa.prototype.setClip=function(a){this.clip=a};qa.prototype.getNonTransparentBounds=function(a){return this.image.getNonTransparentBounds(a)};qa.prototype.getBounds=function(){return new ka(0,0,this.image.width,this.image.height)};qa.prototype.getMemoryUsed=function(){return this.image?this.image.getMemorySize():0};qa.prototype.rebuildImageThumbnail=function(){if(!this.imageThumbnail){var a=
Math.ceil(Math.max(this.image.width/Ta.LAYER_THUMBNAIL_WIDTH,this.image.height/Ta.LAYER_THUMBNAIL_HEIGHT));this.imageThumbnail=new z(Math.floor(this.image.width/a),Math.floor(this.image.height/a))}this.imageThumbnail.createThumbnailFrom(this.image)};qa.prototype.getImageThumbnail=function(){return this.imageThumbnail||this.rebuildImageThumbnail(),this.imageThumbnail};L.blendFunctionNameForParameters=function(a,c,d,b){d=L.BLEND_MODE_CODENAMES[d]+"Onto";return a?d+="TransparentFusion":d+="OpaqueFusion",
100==c?d+="WithOpaqueLayer":d+="WithTransparentLayer",b&&(d+="Masked"),d};L.fuseImageOntoImage=function(a,c,d,b,g,n,f){0>=b||(c=L.blendFunctionNameForParameters(c,b,g,null!=f),n=a.getBounds().clipTo(n),this[c](a,d,b,n,f))};L.normalFuseImageOntoImageAtPosition=function(a,c,d,b,g){g=g.clone();d=new ka(d,b,0,0);a.getBounds().clipSourceDest(g,d);this._normalFuseImageOntoImageAtPosition(a,c,100,g,d.left,d.top)};L.multiplyAlphaBy=function(a,c){if(100>c)if(0==c)a.clearAll(0);else{a=a.data;for(var d=3;d<
a.length;d+=4)a[d]=Math.round(a[d]*c/100)}};L.multiplyAlphaByMask=function(a,c,d){c/=25500;for(var b=z.ALPHA_BYTE_OFFSET,g=0;b<a.data.length;b+=z.BYTES_PER_PIXEL,g++)a.data[b]=Math.round(a.data[b]*d.data[g]*c)};L.copyAndMultiplyAlphaBy=function(a,c,d,b){if(100==d)a.copyBitmapRect(c,b.left,b.top,b);else if(0==d)a.clearRect(b,0);else for(a=c.data,c=0;c<a.length;c+=4)a[c]=a[c],a[c+1]=a[c+1],a[c+2]=a[c+2],a[c+3]=Math.round(a[c+3]*d/100)};Pc.prototype.addChildren=function(a){null!=a&&(Array.isArray(a)?
(a.forEach(c=>c.parent=this),this.layers=this.layers.concat(a)):(a.parent=this,this.layers.push(a)))};var Ab={};!function(a){function c(){}function d(f,e){for(var l=f.length;l--;)if(f[l].listener===e)return l;return-1}function b(f){return function(){return this[f].apply(this,arguments)}}var g=c.prototype,n=a.EventEmitter;g.getListeners=function(f){var e,l,k=this._getEvents();if(f instanceof RegExp)for(l in e={},k)k.hasOwnProperty(l)&&f.test(l)&&(e[l]=k[l]);else e=k[f]||(k[f]=[]);return e};g.flattenListeners=
function(f){var e,l=[];for(e=0;e<f.length;e+=1)l.push(f[e].listener);return l};g.getListenersAsObject=function(f){var e,l=this.getListeners(f);return l instanceof Array&&((e={})[f]=l),e||l};g.addListener=function(f,e){if(!function q(m){return"function"==typeof m||m instanceof RegExp||!!m&&"object"==typeof m&&q(m.listener)}(e))throw TypeError("listener must be a function");var l;f=this.getListenersAsObject(f);var k="object"==typeof e;for(l in f)f.hasOwnProperty(l)&&-1===d(f[l],e)&&f[l].push(k?e:{listener:e,
once:!1});return this};g.on=b("addListener");g.addOnceListener=function(f,e){return this.addListener(f,{listener:e,once:!0})};g.once=b("addOnceListener");g.defineEvent=function(f){return this.getListeners(f),this};g.defineEvents=function(f){for(var e=0;e<f.length;e+=1)this.defineEvent(f[e]);return this};g.removeListener=function(f,e){var l,k;f=this.getListenersAsObject(f);for(k in f)f.hasOwnProperty(k)&&-1!==(l=d(f[k],e))&&f[k].splice(l,1);return this};g.off=b("removeListener");g.addListeners=function(f,
e){return this.manipulateListeners(!1,f,e)};g.removeListeners=function(f,e){return this.manipulateListeners(!0,f,e)};g.manipulateListeners=function(f,e,l){var k,h,m=f?this.removeListener:this.addListener;f=f?this.removeListeners:this.addListeners;if("object"!=typeof e||e instanceof RegExp)for(k=l.length;k--;)m.call(this,e,l[k]);else for(k in e)e.hasOwnProperty(k)&&(h=e[k])&&("function"==typeof h?m.call(this,k,h):f.call(this,k,h));return this};g.removeEvent=function(f){var e,l=typeof f,k=this._getEvents();
if("string"===l)delete k[f];else if(f instanceof RegExp)for(e in k)k.hasOwnProperty(e)&&f.test(e)&&delete k[e];else delete this._events;return this};g.removeAllListeners=b("removeEvent");g.emitEvent=function(f,e){var l,k,h,m=this.getListenersAsObject(f);for(h in m)if(m.hasOwnProperty(h)){var q=0;for(l=m[h].slice(0);q<l.length;q++)!0===(k=l[q]).once&&this.removeListener(f,k.listener),k.listener.apply(this,e||[])===this._getOnceReturnValue()&&this.removeListener(f,k.listener)}return this};g.trigger=
b("emitEvent");g.emit=function(f){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(f,e)};g.setOnceReturnValue=function(f){return this._onceReturnValue=f,this};g._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue};g._getEvents=function(){return this._events||(this._events={})};c.noConflict=function(){return a.EventEmitter=n,c};"function"==typeof define&&define.amd?define(function(){return c}):Ab?Ab=c:a.EventEmitter=c}("undefined"!=
typeof window?window:Ab||{});class Kf extends Ha(Ab){close(){this.layer=this.buffer=null;this.emitEvent("changeLayer")}setLayer(a){this.layer=a;this.invalidRect=a.getBounds();this.emitEvent("changeLayer")}isOpen(){return null!=this.layer}invalidateRect(a){this.invalidRect.union(a)}getImageData(){this.prepareMask();if(!this.invalidRect.isEmpty()&&this.layer&&this.layer.mask){var a=this.buffer,c=this.layer.mask,d=this.invalidRect,b=d.top*c.width+d.left,g=b*z.BYTES_PER_PIXEL,n=d.getWidth();d=d.getHeight();
var f=c.width-n,e=f*z.BYTES_PER_PIXEL;for(let l=0;l<d;l++,b+=f,g+=e)for(let k=0;k<n;k++,b++,g+=z.BYTES_PER_PIXEL)a.data[g+z.RED_BYTE_OFFSET]=c.data[b],a.data[g+z.GREEN_BYTE_OFFSET]=c.data[b],a.data[g+z.BLUE_BYTE_OFFSET]=c.data[b],a.data[g+z.ALPHA_BYTE_OFFSET]=255;!0;this.invalidRect.makeEmpty()}return this.buffer}constructor(a,c){super();this.layer=a;this.buffer=a.mask.getImageData(0,0,a.mask.width,a.mask.height);this.invalidRect=new ka(0,0,0,0);this.prepareMask=c}}class Mb{merge(a){return!1}noChange(){return!1}getMemoryUsed(a,
c){return 0}compact(){}}Za.prototype.getRgb=function(){return this.rgb};Za.prototype.getSaturation=function(){return this.saturation};Za.prototype.getHue=function(){return this.hue};Za.prototype.getValue=function(){return this.value};Za.prototype.setRgbComponents=function(a,c,d){this.setRgb(a<<16|c<<8|d)};Za.prototype.setRgb=function(a){this.rgb=a;var c=a>>16&255,d=a>>8&255;a&=255;this.value=Math.max(c,Math.max(d,a));var b=Math.min(c,Math.min(d,a));if(0==this.value?this.saturation=0:this.saturation=
~~((this.value-b)/this.value*255),0==this.saturation)this.hue=0;else{var g=(this.value-c)/(this.value-b),n=(this.value-d)/(this.value-b);b=(this.value-a)/(this.value-b);var f=0;this.value==c&&(f=b-n);this.value==d&&(f=2+g-b);this.value==a&&(f=4+n-g);0>(f*=60)&&(f+=360);this.hue=~~f}};Za.prototype.setHsv=function(a,c,d){this.hue=a;this.saturation=c;this.value=d;this.rgb=ed(this)};Za.prototype.setHue=function(a){this.hue=a;this.rgb=ed(this)};Za.prototype.setSaturation=function(a){this.saturation=a;
this.rgb=ed(this)};Za.prototype.setValue=function(a){this.value=a;this.rgb=ed(this)};Za.prototype.setGreyscale=function(a){this.rgb=Za.greyToRGB(a);this.saturation=this.hue=0;this.value=a};Za.prototype.clone=function(){var a=new Za(0);return a.copyFrom(this),a};Za.prototype.copyFrom=function(a){this.rgb=a.rgb;this.hue=a.hue;this.saturation=a.saturation;this.value=a.value};Za.prototype.isEqual=function(a){return this.rgb==a.rgb&&this.hue==a.hue&&this.saturation==a.saturation&&this.value==a.value};
Za.greyToRGB=function(a){return a|a<<8|a<<16};ib.prototype.setToIdentity=function(){this.m=[1,0,0,1,0,0]};ib.prototype.multiply=function(a){var c=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],b=this.m[1]*a.m[2]+this.m[3]*a.m[3],g=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],n=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=this.m[0]*a.m[0]+this.m[2]*a.m[1];this.m[1]=c;this.m[2]=d;this.m[3]=b;this.m[4]=g;this.m[5]=n};ib.prototype.preMultiply=function(a){var c=a.m[1]*this.m[0]+
a.m[3]*this.m[1],d=a.m[0]*this.m[2]+a.m[2]*this.m[3],b=a.m[1]*this.m[2]+a.m[3]*this.m[3],g=a.m[0]*this.m[4]+a.m[2]*this.m[5]+a.m[4],n=a.m[1]*this.m[4]+a.m[3]*this.m[5]+a.m[5];this.m[0]=a.m[0]*this.m[0]+a.m[2]*this.m[1];this.m[1]=c;this.m[2]=d;this.m[3]=b;this.m[4]=g;this.m[5]=n};ib.prototype.invert=function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),c=-this.m[1]*a,d=-this.m[2]*a,b=this.m[0]*a,g=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),n=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=
this.m[3]*a;this.m[1]=c;this.m[2]=d;this.m[3]=b;this.m[4]=g;this.m[5]=n};ib.prototype.getInverted=function(){var a=new ib;return a.m[0]=this.m[0],a.m[1]=this.m[1],a.m[2]=this.m[2],a.m[3]=this.m[3],a.m[4]=this.m[4],a.m[5]=this.m[5],a.invert(),a};ib.prototype.rotate=function(a){var c=Math.cos(a);a=Math.sin(a);var d=this.m[1]*c+this.m[3]*a,b=-(this.m[0]*a)+this.m[2]*c,g=-(this.m[1]*a)+this.m[3]*c;this.m[0]=this.m[0]*c+this.m[2]*a;this.m[1]=d;this.m[2]=b;this.m[3]=g};ib.prototype.rotateAroundPoint=function(a,
c,d){this.translate(c,d);this.rotate(a);this.translate(-c,-d)};ib.prototype.translate=function(a,c){this.m[4]+=this.m[0]*a+this.m[2]*c;this.m[5]+=this.m[1]*a+this.m[3]*c};ib.prototype.scale=function(a,c){this.m[0]*=a;this.m[1]*=a;this.m[2]*=c;this.m[3]*=c};ib.prototype.scaleAroundPoint=function(a,c,d,b){this.translate(d,b);this.scale(a,c);this.translate(-d,-b)};ib.prototype.shear=function(a,c){var d=this.m[1]+this.m[3]*c,b=this.m[2]+this.m[0]*a;a=this.m[3]+this.m[1]*a;this.m[0]+=this.m[2]*c;this.m[1]=
d;this.m[2]=b;this.m[3]=a};ib.prototype.getTransformedPoint=function(a){return{x:a.x*this.m[0]+a.y*this.m[2]+this.m[4],y:a.x*this.m[1]+a.y*this.m[3]+this.m[5]}};ib.prototype.transformPoints=function(a){for(var c=0;c<a.length;c++)a[c]=this.getTransformedPoint(a[c])};ib.prototype.getTranslateX=function(){return this.m[4]};ib.prototype.getTranslateY=function(){return this.m[5]};ib.prototype.clone=function(){var a=new ib;return a.m[0]=this.m[0],a.m[1]=this.m[1],a.m[2]=this.m[2],a.m[3]=this.m[3],a.m[4]=
this.m[4],a.m[5]=this.m[5],a};ib.prototype.getDeterminant=function(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]};ib.prototype.decompose=function(){var a=this.getDeterminant(),c=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return{translate:{x:this.m[4],y:this.m[5]},rotate:Math.sign(this.m[1])*Math.acos(this.m[0]/c),scale:{x:c,y:a/c},shear:{x:Math.atan((this.m[0]*this.m[2]+this.m[1]*this.m[3])/(c*c)),y:0}}};ib.prototype.toString=function(){return"["+this.m[0].toFixed(2)+" "+this.m[2].toFixed(2)+
" "+this.m[4].toFixed(2)+"]\n["+this.m[1].toFixed(2)+" "+this.m[3].toFixed(2)+" "+this.m[5].toFixed(2)+"]\n[0.00 0.00 1.00]"};Math.sign=Math.sign||function(a){return 0==(a*=1)||isNaN(a)?a:0<a?1:-1};ec.prototype.toInt=function(){return Math.max(0,Math.min(255,Math.round(255*this.r)))<<16|Math.max(0,Math.min(255,Math.round(255*this.g)))<<8|Math.max(0,Math.min(255,Math.round(255*this.b)))};ec.prototype.mixWith=function(a,c){this.r=this.r*(1-c)+a.r*c;this.g=this.g*(1-c)+a.g*c;this.b=this.b*(1-c)+a.b*
c};ec.prototype.clone=function(){return new ec(this.r,this.g,this.b)};ec.createFromInt=function(a){return new ec((a>>>16&255)/255,(a>>>8&255)/255,(255&a)/255)};class Dc{paintDab(a,c,d,b,g,n,f){a=Math.max(1,Math.ceil(n.alpha*b.alphaScale));switch(b.paintMode){case ha.PAINT_MODE_FLOW:this._paintFlow(g,c,n.brush,n.width,a);break;case ha.PAINT_MODE_OPACITY:this._paintOpacity(g,c,n.brush,n.width,a)}}mergeOntoImage(a,c,d){let b=this._strokeBuffer.data;var g=this._strokedRegion;c=c.data;let n=a.data,f=d>>
16&255,e=d>>8&255;d&=255;let l=0|g.getWidth(),k=0|g.getHeight(),h=this._strokeBuffer.offsetOfPixel(g.left,g.top);g=a.offsetOfPixel(g.left,g.top);let m=this._strokeBuffer.width-l|0;a=(a.width-l)*z.BYTES_PER_PIXEL|0;for(let r=0;r<k;r++,h+=m,g+=a)for(let t=0;t<l;t++,h++,g+=z.BYTES_PER_PIXEL){var q=b[h]/255+.5|0;if(0<q){let u=q+c[g+z.ALPHA_BYTE_OFFSET]*(255-q)/255|0;q=255*q/u|0;let y=255-q;n[g]=(f*q+c[g]*y)/255&255;n[g+1]=(e*q+c[g+1]*y)/255&255;n[g+2]=(d*q+c[g+2]*y)/255&255;n[g+3]=u}}}mergeOntoMask(a,
c,d){let b=this._strokeBuffer.data;var g=this._strokedRegion;c=c.data;let n=a.data,f=0|g.getWidth(),e=0|g.getHeight(),l=a.offsetOfPixel(g.left,g.top);g=this._strokeBuffer.offsetOfPixel(g.left,g.top);let k=this._strokeBuffer.width-f|0;a=a.width-f|0;for(let h=0;h<e;h++,g+=k,l+=a)for(let m=0;m<f;m++,g++,l++){let q=b[g]/255|0;0<q&&(n[l]=(d*q+c[l]*(255-q))/255)}}_paintFlow(a,c,d,b,g){let n=this._strokeBuffer.data;a=a.left+a.top*b;let f=this._strokeBuffer.offsetOfPixel(c.left,c.top),e=c.getHeight(),l=c.getWidth();
b-=l;let k=this._strokeBuffer.width-l;this._strokedRegion.union(c);for(c=0;c<e;c++,a+=b,f+=k)for(let h=0;h<l;h++,a++,f++){let m=d[a]*g;0!=m&&(n[f]=Math.min(65025,n[f]+(255-n[f]/255)*m/255))}}_paintOpacity(a,c,d,b,g){let n=this._strokeBuffer.data;a=a.left+a.top*b;let f=this._strokeBuffer.offsetOfPixel(c.left,c.top),e=c.getWidth();b-=e;let l=this._strokeBuffer.width-e;g=Math.min(255,g);this._strokedRegion.union(c);for(let k=c.top;k<c.bottom;k++,a+=b,f+=l)for(let h=0;h<e;h++,a++,f++)n[f]=Math.max(d[a]*
g,n[f])}beginStroke(){}endStroke(){}constructor(a,c){this._strokeBuffer=a;this._strokedRegion=c;this.wantsOutputAsInput=!0}}class Lf extends Dc{mergeOntoImage(a,c,d){d=this._strokeBuffer.data;let b=this._strokedRegion;c=c.data;let g=a.data;for(let n=b.top;n<b.bottom;n++){let f=a.offsetOfPixel(b.left,n)+z.ALPHA_BYTE_OFFSET,e=this._strokeBuffer.offsetOfPixel(b.left,n);for(let l=b.left;l<b.right;l++,f+=z.BYTES_PER_PIXEL){let k=d[e++]/255|0;0<k&&(g[f]=c[f]*(255-k)/255)}}}}class Mf extends Dc{mergeOntoImage(a,
c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;let g=b.getWidth(),n=b.getHeight(),f=a.offsetOfPixel(b.left,b.top);b=this._strokeBuffer.offsetOfPixel(b.left,b.top);let e=(a.width-g)*z.BYTES_PER_PIXEL,l=this._strokeBuffer.width-g;c=c.data;a=a.data;for(let h=0;h<n;h++,b+=l,f+=e)for(let m=0;m<g;m++,b++,f+=z.BYTES_PER_PIXEL){var k=d[b]/255|0;0<k&&0!=c[f+z.ALPHA_BYTE_OFFSET]&&(k=(k+255)/255,a[f+z.RED_BYTE_OFFSET]=c[f+z.RED_BYTE_OFFSET]*k,a[f+z.GREEN_BYTE_OFFSET]=c[f+z.GREEN_BYTE_OFFSET]*k,a[f+
z.BLUE_BYTE_OFFSET]=c[f+z.BLUE_BYTE_OFFSET]*k)}}mergeOntoMask(a,c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;let g=b.getWidth(),n=b.getHeight(),f=a.offsetOfPixel(b.left,b.top);b=this._strokeBuffer.offsetOfPixel(b.left,b.top);let e=a.width-g,l=this._strokeBuffer.width-g;c=c.data;a=a.data;for(let k=0;k<n;k++,b+=l,f+=e)for(let h=0;h<g;h++,b++,f++){let m=d[b]/255|0;0<m&&(a[f]=Math.min((m+255)/255*c[f],255))}}}class Nf extends Dc{mergeOntoImage(a,c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;
let g=b.getWidth(),n=b.getHeight(),f=a.offsetOfPixel(b.left,b.top);b=this._strokeBuffer.offsetOfPixel(b.left,b.top);let e=(a.width-g)*z.BYTES_PER_PIXEL,l=this._strokeBuffer.width-g;c=c.data;a=a.data;for(let k=0;k<n;k++,b+=l,f+=e)for(let h=0;h<g;h++,b++,f+=z.BYTES_PER_PIXEL){let m=d[b]/255|0;0<m&&0!=c[f+z.ALPHA_BYTE_OFFSET]&&(a[f+z.RED_BYTE_OFFSET]=c[f+z.RED_BYTE_OFFSET]-(260-c[f+z.RED_BYTE_OFFSET])*m/255|0,a[f+z.GREEN_BYTE_OFFSET]=c[f+z.GREEN_BYTE_OFFSET]-(260-c[f+z.GREEN_BYTE_OFFSET])*m/255|0,a[f+
z.BLUE_BYTE_OFFSET]=c[f+z.BLUE_BYTE_OFFSET]-(260-c[f+z.BLUE_BYTE_OFFSET])*m/255|0)}}mergeOntoMask(a,c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;let g=b.getWidth(),n=b.getHeight(),f=a.offsetOfPixel(b.left,b.top);b=this._strokeBuffer.offsetOfPixel(b.left,b.top);let e=a.width-g,l=this._strokeBuffer.width-g;c=c.data;a=a.data;for(let k=0;k<n;k++,b+=l,f+=e)for(let h=0;h<g;h++,b++,f++){let m=d[b]/255|0;0<m&&(a[f]=Math.max(c[f]-(260-c[f])*m/255,0))}}}class Of extends Dc{mergeOntoImage(a,c,d){d=
this._strokeBuffer.data;let b=this._strokedRegion,g=c.data;a=a.data;var n=b.getWidth();let f=c.width*z.BYTES_PER_PIXEL,e=c.offsetOfPixel(b.left,b.top),l=this._strokeBuffer.offsetOfPixel(b.left,b.top),k=(c.width-n)*z.BYTES_PER_PIXEL;n=this._strokeBuffer.width-n;let h,m,q,r,t=function(y){h+=g[y+z.RED_BYTE_OFFSET];m+=g[y+z.GREEN_BYTE_OFFSET];q+=g[y+z.BLUE_BYTE_OFFSET];r+=g[y+z.ALPHA_BYTE_OFFSET]};for(let y=b.top;y<b.bottom;y++,e+=k,l+=n)for(let A=b.left;A<b.right;A++,e+=z.BYTES_PER_PIXEL,l++){var u=
d[l]/255|0;if(0<u){u=64+-63*u/255|0;let F=u+4;h=u*g[e+z.RED_BYTE_OFFSET];m=u*g[e+z.GREEN_BYTE_OFFSET];q=u*g[e+z.BLUE_BYTE_OFFSET];r=u*g[e+z.ALPHA_BYTE_OFFSET];t(0<y?e-f:e);t(y<c.height-1?e+f:e);t(0<A?e-z.BYTES_PER_PIXEL:e);t(A<c.width-1?e+z.BYTES_PER_PIXEL:e);r/=F;h/=F;m/=F;q/=F;a[e+z.RED_BYTE_OFFSET]=0|h;a[e+z.GREEN_BYTE_OFFSET]=0|m;a[e+z.BLUE_BYTE_OFFSET]=0|q;a[e+z.ALPHA_BYTE_OFFSET]=0|r}}}mergeOntoMask(a,c,d){d=this._strokeBuffer.data;let b=this._strokedRegion,g=c.data;a=a.data;var n=b.getWidth();
let f=c.width,e=c.offsetOfPixel(b.left,b.top),l=this._strokeBuffer.offsetOfPixel(b.left,b.top),k=c.width-n;n=this._strokeBuffer.width-n;for(let q=b.top;q<b.bottom;q++,e+=k,l+=n)for(let r=b.left;r<b.right;r++,e++,l++){var h=d[l]/255|0;if(0<h){var m=64+-63*h/255|0;h=m+4;m=m*g[e]+g[0<q?e-f:e]+g[q<c.height-1?e+f:e]+g[0<r?e-1:e]+g[r<c.width-1?e+1:e];a[e]=m/h|0}}}}class de extends Dc{mergeOntoImage(a,c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;c=c.data;let g=a.data,n=this._strokeBuffer.offsetOfPixel(b.left,
b.top),f=a.offsetOfPixel(b.left,b.top),e=0|b.getWidth();b=0|b.getHeight();let l=this._strokeBuffer.width-e|0;a=(a.width-e)*z.BYTES_PER_PIXEL|0;for(let m=0;m<b;m++,n+=l,f+=a)for(let q=0;q<e;q++,n++,f+=z.BYTES_PER_PIXEL){let r=d[n];var k=r>>>24;if(0<k){var h=c[f+z.ALPHA_BYTE_OFFSET];h=k+h-k*h/255|0;k=255*k/h|0;let t=255-k;g[f]=((r>>16&255)*k+c[f]*t)/255|0;g[f+1]=((r>>8&255)*k+c[f+1]*t)/255|0;g[f+2]=((255&r)*k+c[f+2]*t)/255|0;g[f+3]=h}}}mergeOntoMask(a,c,d){d=this._strokeBuffer.data;var b=this._strokedRegion;
c=c.data;let g=a.data,n=this._strokeBuffer.offsetOfPixel(b.left,b.top),f=a.offsetOfPixel(b.left,b.top),e=0|b.getWidth();b=0|b.getHeight();let l=this._strokeBuffer.width-e|0;a=a.width-e|0;for(let k=0;k<b;k++,n+=l,f+=a)for(let h=0;h<e;h++,n++,f++){let m=d[n],q=m>>8;0<q&&(g[f]=((255&m)*q+c[f]*(255-q))/255|0)}}}let bf=2/6;class Qc extends de{static _sampleGrey(a,c,d,b,g){c|=0;d|=0;let n=[{x:c,y:d}];for(let f=.25;1.001>f;f+=.25)Array.prototype.push.apply(n,[{x:~~(c+f*b),y:d},{x:~~(c-f*b),y:d},{x:c,y:~~(d+
f*g)},{x:c,y:~~(d-f*g)},{x:~~(c+.7*f*b),y:~~(d+.7*f*g)},{x:~~(c+.7*f*b),y:~~(d-.7*f*g)},{x:~~(c-.7*f*b),y:~~(d+.7*f*g)},{x:~~(c-.7*f*b),y:~~(d-.7*f*g)}]);return pe(n.map(f=>a.getPixel(f.x,f.y)))}static _sampleRGB(a,c,d,b,g){c|=0;d|=0;let n=[{x:c,y:d}];for(let f=.25;1.001>f;f+=.25)Array.prototype.push.apply(n,[{x:~~(c+f*b),y:d},{x:~~(c-f*b),y:d},{x:c,y:~~(d+f*g)},{x:c,y:~~(d-f*g)},{x:~~(c+.7*f*b),y:~~(d+.7*f*g)},{x:~~(c+.7*f*b),y:~~(d-.7*f*g)},{x:~~(c-.7*f*b),y:~~(d+.7*f*g)},{x:~~(c-.7*f*b),y:~~(d-
.7*f*g)}]);return qe(n.map(f=>ec.createFromInt(a.getPixel(f.x,f.y))))}_paintToColorStrokeBuffer(a,c,d,b,g,n){let f=this._strokeBuffer.data,e=c.getWidth(),l=c.getHeight(),k=this._strokeBuffer.width-e,h=b-e;a=a.left+a.top*b;b=this._strokeBuffer.offsetOfPixel(c.left,c.top);this._strokedRegion.union(c);for(c=0;c<l;c++,a+=h,b+=k)for(let r=0;r<e;r++,a++,b++){var m=d[a]*g/255|0;if(0<m){let t=f[b];var q=t>>>24;q=m+q-m*q/255|0;m=255-(255*m/q|0);f[b]=q<<24|(n>>16&255)+((t>>16&255)*m-(n>>16&255)*m)/255<<16|
(n>>8&255)+((t>>8&255)*m-(n>>8&255)*m)/255<<8|(255&n)+((255&t)*m-(255&n)*m)/255}}}_paintToGreyscaleStrokeBuffer(a,c,d,b,g,n){let f=this._strokeBuffer.data;this._strokedRegion.union(c);for(let k=c.top,h=a.top;k<c.bottom;k++,h++){let m=a.left+h*b,q=this._strokeBuffer.offsetOfPixel(c.left,k);for(let r=c.left;r<c.right;r++,m++,q++){var e=d[m]*g/255|0;if(0>=e)continue;let t=f[q];var l=t>>8;l=e+l-e*l/255|0;0<l&&(e=255-(255*e/l|0),f[q]=l<<8|n+((255&t)*e-n*e)/255)}}}beginStroke(){this._previousSamples=null}paintDab(a,
c,d,b,g,n,f){var e,l;a=Math.max(1,n.alpha/4);var k=(c.left+c.right)/2,h=(c.top+c.bottom)/2,m=Math.max(1,Math.min(64,c.getWidth()*bf)),q=Math.max(1,Math.min(64,c.getHeight()*bf));if(d instanceof ya){null==this._previousSamples&&(this._previousSamples=Array(50),this._previousSamples.fill(Qc._sampleGrey(d,k,h,m,q)));let t=pe(this._previousSamples);var r=t;f=r=t=r*(1-(e=b.resat*b.resat))+(255&f)*e;d=Qc._sampleGrey(d,k,h,m,q);t=f*(1-(l=b.bleed))+d*l;this._previousSamples.push(t);this._previousSamples.shift();
this._paintToGreyscaleStrokeBuffer(g,c,n.brush,n.width,a,Math.round(r))}else null==this._previousSamples&&(this._previousSamples=Array(50),this._previousSamples.fill(Qc._sampleRGB(d,k,h,m,q))),l=qe(this._previousSamples),l.mixWith(ec.createFromInt(f),b.resat*b.resat),f=l.toInt(),l.mixWith(Qc._sampleRGB(d,k,h,m,q),b.bleed),this._previousSamples.push(l),this._previousSamples.shift(),this._paintToColorStrokeBuffer(g,c,n.brush,n.width,a,f)}constructor(a,c){super(a,c);this.wantsOutputAsInput=!0}}class Qf extends de{_accumulatePaintFromMask(a,
c,d,b){let g=this._brushBuffer.data,n=a.data,f=d.getWidth(),e=d.getHeight();c=c.left+c.top*this._brushBuffer.width;d=a.offsetOfPixel(d.left,d.top);let l=this._brushBuffer.width-f;a=a.width-f;if(!(0>=b))for(let h=0;h<e;h++,c+=l,d+=a)for(let m=0;m<f;m++,c++,d++){let q=n[d],r=g[c];var k=r>>8;k=b+k-b*k/255|0;let t=255-(255*b/k|0);g[c]=k<<8|q+((255&r)*t-q*t)/255}}_resaturateBrushWithGrey(a,c,d){if(!(0>=c)){var b=this._brushBuffer.data,g=a.getWidth(),n=a.getHeight();a=a.left+a.top*this._brushBuffer.width;
var f=this._brushBuffer.width-g;for(let l=0;l<n;l++,a+=f)for(let k=0;k<g;k++,a++){let h=b[a];var e=h>>8;e=c+e-c*e/255|0;let m=255-(255*c/e|0);b[a]=e<<8|d+((255&h)*m-d*m)/255}}}_paintToGreyscaleStrokeBuffer(a,c,d,b,g){let n=this._strokeBuffer.data,f=this._brushBuffer.data,e=a.data;this._strokedRegion.union(d);for(let k=d.top,h=c.top;k<d.bottom;k++,h++){let m=this._brushBuffer.offsetOfPixel(c.left,h),q=this._strokeBuffer.offsetOfPixel(d.left,k),r=a.offsetOfPixel(d.left,k);for(let t=d.left;t<d.right;t++,
m++,r++,q++){let u=f[m];var l=(u>>8)*b[m]*g/65025|0;0<l&&(l=255-l,n[q]=65280|(255&u)+(e[r]*l-(255&u)*l)/255)}}}_accumulatePaintFromImage(a,c,d,b){let g=this._brushBuffer.data,n=a.data,f=d.getWidth(),e=d.getHeight();c=c.left+c.top*this._brushBuffer.width;d=a.offsetOfPixel(d.left,d.top);let l=this._brushBuffer.width-f;a=(a.width-f)*z.BYTES_PER_PIXEL;for(let m=0;m<e;m++,c+=l,d+=a)for(let q=0;q<f;q++,c++,d+=z.BYTES_PER_PIXEL){var k=n[d+z.ALPHA_BYTE_OFFSET]*b/255|0;if(0<k){let r=g[c];var h=r>>>24;h=k+
h-k*h/255|0;k=255-(255*k/h|0);let t=n[d+z.RED_BYTE_OFFSET],u=n[d+z.GREEN_BYTE_OFFSET],y=n[d+z.BLUE_BYTE_OFFSET];g[c]=h<<24|t+((r>>16&255)*k-t*k)/255<<16|u+((r>>8&255)*k-u*k)/255<<8|y+((255&r)*k-y*k)/255}}}_resaturateBrushWithColor(a,c,d){if(!(0>=c)){var b=this._brushBuffer.data,g=a.getWidth(),n=a.getHeight();a=a.left+a.top*this._brushBuffer.width;var f=this._brushBuffer.width-g;for(let l=0;l<n;l++,a+=f)for(let k=0;k<g;k++,a++){let h=b[a];var e=h>>>24;e=c+e-c*e/255|0;let m=255-(255*c/e|0);b[a]=e<<
24|(d>>>16&255)+((h>>>16&255)*m-(d>>>16&255)*m)/255<<16|(d>>>8&255)+((h>>>8&255)*m-(d>>>8&255)*m)/255<<8|(255&d)+((255&h)*m-(255&d)*m)/255}}}_paintToColorStrokeBuffer(a,c,d,b,g){let n=this._strokeBuffer.data,f=this._brushBuffer.data,e=a.data;this._strokedRegion.union(d);for(let h=d.top,m=c.top;h<d.bottom;h++,m++){let q=this._brushBuffer.offsetOfPixel(c.left,m),r=this._strokeBuffer.offsetOfPixel(d.left,h),t=a.offsetOfPixel(d.left,h);for(let u=d.left;u<d.right;u++,q++,t+=z.BYTES_PER_PIXEL,r++){let y=
f[q];var l=(y>>>24)*b[q]*g/65025|0;if(0<l){var k=e[t+z.ALPHA_BYTE_OFFSET];k=l+k-l*k/255|0;l=255-(255*l/k|0);n[r]=k<<24|(y>>16&255)+(e[t+z.RED_BYTE_OFFSET]*l-(y>>16&255)*l)/255<<16|(y>>8&255)+(e[t+z.GREEN_BYTE_OFFSET]*l-(y>>8&255)*l)/255<<8|(255&y)+(e[t+z.BLUE_BYTE_OFFSET]*l-(255&y)*l)/255}}}}paintDab(a,c,d,b,g,n,f){a instanceof z?null==this._brushBuffer?(this._brushBuffer=new ya(n.width,n.height,32),this._accumulatePaintFromImage(d,g,c,255)):(this._resaturateBrushWithColor(g,~~(0>=b.resat?0:Math.max(1,
b.resat*b.resat*255)),16777215&f),this._paintToColorStrokeBuffer(a,g,c,n.brush,n.alpha),this._accumulatePaintFromImage(d,g,c,~~(255*b.bleed))):null==this._brushBuffer?(this._brushBuffer=new ya(n.width,n.height,16),this._accumulatePaintFromMask(d,g,c,255)):(this._resaturateBrushWithGrey(g,~~(0>=b.resat?0:Math.max(1,b.resat*b.resat*255)),255&f),this._paintToGreyscaleStrokeBuffer(a,g,c,n.brush,n.alpha),this._accumulatePaintFromMask(d,g,c,~~(255*b.bleed)))}endStroke(){this._brushBuffer=null}constructor(a,
c){super(a,c);this.wantsOutputAsInput=!0}}class Pf extends de{_sampleFromMask(a,c,d,b){let g=this._brushBuffer.data,n=c.getWidth(),f=c.getHeight(),e=this._brushBuffer.offsetOfPixel(c.left,c.top);d=a.offsetOfPixel(d.left,d.top);let l=this._brushBuffer.width-n,k=a.width-n,h=255-b;if(255!=b){for(let m=0;m<f;m++,e+=l,d+=k)for(let q=0;q<n;q++,e++,d++){let r=a.data[d],t=g[e],u=(r*h+(255&t)*b)/255,y=(255*h+(t>>8)*b)/255<<8|u;y==t&&(r>u?y++:r<u&&y--);g[e]=y}re(this._brushBuffer,c)}}_paintToMask(a,c,d,b){let g=
c.getWidth(),n=c.getHeight();c=this._brushBuffer.offsetOfPixel(c.left,c.top);d=a.offsetOfPixel(d.left,d.top);let f=this._brushBuffer.width-g,e=a.width-g;a=a.data;let l=this._brushBuffer.data;for(let k=0;k<n;k++,d+=e,c+=f)for(let h=0;h<g;h++,c++,d++){let m=l[c],q=255&m;0<((m>>8)*b[c]/255|0)&&(a[d]=q)}}_sampleFromImage(a,c,d,b){let g=this._brushBuffer.data,n=c.getWidth(),f=c.getHeight(),e=this._brushBuffer.offsetOfPixel(c.left,c.top);d=a.offsetOfPixel(d.left,d.top);let l=this._brushBuffer.width-n,k=
(a.width-n)*z.BYTES_PER_PIXEL,h=255-b;if(255!=b){for(let q=0;q<f;q++,e+=l,d+=k)for(let r=0;r<n;r++,e++,d+=z.BYTES_PER_PIXEL){let t=a.data[d+z.RED_BYTE_OFFSET],u=a.data[d+z.GREEN_BYTE_OFFSET],y=a.data[d+z.BLUE_BYTE_OFFSET];var m=g[e];let A=(a.data[d+z.ALPHA_BYTE_OFFSET]*h+(m>>24&255)*b)/255<<24&4278190080|(t*h+(m>>16&255)*b)/255<<16&16711680|(u*h+(m>>8&255)*b)/255<<8&65280|(y*h+(255&m)*b)/255&255;if(A==m){m=(16711680&A)>>16;let F=(65280&A)>>8,D=255&A;t>m?A+=65536:t<m&&(A-=65536);u>F?A+=256:u<F&&(A-=
256);y>D?A+=1:y<D&&--A}g[e]=A}re(this._brushBuffer,c)}}_paintToImage(a,c,d,b){let g=c.getWidth(),n=c.getHeight();c=this._brushBuffer.offsetOfPixel(c.left,c.top);d=a.offsetOfPixel(d.left,d.top);let f=this._brushBuffer.width-g,e=(a.width-g)*z.BYTES_PER_PIXEL;a=a.data;let l=this._brushBuffer.data;for(let k=0;k<n;k++,d+=e,c+=f)for(let h=0;h<g;h++,c++,d+=z.BYTES_PER_PIXEL){let m=l[c];0<((m>>>24)*b[c]/255|0)&&(a[d+z.RED_BYTE_OFFSET]=m>>16&255,a[d+z.GREEN_BYTE_OFFSET]=m>>8&255,a[d+z.BLUE_BYTE_OFFSET]=255&
m,a[d+z.ALPHA_BYTE_OFFSET]=m>>24&255)}}paintDab(a,c,d,b,g,n,f){a instanceof z?null==this._brushBuffer?(this._brushBuffer=new ya(n.width,n.height,32),this._sampleFromImage(d,g,c,0)):(this._sampleFromImage(d,g,c,n.alpha),this._paintToImage(a,g,c,n.brush)):null==this._brushBuffer?(this._brushBuffer=new ya(n.width,n.height,16),this._sampleFromMask(d,g,c,0)):(this._sampleFromMask(d,g,c,n.alpha),this._paintToMask(a,g,c,n.brush))}mergeOntoImage(a,c,d){}mergeOntoMask(a,c,d){}beginStroke(){this._brushBuffer=
null}endStroke(){this._brushBuffer=null}constructor(a,c){super(a,c);this._brushBuffer=null;this.noMergePhase=this.wantsOutputAsInput=!0}}"use strict";"use strict";Pb.prototype=Object.create(Ha(Ab).prototype);Pb.prototype.constructor=Pb;Pb.prototype.getBounds=function(){return new ka(0,0,this.width,this.height)};Pb.prototype.isPointWithin=function(a,c){return 0<=a&&0<=c&&a<this.width&&c<this.height};Pb.EDITING_MODE_IMAGE=0;Pb.EDITING_MODE_MASK=1;Va.prototype.readChar=function(){return this.pos<this.end?
String.fromCharCode(this.data[this.pos++]):(this.eof=!0,-1)};Va.prototype.readByte=function(){return this.pos<this.end?this.data[this.pos++]:(this.eof=!0,-1)};Va.prototype.readU8=Va.prototype.readByte;Va.prototype.readS8=function(){var a;return 128&(a=this.readByte())?4294967040|a:a};Va.prototype.unreadChar=function(a){this.pos--};Va.prototype.peekChar=function(){return this.pos<this.end?String.fromCharCode(this.data[this.pos]):(this.eof=!0,-1)};Va.prototype.readString=function(a){var c,d=Array(a);
for(c=0;c<a;c++)d[c]=this.readChar();return d.join("")};Va.prototype.readS16=function(){var a;return 32768&(a=this.readByte()<<8|this.readByte())?4294901760|a:a};Va.prototype.readU16BE=function(){return this.readByte()<<8|this.readByte()};Va.prototype.readU16LE=function(){var a=this.readByte();return this.readByte()<<8|a};Va.prototype.readU32BE=function(){return(this.readByte()<<24|this.readByte()<<16|this.readByte()<<8|this.readByte())>>>0};Va.prototype.readU32LE=function(){var a=this.readByte(),
c=this.readByte(),d=this.readByte();return(this.readByte()<<24|d<<16|c<<8|a)>>>0};Va.prototype.readBytes=function(a){var c=this.data.subarray(this.pos,this.pos+a);return this.pos+=a,this.pos>this.end&&(this.eof=!0),c};Va.prototype.skip=function(a){this.pos+=a;this.pos>this.end&&(this.eof=!0)};Va.prototype.seek=function(a){this.pos=a};Va.prototype.writeBytes=function(a){for(var c=0;c<a.length;c++)this.data[this.pos++]=a[c]};Va.prototype.writeByte=function(a){this.data[this.pos++]=a};Va.prototype.writeU8=
Va.prototype.writeByte;Va.prototype.writeU16LE=function(a){this.data[this.pos++]=a;this.data[this.pos++]=a>>8};Va.prototype.writeU16BE=function(a){this.data[this.pos++]=a>>8;this.data[this.pos++]=a};Va.prototype.writeU32BE=function(a){this.data[this.pos++]=a>>24;this.data[this.pos++]=a>>16;this.data[this.pos++]=a>>8;this.data[this.pos++]=a};Va.prototype.writeU32LE=function(a){this.data[this.pos++]=a;this.data[this.pos++]=a>>8;this.data[this.pos++]=a>>16;this.data[this.pos++]=a>>24};Va.prototype.writeDoubleBE=
function(a){a=new Uint8Array((new Float64Array([a])).buffer);for(var c=a.length-1;0<=c;c--)this.writeByte(a[c])};Va.prototype.writeFloatBE=function(a){a=new Uint8Array((new Float32Array([a])).buffer);for(var c=a.length-1;0<=c;c--)this.writeByte(a[c])};Va.prototype.writeString=function(a){for(var c=0;c<a.length;c++)this.data[this.pos++]=a.charCodeAt(c)};Va.prototype.writeUnsignedIntBE=function(a,c){switch(void 0===c&&(c=this.measureUnsignedInt(a)),c){case 5:this.writeU8(Math.floor(a/4294967296));case 4:this.writeU8(a>>
24);case 3:this.writeU8(a>>16);case 2:this.writeU8(a>>8);case 1:this.writeU8(a);break;default:throw"Bad UINT size "+c;}};Va.prototype.measureUnsignedInt=function(a){return 256>a?1:65536>a?2:16777216>a?3:4294967296>a?4:5};Va.prototype.getAsDataArray=function(){if(this.pos<this.data.byteLength)return this.data.subarray(0,this.pos);if(this.pos==this.data.byteLength)return this.data;throw"ArrayDataStream's pos lies beyond end of buffer";};Va.prototype.EOF=-1;var Wd={},za={},ng="undefined"!=typeof Uint8Array&&
"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;za.assign=function(a){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var d=c.shift();if(d){if("object"!=typeof d)throw TypeError(d+"must be non-object");for(var b in d)Object.prototype.hasOwnProperty.call(d,b)&&(a[b]=d[b])}}return a};za.shrinkBuf=function(a,c){return a.length===c?a:a.subarray?a.subarray(0,c):(a.length=c,a)};"use strict";"use strict";"use strict";var og={arraySet:function(a,c,d,b,g){if(c.subarray&&a.subarray)a.set(c.subarray(d,
d+b),g);else for(var n=0;n<b;n++)a[g+n]=c[d+n]},flattenChunks:function(a){var c,d;var b=c=0;for(d=a.length;c<d;c++)b+=a[c].length;c=0;var g=new Uint8Array(b);b=0;for(d=a.length;c<d;c++){var n=a[c];g.set(n,b);b+=n.length}return g}},pg={arraySet:function(a,c,d,b,g){for(var n=0;n<b;n++)a[g+n]=c[d+n]},flattenChunks:function(a){return[].concat.apply([],a)}};za.setTyped=function(a){a?(za.Buf8=Uint8Array,za.Buf16=Uint16Array,za.Buf32=Int32Array,za.assign(za,og)):(za.Buf8=Array,za.Buf16=Array,za.Buf32=Array,
za.assign(za,pg))};za.setTyped(ng);var qg=za.assign,$c={};ic($c,"Deflate",function(){return cf},function(a){return cf=a});ic($c,"deflate",function(){return df},function(a){return df=a});ic($c,"deflateRaw",function(){return ef},function(a){return ef=a});ic($c,"gzip",function(){return ff},function(a){return ff=a});var Md=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],gd=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],rg=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],gf=[16,
17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],gc=Array(576);Ec(gc);var ad=Array(60);Ec(ad);var Rc=Array(512);Ec(Rc);var Tc=Array(256);Ec(Tc);var Nd=Array(29);Ec(Nd);var hd=Array(30);Ec(hd);var hf=!1;"use strict";var Tf=function(a){if(!hf){var c,d,b=Array(16);for(c=d=0;28>d;d++){var g=0;for(Nd[d]=c;g<1<<Md[d];g++)Tc[c++]=d}Tc[c-1]=d;for(d=c=0;16>d;d++)for(g=0,hd[d]=c;g<1<<gd[d];g++)Rc[c++]=d;for(c>>=7;30>d;d++)for(g=0,hd[d]=c<<7;g<1<<gd[d]-7;g++)Rc[256+c++]=d;for(g=0;15>=g;g++)b[g]=0;for(g=0;143>=g;)gc[2*
g+1]=8,g++,b[8]++;for(;255>=g;)gc[2*g+1]=9,g++,b[9]++;for(;279>=g;)gc[2*g+1]=7,g++,b[7]++;for(;287>=g;)gc[2*g+1]=8,g++,b[8]++;ve(gc,287,b);for(g=0;30>g;g++)ad[2*g+1]=5,ad[2*g]=ue(g,5);Ze=new Jd(gc,Md,257,286,15);$e=new Jd(ad,gd,0,30,15);af=new Jd([],rg,0,19,7);!0;hf=!0}a.l_desc=new Kd(a.dyn_ltree,Ze);a.d_desc=new Kd(a.dyn_dtree,$e);a.bl_desc=new Kd(a.bl_tree,af);a.bi_buf=0;a.bi_valid=0;we(a)};var Rf=function(a,c,d,b){var g,n,f=0;0<a.level?(2===a.strm.data_type&&(a.strm.data_type=function(e){var l,
k=4093624447;for(l=0;31>=l;l++,k>>>=1)if(1&k&&0!==e.dyn_ltree[2*l])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(l=32;256>l;l++)if(0!==e.dyn_ltree[2*l])return 1;return 0}(a)),Od(a,a.l_desc),Od(a,a.d_desc),f=function(e){var l;Ae(e,e.dyn_ltree,e.l_desc.max_code);Ae(e,e.dyn_dtree,e.d_desc.max_code);Od(e,e.bl_desc);for(l=18;3<=l&&0===e.bl_tree[2*gf[l]+1];l--);return e.opt_len+=3*(l+1)+14,l}(a),g=a.opt_len+3+7>>>3,(n=a.static_len+3+7>>>3)<=g&&(g=n)):g=n=d+5;d+4<=
g&&-1!==c?Ce(a,c,d,b):4===a.strategy||n===g?(Rb(a,2+ +!!b,3),ze(a,gc,ad)):(Rb(a,4+ +!!b,3),function(e,l,k,h){var m;Rb(e,l-257,5);Rb(e,k-1,5);Rb(e,h-4,4);for(m=0;m<h;m++)Rb(e,e.bl_tree[2*gf[m]+1],3);Be(e,e.dyn_ltree,l-1);Be(e,e.dyn_dtree,k-1)}(a,a.l_desc.max_code+1,a.d_desc.max_code+1,f+1),ze(a,a.dyn_ltree,a.dyn_dtree));we(a);b&&xe(a)};var mc=function(a,c,d){return a.pending_buf[a.d_buf+2*a.last_lit]=c>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&c,a.pending_buf[a.l_buf+a.last_lit]=255&d,a.last_lit++,
0===c?a.dyn_ltree[2*d]++:(a.matches++,c--,a.dyn_ltree[2*(Tc[d]+256+1)]++,a.dyn_dtree[2*te(c)]++),a.last_lit===a.lit_bufsize-1};var sg=function(a){Rb(a,2,3);bc(a,256,gc);16===a.bi_valid?(Sc(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):8<=a.bi_valid&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)};"use strict";var Fc={};Fc=function(a,c,d,b){var g=65535&a|0;a=a>>>16&65535|0;for(var n;0!==d;){n=2E3<d?2E3:d;d-=n;do a=a+(g=g+c[b++]|0)|0;while(--n);g%=65521;a%=65521}return g|a<<16|0};"use strict";
var Db={},tg=function(){for(var a,c=[],d=0;256>d;d++){a=d;for(var b=0;8>b;b++)a=1&a?3988292384^a>>>1:a>>>1;c[d]=a}return c}();Db=function(a,c,d,b){d=b+d;for(a^=-1;b<d;b++)a=a>>>8^tg[(a^c[b])&255];return-1^a};var vc={};vc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};var Vc=[new cc(0,0,0,0,function(a,c){var d=65535;for(65535>a.pending_buf_size-5&&(d=a.pending_buf_size-5);;){if(1>=
a.lookahead){if(wc(a),0===a.lookahead&&0===c)return 1;if(0===a.lookahead)break}a.strstart+=a.lookahead;a.lookahead=0;var b=a.block_start+d;if((0===a.strstart||a.strstart>=b)&&(a.lookahead=a.strstart-b,a.strstart=b,Ib(a,!1),0===a.strm.avail_out)||a.strstart-a.block_start>=a.w_size-262&&(Ib(a,!1),0===a.strm.avail_out))return 1}return(a.insert=0,4===c)?(Ib(a,!0),0===a.strm.avail_out)?3:4:(a.strstart>a.block_start&&(Ib(a,!1),a.strm.avail_out),1)}),new cc(4,4,8,4,Pd),new cc(4,5,16,8,Pd),new cc(4,6,32,
32,Pd),new cc(4,4,16,16,Gc),new cc(8,16,32,32,Gc),new cc(8,16,128,128,Gc),new cc(8,32,128,256,Gc),new cc(32,128,258,1024,Gc),new cc(32,258,258,4096,Gc)];"use strict";var ug=function(a,c){if(!a||!a.state||5<c||0>c)return a?jc(a,-2):-2;if(b=a.state,!a.output||!a.input&&0!==a.avail_in||666===b.status&&4!==c)return jc(a,0===a.avail_out?-5:-2);if(b.strm=a,d=b.last_flush,b.last_flush=c,42===b.status)if(2===b.wrap)a.adler=0,ab(b,31),ab(b,139),ab(b,8),b.gzhead?(ab(b,+!!b.gzhead.text+2*!!b.gzhead.hcrc+4*!!b.gzhead.extra+
8*!!b.gzhead.name+16*!!b.gzhead.comment),ab(b,255&b.gzhead.time),ab(b,b.gzhead.time>>8&255),ab(b,b.gzhead.time>>16&255),ab(b,b.gzhead.time>>24&255),ab(b,9===b.level?2:4*(2<=b.strategy||2>b.level)),ab(b,255&b.gzhead.os),b.gzhead.extra&&b.gzhead.extra.length&&(ab(b,255&b.gzhead.extra.length),ab(b,b.gzhead.extra.length>>8&255)),b.gzhead.hcrc&&(a.adler=Db(a.adler,b.pending_buf,b.pending,0)),b.gzindex=0,b.status=69):(ab(b,0),ab(b,0),ab(b,0),ab(b,0),ab(b,0),ab(b,9===b.level?2:4*(2<=b.strategy||2>b.level)),
ab(b,3),b.status=113);else{var d,b;var g=8+(b.w_bits-8<<4)<<8;g|=(2<=b.strategy||2>b.level?0:6>b.level?1:6===b.level?2:3)<<6;0!==b.strstart&&(g|=32);b.status=113;Uc(b,g+(31-g%31));0!==b.strstart&&(Uc(b,a.adler>>>16),Uc(b,65535&a.adler));a.adler=1}if(69===b.status)if(b.gzhead.extra){for(g=b.pending;b.gzindex<(65535&b.gzhead.extra.length)&&(b.pending!==b.pending_buf_size||(b.gzhead.hcrc&&b.pending>g&&(a.adler=Db(a.adler,b.pending_buf,b.pending-g,g)),lc(a),g=b.pending,b.pending!==b.pending_buf_size));)ab(b,
255&b.gzhead.extra[b.gzindex]),b.gzindex++;b.gzhead.hcrc&&b.pending>g&&(a.adler=Db(a.adler,b.pending_buf,b.pending-g,g));b.gzindex===b.gzhead.extra.length&&(b.gzindex=0,b.status=73)}else b.status=73;if(73===b.status)if(b.gzhead.name){g=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>g&&(a.adler=Db(a.adler,b.pending_buf,b.pending-g,g)),lc(a),g=b.pending,b.pending===b.pending_buf_size)){var n=1;break}n=b.gzindex<b.gzhead.name.length?255&b.gzhead.name.charCodeAt(b.gzindex++):
0;ab(b,n)}while(0!==n);b.gzhead.hcrc&&b.pending>g&&(a.adler=Db(a.adler,b.pending_buf,b.pending-g,g));0===n&&(b.gzindex=0,b.status=91)}else b.status=91;if(91===b.status)if(b.gzhead.comment){g=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>g&&(a.adler=Db(a.adler,b.pending_buf,b.pending-g,g)),lc(a),g=b.pending,b.pending===b.pending_buf_size)){n=1;break}n=b.gzindex<b.gzhead.comment.length?255&b.gzhead.comment.charCodeAt(b.gzindex++):0;ab(b,n)}while(0!==n);b.gzhead.hcrc&&b.pending>
g&&(a.adler=Db(a.adler,b.pending_buf,b.pending-g,g));0===n&&(b.status=103)}else b.status=103;if(103===b.status&&(b.gzhead.hcrc?(b.pending+2>b.pending_buf_size&&lc(a),b.pending+2<=b.pending_buf_size&&(ab(b,255&a.adler),ab(b,a.adler>>8&255),a.adler=0,b.status=113)):b.status=113),0!==b.pending){if(lc(a),0===a.avail_out)return b.last_flush=-1,0}else if(0===a.avail_in&&(c<<1)-9*(4<c)<=(d<<1)-9*(4<d)&&4!==c)return jc(a,-5);if(666===b.status&&0!==a.avail_in)return jc(a,-5);if(0!==a.avail_in||0!==b.lookahead||
0!==c&&666!==b.status){d=2===b.strategy?function(f,e){for(var l;;){if(0===f.lookahead&&(wc(f),0===f.lookahead)){if(0===e)return 1;break}if(f.match_length=0,l=mc(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++,l&&(Ib(f,!1),0===f.strm.avail_out))return 1}return(f.insert=0,4===e)?(Ib(f,!0),0===f.strm.avail_out)?3:4:f.last_lit&&(Ib(f,!1),0===f.strm.avail_out)?1:2}(b,c):3===b.strategy?function(f,e){for(var l,k,h,m,q=f.window;;){if(258>=f.lookahead){if(wc(f),258>=f.lookahead&&0===e)return 1;if(0===
f.lookahead)break}if(f.match_length=0,3<=f.lookahead&&0<f.strstart&&(k=q[h=f.strstart-1])===q[++h]&&k===q[++h]&&k===q[++h]){for(m=f.strstart+258;k===q[++h]&&k===q[++h]&&k===q[++h]&&k===q[++h]&&k===q[++h]&&k===q[++h]&&k===q[++h]&&k===q[++h]&&h<m;);f.match_length=258-(m-h);f.match_length>f.lookahead&&(f.match_length=f.lookahead)}if(3<=f.match_length?(l=mc(f,1,f.match_length-3),f.lookahead-=f.match_length,f.strstart+=f.match_length,f.match_length=0):(l=mc(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++),
l&&(Ib(f,!1),0===f.strm.avail_out))return 1}return(f.insert=0,4===e)?(Ib(f,!0),0===f.strm.avail_out)?3:4:f.last_lit&&(Ib(f,!1),0===f.strm.avail_out)?1:2}(b,c):Vc[b.level].func(b,c);if((3===d||4===d)&&(b.status=666),1===d||3===d)return 0===a.avail_out&&(b.last_flush=-1),0;if(2===d&&(1===c?sg(b):5!==c&&(Ce(b,0,0,!1),3===c&&(kc(b.head),0===b.lookahead&&(b.strstart=0,b.block_start=0,b.insert=0))),lc(a),0===a.avail_out))return b.last_flush=-1,0}return 4!==c?0:0>=b.wrap?1:(2===b.wrap?(ab(b,255&a.adler),
ab(b,a.adler>>8&255),ab(b,a.adler>>16&255),ab(b,a.adler>>24&255),ab(b,255&a.total_in),ab(b,a.total_in>>8&255),ab(b,a.total_in>>16&255),ab(b,a.total_in>>24&255)):(Uc(b,a.adler>>>16),Uc(b,65535&a.adler)),lc(a),0<b.wrap&&(b.wrap=-b.wrap),+(0===b.pending))};var vg=function(a){var c;return a&&a.state?42!==(c=a.state.status)&&69!==c&&73!==c&&91!==c&&103!==c&&113!==c&&666!==c?jc(a,-2):(a.state=null,113===c?jc(a,-3):0):-2};var Uf=function(a,c){var d,b,g;var n=c.length;if(!a||!a.state||2===(b=(d=a.state).wrap)||
1===b&&42!==d.status||d.lookahead)return-2;1===b&&(a.adler=Fc(a.adler,c,n,0));d.wrap=0;n>=d.w_size&&(0===b&&(kc(d.head),d.strstart=0,d.block_start=0,d.insert=0),g=new za.Buf8(d.w_size),za.arraySet(g,c,n-d.w_size,d.w_size,0),c=g,n=d.w_size);g=a.avail_in;var f=a.next_in;var e=a.input;a.avail_in=n;a.next_in=0;a.input=c;for(wc(d);3<=d.lookahead;){c=d.strstart;n=d.lookahead-2;do d.ins_h=(d.ins_h<<d.hash_shift^d.window[c+3-1])&d.hash_mask,d.prev[c&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=c,c++;while(--n);
d.strstart=c;d.lookahead=2;wc(d)}return d.strstart+=d.lookahead,d.block_start=d.strstart,d.insert=d.lookahead,d.lookahead=0,d.match_length=d.prev_length=2,d.match_available=0,a.next_in=f,a.input=e,a.avail_in=g,d.wrap=b,0};var Ge=!0,Fe=!0;try{String.fromCharCode.apply(null,[0])}catch(a){Ge=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(a){Fe=!1}for(var bd=new za.Buf8(256),nc=0;256>nc;nc++)bd[nc]=252<=nc?6:248<=nc?5:240<=nc?4:224<=nc?3:192<=nc?2:1;"use strict";bd[254]=bd[254]=1;var Rd=
function(a){var c,d,b,g=a.length,n=0;for(b=0;b<g;b++)55296==(64512&(c=a.charCodeAt(b)))&&b+1<g&&56320==(64512&(d=a.charCodeAt(b+1)))&&(c=65536+(c-55296<<10)+(d-56320),b++),n+=128>c?1:2048>c?2:65536>c?3:4;var f=0;var e=new za.Buf8(n);for(b=0;f<n;b++)55296==(64512&(c=a.charCodeAt(b)))&&b+1<g&&56320==(64512&(d=a.charCodeAt(b+1)))&&(c=65536+(c-55296<<10)+(d-56320),b++),128>c?e[f++]=c:(2048>c?e[f++]=192|c>>>6:(65536>c?e[f++]=224|c>>>12:(e[f++]=240|c>>>18,e[f++]=128|c>>>12&63),e[f++]=128|c>>>6&63),e[f++]=
128|63&c);return e};var wg=function(a){for(var c=new za.Buf8(a.length),d=0,b=c.length;d<b;d++)c[d]=a.charCodeAt(d);return c};var xg=function(a,c){var d,b,g,n=c||a.length,f=Array(2*n);for(c=d=0;c<n;)if(128>(b=a[c++]))f[d++]=b;else if(4<(g=bd[b]))f[d++]=65533,c+=g-1;else{for(b&=2===g?31:3===g?15:7;1<g&&c<n;)b=b<<6|63&a[c++],g--;1<g?f[d++]=65533:65536>b?f[d++]=b:(b-=65536,f[d++]=55296|b>>10&1023,f[d++]=56320|1023&b)}return Ee(f,d)};var yg=function(a,c){var d;(c=c||a.length)>a.length&&(c=a.length);for(d=
c-1;0<=d&&128==(192&a[d]);)d--;return 0>d||0===d?c:d+bd[a[d]]>c?d:c};var Qd={};Qd=function(){this.input=null;this.total_in=this.avail_in=this.next_in=0;this.output=null;this.total_out=this.avail_out=this.next_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0};var He=Object.prototype.toString;"use strict";"use strict";xc.prototype.push=function(a,c){var d,b,g=this.strm,n=this.options.chunkSize;if(this.ended)return!1;c=c===~~c?c:4*(!0===c);"string"==typeof a?g.input=Rd(a):"[object ArrayBuffer]"===
He.call(a)?g.input=new Uint8Array(a):g.input=a;g.next_in=0;g.avail_in=g.input.length;do{if(0===g.avail_out&&(g.output=new za.Buf8(n),g.next_out=0,g.avail_out=n),1!==(b=ug(g,c))&&0!==b)return this.onEnd(b),this.ended=!0,!1;(0===g.avail_out||0===g.avail_in&&(4===c||2===c))&&("string"===this.options.to?this.onData(Ee(d=za.shrinkBuf(g.output,g.next_out),d.length)):this.onData(za.shrinkBuf(g.output,g.next_out)))}while((0<g.avail_in||0===g.avail_out)&&1!==b);return 4===c?(b=vg(this.strm),this.onEnd(b),
this.ended=!0,0===b):(2===c&&(this.onEnd(0),g.avail_out=0),!0)};xc.prototype.onData=function(a){this.chunks.push(a)};xc.prototype.onEnd=function(a){0===a&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=za.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};var cf=xc;var df=Sd;var ef=function(a,c){return(c=c||{}).raw=!0,Sd(a,c)};var ff=function(a,c){return(c=c||{}).gzip=!0,Sd(a,c)};"use strict";var cd={};ic(cd,"Inflate",function(){return jf},function(a){return jf=
a});ic(cd,"inflate",function(){return kf},function(a){return kf=a});ic(cd,"inflateRaw",function(){return lf},function(a){return lf=a});ic(cd,"ungzip",function(){return mf},function(a){return mf=a});"use strict";var nf={};nf=function(a,c){var d,b,g,n;var f=a.state;var e=a.next_in;var l=a.input;var k=e+(a.avail_in-5);var h=a.next_out;var m=a.output;c=h-(c-a.avail_out);var q=h+(a.avail_out-257);var r=f.dmax;var t=f.wsize;var u=f.whave;var y=f.wnext;var A=f.window;var F=f.hold;var D=f.bits;var G=f.lencode;
var E=f.distcode;var P=(1<<f.lenbits)-1;var N=(1<<f.distbits)-1;a:do for(15>D&&(F+=l[e++]<<D,D+=8,F+=l[e++]<<D,D+=8),d=G[F&P];;){if(F>>>=b=d>>>24,D-=b,0==(b=d>>>16&255))m[h++]=65535&d;else if(16&b){var O=65535&d;(b&=15)&&(D<b&&(F+=l[e++]<<D,D+=8),O+=F&(1<<b)-1,F>>>=b,D-=b);15>D&&(F+=l[e++]<<D,D+=8,F+=l[e++]<<D,D+=8);for(d=E[F&N];;){if(F>>>=b=d>>>24,D-=b,16&(b=d>>>16&255)){if(g=65535&d,D<(b&=15)&&(F+=l[e++]<<D,(D+=8)<b&&(F+=l[e++]<<D,D+=8)),(g+=F&(1<<b)-1)>r){a.msg="invalid distance too far back";
f.mode=30;break a}if(F>>>=b,D-=b,g>(b=h-c)){if((b=g-b)>u&&f.sane){a.msg="invalid distance too far back";f.mode=30;break a}if(d=0,n=A,0===y){if(d+=t-b,b<O){O-=b;do m[h++]=A[d++];while(--b);d=h-g;n=m}}else if(y<b){if(d+=t+y-b,(b-=y)<O){O-=b;do m[h++]=A[d++];while(--b);if(d=0,y<O){O-=b=y;do m[h++]=A[d++];while(--b);d=h-g;n=m}}}else if(d+=y-b,b<O){O-=b;do m[h++]=A[d++];while(--b);d=h-g;n=m}for(;2<O;)m[h++]=n[d++],m[h++]=n[d++],m[h++]=n[d++],O-=3;O&&(m[h++]=n[d++],1<O&&(m[h++]=n[d++]))}else{d=h-g;do m[h++]=
m[d++],m[h++]=m[d++],m[h++]=m[d++],O-=3;while(2<O);O&&(m[h++]=m[d++],1<O&&(m[h++]=m[d++]))}}else if(0==(64&b)){d=E[(65535&d)+(F&(1<<b)-1)];continue}else{a.msg="invalid distance code";f.mode=30;break a}break}}else if(0==(64&b)){d=G[(65535&d)+(F&(1<<b)-1)];continue}else{32&b?f.mode=12:(a.msg="invalid literal/length code",f.mode=30);break a}break}while(e<k&&h<q);e-=O=D>>3;D-=O<<3;a.next_in=e;a.next_out=h;a.avail_in=e<k?5+(k-e):5-(e-k);a.avail_out=h<q?257+(q-h):257-(h-q);f.hold=F&(1<<D)-1;f.bits=D};var Lc=
{},zg=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Ag=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Bg=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Cg=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];Lc=function(a,c,d,b,g,n,f,e){var l,k,h,m,q,r,t=e.bits,u,y,A,F,D,G=0,E,P=null,N=0,O=
new za.Buf16(16);var U=new za.Buf16(16);var da=null,la=0;for(u=0;15>=u;u++)O[u]=0;for(y=0;y<b;y++)O[c[d+y]]++;var J=15;for(A=t;1<=J&&0===O[J];J--);if(A>J&&(A=J),0===J)return g[n++]=20971520,g[n++]=20971520,e.bits=1,0;for(t=1;t<J&&0===O[t];t++);A<t&&(A=t);for(u=l=1;15>=u;u++)if(l<<=1,0>(l-=O[u]))return-1;if(0<l&&(0===a||1!==J))return-1;u=1;for(U[1]=0;15>u;u++)U[u+1]=U[u]+O[u];for(y=0;y<b;y++)0!==c[d+y]&&(f[U[c[d+y]]++]=y);if(0===a?(P=da=f,m=19):1===a?(P=zg,N-=257,da=Ag,la-=257,m=256):(P=Bg,da=Cg,m=
-1),E=0,y=0,u=t,U=n,F=A,D=0,h=-1,b=(G=1<<A)-1,1===a&&852<G||2===a&&592<G)return 1;for(;;){var ea=u-D;f[y]<m?(q=0,r=f[y]):f[y]>m?(q=da[la+f[y]],r=P[N+f[y]]):(q=96,r=0);l=1<<u-D;t=k=1<<F;do g[U+(E>>D)+(k-=l)]=ea<<24|q<<16|r|0;while(0!==k);for(l=1<<u-1;E&l;)l>>=1;if(0!==l?(E&=l-1,E+=l):E=0,y++,0==--O[u]){if(u===J)break;u=c[d+f[y]]}if(u>A&&(E&b)!==h){0===D&&(D=A);U+=t;for(l=1<<(F=u-D);F+D<J&&!(0>=(l-=O[F+D]));)F++,l<<=1;if(G+=1<<F,1===a&&852<G||2===a&&592<G)return 1;g[h=E&b]=A<<24|F<<16|U-n|0}}return 0!==
E&&(g[U+E]=u-D<<24|4194304),e.bits=A,0};var of=!0;"use strict";var Dg=function(a,c){var d,b,g,n,f,e,l,k,h,m=0,q=new za.Buf8(4),r=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return-2;12===(b=a.state).mode&&(b.mode=13);var t=a.next_out;var u=a.output;var y=a.avail_out;var A=a.next_in;var F=a.input;var D=a.avail_in;var G=b.hold;var E=b.bits;var P=D;var N=y;var O=0;a:for(;;)switch(b.mode){case 1:if(0===b.wrap){b.mode=13;break}for(;16>E;){if(0===
D)break a;D--;G+=F[A++]<<E;E+=8}if(2&b.wrap&&35615===G){b.check=0;q[0]=255&G;q[1]=G>>>8&255;b.check=Db(b.check,q,2,0);E=G=0;b.mode=2;break}if(b.flags=0,b.head&&(b.head.done=!1),!(1&b.wrap)||(((255&G)<<8)+(G>>8))%31){a.msg="incorrect header check";b.mode=30;break}if(8!=(15&G)){a.msg="unknown compression method";b.mode=30;break}if(G>>>=4,E-=4,k=(15&G)+8,0===b.wbits)b.wbits=k;else if(k>b.wbits){a.msg="invalid window size";b.mode=30;break}b.dmax=1<<k;a.adler=b.check=1;b.mode=512&G?10:12;E=G=0;break;case 2:for(;16>
E;){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}if(b.flags=G,8!=(255&b.flags)){a.msg="unknown compression method";b.mode=30;break}if(57344&b.flags){a.msg="unknown header flags set";b.mode=30;break}b.head&&(b.head.text=G>>8&1);512&b.flags&&(q[0]=255&G,q[1]=G>>>8&255,b.check=Db(b.check,q,2,0));E=G=0;b.mode=3;case 3:for(;32>E;){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}b.head&&(b.head.time=G);512&b.flags&&(q[0]=255&G,q[1]=G>>>8&255,q[2]=G>>>16&255,q[3]=G>>>24&255,b.check=Db(b.check,q,4,0));E=G=0;b.mode=4;case 4:for(;16>
E;){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}b.head&&(b.head.xflags=255&G,b.head.os=G>>8);512&b.flags&&(q[0]=255&G,q[1]=G>>>8&255,b.check=Db(b.check,q,2,0));E=G=0;b.mode=5;case 5:if(1024&b.flags){for(;16>E;){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}b.length=G;b.head&&(b.head.extra_len=G);512&b.flags&&(q[0]=255&G,q[1]=G>>>8&255,b.check=Db(b.check,q,2,0));E=G=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(1024&b.flags&&((g=b.length)>D&&(g=D),g&&(b.head&&(k=b.head.extra_len-b.length,b.head.extra||
(b.head.extra=Array(b.head.extra_len)),za.arraySet(b.head.extra,F,A,g,k)),512&b.flags&&(b.check=Db(b.check,F,g,A)),D-=g,A+=g,b.length-=g),b.length))break a;b.length=0;b.mode=7;case 7:if(2048&b.flags){if(0===D)break a;g=0;do k=F[A+g++],b.head&&k&&65536>b.length&&(b.head.name+=String.fromCharCode(k));while(k&&g<D);if(512&b.flags&&(b.check=Db(b.check,F,g,A)),D-=g,A+=g,k)break a}else b.head&&(b.head.name=null);b.length=0;b.mode=8;case 8:if(4096&b.flags){if(0===D)break a;g=0;do k=F[A+g++],b.head&&k&&65536>
b.length&&(b.head.comment+=String.fromCharCode(k));while(k&&g<D);if(512&b.flags&&(b.check=Db(b.check,F,g,A)),D-=g,A+=g,k)break a}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(512&b.flags){for(;16>E;){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}if(G!==(65535&b.check)){a.msg="header crc mismatch";b.mode=30;break}E=G=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0);a.adler=b.check=0;b.mode=12;break;case 10:for(;32>E;){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}a.adler=b.check=Ie(G);E=G=0;b.mode=11;
case 11:if(0===b.havedict)return a.next_out=t,a.avail_out=y,a.next_in=A,a.avail_in=D,b.hold=G,b.bits=E,2;a.adler=b.check=1;b.mode=12;case 12:if(5===c||6===c)break a;case 13:if(b.last){G>>>=7&E;E-=7&E;b.mode=27;break}for(;3>E;){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}switch(b.last=1&G,--E,3&(G>>>=1)){case 0:b.mode=14;break;case 1:if(of){be=new za.Buf32(512);ce=new za.Buf32(32);for(d=0;144>d;)b.lens[d++]=8;for(;256>d;)b.lens[d++]=9;for(;280>d;)b.lens[d++]=7;for(;288>d;)b.lens[d++]=8;Lc(1,b.lens,0,288,
be,0,b.work,{bits:9});for(d=0;32>d;)b.lens[d++]=5;Lc(2,b.lens,0,32,ce,0,b.work,{bits:5});of=!1}if(b.lencode=be,b.lenbits=9,b.distcode=ce,b.distbits=5,b.mode=20,6===c){G>>>=2;E-=2;break a}break;case 2:b.mode=17;break;case 3:a.msg="invalid block type",b.mode=30}G>>>=2;E-=2;break;case 14:G>>>=7&E;for(E-=7&E;32>E;){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}if((65535&G)!=(G>>>16^65535)){a.msg="invalid stored block lengths";b.mode=30;break}if(b.length=65535&G,G=0,E=0,b.mode=15,6===c)break a;case 15:b.mode=
16;case 16:if(g=b.length){if(g>D&&(g=D),g>y&&(g=y),0===g)break a;za.arraySet(u,F,A,g,t);D-=g;A+=g;y-=g;t+=g;b.length-=g;break}b.mode=12;break;case 17:for(;14>E;){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}if(b.nlen=(31&G)+257,E-=5,b.ndist=(31&(G>>>=5))+1,E-=5,b.ncode=(15&(G>>>=5))+4,G>>>=4,E-=4,286<b.nlen||30<b.ndist){a.msg="too many length or distance symbols";b.mode=30;break}b.have=0;b.mode=18;case 18:for(;b.have<b.ncode;){for(;3>E;){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}b.lens[r[b.have++]]=7&G;G>>>=
3;E-=3}for(;19>b.have;)b.lens[r[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,h={bits:b.lenbits},O=Lc(0,b.lens,0,19,b.lencode,0,b.work,h),b.lenbits=h.bits,O){a.msg="invalid code lengths set";b.mode=30;break}b.have=0;b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;f=(m=b.lencode[G&(1<<b.lenbits)-1])>>>24,e=65535&m,!(f<=E);){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}if(16>e)G>>>=f,E-=f,b.lens[b.have++]=e;else{if(16===e){for(d=f+2;E<d;){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}if(G>>>=f,E-=f,0===b.have){a.msg=
"invalid bit length repeat";b.mode=30;break}k=b.lens[b.have-1];g=3+(3&G);G>>>=2;E-=2}else if(17===e){for(d=f+3;E<d;){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}G>>>=f;E-=f;k=0;g=3+(7&G);G>>>=3;E-=3}else{for(d=f+7;E<d;){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}G>>>=f;E-=f;k=0;g=11+(127&G);G>>>=7;E-=7}if(b.have+g>b.nlen+b.ndist){a.msg="invalid bit length repeat";b.mode=30;break}for(;g--;)b.lens[b.have++]=k}}if(30===b.mode)break;if(0===b.lens[256]){a.msg="invalid code -- missing end-of-block";b.mode=30;break}if(b.lenbits=
9,h={bits:b.lenbits},O=Lc(1,b.lens,0,b.nlen,b.lencode,0,b.work,h),b.lenbits=h.bits,O){a.msg="invalid literal/lengths set";b.mode=30;break}if(b.distbits=6,b.distcode=b.distdyn,h={bits:b.distbits},O=Lc(2,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,h),b.distbits=h.bits,O){a.msg="invalid distances set";b.mode=30;break}if(b.mode=20,6===c)break a;case 20:b.mode=21;case 21:if(6<=D&&258<=y){a.next_out=t;a.avail_out=y;a.next_in=A;a.avail_in=D;b.hold=G;b.bits=E;nf(a,N);t=a.next_out;u=a.output;y=a.avail_out;A=
a.next_in;F=a.input;D=a.avail_in;G=b.hold;E=b.bits;12===b.mode&&(b.back=-1);break}for(b.back=0;f=(m=b.lencode[G&(1<<b.lenbits)-1])>>>24,d=m>>>16&255,e=65535&m,!(f<=E);){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}if(d&&0==(240&d)){var U=f;var da=d;for(l=e;f=(m=b.lencode[l+((G&(1<<U+da)-1)>>U)])>>>24,d=m>>>16&255,e=65535&m,!(U+f<=E);){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}G>>>=U;E-=U;b.back+=U}if(G>>>=f,E-=f,b.back+=f,b.length=e,0===d){b.mode=26;break}if(32&d){b.back=-1;b.mode=12;break}if(64&d){a.msg=
"invalid literal/length code";b.mode=30;break}b.extra=15&d;b.mode=22;case 22:if(b.extra){for(d=b.extra;E<d;){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}b.length+=G&(1<<b.extra)-1;G>>>=b.extra;E-=b.extra;b.back+=b.extra}b.was=b.length;b.mode=23;case 23:for(;f=(m=b.distcode[G&(1<<b.distbits)-1])>>>24,d=m>>>16&255,e=65535&m,!(f<=E);){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}if(0==(240&d)){U=f;da=d;for(l=e;f=(m=b.distcode[l+((G&(1<<U+da)-1)>>U)])>>>24,d=m>>>16&255,e=65535&m,!(U+f<=E);){if(0===D)break a;D--;
G+=F[A++]<<E;E+=8}G>>>=U;E-=U;b.back+=U}if(G>>>=f,E-=f,b.back+=f,64&d){a.msg="invalid distance code";b.mode=30;break}b.offset=e;b.extra=15&d;b.mode=24;case 24:if(b.extra){for(d=b.extra;E<d;){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}b.offset+=G&(1<<b.extra)-1;G>>>=b.extra;E-=b.extra;b.back+=b.extra}if(b.offset>b.dmax){a.msg="invalid distance too far back";b.mode=30;break}b.mode=25;case 25:if(0===y)break a;if(g=N-y,b.offset>g){if((g=b.offset-g)>b.whave&&b.sane){a.msg="invalid distance too far back";b.mode=
30;break}g>b.wnext?(g-=b.wnext,n=b.wsize-g):n=b.wnext-g;g>b.length&&(g=b.length);d=b.window}else d=u,n=t-b.offset,g=b.length;g>y&&(g=y);y-=g;b.length-=g;do u[t++]=d[n++];while(--g);0===b.length&&(b.mode=21);break;case 26:if(0===y)break a;u[t++]=b.length;y--;b.mode=21;break;case 27:if(b.wrap){for(;32>E;){if(0===D)break a;D--;G|=F[A++]<<E;E+=8}if(N-=y,a.total_out+=N,b.total+=N,N&&(a.adler=b.check=b.flags?Db(b.check,u,N,t-N):Fc(b.check,u,N,t-N)),N=y,(b.flags?G:Ie(G))!==b.check){a.msg="incorrect data check";
b.mode=30;break}E=G=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;32>E;){if(0===D)break a;D--;G+=F[A++]<<E;E+=8}if(G!==(4294967295&b.total)){a.msg="incorrect length check";b.mode=30;break}E=G=0}b.mode=29;case 29:O=1;break a;case 30:O=-3;break a;case 31:return-4;default:return-2}return(a.next_out=t,a.avail_out=y,a.next_in=A,a.avail_in=D,b.hold=G,b.bits=E,(b.wsize||N!==a.avail_out&&30>b.mode&&(27>b.mode||4!==c))&&Je(a,a.output,a.next_out,N-a.avail_out))?(b.mode=31,-4):(P-=a.avail_in,N-=a.avail_out,a.total_in+=
P,a.total_out+=N,b.total+=N,b.wrap&&N&&(a.adler=b.check=b.flags?Db(b.check,u,N,a.next_out-N):Fc(b.check,u,N,a.next_out-N)),a.data_type=b.bits+64*!!b.last+128*(12===b.mode)+256*(20===b.mode||15===b.mode),(0===P&&0===N||4===c)&&0===O&&(O=-5),O)};var Eg=function(a){if(!a||!a.state)return-2;var c=a.state;return c.window&&(c.window=null),a.state=null,0};var Wf=function(a,c){var d;return a&&a.state&&0!=(2&(d=a.state).wrap)?(d.head=c,c.done=!1,0):-2};var Me=function(a,c){var d,b=c.length;return a&&a.state&&
(0===(d=a.state).wrap||11===d.mode)?11===d.mode&&Fc(1,c,b,0)!==d.check?-3:Je(a,c,b,b)?(d.mode=31,-4):(d.havedict=1,0):-2};"use strict";var ub={};ub={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,
Z_UNKNOWN:2,Z_DEFLATED:8};var Ke={};Ke=function(){this.os=this.xflags=this.time=this.text=0;this.extra=null;this.extra_len=0;this.comment=this.name="";this.hcrc=0;this.done=!1};var Le=Object.prototype.toString;yc.prototype.push=function(a,c){var d,b,g,n,f=this.strm,e=this.options.chunkSize,l=this.options.dictionary,k=!1;if(this.ended)return!1;c=c===~~c?c:!0===c?ub.Z_FINISH:ub.Z_NO_FLUSH;"string"==typeof a?f.input=wg(a):"[object ArrayBuffer]"===Le.call(a)?f.input=new Uint8Array(a):f.input=a;f.next_in=
0;f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new za.Buf8(e),f.next_out=0,f.avail_out=e),(d=Dg(f,ub.Z_NO_FLUSH))===ub.Z_NEED_DICT&&l&&(d=Me(this.strm,l)),d===ub.Z_BUF_ERROR&&!0===k&&(d=ub.Z_OK,k=!1),d!==ub.Z_STREAM_END&&d!==ub.Z_OK)return this.onEnd(d),this.ended=!0,!1;f.next_out&&(0===f.avail_out||d===ub.Z_STREAM_END||0===f.avail_in&&(c===ub.Z_FINISH||c===ub.Z_SYNC_FLUSH))&&("string"===this.options.to?(b=yg(f.output,f.next_out),g=f.next_out-b,n=xg(f.output,b),f.next_out=g,f.avail_out=
e-g,g&&za.arraySet(f.output,f.output,b,g,0),this.onData(n)):this.onData(za.shrinkBuf(f.output,f.next_out)));0===f.avail_in&&0===f.avail_out&&(k=!0)}while((0<f.avail_in||0===f.avail_out)&&d!==ub.Z_STREAM_END);return(d===ub.Z_STREAM_END&&(c=ub.Z_FINISH),c===ub.Z_FINISH)?(d=Eg(this.strm),this.onEnd(d),this.ended=!0,d===ub.Z_OK):(c===ub.Z_SYNC_FLUSH&&(this.onEnd(ub.Z_OK),f.avail_out=0),!0)};yc.prototype.onData=function(a){this.chunks.push(a)};yc.prototype.onEnd=function(a){a===ub.Z_OK&&("string"===this.options.to?
this.result=this.chunks.join(""):this.result=za.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};var jf=yc;var kf=Td;var lf=function(a,c){return(c=c||{}).raw=!0,Td(a,c)};var mf=Td;var pf={};qg(pf,$c,cd,ub);Wd=pf;Ud.FIXED_HEADER_LENGTH=16;id.HEADER_LENGTH=8;class qf{readFixedHeader(a){this.payloadOffset=a.readU32BE();this.blendMode=a.readU32BE();this.alpha=a.readU32BE();let c=a.readU32BE();this.visible=0!=(1&c);this.clip=0!=(2&c);this.hasMask=0!=(4&c);this.maskLinked=0!=
(8&c);this.maskVisible=0!=(16&c);this.expanded=0!=(32&c);this.lockAlpha=0!=(64&c);this.blendMode===L.LM_MULTIPLY&&0!=(128&c)&&(this.blendMode=L.LM_MULTIPLY2);this.nameLength=a.readU32BE()}getFixedHeaderLen(){return 20}getVariableHeaderLen(){return this.nameLength}readVariableSizeHeader(a){this.name=a.readString(this.nameLength)}decode(a){for(var c;;){if(0<this.skipBytes){if(this.skipBytes>=a.length)return this.skipBytes-=a.length,null;a=a.subarray(this.skipBytes);this.skipBytes=0}switch(this.state){case 0:if(a.length<
this.getFixedHeaderLen())break;c=new Va(a);this.readFixedHeader(c);a=a.subarray(c.pos);this.state=1;continue;case 1:if(a.length<this.getVariableHeaderLen())break;c=new Va(a);this.readVariableSizeHeader(c);this.layer=this.createLayer();this.hasMask&&(this.layer.setMask(new ya(this.width,this.height,8)),this.maskDecoder=new Fg(this.layer.mask));this.layer instanceof qa&&(this.colorDecoder=new Gg(this.layer.image));this.skipBytes=this.payloadOffset-this.getFixedHeaderLen();this.colorDecoder?this.state=
3:this.maskDecoder?this.state=4:this.state=5;continue;case 3:if(a=this.colorDecoder.decode(a),this.colorDecoder.done){this.maskDecoder?this.state=4:this.state=5;continue}break;case 4:if(a=this.maskDecoder.decode(a),this.maskDecoder.done){this.state=5;continue}break;case 5:c=this.payloadOffset;this.colorDecoder&&(c+=this.colorDecoder.bytesTotal);this.maskDecoder&&(c+=this.maskDecoder.bytesTotal);this.state=6;this.skipBytes=this.chunkHeader.chunkSize-c;continue;case 6:this.done=!0}break}return a}constructor(a,
c,d){this.chunkHeader=a;this.width=c;this.height=d;this.nameLength=this.skipBytes=this.payloadOffset=this.state=0;this.done=!1;this.maskDecoder=this.colorDecoder=null}}class Xf extends qf{createLayer(){let a=new qa(this.width,this.height,this.name);return a.setBlendMode(this.blendMode),a.setAlpha(this.alpha),a.setVisible(this.visible),a.setClip(this.clip),a.setMaskLinked(this.maskLinked),a.setMaskVisible(this.maskVisible),a.setLockAlpha(this.lockAlpha),a}}class Yf extends qf{readFixedHeader(a){super.readFixedHeader.call(this,
a);this.childLayers=a.readU32BE()}getFixedHeaderLen(){return super.getFixedHeaderLen.call(this)+4}createLayer(){let a=new Qa(this.name,this.blendMode);return a.setAlpha(this.alpha),a.setVisible(this.visible),a.setExpanded(this.expanded),a.setMaskLinked(this.maskLinked),a.setMaskVisible(this.maskVisible),a}constructor(a,c,d){super(a,c,d);this.childLayers=0}}class Gg{decode(a){if(null==a)return null;var c=this.bytesRead%z.BYTES_PER_PIXEL,d=this.bytesRead-c;let b=0,g=[z.ALPHA_BYTE_OFFSET,z.RED_BYTE_OFFSET,
z.GREEN_BYTE_OFFSET,z.BLUE_BYTE_OFFSET];for(;c<z.BYTES_PER_PIXEL&&b<a.length;c++)this.output[d+g[c]]=a[b],b++;this.bytesRead+=b;var n=0|Math.min(a.length-b,this.bytesTotal-this.bytesRead);c=n/z.BYTES_PER_PIXEL|0;n%=z.BYTES_PER_PIXEL;for(d=0;d<c;d++)this.output[this.bytesRead+z.ALPHA_BYTE_OFFSET]=a[b],this.output[this.bytesRead+z.RED_BYTE_OFFSET]=a[b+1],this.output[this.bytesRead+z.GREEN_BYTE_OFFSET]=a[b+2],this.output[this.bytesRead+z.BLUE_BYTE_OFFSET]=a[b+3],this.bytesRead+=z.BYTES_PER_PIXEL,b+=
z.BYTES_PER_PIXEL;c=0;for(d=this.bytesRead;c<n;c++)this.output[d+g[c]]=a[b],b++;return(this.bytesRead+=n,this.bytesRead>=this.bytesTotal&&(this.done=!0),b<a.length)?a.subarray(b):null}constructor(a){this.bytesRead=0;this.bytesTotal=a.width*a.height*z.BYTES_PER_PIXEL;this.output=a.data;this.done=!1}}class Fg{decode(a){if(null==a)return null;let c=0|Math.min(a.length,this.bytesTotal-this.bytesRead),d=this.bytesRead,b;for(b=0;b<c;b++,d++)this.output[d]=a[b];return(this.bytesRead=d,this.bytesRead>=this.bytesTotal&&
(this.done=!0),b<a.length)?a.subarray(b):null}constructor(a){this.bytesRead=0;this.bytesTotal=a.width*a.height;this.output=a.data;this.done=!1}}Hc.prototype.read=function(a){if(null==a)return null;var c=new Va(new Uint8Array(a)),d=[];if(1!=c.readU16BE())return null;a=c.readU16BE();for(var b=0;b<a;b++)if(0==c.readU16BE()){var g=255*c.readU16BE()/65535,n=255*c.readU16BE()/65535,f=255*c.readU16BE()/65535;c.readU16BE();d.push(g<<16|n<<8|f)}return d};Hc.prototype.write=function(a){var c=new Va(new Uint8Array(4+
10*a.length));c.writeU16BE(1);c.writeU16BE(a.length);for(var d=0;d<a.length;d++){var b=a[d];c.writeU16BE(0);c.writeU16BE(257*(b>>16&255));c.writeU16BE(257*(b>>8&255));c.writeU16BE(257*(255&b));c.writeU16BE(0)}return c.getAsDataArray()};jd.prototype=Object.create(Ha(Ab).prototype);jd.prototype.constructor=jd;var Xc={};var rf=function(){function a(f,e,l){var k=new XMLHttpRequest;k.open("GET",f);k.responseType="blob";k.onload=function(){n(k.response,e,l)};k.onerror=function(){console.error("could not download file")};
k.send()}function c(f){var e=new XMLHttpRequest;e.open("HEAD",f,!1);try{e.send()}catch(l){}return 200<=e.status&&299>=e.status}function d(f){try{f.dispatchEvent(new MouseEvent("click"))}catch(l){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null);f.dispatchEvent(e)}}var b="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof zd&&zd.global===zd?zd:void 0,g=b.navigator&&/Macintosh/.test(navigator.userAgent)&&
/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),n=b.saveAs||("object"!=typeof window||window!==b?function(){}:"download"in HTMLAnchorElement.prototype&&!g?function(f,e,l){var k=b.URL||b.webkitURL,h=document.createElement("a");h.download=e=e||f.name||"download";h.rel="noopener";"string"==typeof f?(h.href=f,h.origin===location.origin?d(h):c(h.href)?a(f,e,l):d(h,h.target="_blank")):(h.href=k.createObjectURL(f),setTimeout(function(){k.revokeObjectURL(h.href)},4E4),setTimeout(function(){d(h)},
0))}:"msSaveOrOpenBlob"in navigator?function(f,e,l){if(e=e||f.name||"download","string"!=typeof f){var k;navigator.msSaveOrOpenBlob((void 0===(k=l)?k={autoBom:!1}:"object"!=typeof k&&(console.warn("Deprecated: Expected third argument to be a object"),k={autoBom:!k}),k.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(f.type)?new Blob(["\ufeff",f],{type:f.type}):f),e)}else if(c(f))a(f,e,l);else{var h=document.createElement("a");h.href=f;h.target="_blank";setTimeout(function(){d(h)})}}:
function(f,e,l,k){if((k=k||open("","_blank"))&&(k.document.title=k.document.body.innerText="downloading..."),"string"==typeof f)return a(f,e,l);e="application/octet-stream"===f.type;l=/constructor/i.test(b.HTMLElement)||b.safari;var h=/CriOS\/[\d]+/.test(navigator.userAgent);if((h||e&&l||g)&&"undefined"!=typeof FileReader){var m=new FileReader;m.onloadend=function(){var t=m.result;t=h?t:t.replace(/^data:[^;]*;/,"data:attachment/file;");k?k.location.href=t:location=t;k=null};m.readAsDataURL(f)}else{var q=
b.URL||b.webkitURL,r=q.createObjectURL(f);k?k.location=r:location.href=r;k=null;setTimeout(function(){q.revokeObjectURL(r)},4E4)}});Xc=b.saveAs=n.saveAs=n};"function"==typeof define&&define.amd?define([],rf):rf();var ld={};ld=JSON.parse('{"Dodge (tool)":"Dodge","Burn (tool)":"Burn","Color (picker)":"Color","Color swatches (shorter)":"Swatches"}');let Yd={ja:JSON.parse('{"File":"\u30d5\u30a1\u30a4\u30eb","Save to my computer":"PC\u306b\u4fdd\u5b58","Post Oekaki":"\u753b\u50cf\u3092\u6295\u7a3f","Edit":"\u7de8\u96c6","Undo":"\u53d6\u308a\u6d88\u3057","Redo":"\u3084\u308a\u76f4\u3057","Cut":"\u5207\u308a\u53d6\u308a","Copy":"\u30b3\u30d4\u30fc","Clear history":"\u5c65\u6b74\u6d88\u53bb","Copy merged":"\u7d50\u5408\u30b3\u30d4\u30fc","Paste":"\u8cbc\u308a\u4ed8\u3051","Select all":"\u3059\u3079\u3066\u9078\u629e","Deselect":"\u9078\u629e\u89e3\u9664","Transform":"\u5909\u5f62","Layers":"\u30ec\u30a4\u30e4\u30fc","Duplicate":"\u8907\u88fd","Merge down":"\u4e0b\u306e\u30ec\u30a4\u30e4\u30fc\u3068\u7d50\u5408","Merge group":"\u30b0\u30eb\u30fc\u30d7\u7d50\u5408","Merge all layers":"\u5168\u30ec\u30a4\u30e4\u30fc\u7d50\u5408","Add layer mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u8ffd\u52a0","Delete mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u524a\u9664","Delete layer mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u524a\u9664","Apply mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u9069\u7528","Apply layer mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u9069\u7528","Disable mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u7121\u52b9\u5316","Enable mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u6709\u52b9\u5316","Clip to the layer below":"\u4e0b\u306e\u30ec\u30a4\u30e4\u30fc\u3067\u30af\u30ea\u30c3\u30d4\u30f3\u30b0","Unclip from the layer below":"\u30af\u30ea\u30c3\u30d4\u30f3\u30b0\u89e3\u9664","Effects":"\u52b9\u679c","Clear":"\u6d88\u53bb","Fill":"\u5857\u308a\u6f70\u3057","Flip horizontal":"\u5de6\u53f3\u53cd\u8ee2","Flip vertical":"\u4e0a\u4e0b\u53cd\u8ee2","Invert":"\u30cd\u30ac\u30dd\u30b8\u53cd\u8ee2","Convert brightness to opacity":"\u8f1d\u5ea6\u3092\u900f\u660e\u5ea6\u306b\u5909\u63db","Box blur...":"\u307c\u304b\u3057","Box blur":"\u307c\u304b\u3057","Blur amount (pixels)":"\u307c\u304b\u3057\u91cf(\u30d4\u30af\u30bb\u30eb\u5358\u4f4d)","Iterations (1-8, larger gives smoother blur)":"\u53cd\u5fa9(1-8,\u5927\u304d\u3044\u307b\u3069\u307c\u304b\u3057\u304c\u6ed1\u3089\u304b)","Monochromatic noise":"\u5358\u8272\u30ce\u30a4\u30ba","Color noise":"\u30ab\u30e9\u30fc\u30ce\u30a4\u30ba","View":"\u8868\u793a","Full-screen mode":"\u30d5\u30eb\u30b9\u30af\u30ea\u30fc\u30f3\u30e2\u30fc\u30c9","Zoom in":"\u62e1\u5927","Zoom out":"\u7e2e\u5c0f","Zoom 100%":"100%","Smooth-out zoomed canvas":"\u30ba\u30fc\u30e0\u3092\u306a\u3081\u3089\u304b\u306b\u8868\u793a\u3059\u308b","Show grid":"\u30b0\u30ea\u30c3\u30c9\u3092\u8868\u793a","Grid options...":"\u30b0\u30ea\u30c3\u30c9\u306e\u8a2d\u5b9a","Palettes":"\u30d1\u30ec\u30c3\u30c8","Rearrange":"\u521d\u671f\u5316","Toggle palettes":"\u8868\u793a\u975e\u8868\u793a\u5207\u308a\u66ff\u3048","Use old icons":"\u53e4\u3044\u30a2\u30a4\u30b3\u30f3","Show tool options":"\u30c4\u30fc\u30eb\u30aa\u30d7\u30b7\u30e7\u30f3","Show color":"\u30ab\u30e9\u30fc","Show layers":"\u30ec\u30a4\u30e4\u30fc","Show misc":"\u64cd\u4f5c","Show stroke":"\u30b9\u30c8\u30ed\u30fc\u30af","Show swatches":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8","Show textures":"\u30c6\u30af\u30b9\u30c1\u30e3","Show tools":"\u30c4\u30fc\u30eb","Help":"\u30d8\u30eb\u30d7","Tablet support":"\u30bf\u30d6\u30ec\u30c3\u30c8\u30b5\u30dd\u30fc\u30c8","Shortcuts":"\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8","About":"ChickenPaint Be\u306b\u3064\u3044\u3066","Removes all undo/redo information to regain memory":"\u5c65\u6b74\u3092\u30af\u30ea\u30a2\u3057\u3066\u30e1\u30e2\u30ea\u3092\u958b\u653e\u3057\u307e\u3059","Clears the selected area":"\u6d88\u53bb","Invert the image colors":"\u30cd\u30ac\u30dd\u30b8\u53cd\u8ee2","Blur effect":"\u307c\u304b\u3057\u30d5\u30a3\u30eb\u30bf","Fills the selection with noise":"\u5358\u8272\u30ce\u30a4\u30ba\u3067\u5857\u308a\u6f70\u3057","Fills the selection with colored noise":"\u30ab\u30e9\u30fc\u30ce\u30a4\u30ba\u3067\u5857\u308a\u6f70\u3057","Linear interpolation is used to give a smoothed looked to the picture when zoomed in":"\u753b\u50cf\u306e\u62e1\u5927\u6642\u306b\u88dc\u5b8c\u3057\u3066\u6ed1\u3089\u304b\u306b\u8868\u793a\u3057\u307e\u3059","Rearrange the palette windows":"\u30d1\u30ec\u30c3\u30c8\u3092\u518d\u914d\u7f6e","Hides or shows all palettes":"\u30d1\u30ec\u30c3\u30c8\u306e\u8868\u793a/\u975e\u8868\u793a","You\'re about to clear the current Undo/Redo history.\\nThis operation cannot be undone, are you sure you want to do that?":"\u30a2\u30f3\u30c9\u30a5\u30fb\u30ea\u30c9\u30a5\u306e\u5c65\u6b74\u3092\u6d88\u53bb\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059\u3002\\n\u3053\u306e\u64cd\u4f5c\u306f\u5143\u306b\u623b\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\u672c\u5f53\u306b\u5b9f\u884c\u3057\u307e\u3059\u304b?","Misc":"\u64cd\u4f5c","Round Pixelated":"\u5186\u30d4\u30af\u30bb\u30eb","Round Hard Edge":"\u5186\u30cf\u30fc\u30c9\u30a8\u30c3\u30b8","Round Soft":"\u5186\u30bd\u30d5\u30c8","Square Pixelated":"\u89d2\u30d4\u30af\u30bb\u30eb","Square Hard Edge":"\u89d2\u30cf\u30fc\u30c9\u30a8\u30c3\u30b8","Color (picker)":"\u30ab\u30e9\u30fc","Tool options":"\u30c4\u30fc\u30eb\u30aa\u30d7\u30b7\u30e7\u30f3","Brush size":"\u30d6\u30e9\u30b7\u30b5\u30a4\u30ba","Opacity":"\u4e0d\u900f\u660e\u5ea6","Color":"\u8272\u88dc\u5145","Blend":"\u6df7\u8272","Spacing":"\u9593\u9694","Scattering":"\u6563\u4e71","Smoothing":"\u624b\u3076\u308c\u88dc\u6b63","Color swatches":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8","Color swatches (shorter)":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8","Remove":"\u524a\u9664","Replace with current color":"\u9078\u629e\u4e2d\u306e\u8272\u306b\u7f6e\u304d\u63db\u3048","Save swatches to your computer...":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8\u3092PC\u306b\u4fdd\u5b58","Load swatches from your computer...":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8\u3092PC\u304b\u3089\u8aad\u307f\u8fbc\u307f","Add the current brush color as a new swatch":"\u9078\u629e\u4e2d\u306e\u8272\u3092\u8ffd\u52a0","Sample all layers":"\u5168\u30ec\u30a4\u30e4\u30fc\u6df7\u5408","Lock transparency":"\u900f\u660e\u90e8\u5206\u3092\u4fdd\u8b77","Textures":"\u30c6\u30af\u30b9\u30c1\u30e3","Customize":"\u30ab\u30b9\u30bf\u30de\u30a4\u30ba","Inverse":"\u30cd\u30ac\u30dd\u30b8\u53cd\u8ee2","Mirror":"\u5de6\u53f3\u53cd\u8ee2","Brightness":"\u8f1d\u5ea6","Contrast":"\u30b3\u30f3\u30c8\u30e9\u30b9\u30c8","Reset":"\u30ea\u30bb\u30c3\u30c8","Layer blending mode":"\u5408\u6210\u30e2\u30fc\u30c9","Normal":"\u901a\u5e38","Multiply":"\u4e57\u7b97","Add":"\u52a0\u7b97","Screen":"\u30b9\u30af\u30ea\u30fc\u30f3","Lighten":"\u6bd4\u8f03(\u660e)","Darken":"\u6bd4\u8f03(\u6697)","Subtract":"\u6e1b\u7b97","Dodge":"\u8986\u3044\u713c\u304d","Burn":"\u713c\u304d\u8fbc\u307f","Overlay":"\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4","Hard Light":"\u30cf\u30fc\u30c9\u30e9\u30a4\u30c8","Soft Light":"\u30bd\u30d5\u30c8\u30e9\u30a4\u30c8","Vivid Light":"\u30d3\u30d3\u30c3\u30c9\u30e9\u30a4\u30c8","Linear Light":"\u30ea\u30cb\u30a2\u30e9\u30a4\u30c8","Pin Light":"\u30d4\u30f3\u30e9\u30a4\u30c8","Passthrough":"\u901a\u904e","Stroke":"\u30b9\u30c8\u30ed\u30fc\u30af","Free-hand":"\u30d5\u30ea\u30fc\u30cf\u30f3\u30c9","Straight line":"\u76f4\u7dda","Bezier curve":"Bz\uff08\u30d9\u30b8\u30a7\uff09\u66f2\u7dda","Tools":"\u30c4\u30fc\u30eb","Marquee":"\u9078\u629e\u7bc4\u56f2","Move tool":"\u79fb\u52d5","Flood fill":"\u5857\u308a\u6f70\u3057","Gradient fill":"\u30b0\u30e9\u30c7\u30fc\u30b7\u30e7\u30f3","Color picker":"\u30b9\u30dd\u30a4\u30c8","Rotate canvas":"\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u56de\u8ee2","Grab canvas":"\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u4f4d\u7f6e","Pencil":"\u925b\u7b46","Pen":"\u30da\u30f3","Airbrush":"\u30a8\u30a2\u30d6\u30e9\u30b7","Waterpaint":"\u6c34\u5f69","Eraser":"\u6d88\u3057\u30b4\u30e0","Soft eraser":"\u8584\u6d88\u3057","Smudge":"\u6307\u5148","Blender":"\u6df7\u8272","Dodge (tool)":"\u8986\u3044\u713c\u304d","Burn (tool)":"\u713c\u304d\u8fbc\u307f","Blur":"\u307c\u304b\u3057","Grid options":"\u30b0\u30ea\u30c3\u30c9\u306e\u8a2d\u5b9a","Grid size":"\u30b0\u30ea\u30c3\u30c9\u30b5\u30a4\u30ba","Rename...":"\u540d\u524d\u3092\u5909\u66f4","Add layer":"\u65b0\u898f\u30ec\u30a4\u30e4\u30fc","Delete layer":"\u30ec\u30a4\u30e4\u30fc\u524a\u9664","Add group":"\u65b0\u898f\u30b0\u30eb\u30fc\u30d7","Delete group":"\u30b0\u30eb\u30fc\u30d7\u524a\u9664","Add mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u8ffd\u52a0","Gradient":"\u30b0\u30e9\u30c7\u30fc\u30b7\u30e7\u30f3\u4f5c\u6210","Transform style":"\u5909\u5f62\u30b9\u30bf\u30a4\u30eb","Apply transform":"\u5909\u5f62\u78ba\u5b9a","Complete transform":"\u5909\u5f62\u3092\u5b8c\u4e86","Undo transform":"\u53d6\u308a\u6d88\u3057","You need to finish transforming this layer before you can do that. What would you like to do with the transform?":"\u7d9a\u884c\u3059\u308b\u305f\u3081\u306b\u5909\u5f62\u3092\u5b8c\u4e86\u3057\u307e\u3059\u3002","Smooth":"\u30b9\u30e0\u30fc\u30ba","Sharp":"\u30b7\u30e3\u30fc\u30d7","Opacity: ":"\u4e0d\u900f\u660e\u5ea6:","Please enter a color in hex format":"16\u9032\u5f62\u5f0f\u3067\u8272\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\uff08#xxxxxx\u306e\u5f62\uff09","Cancel":"\u30ad\u30e3\u30f3\u30bb\u30eb","Ok":"OK","Okay":"OK","OK":"OK","Whoops! This layer is currently hidden":"\u975e\u8868\u793a\u30ec\u30a4\u30e4\u30fc\u3067\u3059\u3002","Whoops! This layer\'s opacity is currently 0%":"\u30ec\u30a4\u30e4\u30fc\u306e\u4e0d\u900f\u660e\u5ea6\u304c0%\u3067\u3059","Whoops! You can\'t draw on a group":"\u30b0\u30eb\u30fc\u30d7\u30d5\u30a9\u30eb\u30c0\u306b\u306f\u63cf\u3051\u307e\u305b\u3093","Whoops! All of the selected pixels are transparent!":"\u30ec\u30a4\u30e4\u30fc\u304c\u7a7a\u3067\u3059","Image":"\u753b\u50cf","Layer mask":"\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af","Sorry, you can\'t remove the last remaining layer in the drawing.":"\u6700\u5f8c\u306e1\u3064\u306a\u306e\u3067\u524a\u9664\u3067\u304d\u307e\u305b\u3093\u3002","Are you sure you want to send your drawing to the server and finish drawing now?":"\u753b\u50cf\u3092\u30b5\u30fc\u30d0\u30fc\u306b\u9001\u4fe1\u3057\u307e\u3059\u3002\u7d42\u4e86\u3057\u3066\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f","Your drawing has unsaved changes! Are you sure to want to navigate away?":"\u753b\u50cf\u306b\u672a\u4fdd\u5b58\u306e\u5909\u66f4\u304c\u3042\u308a\u307e\u3059\u3002\u7d42\u4e86\u3057\u3066\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f","Many of the menu options and painting tools have keyboard shortcuts which are written next to them or appear when you hover.":"\u5229\u7528\u53ef\u80fd\u306a\u30ad\u30fc\u30dc\u30fc\u30c9\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u306e\u3044\u304f\u3064\u304b\u306f\u30e1\u30cb\u30e5\u30fc\u306e\u6a2a\u3084\u30c4\u30fc\u30eb\u30c1\u30c3\u30d7\u306b\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002","Here are some other shortcuts which are not as obvious!":"\u3053\u306e\u4e00\u89a7\u306f\u305d\u308c\u4ee5\u5916\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u3092\u307e\u3068\u3081\u305f\u3082\u306e\u3067\u3059\u3002","Right":"\u53f3","Left":"\u5de6","Middle":"\u4e2d","or":"\u307e\u305f\u306f","Double click":"\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af","Color swatches palette":"\u30ab\u30e9\u30fc\u30bb\u30c3\u30c8","Use as the drawing color":"\u30d1\u30ec\u30c3\u30c8\u306e\u8272\u3092\u53d6\u5f97","Remove or replace a color swatch":"\u30d1\u30ec\u30c3\u30c8\u306e\u5909\u66f4\uff65\u524a\u9664","Line drawing mode":"\u76f4\u7dda\u30e2\u30fc\u30c9","Snap line to nearest 45 degrees":"45\u00b0\u5358\u4f4d\u3067\u30b9\u30ca\u30c3\u30d7","Painting tools":"\u30c4\u30fc\u30eb","Change brush opacity":"\u30d6\u30e9\u30b7\u306e\u4e0d\u900f\u660e\u5ea6","Change brush size":"\u30d6\u30e9\u30b7\u30b5\u30a4\u30ba","Brush palette":"\u30d6\u30e9\u30b7\u30d1\u30ec\u30c3\u30c8","Adjust brush sliders more precisely":"\u30d6\u30e9\u30b7\u30b9\u30e9\u30a4\u30c0\u30fc\u3092\u3088\u308a\u7d30\u304b\u304f\u8abf\u6574","Drawing canvas":"\u30ad\u30e3\u30f3\u30d0\u30b9","Move the canvas around":"\u30ad\u30e3\u30f3\u30d0\u30b9\u3092\u79fb\u52d5","Rotate the canvas":"\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u56de\u8ee2","Sample the color under the cursor":"\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u8272\u3092\u30b9\u30dd\u30a4\u30c8","Layers palette":"\u30ec\u30a4\u30e4\u30fc\u30d1\u30ec\u30c3\u30c8","Rename layer":"\u30ec\u30a4\u30e4\u30fc\u540d\u5909\u66f4","Toggle mask enable/disable":"\u30de\u30b9\u30af\u306e\u6709\u52b9/\u7121\u52b9\u5207\u308a\u66ff\u3048","Toggle mask View":"\u30de\u30b9\u30af\u306e\u8868\u793a/\u975e\u8868\u793a\u5207\u308a\u66ff\u3048","Save Oekaki":"\u4fdd\u5b58","Saving drawing...":"\u753b\u50cf\u3092\u4fdd\u5b58\u4e2d\u2026","Preparing your drawing to be saved, please wait...":"\u753b\u50cf\u3092\u4fdd\u5b58\u3059\u308b\u6e96\u5099\u3092\u3057\u3066\u3044\u307e\u3059\u3002\u3057\u3070\u3089\u304f\u304a\u5f85\u3061\u304f\u3060\u3055\u3044\u2026","Drawing saved!":"\u753b\u50cf\u3092\u4fdd\u5b58\u3057\u307e\u3057\u305f\uff01","Your drawing has been saved, would you like to post it to the forum now?":"\u753b\u50cf\u306e\u4fdd\u5b58\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002\u30d5\u30a9\u30fc\u30e9\u30e0\u3078\u6295\u7a3f\u3057\u307e\u3059\u304b\uff1f","Yes, post it now":"\u306f\u3044\u3001\u6295\u7a3f\u3057\u307e\u3059","No, keep drawing":"\u307e\u3060\u63cf\u304d\u307e\u3059","No, quit and I\'ll finish it later":"\u30a2\u30d7\u30ea\u3092\u7d42\u4e86\u3057\u3066\u7d9a\u304d\u3092\u5f8c\u3067\u63cf\u304f","Your drawing has been saved, would you like to view it on the forum now?":"\u753b\u50cf\u306e\u4fdd\u5b58\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002\u30d5\u30a9\u30fc\u30e9\u30e0\u3078\u6295\u7a3f\u3057\u307e\u3059\u304b\uff1f","Yes, view the post":"\u306f\u3044\u3001\u6295\u7a3f\u3057\u307e\u3059\u3002","Your drawing has been saved, redirecting you to view your new post now...":"\u753b\u50cf\u306e\u4fdd\u5b58\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002\u6295\u7a3f\u5148\u306b\u79fb\u52d5\u3057\u307e\u3059\u3002","Sorry, your drawing could not be saved, Please see the error message.":"\u753b\u50cf\u3092\u4fdd\u5b58\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002","Sorry, your drawing could not be saved, please try again later.":"\u753b\u50cf\u3092\u4fdd\u5b58\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u6642\u9593\u3092\u7f6e\u3044\u3066\u518d\u5ea6\u6295\u7a3f\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002","The error returned from the server was":"\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u8fd4\u3063\u3066\u6765\u305f\u30a8\u30e9\u30fc","The file size exceeds the server limit.":"\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c\u30b5\u30fc\u30d0\u30fc\u306e\u4e0a\u9650\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002","The total size of FormData is within the acceptable range.":"FormData\u306e\u5408\u8a08\u30b5\u30a4\u30ba\u306f\u5236\u9650\u7bc4\u56f2\u5185\u3067\u3059\u3002","Limit size":"\u4e0a\u9650\u30b5\u30a4\u30ba","Current size":"\u73fe\u5728\u306e\u30b5\u30a4\u30ba","Network response was not OK":"\u901a\u4fe1\u30a8\u30e9\u30fc","HTTP status code":"HTTP\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9"}'),
en:ld},kd=ld,Zd="en";Wc.prototype=Object.create(Ha(Ab).prototype);Wc.prototype.constructor=Wc;var Lb={};Lb=function(){function a(p,v){return v&&`${v}::${fc++}`||p.uidEvent||fc++}function c(p){let v=a(p);return p.uidEvent=v,Yb[v]=Yb[v]||{},Yb[v]}function d(p,v,B=null){return Object.values(p).find(K=>K.callable===v&&K.delegationSelector===B)}function b(p,v,B){let K="string"==typeof v,R=f(p);return tc.has(R)||(R=p),[K,K?B:v||B,R]}function g(p,v,B,K,R){var aa,ja;if("string"==typeof v&&p){var [oa,Aa,Na]=
b(v,B,K);if(v in uc){let Da;Da=Aa;Aa=function(pa){if(!pa.relatedTarget||pa.relatedTarget!==pa.delegateTarget&&!pa.delegateTarget.contains(pa.relatedTarget))return Da.call(this,pa)}}K=c(p);K=K[Na]||(K[Na]={});var fa=d(K,Aa,oa?B:null);if(fa)return void(fa.oneOff=fa.oneOff&&R);v=a(Aa,v.replace($b,""));fa=oa?(aa=Aa,function Oa(pa){let La=p.querySelectorAll(B);for(let {target:Fa}=pa;Fa&&Fa!==this;Fa=Fa.parentNode)for(let Ga of La)if(Ga===Fa)return e(pa,{delegateTarget:Fa}),Oa.oneOff&&ca.off(p,pa.type,
B,aa),aa.apply(Fa,[pa])}):(ja=Aa,function La(Oa){return e(Oa,{delegateTarget:p}),La.oneOff&&ca.off(p,Oa.type,ja),ja.apply(p,[Oa])});fa.delegationSelector=oa?B:null;fa.callable=Aa;fa.oneOff=R;fa.uidEvent=v;K[v]=fa;p.addEventListener(Na,fa,oa)}}function n(p,v,B,K,R){(K=d(v[B],K,R))&&(p.removeEventListener(B,K,!!R),delete v[B][K.uidEvent])}function f(p){return uc[p=p.replace(Gb,"")]||p}function e(p,v={}){for(let [B,K]of Object.entries(v))try{p[B]=K}catch(R){Object.defineProperty(p,B,{configurable:!0,
get:()=>K})}return p}function l(p){if("true"===p)return!0;if("false"===p)return!1;if(p===Number(p).toString())return Number(p);if(""===p||"null"===p)return null;if("string"!=typeof p)return p;try{return JSON.parse(decodeURIComponent(p))}catch(v){return p}}function k(p){return p.replace(/[A-Z]/g,v=>`-${v.toLowerCase()}`)}function h(p){return p?(p.nodeName||"").toLowerCase():null}function m(p){return null==p?window:"[object Window]"!==p.toString()?(p=p.ownerDocument)&&p.defaultView||window:p}function q(p){return p instanceof
m(p).Element||p instanceof Element}function r(p){return p instanceof m(p).HTMLElement||p instanceof HTMLElement}function t(p){return"undefined"!=typeof ShadowRoot&&(p instanceof m(p).ShadowRoot||p instanceof ShadowRoot)}function u(p){return p.split("-")[0]}function y(){var p=navigator.userAgentData;return null!=p&&p.brands&&Array.isArray(p.brands)?p.brands.map(function(v){return v.brand+"/"+v.version}).join(" "):navigator.userAgent}function A(){return!/^((?!chrome|android).)*safari/i.test(y())}function F(p,
v,B){void 0===v&&(v=!1);void 0===B&&(B=!1);var K=p.getBoundingClientRect(),R=1,aa=1;v&&r(p)&&(R=0<p.offsetWidth&&Ua(K.width)/p.offsetWidth||1,aa=0<p.offsetHeight&&Ua(K.height)/p.offsetHeight||1);p=(q(p)?m(p):window).visualViewport;v=!A()&&B;B=(K.left+(v&&p?p.offsetLeft:0))/R;p=(K.top+(v&&p?p.offsetTop:0))/aa;R=K.width/R;K=K.height/aa;return{width:R,height:K,top:p,right:B+R,bottom:p+K,left:B,x:B,y:p}}function D(p){var v=F(p),B=p.offsetWidth,K=p.offsetHeight;return 1>=Math.abs(v.width-B)&&(B=v.width),
1>=Math.abs(v.height-K)&&(K=v.height),{x:p.offsetLeft,y:p.offsetTop,width:B,height:K}}function G(p,v){var B=v.getRootNode&&v.getRootNode();if(p.contains(v))return!0;if(B&&t(B)){do{if(v&&p.isSameNode(v))return!0;v=v.parentNode||v.host}while(v)}return!1}function E(p){return m(p).getComputedStyle(p)}function P(p){return((q(p)?p.ownerDocument:p.document)||window.document).documentElement}function N(p){return"html"===h(p)?p:p.assignedSlot||p.parentNode||(t(p)?p.host:null)||P(p)}function O(p){return r(p)&&
"fixed"!==E(p).position?p.offsetParent:null}function U(p){for(var v=m(p),B=O(p);B&&0<=["table","td","th"].indexOf(h(B))&&"static"===E(B).position;)B=O(B);if(!B||"html"!==h(B)&&("body"!==h(B)||"static"!==E(B).position)){if(!B)a:{B=/firefox/i.test(y());if(!/Trident/i.test(y())||!r(p)||"fixed"!==E(p).position)for(p=N(p),t(p)&&(p=p.host);r(p)&&0>["html","body"].indexOf(h(p));){var K=E(p);if("none"!==K.transform||"none"!==K.perspective||"paint"===K.contain||-1!==["transform","perspective"].indexOf(K.willChange)||
B&&"filter"===K.willChange||B&&K.filter&&"none"!==K.filter){B=p;break a}p=p.parentNode}B=null}v=B||v}return v}function da(p){return 0<=["top","bottom"].indexOf(p)?"x":"y"}function la(p){return Object.assign({},{top:0,right:0,bottom:0,left:0},p)}function J(p,v){return v.reduce(function(B,K){return B[K]=p,B},{})}function ea(p){return p.split("-")[1]}function Z(p){var v,B=p.popper,K=p.popperRect,R=p.placement,aa=p.variation,ja=p.offsets,oa=p.position,Aa=p.gpuAcceleration,Na=p.adaptive,fa=p.roundOffsets,
Da=p.isFixed;p=ja.x;p=void 0===p?0:p;var pa=ja.y;pa=void 0===pa?0:pa;pa="function"==typeof fa?fa({x:p,y:pa}):{x:p,y:pa};p=pa.x;pa=pa.y;var Oa=ja.hasOwnProperty("x");ja=ja.hasOwnProperty("y");var La="left",Fa="top",Ga=window;if(Na){var Pa=U(B),ob="clientHeight",Sa="clientWidth";Pa===m(B)&&"static"!==E(Pa=P(B)).position&&"absolute"===oa&&(ob="scrollHeight",Sa="scrollWidth");("top"===R||("left"===R||"right"===R)&&"end"===aa)&&(Fa="bottom",pa-=(Da&&Pa===Ga&&Ga.visualViewport?Ga.visualViewport.height:
Pa[ob])-K.height,pa*=Aa?1:-1);"left"!==R&&("top"!==R&&"bottom"!==R||"end"!==aa)||(La="right",p-=(Da&&Pa===Ga&&Ga.visualViewport?Ga.visualViewport.width:Pa[Sa])-K.width,p*=Aa?1:-1)}var xa,fb,gb,rb,hb,cb;K=Object.assign({position:oa},Na&&Ac);fa=!0===fa?(xa={x:p,y:pa},fb=m(B),gb=xa.x,rb=xa.y,{x:Ua(gb*(hb=fb.devicePixelRatio||1))/hb||0,y:Ua(rb*hb)/hb||0}):{x:p,y:pa};return p=fa.x,pa=fa.y,Aa?Object.assign({},K,((cb={})[Fa]=ja?"0":"",cb[La]=Oa?"0":"",cb.transform=1>=(Ga.devicePixelRatio||1)?"translate("+
p+"px, "+pa+"px)":"translate3d("+p+"px, "+pa+"px, 0)",cb)):Object.assign({},K,((v={})[Fa]=ja?pa+"px":"",v[La]=Oa?p+"px":"",v.transform="",v))}function Xa(p){return p.replace(/left|right|bottom|top/g,function(v){return Hg[v]})}function Ca(p){return p.replace(/start|end/g,function(v){return Ig[v]})}function pb(p){p=m(p);return{scrollLeft:p.pageXOffset,scrollTop:p.pageYOffset}}function jb(p){return F(P(p)).left+pb(p).scrollLeft}function sa(p){p=E(p);return/auto|scroll|overlay|hidden/.test(p.overflow+
p.overflowY+p.overflowX)}function ta(p,v){void 0===v&&(v=[]);var B,K=function ja(aa){return 0<=["html","body","#document"].indexOf(h(aa))?aa.ownerDocument.body:r(aa)&&sa(aa)?aa:ja(N(aa))}(p);p=K===(null==(B=p.ownerDocument)?void 0:B.body);B=m(K);K=p?[B].concat(B.visualViewport||[],sa(K)?K:[]):K;v=v.concat(K);return p?v:v.concat(ta(N(K)))}function T(p){return Object.assign({},p,{left:p.x,top:p.y,right:p.x+p.width,bottom:p.y+p.height})}function na(p,v,B){var K,R,aa,ja,oa,Aa,Na;if("viewport"===v){v=
m(p);var fa=P(p);v=v.visualViewport;var Da=fa.clientWidth;fa=fa.clientHeight;var pa=K=0;v&&(Da=v.width,fa=v.height,((R=A())||!R&&"fixed"===B)&&(K=v.offsetLeft,pa=v.offsetTop));p={width:Da,height:fa,x:K+jb(p),y:pa};B=T(p)}else B=q(v)?((Da=F(v,!1,"fixed"===B)).top=Da.top+v.clientTop,Da.left+=v.clientLeft,Da.bottom=Da.top+v.clientHeight,Da.right=Da.left+v.clientWidth,Da.width=v.clientWidth,Da.height=v.clientHeight,Da.x=Da.left,Da.y=Da.top,Da):T((fa=P(p),pa=P(fa),R=pb(fa),aa=null==(K=fa.ownerDocument)?
void 0:K.body,ja=va(pa.scrollWidth,pa.clientWidth,aa?aa.scrollWidth:0,aa?aa.clientWidth:0),oa=va(pa.scrollHeight,pa.clientHeight,aa?aa.scrollHeight:0,aa?aa.clientHeight:0),Aa=-R.scrollLeft+jb(fa),Na=-R.scrollTop,"rtl"===E(aa||pa).direction&&(Aa+=va(pa.clientWidth,aa?aa.clientWidth:0)-ja),{width:ja,height:oa,x:Aa,y:Na}));return B}function ba(p){var v=p.reference,B=p.element,K=(p=p.placement)?u(p):null;p=p?ea(p):null;var R=v.x+v.width/2-B.width/2;var aa=v.y+v.height/2-B.height/2;switch(K){case "top":R=
{x:R,y:v.y-B.height};break;case "bottom":R={x:R,y:v.y+v.height};break;case "right":R={x:v.x+v.width,y:aa};break;case "left":R={x:v.x-B.width,y:aa};break;default:R={x:v.x,y:v.y}}K=K?da(K):null;if(null!=K)switch(aa="y"===K?"height":"width",p){case "start":R[K]-=v[aa]/2-B[aa]/2;break;case "end":R[K]+=v[aa]/2-B[aa]/2}return R}function Q(p,v){void 0===v&&(v={});var B,K,R,aa,ja,oa,Aa,Na,fa=v;v=fa.placement;v=void 0===v?p.placement:v;var Da=fa.strategy,pa=void 0===Da?p.strategy:Da,Oa=fa.boundary,La=fa.rootBoundary;
Da=fa.elementContext;Da=void 0===Da?"popper":Da;var Fa=fa.altBoundary;fa=fa.padding;fa=void 0===fa?0:fa;fa=la("number"!=typeof fa?fa:J(fa,tb));var Ga=p.rects.popper;Fa=p.elements[void 0!==Fa&&Fa?"popper"===Da?"reference":"popper":Da];Fa=(B=q(Fa)?Fa:Fa.contextElement||P(p.elements.popper),K=void 0===Oa?"clippingParents":Oa,R=void 0===La?"viewport":La,Aa=(oa=[].concat("clippingParents"===K?(aa=ta(N(B)),q(ja=0<=["absolute","fixed"].indexOf(E(B).position)&&r(B)?U(B):B)?aa.filter(function(Sa){return q(Sa)&&
G(Sa,ja)&&"body"!==h(Sa)}):[]):[].concat(K),[R]))[0],(Na=oa.reduce(function(Sa,xa){xa=na(B,xa,pa);return Sa.top=va(xa.top,Sa.top),Sa.right=Ra(xa.right,Sa.right),Sa.bottom=Ra(xa.bottom,Sa.bottom),Sa.left=va(xa.left,Sa.left),Sa},na(B,Aa,pa))).width=Na.right-Na.left,Na.height=Na.bottom-Na.top,Na.x=Na.left,Na.y=Na.top,Na);K=F(p.elements.reference);R=ba({reference:K,element:Ga,strategy:"absolute",placement:v});R=T(Object.assign({},Ga,R));K="popper"===Da?R:K;var Pa={top:Fa.top-K.top+fa.top,bottom:K.bottom-
Fa.bottom+fa.bottom,left:Fa.left-K.left+fa.left,right:K.right-Fa.right+fa.right};p=p.modifiersData.offset;if("popper"===Da&&p){var ob=p[v];Object.keys(Pa).forEach(function(Sa){var xa=0<=["right","bottom"].indexOf(Sa)?1:-1,fb=0<=["top","bottom"].indexOf(Sa)?"y":"x";Pa[Sa]+=ob[fb]*xa})}return Pa}function Ja(p,v,B){return void 0===B&&(B={x:0,y:0}),{top:p.top-v.height-B.y,right:p.right-v.width+B.x,bottom:p.bottom-v.height+B.y,left:p.left-v.width-B.x}}function V(p){return["top","right","bottom","left"].some(function(v){return 0<=
p[v]})}function Ba(){for(var p=arguments.length,v=Array(p),B=0;B<p;B++)v[B]=arguments[B];return!v.some(function(K){return!(K&&"function"==typeof K.getBoundingClientRect)})}function ma(p){void 0===p&&(p={});var v=p.defaultModifiers,B=void 0===v?[]:v;p=p.defaultOptions;var K=void 0===p?sf:p;return function(R,aa,ja){function oa(){Da.forEach(function(La){return La()});Da=[]}void 0===ja&&(ja=K);var Aa,Na,fa={placement:"bottom",orderedModifiers:[],options:Object.assign({},sf,K),modifiersData:{},elements:{reference:R,
popper:aa},attributes:{},styles:{}},Da=[],pa=!1,Oa={state:fa,setOptions:function(La){La="function"==typeof La?La(fa.options):La;oa();fa.options=Object.assign({},K,fa.options,La);fa.scrollParents={reference:q(R)?ta(R):R.contextElement?ta(R.contextElement):[],popper:ta(aa)};var Fa,Ga,Pa,ob,Sa;La=(Fa=Object.keys(Sa=[].concat(B,fa.options.modifiers).reduce(function(xa,fb){var gb=xa[fb.name];return xa[fb.name]=gb?Object.assign({},gb,fb,{options:Object.assign({},gb.options,fb.options),data:Object.assign({},
gb.data,fb.data)}):fb,xa},{})).map(function(xa){return Sa[xa]}),Ga=new Map,Pa=new Set,ob=[],Fa.forEach(function(xa){Ga.set(xa.name,xa)}),Fa.forEach(function(xa){Pa.has(xa.name)||function rb(gb){Pa.add(gb.name);[].concat(gb.requires||[],gb.requiresIfExists||[]).forEach(function(hb){Pa.has(hb)||(hb=Ga.get(hb))&&rb(hb)});ob.push(gb)}(xa)}),ia.reduce(function(xa,fb){return xa.concat(ob.filter(function(gb){return gb.phase===fb}))},[]));return fa.orderedModifiers=La.filter(function(xa){return xa.enabled}),
fa.orderedModifiers.forEach(function(xa){var fb=xa.name,gb=xa.options;xa=xa.effect;"function"==typeof xa&&(fb=xa({state:fa,name:fb,instance:Oa,options:void 0===gb?{}:gb}),Da.push(fb||function(){}))}),Oa.update()},forceUpdate:function(){if(!pa){var La=fa.elements,Fa=La.reference;La=La.popper;if(Ba(Fa,La)){fa.rects={reference:(Ga=U(La),Pa="fixed"===fa.options.strategy,fb=r(Ga),gb=r(Ga)&&(Sa=Ua((ob=Ga.getBoundingClientRect()).width)/Ga.offsetWidth||1,xa=Ua(ob.height)/Ga.offsetHeight||1,1!==Sa||1!==xa),
rb=P(Ga),hb=F(Fa,gb,Pa),cb={scrollLeft:0,scrollTop:0},Ob={x:0,y:0},(fb||!fb&&!Pa)&&(("body"!==h(Ga)||sa(rb))&&(cb=Ga!==m(Ga)&&r(Ga)?{scrollLeft:Ga.scrollLeft,scrollTop:Ga.scrollTop}:pb(Ga)),r(Ga)?((Ob=F(Ga,!0)).x+=Ga.clientLeft,Ob.y+=Ga.clientTop):rb&&(Ob.x=jb(rb))),{x:hb.left+cb.scrollLeft-Ob.x,y:hb.top+cb.scrollTop-Ob.y,width:hb.width,height:hb.height}),popper:D(La)};fa.reset=!1;fa.placement=fa.options.placement;fa.orderedModifiers.forEach(function(oc){return fa.modifiersData[oc.name]=Object.assign({},
oc.data)});var Ga,Pa,ob,Sa,xa,fb,gb,rb,hb,cb,Ob;for(Fa=0;Fa<fa.orderedModifiers.length;Fa++)!0!==fa.reset?(Pa=fa.orderedModifiers[Fa],Ga=Pa.fn,ob=Pa.options,ob=void 0===ob?{}:ob,Pa=Pa.name,"function"==typeof Ga&&(fa=Ga({state:fa,options:ob,name:Pa,instance:Oa})||fa)):(fa.reset=!1,Fa=-1)}}},update:(Aa=function(){return new Promise(function(La){Oa.forceUpdate();La(fa)})},function(){return Na||=new Promise(function(La){Promise.resolve().then(function(){Na=void 0;La(Aa())})}),Na}),destroy:function(){oa();
pa=!0}};return Ba(R,aa)?(Oa.setOptions(ja).then(function(La){!pa&&ja.onFirstUpdate&&ja.onFirstUpdate(La)}),Oa):Oa}}let Ma=new Map,yb={set(p,v,B){Ma.has(p)||Ma.set(p,new Map);p=Ma.get(p);p.has(v)||0===p.size?p.set(v,B):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(p.keys())[0]}.`)},get:(p,v)=>Ma.has(p)&&Ma.get(p).get(v)||null,remove(p,v){if(Ma.has(p)){var B=Ma.get(p);B.delete(v);0===B.size&&Ma.delete(p)}}},Cb=p=>(p&&window.CSS&&window.CSS.escape&&
(p=p.replace(/#([^\s"#']+)/g,(v,B)=>`#${CSS.escape(B)}`)),p),vb=p=>!(!p||"object"!=typeof p)&&(void 0!==p.jquery&&(p=p[0]),void 0!==p.nodeType),eb=p=>vb(p)?p.jquery?p[0]:p:"string"==typeof p&&0<p.length?document.querySelector(Cb(p)):null,lb=p=>{if(!vb(p)||0===p.getClientRects().length)return!1;let v="visible"===getComputedStyle(p).getPropertyValue("visibility"),B=p.closest("details:not([open])");return B?B!==p&&((p=p.closest("summary"))&&p.parentNode!==B||null===p)?!1:v:v},Bb=p=>!p||p.nodeType!==
Node.ELEMENT_NODE||!!p.classList.contains("disabled")||(void 0!==p.disabled?p.disabled:p.hasAttribute("disabled")&&"false"!==p.getAttribute("disabled")),bb=p=>document.documentElement.attachShadow?"function"==typeof p.getRootNode?(p=p.getRootNode(),p instanceof ShadowRoot?p:null):p instanceof ShadowRoot?p:p.parentNode?bb(p.parentNode):null:null,Wa=()=>{},Ia=p=>{p.offsetHeight},Ub=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,$a=[],wb=p=>{var v=()=>{let B=Ub();
if(B){let K=p.NAME,R=B.fn[K];B.fn[K]=p.jQueryInterface;B.fn[K].Constructor=p;B.fn[K].noConflict=()=>(B.fn[K]=R,p.jQueryInterface)}};"loading"===document.readyState?($a.length||document.addEventListener("DOMContentLoaded",()=>{for(let B of $a)B()}),$a.push(v)):v()},zb=(p,v=[],B=p)=>"function"==typeof p?p(...v):B,Fb=(p,v,B=!0)=>{if(!B)return void zb(p);B=(aa=>{if(!aa)return 0;let {transitionDuration:ja,transitionDelay:oa}=window.getComputedStyle(aa);aa=Number.parseFloat(ja);let Aa=Number.parseFloat(oa);
return aa||Aa?(ja=ja.split(",")[0],oa=oa.split(",")[0],1E3*(Number.parseFloat(ja)+Number.parseFloat(oa))):0})(v)+5;let K=!1,R=({target:aa})=>{aa===v&&(K=!0,v.removeEventListener("transitionend",R),zb(p))};v.addEventListener("transitionend",R);setTimeout(()=>{K||v.dispatchEvent(new Event("transitionend"))},B)},sb=(p,v,B,K)=>{let R=p.length;v=p.indexOf(v);return-1===v?!B&&K?p[R-1]:p[0]:(v+=B?1:-1,K&&(v=(v+R)%R),p[Math.max(0,Math.min(v,R-1))])},$b=/[^.]*(?=\..*)\.|.*/,Gb=/\..*/,Xb=/::\d+$/,Yb={},fc=
1,uc={mouseenter:"mouseover",mouseleave:"mouseout"},tc=new Set("click dblclick mouseup mousedown contextmenu mousewheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange touchstart touchmove touchend touchcancel pointerdown pointermove pointerup pointerleave pointercancel gesturestart gesturechange gestureend focus blur change reset select submit focusin focusout load unload beforeunload resize move DOMContentLoaded readystatechange error abort scroll".split(" ")),
ca={on(p,v,B,K){g(p,v,B,K,!1)},one(p,v,B,K){g(p,v,B,K,!0)},off(p,v,B,K){if("string"==typeof v&&p){var [R,aa,ja]=b(v,B,K);K=ja!==v;var oa=c(p),Aa=oa[ja]||{},Na=v.startsWith(".");if(void 0===aa){if(Na)for(var fa of Object.keys(oa)){B=v.slice(1);for(let [Da,pa]of Object.entries(oa[fa]||{}))Da.includes(B)&&n(p,oa,fa,pa.callable,pa.delegationSelector)}for(let [Da,pa]of Object.entries(Aa))fa=Da.replace(Xb,""),K&&!v.includes(fa)||n(p,oa,ja,pa.callable,pa.delegationSelector)}else Object.keys(Aa).length&&
n(p,oa,ja,aa,R?B:null)}},trigger(p,v,B){if("string"!=typeof v||!p)return null;let K=Ub(),R=null,aa=!0,ja=!0,oa=!1;v!==f(v)&&K&&(R=K.Event(v,B),K(p).trigger(R),aa=!R.isPropagationStopped(),ja=!R.isImmediatePropagationStopped(),oa=R.isDefaultPrevented());v=e(new Event(v,{bubbles:aa,cancelable:!0}),B);return oa&&v.preventDefault(),ja&&p.dispatchEvent(v),v.defaultPrevented&&R&&R.preventDefault(),v}},Qb={setDataAttribute(p,v,B){p.setAttribute(`data-bs-${k(v)}`,B)},removeDataAttribute(p,v){p.removeAttribute(`data-bs-${k(v)}`)},
getDataAttributes(p){if(!p)return{};let v={};for(let B of Object.keys(p.dataset).filter(K=>K.startsWith("bs")&&!K.startsWith("bsConfig"))){let K=B.replace(/^bs/,"");v[K=K.charAt(0).toLowerCase()+K.slice(1,K.length)]=l(p.dataset[B])}return v},getDataAttribute:(p,v)=>l(p.getAttribute(`data-bs-${k(v)}`))};class ac{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw Error('You have to implement the static method "NAME", for each component!');}_getConfig(p){return p=
this._mergeConfigObj(p),p=this._configAfterMerge(p),this._typeCheckConfig(p),p}_configAfterMerge(p){return p}_mergeConfigObj(p,v){let B=vb(v)?Qb.getDataAttribute(v,"config"):{};return{...this.constructor.Default,...("object"==typeof B?B:{}),...(vb(v)?Qb.getDataAttributes(v):{}),...("object"==typeof p?p:{})}}_typeCheckConfig(p,v=this.constructor.DefaultType){for(let [B,K]of Object.entries(v))if(v=p[B],v=vb(v)?"element":null==v?`${v}`:Object.prototype.toString.call(v).match(/\s([a-z]+)/i)[1].toLowerCase(),
!(new RegExp(K)).test(v))throw TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${B}" provided type "${v}" but expected type "${K}".`);}}class Kb extends ac{dispose(){for(let p of(yb.remove(this._element,this.constructor.DATA_KEY),ca.off(this._element,this.constructor.EVENT_KEY),Object.getOwnPropertyNames(this)))this[p]=null}_queueCallback(p,v,B=!0){Fb(p,v,B)}_getConfig(p){return p=this._mergeConfigObj(p,this._element),p=this._configAfterMerge(p),this._typeCheckConfig(p),p}static getInstance(p){return yb.get(eb(p),
this.DATA_KEY)}static getOrCreateInstance(p,v={}){return this.getInstance(p)||new this(p,"object"==typeof v?v:null)}static get VERSION(){return"5.3.3"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(p){return`${p}${this.EVENT_KEY}`}constructor(p,v){super();(p=eb(p))&&(this._element=p,this._config=this._getConfig(v),yb.set(this._element,this.constructor.DATA_KEY,this))}}let Ea=p=>{let v=p.getAttribute("data-bs-target");if(!v||"#"===v){p=
p.getAttribute("href");if(!p||!p.includes("#")&&!p.startsWith("."))return null;p.includes("#")&&!p.startsWith("#")&&(p=`#${p.split("#")[1]}`);v=p&&"#"!==p?p.trim():null}return v?v.split(",").map(B=>Cb(B)).join(","):null},wa={find:(p,v=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(v,p)),findOne:(p,v=document.documentElement)=>Element.prototype.querySelector.call(v,p),children:(p,v)=>[].concat(...p.children).filter(B=>B.matches(v)),parents(p,v){let B=[];for(p=p.parentNode.closest(v);p;)B.push(p),
p=p.parentNode.closest(v);return B},prev(p,v){for(p=p.previousElementSibling;p;){if(p.matches(v))return[p];p=p.previousElementSibling}return[]},next(p,v){for(p=p.nextElementSibling;p;){if(p.matches(v))return[p];p=p.nextElementSibling}return[]},focusableChildren(p){let v='a button input textarea select details [tabindex] [contenteditable="true"]'.split(" ").map(B=>`${B}:not([tabindex^="-"])`).join(",");return this.find(v,p).filter(B=>!Bb(B)&&lb(B))},getSelectorFromElement(p){return(p=Ea(p))&&wa.findOne(p)?
p:null},getElementFromSelector(p){return(p=Ea(p))?wa.findOne(p):null},getMultipleElementsFromSelector(p){return(p=Ea(p))?wa.find(p):[]}},Hb=(p,v="hide")=>{let B=p.NAME;ca.on(document,`click.dismiss${p.EVENT_KEY}`,`[data-bs-dismiss="${B}"]`,function(K){(["A","AREA"].includes(this.tagName)&&K.preventDefault(),Bb(this))||(K=wa.getElementFromSelector(this)||this.closest(`.${B}`),p.getOrCreateInstance(K)[v]())})};class Vb extends Kb{static get NAME(){return"alert"}close(){if(!ca.trigger(this._element,
"close.bs.alert").defaultPrevented){this._element.classList.remove("show");var p=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,p)}}_destroyElement(){this._element.remove();ca.trigger(this._element,"closed.bs.alert");this.dispose()}static jQueryInterface(p){return this.each(function(){let v=Vb.getOrCreateInstance(this);if("string"==typeof p){if(void 0===v[p]||p.startsWith("_")||"constructor"===p)throw TypeError(`No method named "${p}"`);v[p](this)}})}}
Hb(Vb,"close");wb(Vb);class x extends Kb{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(p){return this.each(function(){let v=x.getOrCreateInstance(this);"toggle"===p&&v[p]()})}}ca.on(document,"click.bs.button.data-api",'[data-bs-toggle="button"]',p=>{p.preventDefault();p=p.target.closest('[data-bs-toggle="button"]');x.getOrCreateInstance(p).toggle()});wb(x);let H={endCallback:null,leftCallback:null,
rightCallback:null},w={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class C extends ac{static get Default(){return H}static get DefaultType(){return w}static get NAME(){return"swipe"}dispose(){ca.off(this._element,".bs.swipe")}_start(p){this._supportPointerEvents?this._eventIsPointerPenTouch(p)&&(this._deltaX=p.clientX):this._deltaX=p.touches[0].clientX}_end(p){this._eventIsPointerPenTouch(p)&&(this._deltaX=p.clientX-this._deltaX);this._handleSwipe();
zb(this._config.endCallback)}_move(p){this._deltaX=p.touches&&1<p.touches.length?0:p.touches[0].clientX-this._deltaX}_handleSwipe(){var p=Math.abs(this._deltaX);40>=p||(p/=this._deltaX,this._deltaX=0,p&&zb(0<p?this._config.rightCallback:this._config.leftCallback))}_initEvents(){this._supportPointerEvents?(ca.on(this._element,"pointerdown.bs.swipe",p=>this._start(p)),ca.on(this._element,"pointerup.bs.swipe",p=>this._end(p)),this._element.classList.add("pointer-event")):(ca.on(this._element,"touchstart.bs.swipe",
p=>this._start(p)),ca.on(this._element,"touchmove.bs.swipe",p=>this._move(p)),ca.on(this._element,"touchend.bs.swipe",p=>this._end(p)))}_eventIsPointerPenTouch(p){return this._supportPointerEvents&&("pen"===p.pointerType||"touch"===p.pointerType)}static isSupported(){return"ontouchstart"in document.documentElement||0<navigator.maxTouchPoints}constructor(p,v){super();(this._element=p)&&C.isSupported()&&(this._config=this._getConfig(v),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,
this._initEvents())}}let I={ArrowLeft:"right",ArrowRight:"left"},M={interval:5E3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},X={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class W extends Kb{static get Default(){return M}static get DefaultType(){return X}static get NAME(){return"carousel"}next(){this._slide("next")}nextWhenVisible(){!document.hidden&&lb(this._element)&&this.next()}prev(){this._slide("prev")}pause(){this._isSliding&&
this._element.dispatchEvent(new Event("transitionend"));this._clearInterval()}cycle(){this._clearInterval();this._updateInterval();this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?ca.one(this._element,"slid.bs.carousel",()=>this.cycle()):this.cycle())}to(p){let v=this._getItems();if(!(p>v.length-1||0>p)){if(this._isSliding)return void ca.one(this._element,"slid.bs.carousel",()=>this.to(p));var B=this._getItemIndex(this._getActive());
B!==p&&this._slide(p>B?"next":"prev",v[p])}}dispose(){this._swipeHelper&&this._swipeHelper.dispose();super.dispose()}_configAfterMerge(p){return p.defaultInterval=p.interval,p}_addEventListeners(){this._config.keyboard&&ca.on(this._element,"keydown.bs.carousel",p=>this._keydown(p));"hover"===this._config.pause&&(ca.on(this._element,"mouseenter.bs.carousel",()=>this.pause()),ca.on(this._element,"mouseleave.bs.carousel",()=>this._maybeEnableCycle()));this._config.touch&&C.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(let p of wa.find(".carousel-item img",
this._element))ca.on(p,"dragstart.bs.carousel",v=>v.preventDefault());this._swipeHelper=new C(this._element,{leftCallback:()=>this._slide(this._directionToOrder("left")),rightCallback:()=>this._slide(this._directionToOrder("right")),endCallback:()=>{"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}})}_keydown(p){if(!/input|textarea/i.test(p.target.tagName)){var v=I[p.key];
v&&(p.preventDefault(),this._slide(this._directionToOrder(v)))}}_getItemIndex(p){return this._getItems().indexOf(p)}_setActiveIndicatorElement(p){if(this._indicatorsElement){var v=wa.findOne(".active",this._indicatorsElement);v.classList.remove("active");v.removeAttribute("aria-current");(p=wa.findOne(`[data-bs-slide-to="${p}"]`,this._indicatorsElement))&&(p.classList.add("active"),p.setAttribute("aria-current","true"))}}_updateInterval(){var p=this._activeElement||this._getActive();p&&(p=Number.parseInt(p.getAttribute("data-bs-interval"),
10),this._config.interval=p||this._config.defaultInterval)}_slide(p,v=null){if(!this._isSliding){var B=this._getActive(),K="next"===p,R=v||sb(this._getItems(),B,K,this._config.wrap);if(R!==B){var aa=this._getItemIndex(R),ja=Na=>ca.trigger(this._element,Na,{relatedTarget:R,direction:this._orderToDirection(p),from:this._getItemIndex(B),to:aa});if(!ja("slide.bs.carousel").defaultPrevented&&B&&R){v=!!this._interval;this.pause();this._isSliding=!0;this._setActiveIndicatorElement(aa);this._activeElement=
R;var oa=K?"carousel-item-start":"carousel-item-end",Aa=K?"carousel-item-next":"carousel-item-prev";R.classList.add(Aa);R.offsetHeight;B.classList.add(oa);R.classList.add(oa);this._queueCallback(()=>{R.classList.remove(oa,Aa);R.classList.add("active");B.classList.remove("active",Aa,oa);this._isSliding=!1;ja("slid.bs.carousel")},B,this._isAnimated());v&&this.cycle()}}}}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return wa.findOne(".active.carousel-item",this._element)}_getItems(){return wa.find(".carousel-item",
this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(p){return"rtl"===document.documentElement.dir?"left"===p?"prev":"next":"left"===p?"next":"prev"}_orderToDirection(p){return"rtl"===document.documentElement.dir?"prev"===p?"left":"right":"prev"===p?"right":"left"}static jQueryInterface(p){return this.each(function(){let v=W.getOrCreateInstance(this,p);if("number"!=typeof p){if("string"==typeof p){if(void 0===v[p]||p.startsWith("_")||
"constructor"===p)throw TypeError(`No method named "${p}"`);v[p]()}}else v.to(p)})}constructor(p,v){super(p,v);this._activeElement=this._interval=null;this._isSliding=!1;this._swipeHelper=this.touchTimeout=null;this._indicatorsElement=wa.findOne(".carousel-indicators",this._element);this._addEventListeners();"carousel"===this._config.ride&&this.cycle()}}ca.on(document,"click.bs.carousel.data-api","[data-bs-slide], [data-bs-slide-to]",function(p){var v=wa.getElementFromSelector(this);if(v&&v.classList.contains("carousel"))return p.preventDefault(),
p=W.getOrCreateInstance(v),v=this.getAttribute("data-bs-slide-to"),v?p.to(v):"next"===Qb.getDataAttribute(this,"slide")?p.next():p.prev(),void p._maybeEnableCycle()});ca.on(window,"load.bs.carousel.data-api",()=>{for(let p of wa.find('[data-bs-ride="carousel"]'))W.getOrCreateInstance(p)});wb(W);let ra={parent:null,toggle:!0},Ka={parent:"(null|element)",toggle:"boolean"};class db extends Kb{static get Default(){return ra}static get DefaultType(){return Ka}static get NAME(){return"collapse"}toggle(){this._isShown()?
this.hide():this.show()}show(){if(!this._isTransitioning&&!this._isShown()){var p=[];if(!(this._config.parent&&(p=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(B=>B!==this._element).map(B=>db.getOrCreateInstance(B,{toggle:!1}))),p.length&&p[0]._isTransitioning||ca.trigger(this._element,"show.bs.collapse").defaultPrevented)){for(let B of p)B.hide();var v=this._getDimension();this._element.classList.remove("collapse");this._element.classList.add("collapsing");this._element.style[v]=
0;this._addAriaAndCollapsedClass(this._triggerArray,!0);this._isTransitioning=!0;p=`scroll${v[0].toUpperCase()+v.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1;this._element.classList.remove("collapsing");this._element.classList.add("collapse","show");this._element.style[v]="";ca.trigger(this._element,"shown.bs.collapse")},this._element,!0);this._element.style[v]=`${this._element[p]}px`}}}hide(){if(!this._isTransitioning&&this._isShown()&&!ca.trigger(this._element,"hide.bs.collapse").defaultPrevented){var p=
this._getDimension();for(let v of(this._element.style[p]=`${this._element.getBoundingClientRect()[p]}px`,Ia(this._element),this._element.classList.add("collapsing"),this._element.classList.remove("collapse","show"),this._triggerArray)){let B=wa.getElementFromSelector(v);B&&!this._isShown(B)&&this._addAriaAndCollapsedClass([v],!1)}this._isTransitioning=!0;this._element.style[p]="";this._queueCallback(()=>{this._isTransitioning=!1;this._element.classList.remove("collapsing");this._element.classList.add("collapse");
ca.trigger(this._element,"hidden.bs.collapse")},this._element,!0)}}_isShown(p=this._element){return p.classList.contains("show")}_configAfterMerge(p){return p.toggle=!!p.toggle,p.parent=eb(p.parent),p}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(this._config.parent)for(let p of this._getFirstLevelChildren('[data-bs-toggle="collapse"]')){let v=wa.getElementFromSelector(p);v&&this._addAriaAndCollapsedClass([p],this._isShown(v))}}_getFirstLevelChildren(p){let v=
wa.find(":scope .collapse .collapse",this._config.parent);return wa.find(p,this._config.parent).filter(B=>!v.includes(B))}_addAriaAndCollapsedClass(p,v){if(p.length)for(let B of p)B.classList.toggle("collapsed",!v),B.setAttribute("aria-expanded",v)}static jQueryInterface(p){let v={};return"string"==typeof p&&/show|hide/.test(p)&&(v.toggle=!1),this.each(function(){let B=db.getOrCreateInstance(this,v);if("string"==typeof p){if(void 0===B[p])throw TypeError(`No method named "${p}"`);B[p]()}})}constructor(p,
v){for(let B of(super(p,v),this._isTransitioning=!1,this._triggerArray=[],wa.find('[data-bs-toggle="collapse"]')))p=wa.getSelectorFromElement(B),v=wa.find(p).filter(K=>K===this._element),null!==p&&v.length&&this._triggerArray.push(B);this._initializeChildren();this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown());this._config.toggle&&this.toggle()}}ca.on(document,"click.bs.collapse.data-api",'[data-bs-toggle="collapse"]',function(p){for(let v of(("A"===p.target.tagName||
p.delegateTarget&&"A"===p.delegateTarget.tagName)&&p.preventDefault(),wa.getMultipleElementsFromSelector(this)))db.getOrCreateInstance(v,{toggle:!1}).toggle()});wb(db);var tb=["top","bottom","right","left"],xb=tb.reduce(function(p,v){return p.concat([v+"-start",v+"-end"])},[]),Ya=[].concat(tb,["auto"]).reduce(function(p,v){return p.concat([v,v+"-start",v+"-end"])},[]),ia="beforeRead read afterRead beforeMain main afterMain beforeWrite write afterWrite".split(" ");let ua={name:"applyStyles",enabled:!0,
phase:"write",fn:function(p){var v=p.state;Object.keys(v.elements).forEach(function(B){var K=v.styles[B]||{},R=v.attributes[B]||{},aa=v.elements[B];r(aa)&&h(aa)&&(Object.assign(aa.style,K),Object.keys(R).forEach(function(ja){var oa=R[ja];!1===oa?aa.removeAttribute(ja):aa.setAttribute(ja,!0===oa?"":oa)}))})},effect:function(p){var v=p.state,B={popper:{position:v.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(v.elements.popper.style,B.popper),
v.styles=B,v.elements.arrow&&Object.assign(v.elements.arrow.style,B.arrow),function(){Object.keys(v.elements).forEach(function(K){var R=v.elements[K],aa=v.attributes[K]||{};K=Object.keys(v.styles.hasOwnProperty(K)?v.styles[K]:B[K]).reduce(function(ja,oa){return ja[oa]="",ja},{});r(R)&&h(R)&&(Object.assign(R.style,K),Object.keys(aa).forEach(function(ja){R.removeAttribute(ja)}))})}},requires:["computeStyles"]};var va=Math.max,Ra=Math.min,Ua=Math.round;let Wb={name:"arrow",enabled:!0,phase:"main",fn:function(p){var v,
B=p.state,K=p.name,R=p.options,aa=B.elements.arrow,ja=B.modifiersData.popperOffsets,oa=u(B.placement);p=da(oa);oa=0<=["left","right"].indexOf(oa)?"height":"width";if(aa&&ja){var Aa;R=(Aa=R.padding,la("number"!=typeof(Aa="function"==typeof Aa?Aa(Object.assign({},B.rects,{placement:B.placement})):Aa)?Aa:J(Aa,tb)));Aa=D(aa);var Na="y"===p?"top":"left",fa="y"===p?"bottom":"right",Da=B.rects.reference[oa]+B.rects.reference[p]-ja[p]-B.rects.popper[oa];ja=ja[p]-B.rects.reference[p];aa=(aa=U(aa))?"y"===p?
aa.clientHeight||0:aa.clientWidth||0:0;ja=aa/2-Aa[oa]/2+(Da/2-ja/2);oa=va(R[Na],Ra(ja,aa-Aa[oa]-R[fa]));B.modifiersData[K]=((v={})[p]=oa,v.centerOffset=oa-ja,v)}},effect:function(p){var v=p.state;p=p.options.element;p=void 0===p?"[data-popper-arrow]":p;null!=p&&("string"!=typeof p||(p=v.elements.popper.querySelector(p)))&&G(v.elements.popper,p)&&(v.elements.arrow=p)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};var Ac={top:"auto",right:"auto",bottom:"auto",left:"auto"};let ee=
{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(p){var v=p.state,B=p.options,K=B.gpuAcceleration;p=B.adaptive;B=B.roundOffsets;B=void 0===B||B;K={placement:u(v.placement),variation:ea(v.placement),popper:v.elements.popper,popperRect:v.rects.popper,gpuAcceleration:void 0===K||K,isFixed:"fixed"===v.options.strategy};null!=v.modifiersData.popperOffsets&&(v.styles.popper=Object.assign({},v.styles.popper,Z(Object.assign({},K,{offsets:v.modifiersData.popperOffsets,position:v.options.strategy,
adaptive:void 0===p||p,roundOffsets:B}))));null!=v.modifiersData.arrow&&(v.styles.arrow=Object.assign({},v.styles.arrow,Z(Object.assign({},K,{offsets:v.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:B}))));v.attributes.popper=Object.assign({},v.attributes.popper,{"data-popper-placement":v.placement})},data:{}};var Ad={passive:!0};let fe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(p){var v=p.state,B=p.instance;p=p.options;var K=p.scroll,R=void 0===
K||K;p=p.resize;var aa=void 0===p||p,ja=m(v.elements.popper),oa=[].concat(v.scrollParents.reference,v.scrollParents.popper);return R&&oa.forEach(function(Aa){Aa.addEventListener("scroll",B.update,Ad)}),aa&&ja.addEventListener("resize",B.update,Ad),function(){R&&oa.forEach(function(Aa){Aa.removeEventListener("scroll",B.update,Ad)});aa&&ja.removeEventListener("resize",B.update,Ad)}},data:{}};var Hg={left:"right",right:"left",bottom:"top",top:"bottom"},Ig={start:"end",end:"start"};let zf={name:"flip",
enabled:!0,phase:"main",fn:function(p){var v=p.state,B=p.options;p=p.name;if(!v.modifiersData[p]._skip){var K=B.mainAxis;K=void 0===K||K;var R=B.altAxis;R=void 0===R||R;var aa=B.fallbackPlacements,ja=B.padding,oa=B.boundary,Aa=B.rootBoundary,Na=B.altBoundary,fa=B.flipVariations,Da=void 0===fa||fa,pa=B.allowedAutoPlacements;B=v.options.placement;fa=u(B);aa=aa||(fa!==B&&Da?function(rb){if("auto"===u(rb))return[];var hb=Xa(rb);return[Ca(rb),hb,Ca(hb)]}(B):[Xa(B)]);var Oa=[B].concat(aa).reduce(function(rb,
hb){var cb,Ob,oc,pc,tf,uf,vf,wf,xf,yf,ge,he;return rb.concat("auto"===u(hb)?(Ob=(cb={placement:hb,boundary:oa,rootBoundary:Aa,padding:ja,flipVariations:Da,allowedAutoPlacements:pa}).placement,oc=cb.boundary,pc=cb.rootBoundary,tf=cb.padding,uf=cb.flipVariations,wf=void 0===(vf=cb.allowedAutoPlacements)?Ya:vf,0===(ge=(yf=(xf=ea(Ob))?uf?xb:xb.filter(function(qc){return ea(qc)===xf}):tb).filter(function(qc){return 0<=wf.indexOf(qc)})).length&&(ge=yf),Object.keys(he=ge.reduce(function(qc,dd){return qc[dd]=
Q(v,{placement:dd,boundary:oc,rootBoundary:pc,padding:tf})[u(dd)],qc},{})).sort(function(qc,dd){return he[qc]-he[dd]})):hb)},[]);B=v.rects.reference;aa=v.rects.popper;var La=new Map;fa=!0;for(var Fa=Oa[0],Ga=0;Ga<Oa.length;Ga++){var Pa=Oa[Ga],ob=u(Pa),Sa="start"===ea(Pa),xa=0<=["top","bottom"].indexOf(ob),fb=xa?"width":"height",gb=Q(v,{placement:Pa,boundary:oa,rootBoundary:Aa,altBoundary:Na,padding:ja});Sa=xa?Sa?"right":"left":Sa?"bottom":"top";B[fb]>aa[fb]&&(Sa=Xa(Sa));fb=Xa(Sa);xa=[];if(K&&xa.push(0>=
gb[ob]),R&&xa.push(0>=gb[Sa],0>=gb[fb]),xa.every(function(rb){return rb})){Fa=Pa;fa=!1;break}La.set(Pa,xa)}if(fa)for(K=function(rb){var hb=Oa.find(function(cb){if(cb=La.get(cb))return cb.slice(0,rb).every(function(Ob){return Ob})});if(hb)return Fa=hb,"break"},R=Da?3:1;0<R&&"break"!==K(R);R--);v.placement!==Fa&&(v.modifiersData[p]._skip=!0,v.placement=Fa,v.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},Af={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(p){var v=
p.state;p=p.name;var B=v.rects.reference,K=v.rects.popper,R=v.modifiersData.preventOverflow,aa=Q(v,{elementContext:"reference"}),ja=Q(v,{altBoundary:!0});B=Ja(aa,B);K=Ja(ja,K,R);R=V(B);ja=V(K);v.modifiersData[p]={referenceClippingOffsets:B,popperEscapeOffsets:K,isReferenceHidden:R,hasPopperEscaped:ja};v.attributes.popper=Object.assign({},v.attributes.popper,{"data-popper-reference-hidden":R,"data-popper-escaped":ja})}},Bf={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(p){var v=
p.state,B=p.name;p=p.options.offset;var K=void 0===p?[0,0]:p;p=Ya.reduce(function(ja,oa){var Aa,Na,fa,Da,pa,Oa;return ja[oa]=(Aa=v.rects,fa=0<=["left","top"].indexOf(Na=u(oa))?-1:1,pa=(Da="function"==typeof K?K(Object.assign({},Aa,{placement:oa})):K)[0],Oa=Da[1],pa=pa||0,Oa=(Oa||0)*fa,0<=["left","right"].indexOf(Na)?{x:Oa,y:pa}:{x:pa,y:Oa}),ja},{});var R=p[v.placement],aa=R.x;R=R.y;null!=v.modifiersData.popperOffsets&&(v.modifiersData.popperOffsets.x+=aa,v.modifiersData.popperOffsets.y+=R);v.modifiersData[B]=
p}},ie={name:"popperOffsets",enabled:!0,phase:"read",fn:function(p){var v=p.state;v.modifiersData[p.name]=ba({reference:v.rects.reference,element:v.rects.popper,strategy:"absolute",placement:v.placement})},data:{}},Cf={name:"preventOverflow",enabled:!0,phase:"main",fn:function(p){var v=p.state,B=p.options;p=p.name;var K=B.mainAxis,R=B.altAxis,aa=B.tether;aa=void 0===aa||aa;var ja=B.tetherOffset,oa=void 0===ja?0:ja,Aa=Q(v,{boundary:B.boundary,rootBoundary:B.rootBoundary,padding:B.padding,altBoundary:B.altBoundary}),
Na=u(v.placement),fa=ea(v.placement),Da=!fa,pa=da(Na);B="x"===pa?"y":"x";ja=v.modifiersData.popperOffsets;var Oa=v.rects.reference,La=v.rects.popper;oa="function"==typeof oa?oa(Object.assign({},v.rects,{placement:v.placement})):oa;var Fa="number"==typeof oa?{mainAxis:oa,altAxis:oa}:Object.assign({mainAxis:0,altAxis:0},oa),Ga=v.modifiersData.offset?v.modifiersData.offset[v.placement]:null;oa={x:0,y:0};if(ja){if(void 0===K||K){var Pa,ob="y"===pa?"top":"left",Sa="y"===pa?"bottom":"right",xa="y"===pa?
"height":"width";K=ja[pa];var fb=K+Aa[ob],gb=K-Aa[Sa],rb=aa?-La[xa]/2:0,hb="start"===fa?Oa[xa]:La[xa];fa="start"===fa?-La[xa]:-Oa[xa];var cb=v.elements.arrow;cb=aa&&cb?D(cb):{width:0,height:0};var Ob=v.modifiersData["arrow#persistent"]?v.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0};ob=Ob[ob];Sa=Ob[Sa];cb=va(0,Ra(Oa[xa],cb[xa]));hb=Da?Oa[xa]/2-rb-cb-ob-Fa.mainAxis:hb-cb-ob-Fa.mainAxis;Da=Da?-Oa[xa]/2+rb+cb+Sa+Fa.mainAxis:fa+cb+Sa+Fa.mainAxis;rb=(xa=v.elements.arrow&&U(v.elements.arrow))?
"y"===pa?xa.clientTop||0:xa.clientLeft||0:0;xa=null!=(Pa=null==Ga?void 0:Ga[pa])?Pa:0;Pa=aa?Ra(fb,K+hb-xa-rb):fb;gb=aa?va(gb,K+Da-xa):gb;Pa=va(Pa,Ra(K,gb));ja[pa]=Pa;oa[pa]=Pa-K}if(void 0!==R&&R){var oc,pc;R=ja[B];K="y"===B?"height":"width";Pa=R+Aa["x"===pa?"top":"left"];Aa=R-Aa["x"===pa?"bottom":"right"];Na=-1!==["top","left"].indexOf(Na);pa=null!=(pc=null==Ga?void 0:Ga[B])?pc:0;pc=Na?Pa:R-Oa[K]-La[K]-pa+Fa.altAxis;Oa=Na?R+Oa[K]+La[K]-pa-Fa.altAxis:Aa;La=aa&&Na?(oc=va(pc,Ra(R,Oa)))>Oa?Oa:oc:va(aa?
pc:Pa,Ra(R,aa?Oa:Aa));ja[B]=La;oa[B]=La-R}v.modifiersData[p]=oa}},requiresIfExists:["offset"]};var sf={placement:"bottom",modifiers:[],strategy:"absolute"},Jg=ma(),Kg=ma({defaultModifiers:[fe,ie,ee,ua]}),je=ma({defaultModifiers:[fe,ie,ee,ua,Bf,zf,Cf,Wb,Af]});let Df=Object.freeze(Object.defineProperty({__proto__:null,afterMain:"afterMain",afterRead:"afterRead",afterWrite:"afterWrite",applyStyles:ua,arrow:Wb,auto:"auto",basePlacements:tb,beforeMain:"beforeMain",beforeRead:"beforeRead",beforeWrite:"beforeWrite",
bottom:"bottom",clippingParents:"clippingParents",computeStyles:ee,createPopper:je,createPopperBase:Jg,createPopperLite:Kg,detectOverflow:Q,end:"end",eventListeners:fe,flip:zf,hide:Af,left:"left",main:"main",modifierPhases:ia,offset:Bf,placements:Ya,popper:"popper",popperGenerator:ma,popperOffsets:ie,preventOverflow:Cf,read:"read",reference:"reference",right:"right",start:"start",top:"top",variationPlacements:xb,viewport:"viewport",write:"write"},Symbol.toStringTag,{value:"Module"})),Lg="rtl"===document.documentElement.dir?
"top-end":"top-start",Mg="rtl"===document.documentElement.dir?"top-start":"top-end",Ng="rtl"===document.documentElement.dir?"bottom-end":"bottom-start",Og="rtl"===document.documentElement.dir?"bottom-start":"bottom-end",Pg="rtl"===document.documentElement.dir?"left-start":"right-start",Qg="rtl"===document.documentElement.dir?"right-start":"left-start",Rg={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Sg={autoClose:"(boolean|string)",boundary:"(string|element)",
display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class dc extends Kb{static get Default(){return Rg}static get DefaultType(){return Sg}static get NAME(){return"dropdown"}toggle(){return this._isShown()?this.hide():this.show()}show(){if(!Bb(this._element)&&!this._isShown()){var p={relatedTarget:this._element};if(!ca.trigger(this._element,"show.bs.dropdown",p).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&
!this._parent.closest(".navbar-nav"))for(let v of[].concat(...document.body.children))ca.on(v,"mouseover",Wa);this._element.focus();this._element.setAttribute("aria-expanded",!0);this._menu.classList.add("show");this._element.classList.add("show");ca.trigger(this._element,"shown.bs.dropdown",p)}}}hide(){!Bb(this._element)&&this._isShown()&&this._completeHide({relatedTarget:this._element})}dispose(){this._popper&&this._popper.destroy();super.dispose()}update(){this._inNavbar=this._detectNavbar();this._popper&&
this._popper.update()}_completeHide(p){if(!ca.trigger(this._element,"hide.bs.dropdown",p).defaultPrevented){if("ontouchstart"in document.documentElement)for(let v of[].concat(...document.body.children))ca.off(v,"mouseover",Wa);this._popper&&this._popper.destroy();this._menu.classList.remove("show");this._element.classList.remove("show");this._element.setAttribute("aria-expanded","false");Qb.removeDataAttribute(this._menu,"popper");ca.trigger(this._element,"hidden.bs.dropdown",p)}}_getConfig(p){if("object"==
typeof(p=super._getConfig(p)).reference&&!vb(p.reference)&&"function"!=typeof p.reference.getBoundingClientRect)throw TypeError('DROPDOWN: Option "reference" provided type "object" without a required "getBoundingClientRect" method.');return p}_createPopper(){if(void 0===Df)throw TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let p=this._element;"parent"===this._config.reference?p=this._parent:vb(this._config.reference)?p=eb(this._config.reference):"object"==typeof this._config.reference&&
(p=this._config.reference);let v=this._getPopperConfig();this._popper=je(p,this._menu,v)}_isShown(){return this._menu.classList.contains("show")}_getPlacement(){let p=this._parent;if(p.classList.contains("dropend"))return Pg;if(p.classList.contains("dropstart"))return Qg;if(p.classList.contains("dropup-center"))return"top";if(p.classList.contains("dropdown-center"))return"bottom";let v="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return p.classList.contains("dropup")?
v?Mg:Lg:v?Og:Ng}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){let {offset:p}=this._config;return"string"==typeof p?p.split(",").map(v=>Number.parseInt(v,10)):"function"==typeof p?v=>p(v,this._element):p}_getPopperConfig(){let p={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||"static"===this._config.display)&&(Qb.setDataAttribute(this._menu,
"popper","static"),p.modifiers=[{name:"applyStyles",enabled:!1}]),{...p,...zb(this._config.popperConfig,[p])}}_selectMenuItem({key:p,target:v}){let B=wa.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(K=>lb(K));B.length&&sb(B,v,"ArrowDown"===p,!B.includes(v)).focus()}static jQueryInterface(p){return this.each(function(){let v=dc.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===v[p])throw TypeError(`No method named "${p}"`);v[p]()}})}static clearMenus(p){if(2!==
p.button&&("keyup"!==p.type||"Tab"===p.key))for(let B of wa.find('[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled).show')){let K=dc.getInstance(B);if(!K||!1===K._config.autoClose)continue;var v=p.composedPath();let R=v.includes(K._menu);v.includes(K._element)||"inside"===K._config.autoClose&&!R||"outside"===K._config.autoClose&&R||K._menu.contains(p.target)&&("keyup"===p.type&&"Tab"===p.key||/input|select|option|textarea|form/i.test(p.target.tagName))||(v={relatedTarget:K._element},"click"===
p.type&&(v.clickEvent=p),K._completeHide(v))}}static dataApiKeydownHandler(p){var v=/input|textarea/i.test(p.target.tagName),B="Escape"===p.key;let K=["ArrowUp","ArrowDown"].includes(p.key);if((K||B)&&(!v||B)){p.preventDefault();v=this.matches('[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)')?this:wa.prev(this,'[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)')[0]||wa.next(this,'[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)')[0]||wa.findOne('[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',
p.delegateTarget.parentNode);B=dc.getOrCreateInstance(v);if(K)return p.stopPropagation(),B.show(),void B._selectMenuItem(p);B._isShown()&&(p.stopPropagation(),B.hide(),v.focus())}}constructor(p,v){super(p,v);this._popper=null;this._parent=this._element.parentNode;this._menu=wa.next(this._element,".dropdown-menu")[0]||wa.prev(this._element,".dropdown-menu")[0]||wa.findOne(".dropdown-menu",this._parent);this._inNavbar=this._detectNavbar()}}ca.on(document,"keydown.bs.dropdown.data-api",'[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',
dc.dataApiKeydownHandler);ca.on(document,"keydown.bs.dropdown.data-api",".dropdown-menu",dc.dataApiKeydownHandler);ca.on(document,"click.bs.dropdown.data-api",dc.clearMenus);ca.on(document,"keyup.bs.dropdown.data-api",dc.clearMenus);ca.on(document,"click.bs.dropdown.data-api",'[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',function(p){p.preventDefault();dc.getOrCreateInstance(this).toggle()});wb(dc);let Tg={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},
Ug={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class Ef extends ac{static get Default(){return Tg}static get DefaultType(){return Ug}static get NAME(){return"backdrop"}show(p){if(!this._config.isVisible)return void zb(p);this._append();let v=this._getElement();this._config.isAnimated&&v.offsetHeight;v.classList.add("show");this._emulateAnimation(()=>{zb(p)})}hide(p){this._config.isVisible?(this._getElement().classList.remove("show"),
this._emulateAnimation(()=>{this.dispose();zb(p)})):zb(p)}dispose(){this._isAppended&&(ca.off(this._element,"mousedown.bs.backdrop"),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){let p=document.createElement("div");p.className=this._config.className;this._config.isAnimated&&p.classList.add("fade");this._element=p}return this._element}_configAfterMerge(p){return p.rootElement=eb(p.rootElement),p}_append(){if(!this._isAppended){var p=this._getElement();this._config.rootElement.append(p);
ca.on(p,"mousedown.bs.backdrop",()=>{zb(this._config.clickCallback)});this._isAppended=!0}}_emulateAnimation(p){Fb(p,this._getElement(),this._config.isAnimated)}constructor(p){super();this._config=this._getConfig(p);this._isAppended=!1;this._element=null}}let Vg={autofocus:!0,trapElement:null},Wg={autofocus:"boolean",trapElement:"element"};class Ff extends ac{static get Default(){return Vg}static get DefaultType(){return Wg}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&
this._config.trapElement.focus(),ca.off(document,".bs.focustrap"),ca.on(document,"focusin.bs.focustrap",p=>this._handleFocusin(p)),ca.on(document,"keydown.tab.bs.focustrap",p=>this._handleKeydown(p)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,ca.off(document,".bs.focustrap"))}_handleFocusin(p){let {trapElement:v}=this._config;p.target===document||p.target===v||v.contains(p.target)||(p=wa.focusableChildren(v),0===p.length?v.focus():"backward"===this._lastTabNavDirection?p[p.length-
1].focus():p[0].focus())}_handleKeydown(p){"Tab"===p.key&&(this._lastTabNavDirection=p.shiftKey?"backward":"forward")}constructor(p){super();this._config=this._getConfig(p);this._isActive=!1;this._lastTabNavDirection=null}}class ke{getWidth(){return Math.abs(window.innerWidth-document.documentElement.clientWidth)}hide(){let p=this.getWidth();this._disableOverFlow();this._setElementAttributes(this._element,"padding-right",v=>v+p);this._setElementAttributes(".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",
"padding-right",v=>v+p);this._setElementAttributes(".sticky-top","margin-right",v=>v-p)}reset(){this._resetElementAttributes(this._element,"overflow");this._resetElementAttributes(this._element,"padding-right");this._resetElementAttributes(".fixed-top, .fixed-bottom, .is-fixed, .sticky-top","padding-right");this._resetElementAttributes(".sticky-top","margin-right")}isOverflowing(){return 0<this.getWidth()}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow");this._element.style.overflow=
"hidden"}_setElementAttributes(p,v,B){let K=this.getWidth();this._applyManipulationCallback(p,R=>{if(!(R!==this._element&&window.innerWidth>R.clientWidth+K)){this._saveInitialAttribute(R,v);var aa=window.getComputedStyle(R).getPropertyValue(v);R.style.setProperty(v,`${B(Number.parseFloat(aa))}px`)}})}_saveInitialAttribute(p,v){let B=p.style.getPropertyValue(v);B&&Qb.setDataAttribute(p,v,B)}_resetElementAttributes(p,v){this._applyManipulationCallback(p,B=>{let K=Qb.getDataAttribute(B,v);null!==K?(Qb.removeDataAttribute(B,
v),B.style.setProperty(v,K)):B.style.removeProperty(v)})}_applyManipulationCallback(p,v){if(vb(p))v(p);else for(let B of wa.find(p,this._element))v(B)}constructor(){this._element=document.body}}let Xg={backdrop:!0,focus:!0,keyboard:!0},Yg={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Mc extends Kb{static get Default(){return Xg}static get DefaultType(){return Yg}static get NAME(){return"modal"}toggle(p){return this._isShown?this.hide():this.show(p)}show(p){this._isShown||
this._isTransitioning||ca.trigger(this._element,"show.bs.modal",{relatedTarget:p}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add("modal-open"),this._adjustDialog(),this._backdrop.show(()=>this._showElement(p)))}hide(){this._isShown&&!this._isTransitioning&&(ca.trigger(this._element,"hide.bs.modal").defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove("show"),this._queueCallback(()=>
this._hideModal(),this._element,this._isAnimated())))}dispose(){ca.off(window,".bs.modal");ca.off(this._dialog,".bs.modal");this._backdrop.dispose();this._focustrap.deactivate();super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new Ef({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Ff({trapElement:this._element})}_showElement(p){document.body.contains(this._element)||document.body.append(this._element);this._element.style.display=
"block";this._element.removeAttribute("aria-hidden");this._element.setAttribute("aria-modal",!0);this._element.setAttribute("role","dialog");this._element.scrollTop=0;let v=wa.findOne(".modal-body",this._dialog);v&&(v.scrollTop=0);this._element.offsetHeight;this._element.classList.add("show");this._queueCallback(()=>{this._config.focus&&this._focustrap.activate();this._isTransitioning=!1;ca.trigger(this._element,"shown.bs.modal",{relatedTarget:p})},this._dialog,this._isAnimated())}_addEventListeners(){ca.on(this._element,
"keydown.dismiss.bs.modal",p=>{"Escape"===p.key&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())});ca.on(window,"resize.bs.modal",()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()});ca.on(this._element,"mousedown.dismiss.bs.modal",p=>{ca.one(this._element,"click.dismiss.bs.modal",v=>{this._element===p.target&&this._element===v.target&&("static"!==this._config.backdrop?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display=
"none";this._element.setAttribute("aria-hidden",!0);this._element.removeAttribute("aria-modal");this._element.removeAttribute("role");this._isTransitioning=!1;this._backdrop.hide(()=>{document.body.classList.remove("modal-open");this._resetAdjustments();this._scrollBar.reset();ca.trigger(this._element,"hidden.bs.modal")})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(!ca.trigger(this._element,"hidePrevented.bs.modal").defaultPrevented){var p=this._element.scrollHeight>
document.documentElement.clientHeight,v=this._element.style.overflowY;"hidden"===v||this._element.classList.contains("modal-static")||(p||(this._element.style.overflowY="hidden"),this._element.classList.add("modal-static"),this._queueCallback(()=>{this._element.classList.remove("modal-static");this._queueCallback(()=>{this._element.style.overflowY=v},this._dialog)},this._dialog),this._element.focus())}}_adjustDialog(){let p=this._element.scrollHeight>document.documentElement.clientHeight,v=this._scrollBar.getWidth(),
B=0<v;B&&!p&&(this._element.style["rtl"===document.documentElement.dir?"paddingLeft":"paddingRight"]=`${v}px`);!B&&p&&(this._element.style["rtl"===document.documentElement.dir?"paddingRight":"paddingLeft"]=`${v}px`)}_resetAdjustments(){this._element.style.paddingLeft="";this._element.style.paddingRight=""}static jQueryInterface(p,v){return this.each(function(){let B=Mc.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===B[p])throw TypeError(`No method named "${p}"`);B[p](v)}})}constructor(p,
v){super(p,v);this._dialog=wa.findOne(".modal-dialog",this._element);this._backdrop=this._initializeBackDrop();this._focustrap=this._initializeFocusTrap();this._isTransitioning=this._isShown=!1;this._scrollBar=new ke;this._addEventListeners()}}ca.on(document,"click.bs.modal.data-api",'[data-bs-toggle="modal"]',function(p){let v=wa.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&p.preventDefault();ca.one(v,"show.bs.modal",B=>{B.defaultPrevented||ca.one(v,"hidden.bs.modal",()=>{lb(this)&&
this.focus()})});(p=wa.findOne(".modal.show"))&&Mc.getInstance(p).hide();Mc.getOrCreateInstance(v).toggle(this)});Hb(Mc);wb(Mc);let Zg={backdrop:!0,keyboard:!0,scroll:!1},$g={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class rc extends Kb{static get Default(){return Zg}static get DefaultType(){return $g}static get NAME(){return"offcanvas"}toggle(p){return this._isShown?this.hide():this.show(p)}show(p){this._isShown||ca.trigger(this._element,"show.bs.offcanvas",{relatedTarget:p}).defaultPrevented||
(this._isShown=!0,this._backdrop.show(),this._config.scroll||(new ke).hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add("showing"),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate();this._element.classList.add("show");this._element.classList.remove("showing");ca.trigger(this._element,"shown.bs.offcanvas",{relatedTarget:p})},this._element,!0))}hide(){this._isShown&&(ca.trigger(this._element,
"hide.bs.offcanvas").defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add("hiding"),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove("show","hiding");this._element.removeAttribute("aria-modal");this._element.removeAttribute("role");this._config.scroll||(new ke).reset();ca.trigger(this._element,"hidden.bs.offcanvas")},this._element,!0)))}dispose(){this._backdrop.dispose();this._focustrap.deactivate();super.dispose()}_initializeBackDrop(){let p=
!!this._config.backdrop;return new Ef({className:"offcanvas-backdrop",isVisible:p,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:p?()=>{"static"!==this._config.backdrop?this.hide():ca.trigger(this._element,"hidePrevented.bs.offcanvas")}:null})}_initializeFocusTrap(){return new Ff({trapElement:this._element})}_addEventListeners(){ca.on(this._element,"keydown.dismiss.bs.offcanvas",p=>{"Escape"===p.key&&(this._config.keyboard?this.hide():ca.trigger(this._element,"hidePrevented.bs.offcanvas"))})}static jQueryInterface(p){return this.each(function(){let v=
rc.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===v[p]||p.startsWith("_")||"constructor"===p)throw TypeError(`No method named "${p}"`);v[p](this)}})}constructor(p,v){super(p,v);this._isShown=!1;this._backdrop=this._initializeBackDrop();this._focustrap=this._initializeFocusTrap();this._addEventListeners()}}ca.on(document,"click.bs.offcanvas.data-api",'[data-bs-toggle="offcanvas"]',function(p){let v=wa.getElementFromSelector(this);(["A","AREA"].includes(this.tagName)&&p.preventDefault(),
Bb(this))||(ca.one(v,"hidden.bs.offcanvas",()=>{lb(this)&&this.focus()}),(p=wa.findOne(".offcanvas.show"))&&p!==v&&rc.getInstance(p).hide(),rc.getOrCreateInstance(v).toggle(this))});ca.on(window,"load.bs.offcanvas.data-api",()=>{for(let p of wa.find(".offcanvas.show"))rc.getOrCreateInstance(p).show()});ca.on(window,"resize.bs.offcanvas",()=>{for(let p of wa.find("[aria-modal][class*=show][class*=offcanvas-]"))"fixed"!==getComputedStyle(p).position&&rc.getOrCreateInstance(p).hide()});Hb(rc);wb(rc);
let Gf={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:"src srcset alt title width height".split(" "),li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},ah=new Set("background cite href itemtype longdesc poster src xlink:href".split(" ")),bh=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,ch=(p,v)=>{let B=
p.nodeName.toLowerCase();return v.includes(B)?!ah.has(B)||!!bh.test(p.nodeValue):v.filter(K=>K instanceof RegExp).some(K=>K.test(B))},dh={allowList:Gf,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},eh={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},fh={entry:"(string|element|function|null)",selector:"(string|element)"};class gh extends ac{static get Default(){return dh}static get DefaultType(){return eh}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(p=>
this._resolvePossibleFunction(p)).filter(Boolean)}hasContent(){return 0<this.getContent().length}changeContent(p){return this._checkContent(p),this._config.content={...this._config.content,...p},this}toHtml(){var p=document.createElement("div");for(let [B,K]of(p.innerHTML=this._maybeSanitize(this._config.template),Object.entries(this._config.content)))this._setContent(p,K,B);p=p.children[0];let v=this._resolvePossibleFunction(this._config.extraClass);return v&&p.classList.add(...v.split(" ")),p}_typeCheckConfig(p){super._typeCheckConfig(p);
this._checkContent(p.content)}_checkContent(p){for(let [v,B]of Object.entries(p))super._typeCheckConfig({selector:v,entry:B},fh)}_setContent(p,v,B){(p=wa.findOne(B,p))&&((v=this._resolvePossibleFunction(v))?vb(v)?this._putElementInTemplate(eb(v),p):this._config.html?p.innerHTML=this._maybeSanitize(v):p.textContent=v:p.remove())}_maybeSanitize(p){if(this._config.sanitize){var v=this._config.allowList;var B=this._config.sanitizeFn;if(p.length)if(B&&"function"==typeof B)v=B(p);else{p=(new window.DOMParser).parseFromString(p,
"text/html");for(let R of[].concat(...p.body.querySelectorAll("*"))){var K=R.nodeName.toLowerCase();if(Object.keys(v).includes(K)){B=[].concat(...R.attributes);K=[].concat(v["*"]||[],v[K]||[]);for(let aa of B)ch(aa,K)||R.removeAttribute(aa.nodeName)}else R.remove()}v=p.body.innerHTML}else v=p}else v=p;return v}_resolvePossibleFunction(p){return zb(p,[this])}_putElementInTemplate(p,v){if(this._config.html)return v.innerHTML="",void v.append(p);v.textContent=p.textContent}constructor(p){super();this._config=
this._getConfig(p)}}let hh=new Set(["sanitize","allowList","sanitizeFn"]),ih={AUTO:"auto",TOP:"top",RIGHT:"rtl"===document.documentElement.dir?"left":"right",BOTTOM:"bottom",LEFT:"rtl"===document.documentElement.dir?"right":"left"},jh={allowList:Gf,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',
title:"",trigger:"hover focus"},kh={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Nc extends Kb{static get Default(){return jh}static get DefaultType(){return kh}static get NAME(){return"tooltip"}enable(){this._isEnabled=
!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout);ca.off(this._element.closest(".modal"),"hide.bs.modal",this._hideModalHandler);this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title"));this._disposePopper();super.dispose()}show(){if("none"===
this._element.style.display)throw Error("Please use show on visible elements");if(this._isWithContent()&&this._isEnabled){var p=ca.trigger(this._element,this.constructor.eventName("show")),v=(bb(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(!p.defaultPrevented&&v){this._disposePopper();p=this._getTipElement();this._element.setAttribute("aria-describedby",p.getAttribute("id"));({container:v}=this._config);if(this._element.ownerDocument.documentElement.contains(this.tip)||
(v.append(p),ca.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(p),p.classList.add("show"),"ontouchstart"in document.documentElement)for(let B of[].concat(...document.body.children))ca.on(B,"mouseover",Wa);this._queueCallback(()=>{ca.trigger(this._element,this.constructor.eventName("shown"));!1===this._isHovered&&this._leave();this._isHovered=!1},this.tip,this._isAnimated())}}}hide(){if(this._isShown()&&!ca.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove("show"),
"ontouchstart"in document.documentElement)for(let p of[].concat(...document.body.children))ca.off(p,"mouseover",Wa);this._activeTrigger.click=!1;this._activeTrigger.focus=!1;this._activeTrigger.hover=!1;this._isHovered=null;this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),ca.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||
(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(p){p=this._getTemplateFactory(p).toHtml();if(!p)return null;p.classList.remove("fade","show");p.classList.add(`bs-${this.constructor.NAME}-auto`);var v=this.constructor.NAME;do v+=Math.floor(1E6*Math.random());while(document.getElementById(v));return p.setAttribute("id",v.toString()),this._isAnimated()&&p.classList.add("fade"),p}setContent(p){this._newContent=p;this._isShown()&&(this._disposePopper(),
this.show())}_getTemplateFactory(p){return this._templateFactory?this._templateFactory.changeContent(p):this._templateFactory=new gh({...this._config,content:p,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(p){return this.constructor.getOrCreateInstance(p.delegateTarget,
this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains("fade")}_isShown(){return this.tip&&this.tip.classList.contains("show")}_createPopper(p){let v=ih[zb(this._config.placement,[this,p,this._element]).toUpperCase()];return je(this._element,p,this._getPopperConfig(v))}_getOffset(){let {offset:p}=this._config;return"string"==typeof p?p.split(",").map(v=>Number.parseInt(v,10)):"function"==typeof p?v=>p(v,this._element):p}_resolvePossibleFunction(p){return zb(p,
[this._element])}_getPopperConfig(p){p={placement:p,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:v=>{this._getTipElement().setAttribute("data-popper-placement",v.state.placement)}}]};return{...p,...zb(this._config.popperConfig,
[p])}}_setListeners(){for(let p of this._config.trigger.split(" "))if("click"===p)ca.on(this._element,this.constructor.eventName("click"),this._config.selector,v=>{this._initializeOnDelegatedTarget(v).toggle()});else if("manual"!==p){let v="hover"===p?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),B="hover"===p?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");ca.on(this._element,v,this._config.selector,K=>{let R=this._initializeOnDelegatedTarget(K);
R._activeTrigger["focusin"===K.type?"focus":"hover"]=!0;R._enter()});ca.on(this._element,B,this._config.selector,K=>{let R=this._initializeOnDelegatedTarget(K);R._activeTrigger["focusout"===K.type?"focus":"hover"]=R._element.contains(K.relatedTarget);R._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()};ca.on(this._element.closest(".modal"),"hide.bs.modal",this._hideModalHandler)}_fixTitle(){let p=this._element.getAttribute("title");p&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||
this._element.setAttribute("aria-label",p),this._element.setAttribute("data-bs-original-title",p),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(p,v){clearTimeout(this._timeout);this._timeout=setTimeout(p,
v)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(p){let v=Qb.getDataAttributes(this._element);for(let B of Object.keys(v))hh.has(B)&&delete v[B];return p={...v,...("object"==typeof p&&p?p:{})},p=this._mergeConfigObj(p),p=this._configAfterMerge(p),this._typeCheckConfig(p),p}_configAfterMerge(p){return p.container=!1===p.container?document.body:eb(p.container),"number"==typeof p.delay&&(p.delay={show:p.delay,hide:p.delay}),"number"==typeof p.title&&(p.title=
p.title.toString()),"number"==typeof p.content&&(p.content=p.content.toString()),p}_getDelegateConfig(){let p={};for(let [v,B]of Object.entries(this._config))this.constructor.Default[v]!==B&&(p[v]=B);return p.selector=!1,p.trigger="manual",p}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null);this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(p){return this.each(function(){let v=Nc.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===v[p])throw TypeError(`No method named "${p}"`);
v[p]()}})}constructor(p,v){if(void 0===Df)throw TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(p,v);this._isEnabled=!0;this._timeout=0;this._isHovered=null;this._activeTrigger={};this.tip=this._newContent=this._templateFactory=this._popper=null;this._setListeners();this._config.selector||this._fixTitle()}}wb(Nc);let lh={...Nc.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',
trigger:"click"},mh={...Nc.DefaultType,content:"(null|string|element|function)"};class le extends Nc{static get Default(){return lh}static get DefaultType(){return mh}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(p){return this.each(function(){let v=le.getOrCreateInstance(this,
p);if("string"==typeof p){if(void 0===v[p])throw TypeError(`No method named "${p}"`);v[p]()}})}}wb(le);let nh={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},oh={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Bd extends Kb{static get Default(){return nh}static get DefaultType(){return oh}static get NAME(){return"scrollspy"}refresh(){for(let p of(this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),
this._observer?this._observer.disconnect():this._observer=this._getNewObserver(),this._observableSections.values()))this._observer.observe(p)}dispose(){this._observer.disconnect();super.dispose()}_configAfterMerge(p){return p.target=eb(p.target)||document.body,p.rootMargin=p.offset?`${p.offset}px 0px -30%`:p.rootMargin,"string"==typeof p.threshold&&(p.threshold=p.threshold.split(",").map(v=>Number.parseFloat(v))),p}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(ca.off(this._config.target,
"click.bs.scrollspy"),ca.on(this._config.target,"click.bs.scrollspy","[href]",p=>{var v=this._observableSections.get(p.target.hash);if(v){p.preventDefault();p=this._rootElement||window;v=v.offsetTop-this._element.offsetTop;if(p.scrollTo)return void p.scrollTo({top:v,behavior:"smooth"});p.scrollTop=v}}))}_getNewObserver(){return new IntersectionObserver(p=>this._observerCallback(p),{root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin})}_observerCallback(p){let v=
aa=>this._targetLinks.get(`#${aa.target.id}`),B=aa=>{this._previousScrollData.visibleEntryTop=aa.target.offsetTop;this._process(v(aa))},K=(this._rootElement||document.documentElement).scrollTop,R=K>=this._previousScrollData.parentScrollTop;for(let aa of(this._previousScrollData.parentScrollTop=K,p))if(aa.isIntersecting)if(p=aa.target.offsetTop>=this._previousScrollData.visibleEntryTop,R&&p){if(B(aa),!K)break}else R||p||B(aa);else this._activeTarget=null,this._clearActiveClass(v(aa))}_initializeTargetsAndObservables(){for(let p of(this._targetLinks=
new Map,this._observableSections=new Map,wa.find("[href]",this._config.target))){if(!p.hash||Bb(p))continue;let v=wa.findOne(decodeURI(p.hash),this._element);lb(v)&&(this._targetLinks.set(decodeURI(p.hash),p),this._observableSections.set(p.hash,v))}}_process(p){this._activeTarget!==p&&(this._clearActiveClass(this._config.target),this._activeTarget=p,p.classList.add("active"),this._activateParents(p),ca.trigger(this._element,"activate.bs.scrollspy",{relatedTarget:p}))}_activateParents(p){if(p.classList.contains("dropdown-item"))wa.findOne(".dropdown-toggle",
p.closest(".dropdown")).classList.add("active");else for(let v of wa.parents(p,".nav, .list-group"))for(let B of wa.prev(v,".nav-link, .nav-item > .nav-link, .list-group-item"))B.classList.add("active")}_clearActiveClass(p){for(let v of(p.classList.remove("active"),wa.find("[href].active",p)))v.classList.remove("active")}static jQueryInterface(p){return this.each(function(){let v=Bd.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===v[p]||p.startsWith("_")||"constructor"===p)throw TypeError(`No method named "${p}"`);
v[p]()}})}constructor(p,v){super(p,v);this._targetLinks=new Map;this._observableSections=new Map;this._rootElement="visible"===getComputedStyle(this._element).overflowY?null:this._element;this._observer=this._activeTarget=null;this._previousScrollData={visibleEntryTop:0,parentScrollTop:0};this.refresh()}}ca.on(window,"load.bs.scrollspy.data-api",()=>{for(let p of wa.find('[data-bs-spy="scroll"]'))Bd.getOrCreateInstance(p)});wb(Bd);class Oc extends Kb{static get NAME(){return"tab"}show(){let p=this._element;
if(!this._elemIsActive(p)){var v=this._getActiveElem(),B=v?ca.trigger(v,"hide.bs.tab",{relatedTarget:p}):null;ca.trigger(p,"show.bs.tab",{relatedTarget:v}).defaultPrevented||B&&B.defaultPrevented||(this._deactivate(v,p),this._activate(p,v))}}_activate(p,v){p&&(p.classList.add("active"),this._activate(wa.getElementFromSelector(p)),this._queueCallback(()=>{"tab"===p.getAttribute("role")?(p.removeAttribute("tabindex"),p.setAttribute("aria-selected",!0),this._toggleDropDown(p,!0),ca.trigger(p,"shown.bs.tab",
{relatedTarget:v})):p.classList.add("show")},p,p.classList.contains("fade")))}_deactivate(p,v){p&&(p.classList.remove("active"),p.blur(),this._deactivate(wa.getElementFromSelector(p)),this._queueCallback(()=>{"tab"===p.getAttribute("role")?(p.setAttribute("aria-selected",!1),p.setAttribute("tabindex","-1"),this._toggleDropDown(p,!1),ca.trigger(p,"hidden.bs.tab",{relatedTarget:v})):p.classList.remove("show")},p,p.classList.contains("fade")))}_keydown(p){if("ArrowLeft ArrowRight ArrowUp ArrowDown Home End".split(" ").includes(p.key)){p.stopPropagation();
p.preventDefault();var v=this._getChildren().filter(B=>!Bb(B));if(["Home","End"].includes(p.key))p=v["Home"===p.key?0:v.length-1];else{let B=["ArrowRight","ArrowDown"].includes(p.key);p=sb(v,p.target,B,!0)}p&&(p.focus({preventScroll:!0}),Oc.getOrCreateInstance(p).show())}}_getChildren(){return wa.find('.nav-link:not(.dropdown-toggle), .list-group-item:not(.dropdown-toggle), [role="tab"]:not(.dropdown-toggle), [data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',this._parent)}_getActiveElem(){return this._getChildren().find(p=>
this._elemIsActive(p))||null}_setInitialAttributes(p,v){for(let B of(this._setAttributeIfNotExists(p,"role","tablist"),v))this._setInitialAttributesOnChild(B)}_setInitialAttributesOnChild(p){p=this._getInnerElement(p);let v=this._elemIsActive(p),B=this._getOuterElement(p);p.setAttribute("aria-selected",v);B!==p&&this._setAttributeIfNotExists(B,"role","presentation");v||p.setAttribute("tabindex","-1");this._setAttributeIfNotExists(p,"role","tab");this._setInitialAttributesOnTargetPanel(p)}_setInitialAttributesOnTargetPanel(p){let v=
wa.getElementFromSelector(p);v&&(this._setAttributeIfNotExists(v,"role","tabpanel"),p.id&&this._setAttributeIfNotExists(v,"aria-labelledby",`${p.id}`))}_toggleDropDown(p,v){p=this._getOuterElement(p);if(p.classList.contains("dropdown")){var B=wa.findOne(".dropdown-toggle",p);B&&B.classList.toggle("active",v);(B=wa.findOne(".dropdown-menu",p))&&B.classList.toggle("show",v);p.setAttribute("aria-expanded",v)}}_setAttributeIfNotExists(p,v,B){p.hasAttribute(v)||p.setAttribute(v,B)}_elemIsActive(p){return p.classList.contains("active")}_getInnerElement(p){return p.matches('.nav-link:not(.dropdown-toggle), .list-group-item:not(.dropdown-toggle), [role="tab"]:not(.dropdown-toggle), [data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]')?
p:wa.findOne('.nav-link:not(.dropdown-toggle), .list-group-item:not(.dropdown-toggle), [role="tab"]:not(.dropdown-toggle), [data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',p)}_getOuterElement(p){return p.closest(".nav-item, .list-group-item")||p}static jQueryInterface(p){return this.each(function(){let v=Oc.getOrCreateInstance(this);if("string"==typeof p){if(void 0===v[p]||p.startsWith("_")||"constructor"===p)throw TypeError(`No method named "${p}"`);v[p]()}})}constructor(p){super(p);
(this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'))&&(this._setInitialAttributes(this._parent,this._getChildren()),ca.on(this._element,"keydown.bs.tab",v=>this._keydown(v)))}}ca.on(document,"click.bs.tab",'[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',function(p){["A","AREA"].includes(this.tagName)&&p.preventDefault();Bb(this)||Oc.getOrCreateInstance(this).show()});ca.on(window,"load.bs.tab",()=>{for(let p of wa.find('.active[data-bs-toggle="tab"], .active[data-bs-toggle="pill"], .active[data-bs-toggle="list"]'))Oc.getOrCreateInstance(p)});
wb(Oc);let ph={animation:"boolean",autohide:"boolean",delay:"number"},qh={animation:!0,autohide:!0,delay:5E3};class Cd extends Kb{static get Default(){return qh}static get DefaultType(){return ph}static get NAME(){return"toast"}show(){ca.trigger(this._element,"show.bs.toast").defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove("hide"),this._element.offsetHeight,this._element.classList.add("show","showing"),this._queueCallback(()=>
{this._element.classList.remove("showing");ca.trigger(this._element,"shown.bs.toast");this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(ca.trigger(this._element,"hide.bs.toast").defaultPrevented||(this._element.classList.add("showing"),this._queueCallback(()=>{this._element.classList.add("hide");this._element.classList.remove("showing","show");ca.trigger(this._element,"hidden.bs.toast")},this._element,this._config.animation)))}dispose(){this._clearTimeout();
this.isShown()&&this._element.classList.remove("show");super.dispose()}isShown(){return this._element.classList.contains("show")}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(p,v){switch(p.type){case "mouseover":case "mouseout":this._hasMouseInteraction=v;break;case "focusin":case "focusout":this._hasKeyboardInteraction=v}if(v)return void this._clearTimeout();p=
p.relatedTarget;this._element===p||this._element.contains(p)||this._maybeScheduleHide()}_setListeners(){ca.on(this._element,"mouseover.bs.toast",p=>this._onInteraction(p,!0));ca.on(this._element,"mouseout.bs.toast",p=>this._onInteraction(p,!1));ca.on(this._element,"focusin.bs.toast",p=>this._onInteraction(p,!0));ca.on(this._element,"focusout.bs.toast",p=>this._onInteraction(p,!1))}_clearTimeout(){clearTimeout(this._timeout);this._timeout=null}static jQueryInterface(p){return this.each(function(){let v=
Cd.getOrCreateInstance(this,p);if("string"==typeof p){if(void 0===v[p])throw TypeError(`No method named "${p}"`);v[p](this)}})}constructor(p,v){super(p,v);this._timeout=null;this._hasKeyboardInteraction=this._hasMouseInteraction=!1;this._setListeners()}}return Hb(Cd),wb(Cd),{Alert:Vb,Button:x,Carousel:W,Collapse:db,Dropdown:dc,Modal:Mc,Offcanvas:rc,Popover:le,ScrollSpy:Bd,Tab:Oc,Toast:Cd,Tooltip:Nc}}();var qb={};for(let a of(!function(c){function d(F,D){for(var G=F.length;G--;)if(F[G]===D)return G;
return-1}function b(F,D,G){var E=n(F);void 0===G&&(G=D,D="all");for(var P=0;P<E.length;P++){var N=[];1<(F=E[P].split("+")).length&&(N=f(F),F=[F[F.length-1]]);(F=t(F=F[0]))in k||(k[F]=[]);k[F].push({shortcut:E[P],scope:D,method:G,key:E[P],mods:N})}}function g(){return m||"all"}function n(F){var D;return""==(D=F.replace(/\s/g,"").split(","))[D.length-1]&&(D[D.length-2]+=","),D}function f(F){F=F.slice(0,F.length-1);for(var D=0;D<F.length;D++)F[D]=q[F[D]];return F}function e(F,D,G){F.addEventListener&&
F.addEventListener(D,G,!1)}var l,k={},h={16:!1,18:!1,17:!1,91:!1},m="all",q={"\u21e7":16,shift:16,"\u2325":18,alt:18,option:18,"\u2303":17,ctrl:17,control:17,"\u2318":91,command:91},r={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},t=function(F){F=r[F]||F.toUpperCase().charCodeAt(0);return"function"==
typeof F?F():F},u=[];for(l=1;20>l;l++)r["f"+l]=111+l;var y={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(l in q)b[l]=!1;e(document,"keydown",function(F){!function(D){var G,E,P,N,O;if(-1==d(u,G=Oe(D.key))&&u.push(G),G in h)for(P in h[G]=!0,q)q[P]==G&&(b[P]=!0);else{for(l in h)h[l]=D[y[l]];if(b.filter.call(this,D)&&G in k){var U=0;for(O=g();U<k[G].length;U++)if((E=k[G][U]).scope==O||"all"==E.scope){for(P in N=0<E.mods.length,h)(!h[P]&&-1<d(E.mods,+P)||h[P]&&-1==d(E.mods,+P))&&(N=!1);(0!=
E.mods.length||h[16]||h[18]||h[17]||h[91])&&!N||!1===E.method(D,E)&&(D.preventDefault?D.preventDefault():D.returnValue=!1,D.stopPropagation&&D.stopPropagation(),D.cancelBubble&&(D.cancelBubble=!0))}}}}(F)});e(document,"keyup",function(F){var D;F=Oe(F.key);var G=d(u,F);if(0<=G&&u.splice(G,1),F in h)for(D in h[F]=!1,q)q[D]==F&&(b[D]=!1)});e(window,"focus",function(){for(l in h)h[l]=!1;for(l in q)b[l]=!1});var A=c.key;c.key=b;c.key.setScope=function(F){m=F||"all"};c.key.getScope=g;c.key.deleteScope=
function(F){var D,G;for(D in k){var E=0;for(G=k[D];E<G.length;)G[E].scope===F?G.splice(E,1):E++}};c.key.filter=function(F){F=(F.target||F.srcElement).tagName;return"INPUT"!=F&&"SELECT"!=F&&"TEXTAREA"!=F};c.key.isPressed=function(F){return"string"==typeof F&&(F=t(F)),-1!=d(u,F)};c.key.getPressedKeyCodes=function(){return u.slice(0)};c.key.noConflict=function(){var F=c.key;return c.key=A,F};c.key.unbind=function(F,D){var G,E,P,N,O=[];var U=0;for(G=n(F);U<G.length&&(1<(E=G[U].split("+")).length&&(O=
f(E)),F=t(F=E[E.length-1]),void 0===D&&(D=g()),k[F]);U++)for(P=0;P<k[F].length;P++){var da;if(da=(N=k[F][P]).scope===D)a:if(N=N.mods,N.length!=O.length)da=!1;else{for(da=0;da<N.length;da++)if(N[da]!==O[da]){da=!1;break a}da=!0}da&&(k[F][P]={})}};qb=b}(qb||{}),zc.prototype.clone=function(){for(var c=new zc(Array(this.points.length)),d=0;d<this.points.length;d++)c.points[d]={x:this.points[d].x,y:this.points[d].y};return c},zc.prototype.getTransformed=function(c){for(var d=new zc(Array(this.points.length)),
b=0;b<this.points.length;b++)d.points[b]=c.getTransformedPoint(this.points[b]);return d},zc.prototype.getCenter=function(){for(var c=this.points[0].x,d=this.points[0].y,b=1;b<this.points.length;b++)c+=this.points[b].x,d+=this.points[b].y;return{x:c/this.points.length,y:d/this.points.length}},zc.prototype.containsPoint=function(c){var d,b=!1;var g=0;for(d=this.points.length-1;g<this.points.length;d=g++)this.points[g].y>c.y!=this.points[d].y>c.y&&c.x<(this.points[d].x-this.points[g].x)*(c.y-this.points[g].y)/
(this.points[d].y-this.points[g].y)+this.points[g].x&&(b=!b);return b},kb.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},kb.prototype.normalize=function(){var c=this.getLength();return this.x/=c,this.y/=c,this},kb.prototype.getDotProduct=function(c){return this.x*c.x+this.y*c.y},kb.prototype.scale=function(c){return this.x*=c,this.y*=c,this},kb.prototype.getScaled=function(c){var d=new kb(this.x,this.y);return d.scale(c),d},kb.prototype.getRounded=function(){return new kb(Math.round(this.x),
Math.round(this.y))},kb.prototype.getTruncated=function(){return new kb(~~this.x,~~this.y)},kb.prototype.getPerpendicular=function(){return new kb(-this.y,this.x)},kb.prototype.add=function(c){return this.x+=c.x,this.y+=c.y,this},kb.prototype.subtract=function(c){return this.x-=c.x,this.y-=c.y,this},kb.prototype.getSum=function(c){return new kb(this.x+c.x,this.y+c.y)},kb.subtractPoints=function(c,d){return new kb(c.x-d.x,c.y-d.y)},Yc.prototype=Object.create(Ha(Ab).prototype),Yc.prototype.constructor=
Yc,Jb.MODE_INDEX_DEFAULT=0,Jb.MODE_INDEX_USER=1,Jb.prototype.setMode=function(c,d){var b=this.modes[c];b!=d&&(b&&b.leave(),this.modes[c]=d,d.enter())},Jb.prototype.setDefaultMode=function(c){c.transient=!1;c.capture=!1;this.setMode(Jb.MODE_INDEX_DEFAULT,c)},Jb.prototype.setUserMode=function(c){for(var d=this.modes.length-1;d>Jb.MODE_INDEX_USER;d--)this.modes[d].leave(),this.modes.splice(d,1);c.transient=!1;c.capture=!1;this.setMode(Jb.MODE_INDEX_USER,c)},Jb.prototype.deliverEvent=function(c,d){for(var b=
this.modes.length-1;0<=b;b--){var g=this.modes[b];if(g[c].apply(g,d)||g.capture&&"paint"!=c)return!0}return!1},["mouseDown","mouseUp"]))Jb.prototype[a]=function(c,d,b){this.deliverEvent(a,[c,d,b])};for(let a of["mouseDrag","mouseMove"])Jb.prototype[a]=function(c,d){this.deliverEvent(a,[c,d])};for(let a of["keyDown","keyUp"])Jb.prototype[a]=function(c){this.deliverEvent(a,[c])&&c.preventDefault()};Jb.prototype.paint=function(a){this.deliverEvent("paint",[a])};Jb.prototype.push=function(a,c){var d=
this.peek();d&&d.suspend();a.transient=c;a.capture=!1;a.enter();this.modes.push(a)};Jb.prototype.peek=function(){return 0<this.modes.length?this.modes[this.modes.length-1]:null};Jb.prototype.pop=function(){var a=this.modes.pop(),c=this.peek();return a&&a.leave(),c&&c.resume(),c};nd.prototype=Object.create(Ha(Ab).prototype);nd.prototype.constructor=nd;Eb.prototype=Object.create(Ha(Ab).prototype);Eb.prototype.constructor=Ha(Ab);od.prototype=Object.create(Eb.prototype);od.prototype.constructor=od;pd.prototype=
Object.create(Eb.prototype);pd.prototype.constructor=pd;qd.prototype=Object.create(Eb.prototype);qd.prototype.constructor=qd;let Dd=window.devicePixelRatio||1,Bc=Math.round(128*Dd),Cc=Math.round(128*Dd);class Se{_makeBitmap(){if(this._bitmapInvalid){var a=0,c=this._imageData.data;if(this._greyscale)for(var d=0;d<Cc;d++){var b=255-Math.round(d/(Cc-1)*255);for(var g=0;g<Bc;g++)c[a+z.RED_BYTE_OFFSET]=b,c[a+z.GREEN_BYTE_OFFSET]=b,c[a+z.BLUE_BYTE_OFFSET]=b,c[a+z.ALPHA_BYTE_OFFSET]=255,a+=z.BYTES_PER_PIXEL}else for(d=
this.color.clone(),b=0;b<Cc;b++)for(d.setValue(255-~~(b/(Cc-1)*255)),g=0;g<Bc;g++)d.setSaturation(Math.round(g/(Bc-1)*255)),c[a+z.RED_BYTE_OFFSET]=d.rgb>>16&255,c[a+z.GREEN_BYTE_OFFSET]=d.rgb>>8&255,c[a+z.BLUE_BYTE_OFFSET]=255&d.rgb,c[a+z.ALPHA_BYTE_OFFSET]=255,a+=z.BYTES_PER_PIXEL;this._bitmapInvalid=!1}}paint(){this._makeBitmap();this._canvasContext.putImageData(this._imageData,0,0);let a=this.color.getSaturation()/255*(Bc-1),c=(255-this.color.getValue())/255*(Cc-1);md(this._canvasContext,"stroke");
this._canvasContext.lineWidth=1.5*Dd;this._canvasContext.beginPath();this._greyscale?(this._canvasContext.moveTo(0,c),this._canvasContext.lineTo(Bc,c)):this._canvasContext.arc(a,c,5*Dd,0,2*Math.PI);this._canvasContext.stroke();this._canvasContext.globalCompositeOperation="source-over"}_mousePickColor(a){let c=this._canvas.getBoundingClientRect();var d=a.pageX-window.scrollX-c.left;a=Math.max(Math.min(255-~~(255*(a.pageY-window.scrollY-c.top)/127),255),0);this._greyscale?this.color.setGreyscale(a):
(d=Math.max(Math.min(~~(255*d/127),255),0),this.color.setHsv(this.color.getHue(),d,a));this.paint();this._controller.setCurColor(this.color)}_endDrag(a){this._canvas.releasePointerCapture(a.pointerId);this._capturedMouse=!1;this._canvas.removeEventListener("pointerup",this._handleEndDrag);this._canvas.removeEventListener("pointermove",this._handleMousePickColor)}_startDrag(a){this._capturedMouse||(this._capturedMouse=!0,this._canvas.setPointerCapture(a.pointerId),this._canvas.addEventListener("pointerup",
this._handleEndDrag),this._canvas.addEventListener("pointermove",this._handleMousePickColor));this._handleMousePickColor(a)}setHue(a){this.color.getHue()!=a&&(this.color.setHue(a),this._controller.setCurColor(this.color))}getElement(){return this._canvas}constructor(a,c){Nb(this,"_controller",void 0);Nb(this,"_canvas",void 0);Nb(this,"_canvasContext",void 0);Nb(this,"_imageData",void 0);Nb(this,"_bitmapInvalid",!0);Nb(this,"_capturedMouse",!1);Nb(this,"_greyscale",!1);Nb(this,"color",new Za(0));this._controller=
a;let d=document.createElement("canvas");this._canvas=d;d.className="chickenpaint-colorpicker-select";d.setAttribute("touch-action","none");d.width=Bc;d.height=Cc;d.style.width="128px";d.style.height="128px";this._canvasContext=d.getContext("2d");this._imageData=this._canvasContext.createImageData(Bc,Cc);this._canvasContext.getImageData(0,0,1,1);this._handleEndDrag=this._endDrag.bind(this);this._handleMousePickColor=this._mousePickColor.bind(this);d.addEventListener("pointerdown",b=>this._startDrag(b));
c&&this.color.copyFrom(c);a.on("colorChange",b=>{this.color.copyFrom(b);this._bitmapInvalid=!0;this.paint()});a.on("colorModeChange",b=>{this._greyscale="greyscale"==b;this._bitmapInvalid=!0;this.paint()});this.paint()}}class Te{paint(){this._canvasContext.putImageData(this._imageData,0,0);let a=128*this.hue/360;md(this._canvasContext,"stroke");this._canvasContext.lineWidth=1.5;this._canvasContext.beginPath();this._canvasContext.moveTo(0,a);this._canvasContext.lineTo(24,a);this._canvasContext.stroke();
this._canvasContext.globalCompositeOperation="source-over"}_mousePickColor(a){let c=this._canvas.getBoundingClientRect();this.hue=Math.max(0,Math.min(359,~~(360*(a.pageY-c.top)/128)));this.paint();this.selecter&&this.selecter.setHue(this.hue)}_endDrag(a){this._canvas.releasePointerCapture(a.pointerId);this._capturedMouse=!1;this._canvas.removeEventListener("pointerup",this._handleEndDrag);this._canvas.removeEventListener("pointermove",this._handleMousePickColor)}_startDrag(a){this._capturedMouse||
(this._capturedMouse=!0,this._canvas.setPointerCapture(a.pointerId),this._canvas.addEventListener("pointerup",this._handleEndDrag),this._canvas.addEventListener("pointermove",this._handleMousePickColor));this._handleMousePickColor(a)}getElement(){return this._canvas}setHue(a){this.hue=a;this.paint()}constructor(a,c,d){Nb(this,"hue",void 0);Nb(this,"selecter",void 0);Nb(this,"_canvas",void 0);Nb(this,"_canvasContext",void 0);Nb(this,"_imageData",void 0);Nb(this,"_capturedMouse",!1);this.selecter=c;
this.hue=d||0;let b=document.createElement("canvas");this._canvas=b;a.on("colorChange",g=>{this.setHue(g.getHue())});a.on("colorModeChange",g=>{b.style.display="greyscale"==g?"none":"block"});b.setAttribute("touch-action","none");b.addEventListener("pointerdown",g=>this._startDrag(g));b.width=24;b.height=128;b.className="chickenpaint-colorpicker-slider";this._canvasContext=b.getContext("2d");this._imageData=this._canvasContext.createImageData(24,128);this._canvasContext.getImageData(0,0,1,1);this._handleEndDrag=
this._endDrag.bind(this);this._handleMousePickColor=this._mousePickColor.bind(this);(function(g){let n=new Za(65535),f=0,e=g.data;for(let l=0;l<g.height;l++){n.setHue(359*l/g.height);for(let k=0;k<g.width;k++)e[f+z.RED_BYTE_OFFSET]=n.rgb>>16&255,e[f+z.GREEN_BYTE_OFFSET]=n.rgb>>8&255,e[f+z.BLUE_BYTE_OFFSET]=255&n.rgb,e[f+z.ALPHA_BYTE_OFFSET]=255,f+=z.BYTES_PER_PIXEL}})(this._imageData);this.paint()}}rd.prototype=Object.create(Eb.prototype);rd.prototype.constructor=rd;Ic.prototype=Object.create(Ha(Ab).prototype);
Ic.prototype.constructor=Ic;Sb.prototype=Object.create(Ha(Ab).prototype);Sb.prototype.constructor=Sb;Zc.prototype=Object.create(Ha(Ab).prototype);Zc.prototype.constructor=Zc;Jc.prototype=Object.create(Eb.prototype);Jc.prototype.constructor=Jc;Jc.CPBrushPreview=function(a){function c(){f.clearRect(0,0,n.width,n.height);f.beginPath();f.arc(n.width/2,n.height/2,g/2*window.devicePixelRatio,0,2*Math.PI);f.stroke()}function d(l){let k=n.getBoundingClientRect();var h=l.clientX-k.left-n.clientWidth/2;l=l.clientY-
k.top-n.clientHeight/2;h=Math.max(1,Math.min(200,Math.round(2*Math.sqrt(h*h+l*l))));c();a.setBrushSize(h)}function b(l){e&&(e=!1,document.removeEventListener("pointerup",b,{passive:!0,capture:!1}),document.removeEventListener("pointermove",d,{passive:!0,capture:!1}))}let g=16,n=document.createElement("canvas"),f=n.getContext("2d"),e=!1;n.addEventListener("pointerdown",function(l){e||(e=!0,document.addEventListener("pointerup",b,{passive:!0,capture:!1}),document.addEventListener("pointermove",d,{passive:!0,
capture:!1}),d(l))});this.getElement=function(){return n};a.on("toolChange",function(l,k){k.size!=g&&(g=k.size,c())});n.width=64;n.height=64;1<window.devicePixelRatio&&(n.style.width=n.width+"px",n.style.height=n.height+"px",n.width*=window.devicePixelRatio,n.height*=window.devicePixelRatio);n.className="chickenpaint-brush-preview";f.strokeStyle="black";f.lineWidth=+window.devicePixelRatio;c()};sd.prototype=Object.create(Eb.prototype);sd.prototype.constructor=sd;td.prototype=Object.create(Eb.prototype);
td.prototype.constructor=td;ud.prototype=Object.create(Eb.prototype);ud.prototype.constructor=ud;vd.prototype=Object.create(Ha(Ab).prototype);vd.prototype.constructor=vd;let Xe=[{name:"File",mnemonic:"F",children:[{name:"Save to my computer",action:"CPSave",mnemonic:"S",shortcut:"ctrl+s"},{name:"Save Oekaki",action:"CPSend",mnemonic:"S",shortcut:"ctrl+s"}]},{name:"Edit",mnemonic:"E",children:[{name:"Undo",action:"CPUndo",mnemonic:"U",shortcut:"ctrl+z"},{name:"Redo",action:"CPRedo",mnemonic:"R",shortcut:"ctrl+y"},
{name:"Clear history",action:"CPClearHistory",mnemonic:"H",title:S("Removes all undo/redo information to regain memory")},{name:"-"},{name:"Cut",action:"CPCut",mnemonic:"T",shortcut:"ctrl+x"},{name:"Copy",action:"CPCopy",mnemonic:"C",shortcut:"ctrl+c"},{name:"Copy merged",action:"CPCopyMerged",mnemonic:"Y",shortcut:"shift+ctrl+c"},{name:"Paste",action:"CPPaste",mnemonic:"P",shortcut:"ctrl+v"},{name:"-"},{name:"Select all",action:"CPSelectAll",mnemonic:"A",shortcut:"ctrl+a"},{name:"Deselect",action:"CPDeselectAll",
mnemonic:"D",shortcut:"ctrl+d"},{name:"-"},{name:"Transform",action:"CPTransform",mnemonic:"T",shortcut:"ctrl+h"}]},{name:"Layers",mnemonic:"L",children:[{name:"Duplicate",action:"CPLayerDuplicate",mnemonic:"D",shortcut:"shift+ctrl+d"},{name:"-"},{name:"Merge down",action:"CPLayerMergeDown",mnemonic:"E",shortcut:"ctrl+e"},{name:"Merge group",action:"CPGroupMerge",mnemonic:"G",shortcut:"shift+ctrl+g"},{name:"Merge all layers",action:"CPLayerMergeAll",shortcut:"shift+ctrl+e",mnemonic:"A"},{name:"-"},
{hideIfNotAvailable:!0,name:"Add layer mask",action:"CPAddLayerMask"},{hideIfNotAvailable:!0,name:"Delete layer mask",action:"CPRemoveLayerMask",shortcut:"shift+m"},{hideIfNotAvailable:!0,name:"Apply layer mask",action:"CPApplyLayerMask",shortcut:"ctrl+m"},{name:"-"},{hideIfNotAvailable:!0,name:"Clip to the layer below",action:"CPCreateClippingMask"},{hideIfNotAvailable:!0,name:"Unclip from the layer below",action:"CPReleaseClippingMask"}]},{name:"Effects",mnemonic:"E",children:[{name:"Clear",action:"CPClear",
mnemonic:"D",shortcut:"del,backspace"},{name:"Fill",action:"CPFill",mnemonic:"F",shortcut:"ctrl+f"},{name:"Flip horizontal",action:"CPHFlip",mnemonic:"H",shortcut:"h"},{name:"Flip vertical",action:"CPVFlip",mnemonic:"V"},{name:"Invert",action:"CPFXInvert",mnemonic:"I",shortcut:"ctrl+i",title:S("Invert the image colors")},{name:"-"},{name:"Convert brightness to opacity",action:"CPBrightnessToOpacity",mnemonic:"B",title:S("Convert brightness to opacity")},{name:"-"},{name:"Box blur...",action:"CPFXBoxBlur",
mnemonic:"B"},{name:"-"},{name:"Monochromatic noise",action:"CPMNoise",mnemonic:"M",title:S("Fills the selection with noise")},{name:"Color noise",action:"CPCNoise",mnemonic:"C",title:S("Fills the selection with colored noise")}]},{name:"View",mnemonic:"V",children:[{name:"Full-screen mode",action:"CPFullScreen",mnemonic:"F",checkbox:!0,checked:!1},{name:"-"},{name:"Zoom in",action:"CPZoomIn",mnemonic:"I",shortcut:"="},{name:"Zoom out",action:"CPZoomOut",mnemonic:"O",shortcut:"-"},{name:"Zoom 100%",
action:"CPZoom100",mnemonic:"1",shortcut:"ctrl+0"},{action:"CPLinearInterpolation",name:"-"},{name:"Smooth-out zoomed canvas",action:"CPLinearInterpolation",mnemonic:"L",title:S("Linear interpolation is used to give a smoothed looked to the picture when zoomed in"),checkbox:!0,checked:!0},{name:"-"},{name:"Show grid",action:"CPToggleGrid",mnemonic:"G",shortcut:"ctrl+g",checkbox:!0,checked:!1},{name:"Grid options...",action:"CPGridOptions",mnemonic:"D"}]},{name:"Palettes",mnemonic:"P",children:[{name:"Rearrange",
action:"CPArrangePalettes",title:S("Rearrange the palette windows")},{name:"Toggle palettes",action:"CPTogglePalettes",mnemonic:"P",shortcut:"tab",title:S("Hides or shows all palettes")},{name:"-"},{name:"Show tools",action:"CPPalTool",mnemonic:"T",checkbox:!0,checked:!0},{name:"Show color",action:"CPPalColor",mnemonic:"C",checkbox:!0,checked:!0},{name:"Show stroke",action:"CPPalStroke",mnemonic:"S",checkbox:!0,checked:!0},{name:"Show misc",action:"CPPalMisc",mnemonic:"M",checkbox:!0,checked:!0},
{name:"Show swatches",action:"CPPalSwatches",mnemonic:"W",checkbox:!0,checked:!0},{name:"Show textures",action:"CPPalTextures",mnemonic:"X",checkbox:!0,checked:!0},{name:"Show tool options",action:"CPPalBrush",mnemonic:"B",checkbox:!0,checked:!0},{name:"Show layers",action:"CPPalLayers",mnemonic:"L",checkbox:!0,checked:!0}]},{name:"Help",mnemonic:"H",children:[{name:"Tablet support",mnemonic:"T",action:"CPTabletSupport"},{name:"Shortcuts",mnemonic:"S",action:"CPShortcuts"},{name:"-"},{name:"About",
mnemonic:"A",action:"CPAbout"}]}];wd.prototype=Object.create(Ha(Ab).prototype);wd.prototype.constructor=wd;xd.prototype=Object.create(Ha(Ab).prototype);xd.prototype.constructor=xd;let Ye=navigator.userAgent.toLowerCase().includes("mac os")?"\u2318":"Ctrl";Kc.getRef=function(){return null==Kc.instance&&(Kc.instance=new Kc),Kc.instance};window.onWacomPluginLoaded=function(){Kc.getRef().pluginLoaded()};yd.prototype=Object.create(Ha(Ab).prototype);yd.prototype.constructor=yd;let hc={toolbarStyle:"new"};
class mg extends Ha(Ab){setDefaults(){for(let a in hc)hc.hasOwnProperty(a)&&this.set(a,hc[a])}load(){let a={};try{a=JSON.parse(localStorage.getItem("chickenpaint-prefs"))}catch(c){console.error(c)}for(let c in a&&"object"==typeof a||(a={}),hc)if(hc.hasOwnProperty(c))try{this.set(c,a.hasOwnProperty(c)?a[c]:hc[c])}catch(d){console.error(d)}}save(){try{let a=!1;for(let c in hc)if(hc.hasOwnProperty(c)&&this[c]!=hc[c]){a=!0;break}a?localStorage.setItem("chickenpaint-prefs",JSON.stringify({toolbarStyle:this.toolbarStyle})):
localStorage.removeItem("chickenpaint-prefs")}catch(a){console.error(a)}}set(a,c){this[a]=c;this.emitEvent(a,[c])}get(a){return this[a]}constructor(){super();Nb(this,"toolbarStyle",void 0);this.setDefaults()}}window.PointerEvent&&(window.hasNativePointerEvents=!0);Y.prototype=Object.create(Ha(Ab).prototype);Y.prototype.constructor=Y;Y.UnsupportedBrowserException=function(a){this.message=a};Y.UnsupportedBrowserException.prototype.toString=function(){let a="Sorry, your web browser does not support ChickenPaint.";
return this.message?a+=" "+this.message:a+=" Please try a modern browser like Chrome, Safari, Firefox, or Edge.",a};Y.M_DRAW=0;Y.M_FLOODFILL=1;Y.M_RECT_SELECTION=2;Y.M_MOVE_TOOL=3;Y.M_ROTATE_CANVAS=4;Y.M_COLOR_PICKER=5;Y.M_GRADIENTFILL=6;Y.M_TRANSFORM=7;Y.M_PAN_CANVAS=8;Y.T_PENCIL=0;Y.T_ERASER=1;Y.T_PEN=2;Y.T_SOFTERASER=3;Y.T_AIRBRUSH=4;Y.T_DODGE=5;Y.T_BURN=6;Y.T_WATER=7;Y.T_BLUR=8;Y.T_SMUDGE=9;Y.T_BLENDER=10;Y.T_MAX=11;Y.COLOR_MODE_RGB=0;Y.COLOR_MODE_GREYSCALE=1;window.ChickenPaint=Y}();
